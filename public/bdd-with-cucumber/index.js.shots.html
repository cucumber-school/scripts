<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Matt Wynne">
<title>BDD with Cucumber (JavaScript)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>BDD with Cucumber (JavaScript)</h1>
<div class="details">
<span id="author" class="author">Matt Wynne</span><br>
<span id="email" class="email"><a href="mailto:matt@cucumber.io">matt@cucumber.io</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_discovering_bdd">1. Discovering BDD</a></li>
<li><a href="#_your_first_scenario">2. Your first Scenario</a>
<ul class="sectlevel2">
<li><a href="#_an_introduction_to_shouty">2.1. An introduction to Shouty</a></li>
<li><a href="#_choose_the_first_scenario">2.2. Choose the first scenario</a></li>
<li><a href="#_install_cucumber">2.3. Install Cucumber</a></li>
<li><a href="#_add_a_scenario_wire_it_up">2.4. Add a scenario, wire it up</a></li>
<li><a href="#_sketch_out_the_solution">2.5. Sketch out the solution</a></li>
<li><a href="#_make_the_scenario_pass">2.6. Make the scenario pass</a></li>
</ul>
</li>
<li><a href="#_expressing_yourself">3. Expressing yourself</a>
<ul class="sectlevel2">
<li><a href="#_cucumber_expressions_not_regular_expressions">3.1. Cucumber expressions not regular expressions</a></li>
<li><a href="#_literal_expressions">3.2. Literal expressions</a></li>
<li><a href="#_capturing_parameters">3.3. Capturing parameters</a></li>
<li><a href="#_flexibility">3.4. Flexibility</a></li>
<li><a href="#_custom_parameters">3.5. Custom parameters</a></li>
</ul>
</li>
<li><a href="#_cleaning_up">4. Cleaning up</a>
<ul class="sectlevel2">
<li><a href="#_the_importance_of_readability">4.1. The importance of readability</a></li>
<li><a href="#_review_changes_that_happened_while_we_were_away">4.2. Review changes that happened while we were away</a></li>
<li><a href="#_description_field">4.3. Description field</a></li>
<li><a href="#_the_before_hook">4.4. The "Before" hook</a></li>
<li><a href="#_create_person_in_a_generic_stepdef">4.5. Create Person in a generic stepdef</a></li>
<li><a href="#_backgrounds">4.6. Backgrounds</a></li>
</ul>
</li>
<li><a href="#_loops">5. Loops</a>
<ul class="sectlevel2">
<li><a href="#_removing_redundant_scenarios">5.1. Removing redundant scenarios</a></li>
<li><a href="#_incidental_details">5.2. Incidental details</a></li>
<li><a href="#_refactoring_to_data_tables">5.3. Refactoring to Data Tables</a></li>
<li><a href="#_deeper_into_data_tables">5.4. Deeper into Data Tables</a></li>
<li><a href="#_docstring">5.5. DocString</a></li>
<li><a href="#_tdd_loops">5.6. TDD Loops</a></li>
</ul>
</li>
<li><a href="#_working_with_cucumber">6. Working with Cucumber</a>
<ul class="sectlevel2">
<li><a href="#_basic_filtering">6.1. Basic Filtering</a></li>
<li><a href="#_filtering_with_tags">6.2. Filtering With Tags</a></li>
<li><a href="#_more_control">6.3. More Control</a></li>
<li><a href="#_formatter_plugins">6.4. Formatter plugins</a></li>
<li><a href="#_publishing_results">6.5. Publishing Results</a></li>
</ul>
</li>
<li><a href="#_details">7. Details</a>
<ul class="sectlevel2">
<li><a href="#_premium_accounts_with_a_bug">7.1. Premium Accounts! With a bug!</a></li>
<li><a href="#_clarifying_the_rules">7.2. Clarifying the rules</a></li>
<li><a href="#_keeping_your_scenarios_brief">7.3. Keeping your scenarios BRIEF</a></li>
<li><a href="#_distilling_the_essence">7.4. Distilling the essence</a></li>
<li><a href="#_expressing_the_rules_capturing_questions">7.5. Expressing the rules, capturing questions</a></li>
<li><a href="#_conclusion">7.6. Conclusion</a></li>
</ul>
</li>
<li><a href="#_example_mapping">8. Example Mapping</a>
<ul class="sectlevel2">
<li><a href="#_example_mapping_why">8.1. Example Mapping: Why?</a></li>
<li><a href="#_example_mapping_how">8.2. Example Mapping: How?</a></li>
<li><a href="#_example_mapping_conclusions">8.3. Example Mapping: Conclusions</a></li>
</ul>
</li>
<li><a href="#_support_code">9. Support Code</a>
<ul class="sectlevel2">
<li><a href="#_problem_and_solution_domains">9.1. Problem and Solution Domains</a></li>
<li><a href="#_layers_of_a_cucumber_test_suite">9.2. Layers of a Cucumber Test Suite</a></li>
<li><a href="#_test_all_the_time">9.3. Test all the time</a></li>
<li><a href="#_extracting_support_code">9.4. Extracting Support Code</a></li>
<li><a href="#_organizing_step_definitions_into_multiple_files">9.5. Organizing step definitions into multiple files</a></li>
</ul>
</li>
<li><a href="#_acceptance_tests_vs_unit_tests">10. Acceptance Tests vs Unit Tests</a>
<ul class="sectlevel2">
<li><a href="#_tidy_up_the_bug_report_gherkin">10.1. Tidy up the bug report Gherkin</a></li>
<li><a href="#_testing_ice_cream_cone">10.2. Testing ice cream cone</a></li>
<li><a href="#_retrofit_unit_test">10.3. Retrofit unit test</a></li>
<li><a href="#_tdd_our_fix_with_a_unit_test">10.4. TDD our fix with a unit test</a></li>
<li><a href="#_another_edge_case">10.5. Another edge case</a></li>
<li><a href="#_re_balancing_our_test_suite">10.6. Re-balancing our test suite</a></li>
</ul>
</li>
<li><a href="#_epilogue">11. Epilogue</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_discovering_bdd">1. Discovering BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The script for this chapter is currently in <a href="https://docs.google.com/document/d/1S8eX3lz8-Ys9v94id9atFcX70hpi6XUoBaE5d6jsbHs/edit">Google Docs</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_your_first_scenario">2. Your first Scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The video and audio assets for this chapter are <a href="https://drive.google.com/drive/u/2/folders/1He7stdn0S-zIlNmWF-d1ISuyhfC7tMwO">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_an_introduction_to_shouty">2.1. An introduction to Shouty</h3>
<div class="paragraph">
<p>Shouty is a social network that allows people who are physically close to communicate, just like people have always communicated with their voices. In the real world you can talk to someone in the same room, or across the street. Or even 100 m away from you in a park - if you shout.</p>
</div>
<div class="paragraph">
<p>That’s Shouty. What you say on this social network can only be “heard” by people who are nearby.</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://drive.google.com/uc?id=185INaLm9jKvAZqvm-CzqpkfSyGt3C_kb" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1coTuZC_HcN3RXfduRqnZMfzlYJStQ2hq" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_choose_the_first_scenario">2.2. Choose the first scenario</h3>
<div class="paragraph">
<p>Let’s start with a very basic example of Shouty’s behaviour. Something we might have discussed in a three amigos meeting:</p>
</div>
<div class="paragraph">
<p>Sean the shouter shouts "free bagels at Sean&#8217;s" and Lucy the listener who happens to be stood across the street from his store, 15 metres away, hears him. She walks into Sean’s Coffee and takes advantage of the offer.</p>
</div>
<div class="paragraph">
<p><a href="#shot-563" id="shot-563" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
We can translate this into a Gherkin scenario so that Cucumber can run it. Here&#8217;s how that would look.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kn">Scenario</span><span class="p">:</span> Listener is within range
  <span class="nf">Given </span>Lucy is located 15m from Sean
  <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
  <span class="nf">Then </span>Lucy hears Sean’s message</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see there are four special keywords being used here. <code>Scenario</code> just tells Cucumber we’re about to describe an example that it can execute. Then you see the lines beginning with Given, When and Then.</p>
</div>
<div class="paragraph">
<p><a href="#shot-564" id="shot-564" title="Highlight line 2" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Highlight line 2</a>
<code>Given</code> is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</div>
<div class="paragraph">
<p><a href="#shot-565" id="shot-565" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a>
<code>When</code> is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</div>
<div class="paragraph">
<p><a href="#shot-566" id="shot-566" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
<code>Then</code> is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</div>
<div class="paragraph">
<p>You’ll notice we’ve omitted from our outcome anything about Lucy walking into Sean’s store and making a purchase. Remember, Gherkin is supposed to describe the behaviour of the system, so it would be distracting to have it in our scenario.</p>
</div>
<div class="paragraph">
<p>Each scenario has these three ingredients:
<a href="#shot-567" id="shot-567" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a>
  a context,
<a href="#shot-568" id="shot-568" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a>
  an action,
<a href="#shot-569" id="shot-569" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a>
  and one or more outcomes.</p>
</div>
<div class="paragraph">
<p>Together, they describe one single aspect of the behaviour of the system. An example.</p>
</div>
<div class="paragraph">
<p>Now that we’ve translated our example into Gherkin, we can automate it!</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions">2.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_whats_an_advantage_of_using_gherkin_to_express_our_examples_in_bdd_choose_one">What’s an advantage of using  Gherkin to express our examples in BDD? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>We can get Cucumber to test whether the code does what the scenario describes.</p>
</li>
<li>
<p>We can easily automate tests even if we don&#8217;t know much about programming.</p>
</li>
<li>
<p>We can use tools to generate the scenarios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Gherkin is just one way of expressing examples of how you want your system to behave. The advantage of using this particular format is that you can use Cucumber to test them for you, making them into Living Documentation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_these_are_gherkin_keywords_choose_multiple">Which of these are Gherkin keywords? (choose multiple)::</h5>
<div class="ulist">
<ul>
<li>
<p>Scenario</p>
</li>
<li>
<p>Story</p>
</li>
<li>
<p>Given</p>
</li>
<li>
<p>Only</p>
</li>
<li>
<p>If</p>
</li>
<li>
<p>When</p>
</li>
<li>
<p>Before</p>
</li>
<li>
<p>Then</p>
</li>
<li>
<p>While</p>
</li>
<li>
<p>Check</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We’ve introduced four Gherkin keywords so far:
  * <code>Scenario</code> tells Cucumber we’re about to describe an example that it can execute.
  * <code>Given</code>, <code>When</code> and <code>Then</code> identify the steps of the scenario.
There are a few other keywords which will be introduced later in the course.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_gherkin_keywords_given_when_and_then_allow_us_to_express_three_different_components_of_a_scenario_which_of_these_statements_correctly_describes_how_each_of_these_keywords_should_be_used_choose_multiple">The Gherkin keywords Given, When and Then, allow us to express three different components of a scenario. Which of these statements correctly describes how each of these keywords should be used? (Choose multiple)::</h5>
<div class="ulist">
<ul>
<li>
<p>Given describes something that has already happened before the interesting part of the scenario starts. (Correct)</p>
</li>
<li>
<p>Then describes an action you want to take.</p>
</li>
<li>
<p>When explains what should happen at the end of the scenario.</p>
</li>
<li>
<p>Then explains what should happen at the end of the scenario. (Correct)</p>
</li>
<li>
<p>When expresses an action that changes the state of the system. (Correct)</p>
</li>
<li>
<p>Given describes the context in which the scenario occurs. (Correct)</p>
</li>
<li>
<p>Explanation:</p>
</li>
<li>
<p>Given is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</li>
<li>
<p>When is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</li>
<li>
<p>Then is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
<strong>Given</strong> is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</div>
<div class="paragraph">
<p><strong>When</strong> is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</div>
<div class="paragraph">
<p><strong>Then</strong> is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_our_scenario_not_mention_anything_about_lucy_walking_into_seans_store_and_making_a_purchase">Why did our scenario not mention anything about Lucy walking into Sean’s store and making a purchase?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s a business goal which does not belong in a Gherkin document.</p>
</li>
<li>
<p>As BDD practitioners, we&#8217;re focussed on the behaviour of the system, so we don&#8217;t care about the people who use the software.</p>
</li>
<li>
<p>Including details about these two people would be distracting from the main point of our scenario.</p>
</li>
<li>
<p>Executable scenarios need to stay focussed on the behaviour of the system itself. We can document business goals elsewhere in our Gherkin to provide context. - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Behaviour-Driven Development practitioners definitely do care about business goals, but when we&#8217;re writing the Scenario part of our Gherkin, we need to focus on the observable, testable behaviour of the system we&#8217;re building.</p>
</div>
<div class="paragraph">
<p>Later in the course we&#8217;ll show you how you can use other parts of Gherkin documents to add other relevant details, like business goals, to make great executable specifications.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_cucumber">2.3. Install Cucumber</h3>
<div class="paragraph">
<p><a href="#shot-570" id="shot-570" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
Before we get started make sure you have a modern version of NodeJs,
<a href="#shot-571" id="shot-571" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a>
and NPM installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>node <span class="nt">-v</span>
<span class="nv">$ </span>npm <span class="nt">-v</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see an error message when you run these commands, you’ll need to fix your Node installation.</p>
</div>
<div class="paragraph">
<p><a href="#shot-572" id="shot-572" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a>
Go back to the command prompt and create a new directory for our project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>shouty</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-573" id="shot-573" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
Go use cd to go into that directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>shouty</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-574" id="shot-574" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a>
First we’ll create a <code>package.json</code> that describes the NPM packages we need for our project
<a href="#shot-575" id="shot-575" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> <a href="#shot-576" id="shot-576" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a>
and add the <code>@cucumber/cucumber</code> package to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm init <span class="nt">-y</span>
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-D</span> @cucumber/cucumber</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-577" id="shot-577" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a>
We can now run  the <code>cucumber-js</code> command to see if everything works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>./node_modules/.bin/cucumber-js</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s no output, because we haven&#8217;t written any scenarios yet, but there are no errors either! Having to remember the full path to Cucumber is not very user friendly, but luckily there&#8217;s a nicer way.</p>
</div>
<div class="paragraph">
<p><a href="#shot-578" id="shot-578" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a>
Edit <code>package.json</code> and change the <code>test</code> line under the <code>scripts</code> from it&#8217;s default to <code>cucumber-js</code> <a href="#shot-579" id="shot-579" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cucumber-js</span><span class="dl">"</span>
  <span class="p">},</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-580" id="shot-580" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a>
Now we’re ready! If we run <code>npm test</code> at this point, we’ll again see cucumber pass with no errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty-js@1.0.0 <span class="nb">test</span> /home/fedex/cucumber/shouty-js
<span class="o">&gt;</span> cucumber-js

<span class="o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we&#8217;re going to install <code>hamjest</code> in order to have more expressive assertions <a href="#shot-581" id="shot-581" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a><a href="#shot-582" id="shot-582" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-D</span> hamjest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Good, we&#8217;ve installed Cucumber. Now we need to write our specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_scenario_wire_it_up">2.4. Add a scenario, wire it up</h3>
<div class="paragraph">
<p><a href="#shot-583" id="shot-583" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
We need to create a <code>features</code> directory. This is the conventional place to store your Gherkin specifications.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>features</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-584" id="shot-584" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a>
Now we’re ready to create our first feature file. Call the file <code>hear_shout.feature</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">touch </span>features/hear_shout.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>All feature files start with the keyword <code>Feature:</code> <a href="#shot-585" id="shot-585" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> followed by a name. <a href="#shot-586" id="shot-586" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
It’s a good convention to give it a name that matches the file name.</p>
</div>
<div class="paragraph">
<p>Now let’s write out our first scenario.</p>
</div>
<div class="paragraph">
<p>This is the one where the listener is within range, <a href="#shot-587" id="shot-587" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> Lucy is located 15 metres from Sean, <a href="#shot-588" id="shot-588" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> Sean shouts "free bagels at Sean&#8217;s", <a href="#shot-589" id="shot-589" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> Lucy hears Sean&#8217;s message. <a href="#shot-590" id="shot-590" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file, switch back to the command-prompt and run <code>npm test</code>. <a href="#shot-591" id="shot-591" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-592" id="shot-592" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a>
The first thing we notice is a big green box right at the end of the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">┌──────────────────────────────────────────────────────────────────────────┐
│ Share your Cucumber Report with your team at https://reports.cucumber.io │
│                                                                          │
│ Command line option:    <span class="nt">--publish</span>                                        │
│ Environment variable:   <span class="nv">CUCUMBER_PUBLISH_ENABLED</span><span class="o">=</span><span class="nb">true</span>                    │
│                                                                          │
│ More information at https://reports.cucumber.io/docs/cucumber-js         │
│                                                                          │
│ To disable this message, add this to your ./cucumber.js:                 │
│ module.exports <span class="o">=</span> <span class="o">{</span> default: <span class="s1">'--publish-quiet'</span> <span class="o">}</span>                          │
└──────────────────────────────────────────────────────────────────────────┘</code></pre>
</div>
</div>
<div class="paragraph">
<p>We don&#8217;t want this warning to distract us right now, so we&#8217;ll follow the instructions mentioned at the end of the warning and add the "publish-quiet" option&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;to the <code>cucumber.js</code> file.<a href="#shot-593" id="shot-593" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a><a href="#shot-594" id="shot-594" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a></p>
</div>
<div class="paragraph">
<p>Now when we run cucumber again, the warning isn&#8217;t there anymore. <a href="#shot-595" id="shot-595" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="paragraph">
<p>You’ll see Cucumber has found our feature file and read it back to us. We can see a summary of the results at the bottom: one scenario,<a href="#shot-596" id="shot-596" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a> three steps - all undefined.<a href="#shot-597" id="shot-597" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

UUU

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15 metres from Sean
       Undefined. Implement with the following snippet:

         Given<span class="o">(</span><span class="s1">'Lucy is located {int} metres from Sean'</span>, <span class="k">function</span> <span class="o">(</span>int<span class="o">)</span> <span class="o">{</span>
         // Given<span class="o">(</span><span class="s1">'Lucy is located {float} metres from Sean'</span>, <span class="k">function</span> <span class="o">(</span>float<span class="o">)</span> <span class="o">{</span>
           // Write code here that turns the phrase above into concrete actions
           <span class="k">return</span> <span class="s1">'pending'</span><span class="p">;</span>
         <span class="o">})</span><span class="p">;</span>

   ? When Sean shouts <span class="s2">"free bagels at Sean's"</span>
       Undefined. Implement with the following snippet:

         When<span class="o">(</span><span class="s1">'Sean shouts {string}'</span>, <span class="k">function</span> <span class="o">(</span>string<span class="o">)</span> <span class="o">{</span>
           // Write code here that turns the phrase above into concrete actions
           <span class="k">return</span> <span class="s1">'pending'</span><span class="p">;</span>
         <span class="o">})</span><span class="p">;</span>

   ? Then Lucy hears Sean<span class="s1">'s message
       Undefined. Implement with the following snippet:

         Then('</span>Lucy hears Sean<span class="se">\'</span>s message<span class="s1">', function () {
           // Write code here that turns the phrase above into concrete actions
           return '</span>pending<span class="s1">';
         });


1 scenario (1 undefined)
3 steps (3 undefined)
0m00.006s (executing steps: 0m00.000s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Undefined</em>` means Cucumber doesn’t know what to do for any of the three steps we wrote in our Gherkin scenario. It needs us to provide some <em>step definitions</em>.</p>
</div>
<div class="paragraph">
<p><a href="#shot-598" id="shot-598" title="02.04.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: 02.04.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>Step definitions translate from the plain language you use in Gherkin into JavaScript code.</p>
</div>
<div class="paragraph">
<p>When Cucumber runs a step, it looks for a step definition that matches the text in the step. If it finds one, then it executes the code in the step definition.</p>
</div>
<div class="paragraph">
<p>If it doesn’t find one… well, you’ve just seen what happens. Cucumber helpfully prints out some code snippets that we can use as a basis for new step definitions.</p>
</div>
<div class="paragraph">
<p>Let’s copy those to create our first step definitions. <a href="#shot-599" id="shot-599" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-600" id="shot-600" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18</a><a href="#shot-601" id="shot-601" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19</a><a href="#shot-602" id="shot-602" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20</a>
We’ll paste them into a JavaScript file under a new directory called <code>step_definitions</code> underneath the <code>features</code> directory. I’ll just call it <code>steps.js</code>.</p>
</div>
<div class="paragraph">
<p>We need to import the <code>Given</code>, <a href="#shot-603" id="shot-603" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21</a> <code>When</code> <a href="#shot-604" id="shot-604" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22</a> and <code>Then</code> <a href="#shot-605" id="shot-605" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23</a> keywords from the <code>cucumber</code> package.<a href="#shot-606" id="shot-606" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-607" id="shot-607" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25</a>
Now we run Cucumber again.</p>
</div>
<div class="paragraph">
<p>This time the output is a little different. We now have a pending step <a href="#shot-608" id="shot-608" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26</a> and two skipped ones.<a href="#shot-609" id="shot-609" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 27</a> This means Cucumber found all our step definitions, and executed the first one.</p>
</div>
<div class="paragraph">
<p><a href="#shot-610" id="shot-610" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 28</a>
But that first step definition returns <code>'pending'</code>, which causes Cucumber to stop, skip the rest of the steps, and mark the scenario as pending.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

P--

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:3</span>
       Pending
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:8</span>
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:13

1 scenario (1 pending)
3 steps (1 pending, 2 skipped)
0m00.007s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve wired up our step definitions to the Gherkin steps, it&#8217;s almost time to start working on our solution. First though, let&#8217;s tidy up the generated code.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll rename the <code>int</code> parameter to something that better reflects its meaning. Let&#8217;s call it <code>distance</code>.<a href="#shot-611" id="shot-611" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 29</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-612" id="shot-612" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 30</a>
And we can print it to the terminal to see the captured result</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">distance</span><span class="p">);</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">;</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-613" id="shot-613" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 31</a>
If we run <code>cucumber</code> again on our terminal, we can see the number 15 pop up in the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

15
P--

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:3</span>
       Pending
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:8</span>
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:13

1 scenario (1 pending)
3 steps (1 pending, 2 skipped)
0m00.009s (executing steps: 0m00.002s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the number 15 does not appear anywhere in our code. The value is automatically passed from the Gherkin step to the step definition. If you&#8217;re curious, that’s the <a href="#shot-614" id="shot-614" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 32</a><code>{int}</code> in the step definition pattern or <em>cucumber expression</em>. We’ll explain these patterns in detail in a future lesson.</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions">2.4.1. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_what_do_step_definitions_do_choose_one">What do step definitions do? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>Provide a glossary of domain terms for your stakeholders</p>
</li>
<li>
<p>Give Cucumber/SpecFlow a way to automate your gherkin steps - TRUE</p>
</li>
<li>
<p>Add extra meaning to our Gherkin steps</p>
</li>
<li>
<p>Generate code from gherkin documents</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
&lt;java&gt;
Step definitions are Java methods that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the method to run it.
&lt;/java&gt;</p>
</div>
<div class="paragraph">
<p>&lt;js&gt;
Step definitions are JavaScript functions that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the function.
&lt;/js&gt;</p>
</div>
<div class="paragraph">
<p>&lt;ruby&gt;
Step definitions are Ruby blocks that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will execute the code in the block.
&lt;/ruby&gt;</p>
</div>
<div class="paragraph">
<p>&lt;C#&gt;
Step definitions are C# methods that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, SpecFlow will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the method to run it.
&lt;/C#&gt;</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_it_mean_when_cucumberspecflow_says_a_step_is_pending_choose_one">What does it mean when Cucumber/SpecFlow says a step is Pending? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>The step took too long to execute and was terminated
&lt;java&gt; * The step threw a <code>PendingException</code>, meaning we&#8217;re still working on implementing that step.&lt;/java&gt;
&lt;js&gt; * The step returned pending, meaning we&#8217;re still working on implementing that step.&lt;/js&gt;
&lt;ruby&gt; * The step definition threw a Pending error, meaning we&#8217;re still working on implementing that step.&lt;/ruby&gt;
&lt;C#&gt; ASK GASPAR &lt;/C#&gt;</p>
</li>
<li>
<p>Cucumber/SpecFlow was unable to find the step definitions</p>
</li>
<li>
<p>The scenario is passing</p>
</li>
<li>
<p>The scenario is failing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>&lt;java&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a PendingException.</p>
</div>
<div class="paragraph">
<p>The PendingException is a special type of exception provided by Cucumber to allow the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that aren&#8217;t finished yet and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/java&gt;</p>
</div>
<div class="paragraph">
<p>&lt;js&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a Pending error.</p>
</div>
<div class="paragraph">
<p>This allows the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that are still being worked on and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/js&gt;</p>
</div>
<div class="paragraph">
<p>&lt;ruby&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a Pending error.</p>
</div>
<div class="paragraph">
<p>This allows the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that are still being worked on and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/ruby&gt;</p>
</div>
<div class="paragraph">
<p>&lt;C#&gt; ASK GASPAR &lt;/C#&gt;</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_might_you_want_to_consider_when_using_a_snippet_generated_by_cucumberspecflow">Which of the following might you want to consider when using a snippet generated by Cucumber/SpecFlow?</h5>
<div class="ulist">
<ul>
<li>
<p>Does the name of the method correctly describe the intent of the step? - TRUE</p>
</li>
<li>
<p>Do the parameter names correctly describe the meaning of the arguments? - TRUE</p>
</li>
<li>
<p>Does the snippet correctly automate the gherkin step as described? - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When Cucumber/SpecFlow generates a snippet, it has no idea of the business context of the undefined step. The implementation that Cucumber/SpecFlow generates will definitely not automate what&#8217;s been written in your Gherkin - that&#8217;s up to you! Also, the name of the method and the parameters are just placeholders. It&#8217;s the job of the person writing the code to rename the method and parameters to reflect the business domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="_whats_the_next_step_in_bdd_after_weve_pasted_in_the_step_definition_snippet_and_seen_it_fail_with_a_pending_status">What’s the next step in BDD after we’ve pasted in the step definition snippet and seen it fail with a <code>pending</code> status?</h5>
<div class="ulist">
<ul>
<li>
<p>Check with our project manager about the requirement</p>
</li>
<li>
<p>Implement some code that does what the Gherkin step describes - TRUE</p>
</li>
<li>
<p>Create a test framework for modelling our application</p>
</li>
<li>
<p>Run a manual test to check what the system does</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
If you read the comment in the generated snippet, Cucumber/SpecFlow is telling you to "turn the phrase above into concrete actions".</p>
</div>
<div class="paragraph">
<p>You need your step definition to call your application and do whatever the Gherkin step describes. In the case of our first step here, we want to tell the system that there are two people in certain locations.</p>
</div>
<div class="paragraph">
<p>We can use the act of fleshing out the body of our step definition as an opportunity to do some software design. We can think about what we want the interface to our system to look like, from the point of view of someone who needs to interact with it. Should we interact with it through the User Interface, or make a call to the programmer API directly? How would we like that interface to work?</p>
</div>
<div class="paragraph">
<p>We can do all of this without writing any implementation yet.</p>
</div>
<div class="paragraph">
<p>This is known as "outside-in" development. It helps us to ensure that when we do come to implementing our solution, we&#8217;re implementing it based on real needs.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sketch_out_the_solution">2.5. Sketch out the solution</h3>
<div class="paragraph">
<p><a href="#shot-615" id="shot-615" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
Now that we have the step definitions matching, we can start working on our solution. We like to use our scenarios to <em>guide</em> our development, so we&#8217;ll start designing the objects we&#8217;ll need by sketching out some code in our step definitions.</p>
</div>
<div class="paragraph">
<p>The scenario will be failing while we do this, but we should see the error messages gradually progressing as we drive out the interface to our object model.</p>
</div>
<div class="paragraph">
<p>Our next goal is for the scenario to fail because we need to implement the actual business logic. <em>Then</em> we can work on changing the business logic inside our objects to make it pass.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">distance</span><span class="p">);</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">;</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To implement the first step, we need to create a couple of <code>Person</code> objects,<a href="#shot-616" id="shot-616" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> with the specified distance between them. <a href="#shot-617" id="shot-617" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> We can remove the <code>pending</code> status now,<a href="#shot-618" id="shot-618" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> and this <code>console.log</code> statement,<a href="#shot-619" id="shot-619" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> and write the implementation for the first step like this:</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have two instances of person, one representing Lucy, <a href="#shot-620" id="shot-620" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a>and one representing Sean. <a href="#shot-621" id="shot-621" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a>Then we call a method to move Lucy to the position specified in the scenario.<a href="#shot-622" id="shot-622" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-623" id="shot-623" title="02.05.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: 02.05.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>To keep things simple, we&#8217;re going to assume all people are situated on a line: a one-dimensional co-ordinate system. We can always introduce proper geo-locations later. We&#8217;ll place Sean in the centre, and Lucy 15 metres away from Sean.</p>
</div>
<div class="paragraph">
<p>This might not be the design we&#8217;ll end up with once this is all working, but it&#8217;s a decent place to start.</p>
</div>
<div class="paragraph">
<p><a href="#shot-624" id="shot-624" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a>
If we run Cucumber, we’ll see a compilation error from JavaScript: we need to define our <code>Person</code> class.<a href="#shot-625" id="shot-625" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

F--

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✖ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:3</span>
       ReferenceError: Person is not defined
           at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:4:19<span class="o">)</span>
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:9</span>
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:14

1 scenario (1 failed)
3 steps (1 failed, 2 skipped)
0m00.011s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-626" id="shot-626" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a>
Let’s give our solution a home by creating a <code>src</code> directory.
<a href="#shot-627" id="shot-627" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a>
We’ll put our Shouty application in a JavaScript file called <code>shouty.js</code> in that directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>src
<span class="nv">$ </span><span class="nb">touch </span>src/shouty.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can  create an empty <code>Person</code> class, <a href="#shot-628" id="shot-628" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a> and export it.<a href="#shot-629" id="shot-629" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="title">src/shouty.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>

<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-630" id="shot-630" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16</a>
For now, we’ll just require the <code>Person</code> class from our <code>steps.js</code> file. In a later lesson we’ll talk more about how to organise this code a bit better.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty.js</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-631" id="shot-631" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a>
When we run the scenario, cucumber tells us that we&#8217;re missing the <code>moveTo</code> method on the <code>Person</code> class.<a href="#shot-632" id="shot-632" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

F--

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✖ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
       TypeError: this.lucy.moveTo is not a <span class="k">function
           </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:7:13<span class="o">)</span>
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:15

1 scenario (1 failed)
3 steps (1 failed, 2 skipped)
0m00.010s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-633" id="shot-633" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19</a>
We&#8217;ll add the method definition without implementing it yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the scenario again,<a href="#shot-634" id="shot-634" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20</a> the first step is green!<a href="#shot-635" id="shot-635" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

.P-

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ? When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
       Pending
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:15

1 scenario (1 pending)
3 steps (1 pending, 1 skipped, 1 passed)
0m00.009s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re making progress!</p>
</div>
<div class="paragraph">
<p>We&#8217;ll keep working like this until we see the scenario failing for the right reasons.</p>
</div>
<div class="paragraph">
<p>In the second step definition, we want to tell Sean to shout something.</p>
</div>
<div class="paragraph">
<p><a href="#shot-636" id="shot-636" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22</a>
In order to send instructions to Sean, we need to store him in an property, which we already have, so that he’ll be accessible from all of our step definitions.</p>
</div>
<div class="paragraph">
<p><a href="#shot-637" id="shot-637" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23</a>
In the <code>When</code> step, we&#8217;re capturing Sean&#8217;s message using the <code>{string}</code> pattern, and pass an argument to the function. <a href="#shot-638" id="shot-638" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24</a> We&#8217;ll call it <code>message</code>.<a href="#shot-639" id="shot-639" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-640" id="shot-640" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26</a>
And now we can now tell him to <em>shout</em> the message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-641" id="shot-641" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 27</a>
If we run Cucumber, it&#8217;s telling is that our <code>Person</code> class needs a <code>shout</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

.F-

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ✖ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
       TypeError: this.sean.shout is not a <span class="k">function
           </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:11:13<span class="o">)</span>
   - Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:14

1 scenario (1 failed)
3 steps (1 failed, 1 skipped, 1 passed)
0m00.009s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-642" id="shot-642" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 28</a>
Let’s not worry about the implementation yet. The most important thing right now is to discover the shape of our domain model.</p>
</div>
<div class="listingblock">
<div class="title">shouty.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And now the second step is green: <a href="#shot-643" id="shot-643" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 29</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

..P

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
   ? Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:14
       Pending

1 scenario (1 pending)
3 steps (1 pending, 2 passed)
0m00.009s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-644" id="shot-644" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 30</a>
The last step definition is where we implement a check, or assertion. We’ll verify that what Lucy has heard is exactly the same as what Sean shouted.</p>
</div>
<div class="paragraph">
<p><a href="#shot-645" id="shot-645" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 31</a>
Once again we’re are going to write the code we wish we had.</p>
</div>
<div class="paragraph">
<p>But before, we need to import <code>assertThat</code> <a href="#shot-646" id="shot-646" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 32</a> and <code>is</code> <a href="#shot-647" id="shot-647" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 33</a> from `hamjest`<a href="#shot-648" id="shot-648" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 34</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">//...</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we need a way to ask Lucy what messages she’s heard, and we also need to know what it was that Sean shouted.</p>
</div>
<div class="paragraph">
<p><a href="#shot-649" id="shot-649" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 35</a>
We can record what Sean shouts by storing it in the <code>this.message</code> property as the <code>When</code> step runs. This is a common pattern to use in Cucumber step definitions when you don’t want to repeat the same test data in different parts of a scenario. Now we can use that in the assertion check.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-650" id="shot-650" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 36</a>
We also need to add a <code>messagesHeard</code> method to our Person class. Let’s do that now, we&#8217;ll just return an empty array for now <a href="#shot-651" id="shot-651" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 37</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-652" id="shot-652" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 38</a>
&#8230;&#8203;and watch Cucumber run the tests again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

..F

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:5</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:11</span>
   ✖ Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:16
       AssertionError:
       Expected: is ["free bagels at Sean'</span>s<span class="s2">"]
            but: was []
           + expected - actual

           -[]
           +[
           +  "</span>free bagels at Sean<span class="s1">'s"
           +]

           at World.&lt;anonymous&gt; (/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:17:3)

1 scenario (1 failed)
3 steps (1 failed, 2 passed)
0m00.014s (executing steps: 0m00.004s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is great! Whenever we do BDD, getting to our first failing test is a milestone. Seeing the test fail proves that it is capable of detecting errors in our code!</p>
</div>
<div class="paragraph">
<p>Never trust an automated test that you haven’t seen fail!</p>
</div>
<div class="paragraph">
<p>Now all we have to do is write the code to make it do what it&#8217;s supposed to.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions">2.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_how_does_the_practice_writing_a_failing_test_before_implementing_the_solution_help_us">How does the practice writing a failing test before implementing the solution help us?</h5>
<div class="ulist">
<ul>
<li>
<p>Until you see a scenario fail, you can’t be sure that it can ever fail [true]</p>
</li>
<li>
<p>There’s no need to always see a scenario fail [false]</p>
</li>
<li>
<p>BDD practitioners use failing scenarios to guide their development [true]</p>
</li>
<li>
<p>A passing scenario implies the functionality it describes has already been implemented, so it may be a duplicate of an existing scenario [true]</p>
</li>
<li>
<p>BDD practitioners believe in learning from failure [false]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Behaviour-Driven Development comes from Test-Driven Development, where we always start with a failing test, then use that to guide our development. This sometimes described as red-green-refactor.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>red - write a scenario/test and see it fail
green - make it pass (as simply as possible)
refactor - improve your code, while keeping all the tests/scenarios green</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s surprisingly easy to write scenarios and step definitions that don&#8217;t do anything. It&#8217;s the transition from red to green that gives us confidence that the scenario and the implementation actually do what we expect.</p>
</div>
<div class="paragraph">
<p>If a scenario passes as soon as we write it, that means that either it&#8217;s not doing what we think it should or the behaviour that it describes has already been implemented. In that case, we&#8217;re not developing using behaviour-driven development.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_change_to_use_an_instance_variable_for_storing_each_person_select_one">Why did we change to use an instance variable for storing each Person? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>It ensures we can interact with the same object from different steps. [true]</p>
</li>
<li>
<p>It’s a better way to organise the code</p>
</li>
<li>
<p>It’s more efficient for performance</p>
</li>
<li>
<p>Cucumber/SpecFlow requires us to store our objects as instance variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
In Cucumber/SpecFlow, one of the ways to access the same instance of an object from different step definition methods, is to store it on an instance variable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_did_we_avoid_having_to_mention_the_detail_of_the_text_sean_had_shouted_in_our_when_and_then_steps_select_one">How did we avoid having to mention the detail of the text Sean had shouted in our When and Then steps? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>We duplicated the text inside our Person class</p>
</li>
<li>
<p>We used an instance variable to store the text that was shouted [true]</p>
</li>
<li>
<p>We called a method on the Person class to retrieve the messages heard</p>
</li>
<li>
<p>We passed the message text in from our Gherkin scenarios</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When you need to assert for a specific value coming out of your system in a Then step, you can use an instance variable to store it where it goes into the system (in a Given or When) step. This means you can avoid duplicating the value in multiple places in your code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_flow_should_we_follow_when_making_a_scenario_pass_select_one">Which flow should we follow when making a Scenario pass? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>Domain modelling &#8594; Write some code &#8594; Make it compile &#8594; Run the scenario &amp; watch it fail</p>
</li>
<li>
<p>Write some code &#8594; Domain modelling &#8594; Make it compile &#8594; Run the scenario</p>
</li>
<li>
<p>Write some code &#8594; Make it compile &#8594; Domain modelling &#8594; Run the scenario - TRUE</p>
</li>
<li>
<p>Domain modelling &#8594; Run the scenario &#8594; Write some code &#8594; Make it compile</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Our goal at this stage is to get to a failing test, where the only thing left to do to make it pass is make changes to the implementation of the app itself.</p>
</div>
<div class="paragraph">
<p>On an existing system, we might not need to create so much new code to get to this goal, but we might need to make some changes to how we call the system. This gives us an opportunity to do some lightweight domain modelling.</p>
</div>
<div class="paragraph">
<p>It may not compile first-time, so we implement the bare-bones of our solution until it does.</p>
</div>
<div class="paragraph">
<p>We use the scenarios to guide us in our implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_make_the_scenario_pass">2.6. Make the scenario pass</h3>
<div class="paragraph">
<p>So we have our failing scenario: <a href="#shot-653" id="shot-653" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

..F

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:5</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:11</span>
   ✖ Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:16
       AssertionError:
       Expected: is ["free bagels at Sean'</span>s<span class="s2">"]
            but: was []
           + expected - actual

           -[]
           +[
           +  "</span>free bagels at Sean<span class="s1">'s"
           +]

           at World.&lt;anonymous&gt; (/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:17:3)

1 scenario (1 failed)
3 steps (1 failed, 2 passed)
0m00.014s (executing steps: 0m00.003s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lucy is expected to hear Sean&#8217;s message, but she hasn&#8217;t heard anything: we got an empty Array back from the <code>messagesHeard</code> method.</p>
</div>
<div class="paragraph">
<p><a href="#shot-654" id="shot-654" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a>
In this case, we’re going to cheat. We have a one-line fix that will make this scenario pass, but it’s not a particularly future-proof implementation. Can you guess what it is?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I told you it wasn’t very future proof!</p>
</div>
<div class="paragraph">
<p><a href="#shot-655" id="shot-655" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

...

1 scenario <span class="o">(</span>1 passed<span class="o">)</span>
3 steps <span class="o">(</span>3 passed<span class="o">)</span>
0m00.010s <span class="o">(</span>executing steps: 0m00.002s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Woohoo! Our scenario is passing for the first time. As long as this is the only message anyone ever shouts, we&#8217;re good to ship this thing!</p>
</div>
<div class="paragraph">
<p>Now, the fact that such a poor implementation can pass our tests shows us that we need to work on our tests. A more comprehensive set of scenarios would force us to write a better implementation.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also a good habit to look for the most simple solution. We can trust that, as our scenarios evolve, so will our solution.</p>
</div>
<div class="paragraph">
<p>This is the essence of Behaviour-Driven Development. Examples of behaviour drive the development. We do just enough to make the next scenario pass, and no more.</p>
</div>
<div class="paragraph">
<p><a href="#shot-656" id="shot-656" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
Instead of writing a note on our TODO list, let&#8217;s write another scenario that shouts a different message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message
  
  <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-657" id="shot-657" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a>
It fails, reminding us we need to find a solution that doesn&#8217;t rely on hard-coding the message.
Now when we come back to this code, we can just run the tests and Cucumber will remind us what we need to do next. We’re done for today!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty-js/shouty
<span class="o">&gt;</span> cucumber-js

.....F

Failures:

1<span class="o">)</span> Scenario: Listener hears a different message <span class="c"># features/hear_shout.feature:7</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:5</span>
   ✔ When Sean shouts <span class="s2">"Free coffee!"</span> <span class="c"># features/step_definitions/steps.js:11</span>
   ✖ Then Lucy hears Sean<span class="s1">'s message # features/step_definitions/steps.js:16
       AssertionError:
       Expected: is ["Free coffee!"]
            but: was ["free bagels at Sean'</span>s<span class="s2">"]
           + expected - actual

            [
           -  "</span>free bagels at Sean<span class="s1">'s"
           +  "Free coffee!"
            ]

           at World.&lt;anonymous&gt; (/home/fedex/code/shouty-js/shouty/features/step_definitions/steps.js:17:3)

2 scenarios (1 failed, 1 passed)
6 steps (1 failed, 5 passed)
0m00.015s (executing steps: 0m00.004s)
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_questions">2.6.1. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>Why should we always make sure that we see a scenario fail before we make it pass? (select multiple) </em></p>
<div class="ulist">
<ul>
<li>
<p>Until you see a scenario fail, you can’t be sure that it can ever fail [true]</p>
</li>
<li>
<p>There’s no need to always see a scenario fail [false]</p>
</li>
<li>
<p>BDD practitioners use failing scenarios to drive their development [true]</p>
</li>
<li>
<p>A passing scenario implies the functionality it describes has already been implemented, so it may be a duplicate of an existing scenario [true]</p>
</li>
<li>
<p>BDD practitioners believe in learning from failure [false]</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Why did we change to use an instance variable for storing each Person? </em></p>
<div class="ulist">
<ul>
<li>
<p>It ensures we can interact with the same object from different steps. [true]</p>
</li>
<li>
<p>It’s a better way to organise the code</p>
</li>
<li>
<p>It’s more efficient for performance</p>
</li>
<li>
<p>Cucumber requires us to store our objects as instance variables.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>How did we avoid having to mention the detail of the text Sean had shouted in our When and Then steps? </em></p>
<div class="ulist">
<ul>
<li>
<p>We duplicated the text inside our Person class</p>
</li>
<li>
<p>We used an instance variable to store the text that was shouted [true]</p>
</li>
<li>
<p>We called a method on the Person class to retrieve the messages heard</p>
</li>
<li>
<p>We passed the message text in from our Gherkin scenarios</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Which flow should we follow when making a Scenario pass? </em></p>
<div class="ulist">
<ul>
<li>
<p>Domain modelling &#8594; Write some code &#8594; Make it compile &#8594; Run the scenario &amp; watch it fail</p>
</li>
<li>
<p>Write some code &#8594; Domain modelling &#8594; Make it compile &#8594; Run the scenario</p>
</li>
<li>
<p>Write some code &#8594; Make it compile &#8594; Domain modelling &#8594; Run the scenario</p>
</li>
<li>
<p>Domain modelling &#8594; Run the scenario &#8594; Write some code &#8594; Make it compile</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Why is our naive implementation of Person.getMessagesHeard, with a hard-coded message OK in BDD? (select multiple) </em></p>
<div class="ulist">
<ul>
<li>
<p>It shows us that we need better examples to pin down the behaviour we really want from the code. [correct]</p>
</li>
<li>
<p>We know we will iterate on our solution, when we come up with more examples of what we want it to do. [correct]</p>
</li>
<li>
<p>Nobody is using our solution yet [incorrect]</p>
</li>
<li>
<p>We have to do a bad implementation so we can see our test fail. [incorrect]</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Look at this diagram (1) Write a scenario, 2) Automate it and watch it fail, 3) Write just enough code to make it pass). Which stage are we at as the video ends? </em></p>
<div class="ulist">
<ul>
<li>
<p>1</p>
</li>
<li>
<p>2</p>
</li>
<li>
<p>3</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressing_yourself">3. Expressing yourself</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cucumber_expressions_not_regular_expressions">3.1. Cucumber expressions not regular expressions</h3>
<div class="paragraph">
<p><a href="#shot-658" id="shot-658" title="03.01.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 0.1: 03.01.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>In the previous chapter we explored the fundamental components of a Cucumber test suite, and how we use Cucumber to drive out a solution, test-first.</p>
</div>
<div class="paragraph">
<p>First we specified the behaviour we wanted, using a Gherkin scenario in a feature file. Then we wrote step definitions to translate the plain english from our scenario into concrete actions in code. Finally, we used the step definitions to guide us in building out our very basic domain model for the Shouty application.</p>
</div>
<div class="paragraph">
<p>We tend to think of the code that actually pokes around with the system as distinct from the step definitions, so we’ve drawn an extra box labelled "automation code" for this.</p>
</div>
<div class="paragraph">
<p>Automation code can do almost anything to your application: it can drive a web browser around your site, make HTTP requests to a REST API, or&#8201;&#8212;&#8201;as you’ve already seen&#8201;&#8212;&#8201;drive a domain model directly.</p>
</div>
<div class="paragraph">
<p>Automation code is a big topic that we’ll come back to. First, we want to concentrate on step definitions.
Good step definitions are important because they enable the <em>readability</em> of your scenarios. The better you are at matching plain language phrases from Gherkin, the more expressive you can be when writing scenarios. Teams who do this well refer to their features as <em>living documentation</em> - a specification document that never goes out of date.</p>
</div>
<div class="paragraph">
<p>When Cucumber first started, we used to use <em>regular expressions</em> to match plain language phrases from Gherkin steps.</p>
</div>
<div class="paragraph">
<p>Regular expressions have quite an intimidating reputation.</p>
</div>
<div class="paragraph">
<p>So we replaced them with something simpler, something we call <em>Cucumber expressions</em>. Cucumber is backwards compatible so you can still use the power of regular expressions if that&#8217;s your thing.</p>
</div>
<div class="paragraph">
<p>This chapter is all about Cucumber Expressions.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_ruby_java_js">3.1.1. Lesson 1 - Questions (Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Step definitions translate human-readable scenarios into concrete actions in code - TRUE</p>
</li>
<li>
<p>BDD practitioners think of "step definitions" and "automation code" as distinct concepts - TRUE</p>
</li>
<li>
<p>Cucumber only supports automation through the user interface - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: A step definition is a piece of code that is called by Cucumber in response to a step in a scenario. You can write any code you like inside a step definition, but we&#8217;ve found it easier to maintain if we keep them short. This leads to step definitions calling dedicated automation code to perform concrete actions against the system under construction. That automation code can manipulate the user interface, make a REST call, or drive the domain model directly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true_2">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Regular Expressions are exactly the same as Cucumber Expressions - FALSE</p>
</li>
<li>
<p>Modern versions of Cucumber only support both Cucumber Expressions and Rregular Expressions - TRUE</p>
</li>
<li>
<p>Cucumber Expressions are more intimidating than Regular Expressions - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Regular Expressions are a powerful tool that have been in use in computer science for many decades. They can be hard understand and maintain, so the Cucumber team created a simplified mechanism, called Cucumber Expressions. However, Cucumber remains backwards compatible, so you can use both Regular Expressions and Cucumber Expressions with modern releases of Cucumber.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_specflowcdotnet">3.1.2. Lesson 1 - Questions (SpecFlow/C#/Dotnet)</h4>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true_3">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Step definitions translate human-readable scenarios into concrete actions in code - TRUE</p>
</li>
<li>
<p>BDD practitioners think of "step definitions" and "automation code" as distinct concepts - TRUE</p>
</li>
<li>
<p>SpecFlow only supports automation through the user interface - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: A step definition is a piece of code that is called by SpecFlow in response to a step in a scenario. You can write any code you like inside a step definition, but we&#8217;ve found it easier to maintain if we keep them short. This leads to step definitions calling dedicated automation code to perform concrete actions against the system under construction. That automation code can manipulate the user interface, make a REST call, or drive the domain model directly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true_4">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Regular Expressions are exactly the same as Cucumber Expressions - FALSE</p>
</li>
<li>
<p>In modern versions of SpecFlow steps can be defined using Cucumber Expressions but this feature has to be enabled first - TRUE</p>
</li>
<li>
<p>Cucumber Expressions are more intimidating than Regular Expressions - FALSE</p>
</li>
<li>
<p>Regular expressions can still be used even in modern versions of SpecFlow even if Cucumber Expressions are enabled - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Regular Expressions are a powerful tool that have been in use in computer science for many decades. They can be hard understand and maintain, so the Cucumber team created a simplified mechanism, called Cucumber Expressions that is now also available for SpecFlow. SpecFlow remains backwards compatible, so you can use both Regular Expressions and Cucumber Expressions with modern releases of SpecFlow.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_literal_expressions">3.2. Literal expressions</h3>
<div class="paragraph">
<p><a href="#shot-659" id="shot-659" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
Let&#8217;s look at the Shouty scenario from the last chapter.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Cucumber starts to execute this feature, it will come to the first step of the scenario <code>Given Lucy is located 15 metres from Sean</code> <a href="#shot-660" id="shot-660" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> and say to itself "now - do I have any step definitions that match the phrase <code>Lucy is located 15 metres from Sean</code>?”"</p>
</div>
<div class="paragraph">
<p><a href="#shot-661" id="shot-661" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a>
The most simple cucumber expression that would match that step is this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Lucy is located 15 metres from Sean</pre>
</div>
</div>
<div class="paragraph">
<p>That’s pretty simple isn&#8217;t it? Cucumber expressions are just string patterns, and the most simple pattern you can use is a perfect match.</p>
</div>
<div class="paragraph">
<p>In Javscript, we can use this pattern to make a step definition like this: <a href="#shot-662" id="shot-662" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located 15 metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">matched!</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use a normal Javascript string to pass the cucumber expression to Cucumber.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_2">3.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_cucumber_expressions_will_match_the_step_given_lucy_is_15_metres_from_sean">Which of the following Cucumber Expressions will match the step "Given Lucy is 15 metres from Sean"?</h5>
<div class="ulist">
<ul>
<li>
<p>"lucy is 15 metres from sean" - FALSE</p>
</li>
<li>
<p>"Given Lucy is 15 metres from Sean" - FALSE</p>
</li>
<li>
<p>"Lucy is 15 metres from Sean" - TRUE</p>
</li>
<li>
<p>"Lucy is 15 metres from Sean Smith" - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber Expressions look for a match of the whole step text EXCLUDING the Gherkin keyword (Given/When/Then/And/But). The match is case sensitive and matches whitespace as well.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_capturing_parameters">3.3. Capturing parameters</h3>
<div class="paragraph">
<p>Sometimes, we want to write step definitions that allow us to use different values in our Gherkin scenarios. For example, we might want to have other scenarios that place Lucy a different distance away from Sean. <a href="#shot-663" id="shot-663" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>To capture interesting values from our step definitions, we can use a feature of Cucumber Expressions called <em>parameters</em>.</p>
</div>
<div class="paragraph">
<p>For example, to capture the number of metres, we can use the <code>{int}</code> parameter: <a href="#shot-664" id="shot-664" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> which is passed as an argument to our step definition: <a href="#shot-665" id="shot-665" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we’re capturing that value as an argument. The value <code>100</code> will be passed to our code automatically by Cucumber.</p>
</div>
<div class="paragraph">
<p>Because we&#8217;ve used Cucumber Expressions' built-in <code>{int}</code> parameter type, the value has been cast to a Number for us automatically, so we can do maths with it if we want.<a href="#shot-666" id="shot-666" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Lucy is </span><span class="p">${</span><span class="nx">distance</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}</span><span class="s2"> centimetres from Sean`</span><span class="p">);</span>

  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber has a bunch of built-in parameter types: <code>{int}</code>, <code>{float}</code>, <code>{word}</code> and <code>{string}</code>. You can also define your own, as we&#8217;ll see later.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3_ruby_java_js">3.3.1. Lesson 3 )Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_which_of_the_following_is_not_a_built_in_cucumber_expression_parameter_type">Which of the following is NOT a built in Cucumber Expression parameter type?</h5>
<div class="ulist">
<ul>
<li>
<p>float - FALSE</p>
</li>
<li>
<p>integer - TRUE</p>
</li>
<li>
<p>string - FALSE</p>
</li>
<li>
<p>word - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The Cucumber Expression parameter type that matches an integer is <code>{int}</code>, not <code>{integer}</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_is_true">Which of the following statements is true?</h5>
<div class="ulist">
<ul>
<li>
<p>You cannot create your own Cucumber Expression parameter types - FALSE</p>
</li>
<li>
<p>Cucumber discards the value that matches a Cucumber Expression parameter type - FALSE</p>
</li>
<li>
<p>Your step definition code will be passed the value that matched the Cucumber Expression parameter type - TRUE</p>
</li>
<li>
<p>Cucumber always passes the matched parameter as a string - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber will pass the step definition a parameter for each Cucumber Expression parameter type. Cucumber will attempt to convert the text that matched into a suitable format. Using the <code>{int}</code> parameter type will result in a number being passed to the step definition. You can extend the predefined Cucumber Expression parameter types, by creating your own.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_specflowcdotnet">3.3.2. Lesson 3 - Questions (SpecFlow/C#/Dotnet)</h4>
<div class="sect4">
<h5 id="_which_of_the_following_is_not_a_built_in_cucumber_expression_parameter_type_2">Which of the following is NOT a built in Cucumber Expression parameter type?</h5>
<div class="ulist">
<ul>
<li>
<p>float - FALSE</p>
</li>
<li>
<p>integer - TRUE</p>
</li>
<li>
<p>string - FALSE</p>
</li>
<li>
<p>word - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The Cucumber Expression parameter type that matches an integer is <code>{int}</code>, not <code>{integer}</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_is_true_2">Which of the following statements is true?</h5>
<div class="ulist">
<ul>
<li>
<p>You cannot create your own Cucumber Expression parameter types - FALSE</p>
</li>
<li>
<p>Cucumber discards the value that matches a Cucumber Expression parameter type - FALSE</p>
</li>
<li>
<p>Your step definition code will be passed the value that matched the Cucumber Expression parameter type - TRUE</p>
</li>
<li>
<p>SpecFlow always passes the matched parameter as a string - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: SpecFlow will pass the step definition a parameter for each Cucumber Expression parameter type. SpecFlow will attempt to convert the text that matched into a suitable format. Using the <code>{int}</code> parameter type will result in a number being passed to the step definition. You can extend the predefined Cucumber Expression parameter types, by creating your own.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flexibility">3.4. Flexibility</h3>
<div class="paragraph">
<p>Although it&#8217;s important to try to use consistent terminology in our Gherkin scenarios to help develop the ubiquitous language of your domain, we also want scenarios to read naturally, which sometimes means allowing a bit of flexibility.</p>
</div>
<div class="paragraph">
<p>Ideally, the language used in scenarios should never be constrained by your step definitions. Otherwise they&#8217;ll end up sounding like they were written by robots. Or worse, they read like code.</p>
</div>
<div class="paragraph">
<p>One common example is the problem of plurals. Suppose we want to place Lucy and Sean just 1 metre apart: <a href="#shot-667" id="shot-667" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">​</span><span class="nf">Given </span>Lucy is located 1 metre from Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we’ve used the singular <code>metre</code> instead of the plural <code>metres</code> we don&#8217;t get a match: <a href="#shot-668" id="shot-668" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty-js/shouty
&gt; cucumber-js

U-U

Failures:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metre from Sean
       Undefined. Implement with the following snippet:

         Given('Lucy is located {int} metre from Sean', function (int) {
         // Given('Lucy is located {float} metre from Sean', function (float) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });

   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('Lucy hears Sean\'s message', function () {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (2 undefined, 1 skipped)
0m00.007s (executing steps: 0m00.000s)
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>What a pain!</p>
</div>
<div class="paragraph">
<p>Fear not. We can just surround the <code>s</code> in parentheses to make it optional, like this: <a href="#shot-669" id="shot-669" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-670" id="shot-670" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
Now our step matches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty-js/shouty
&gt; cucumber-js

Lucy is 100 centimetres from Sean
P-U

Failures:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metre from Sean # features/step_definitions/steps.js:3
       Pending
   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('Lucy hears Sean\'s message', function () {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (1 undefined, 1 pending, 1 skipped)
0m00.010s (executing steps: 0m00.001s)
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is one way to smooth off some of the rough edges in your cucumber expressions, and allow your scenarios to be as expressive as possible.</p>
</div>
<div class="paragraph">
<p>Another is to allow <em>alternates</em> - different ways of saying the same thing. For example, to accept this step: <a href="#shot-671" id="shot-671" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">​</span><span class="nf">Given </span>Lucy is standing 1 metre from Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;we can use this Cucumber Expression: <a href="#shot-672" id="shot-672" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located/standing {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-673" id="shot-673" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a>
Now we can use either 'standing' or 'located' in our scenarios, and both will match just fine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty-js/shouty
&gt; cucumber-js

Lucy is 100 centimetres from Sean
P-U

Failures:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is standing 1 metre from Sean # features/step_definitions/steps.js:3
       Pending
   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('Lucy hears Sean\'s message', function () {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (1 undefined, 1 pending, 1 skipped)
0m00.010s (executing steps: 0m00.002s)
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_4">3.4.1. Lesson 4</h4>
<div class="sect4">
<h5 id="_how_can_you_express_in_a_cucumber_expression_that_matching_some_text_is_optional">How can you express in a Cucumber Expression that matching some text is optional?</h5>
<div class="ulist">
<ul>
<li>
<p>Enclose it in square brackets: [] - FALSE</p>
</li>
<li>
<p>Enclose it in parentheses: () - TRUE</p>
</li>
<li>
<p>Place a question mark after it: ? - FALSE</p>
</li>
<li>
<p>Precede it with a slash: / - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Any text in a Cucumber Expression that is surrounded by parentheses <code>()</code> is considered optional.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_a_slash_separating_words_mean_in_a_cucumber_expression">What does a slash <code>/</code> separating words mean in a Cucumber Expression?</h5>
<div class="ulist">
<ul>
<li>
<p>The words are considered alternatives - the Cucumber Expression will match any of them - TRUE</p>
</li>
<li>
<p>It doesn&#8217;t mean anything special - the Cucumber Expression will match the slash as a literal character- FALSE</p>
</li>
<li>
<p>The word that follows the slash is considered optional - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Words in a Cucumber Expression that are separated by a slash <code>/</code> are considered alternates. There must be no whitespace between the word and the slash.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_cucumber_expressions_would_match_both_it_weighed_3_grammes_and_it_weighed_1_gramme">Which of the following Cucumber Expressions would match both "it weighed 3 grammes" and "it weighed 1 gramme"?</h5>
<div class="ulist">
<ul>
<li>
<p>"it weighed {int} gramme(s)" - TRUE</p>
</li>
<li>
<p>"it weighed 1/3 gramme/s" - FALSE</p>
</li>
<li>
<p>"it weighed 1/3 gramme(s)" - TRUE</p>
</li>
<li>
<p>"it weighed 1 / 3 gramme(s)" - FALSE</p>
</li>
<li>
<p>"it weighed 1/2/3 gramme/grammes" - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Any text surrounded by parentheses <code>()</code> is considered optional. Any words separated by a slash <code>/</code> are considered to be alternates. You can find full documentation about Cucumber Expressions at <a href="https://cucumber.io/docs/cucumber/cucumber-expressions/" class="bare">https://cucumber.io/docs/cucumber/cucumber-expressions/</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_parameters">3.5. Custom parameters</h3>
<div class="paragraph">
<p>Although you can get a long way with Cucumber Expressions' built-in parameter types, you get real power when you define your own <em>custom parameter types</em>. This allows you to transform the text captured from the Gherkin into any object you like before it&#8217;s passed into your step definition.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s define our own <code>{person}</code> custom parameter type that will convert the string <code>Lucy</code> into an instance of <code>Person</code> automatically.</p>
</div>
<div class="paragraph">
<p><a href="#shot-674" id="shot-674" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
We can start with the step definition, which would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{person} is located/standing {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lucy</span><span class="p">,</span> <span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-675" id="shot-675" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a>
If we run Cucumber at this point we&#8217;ll see an error, because we haven&#8217;t defined the <code>{person}</code> parameter type yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty-js/shouty
&gt; cucumber-js

U-U

Undefined parameter types:

- "person" e.g. `{person} is located/standing {int} metre(s) from Sean`

Failures:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metres from Sean
       Undefined. Implement with the following snippet:

         Given('Lucy is located {int} metres from Sean', function (int) {
         // Given('Lucy is located {float} metres from Sean', function (float) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });

   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:15
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('Lucy hears Sean\'s message', function () {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (2 undefined, 1 skipped)
0m00.013s (executing steps: 0m00.000s)
npm ERR! Test failed.  See above for more details.</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s how we define one.</p>
</div>
<div class="paragraph">
<p><a href="#shot-676" id="shot-676" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a>
Let&#8217;s create a new JS file in <code>features/support</code> called <code>person_parameter.js</code>:</p>
</div>
<div class="paragraph">
<p><a href="#shot-677" id="shot-677" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
.person_parameter.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <code>defineParameterType</code> function from Cucumber to define our new parameter type. <a href="#shot-678" id="shot-678" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="paragraph">
<p>We need to give it a <code>name</code> which is the name we&#8217;ll use inside the curly brackets in our step definition expressions. <a href="#shot-679" id="shot-679" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="paragraph">
<p>We also need to define&#8201;&#8212;&#8201;gasp!&#8201;&#8212;&#8201;a regular expression. <a href="#shot-680" id="shot-680" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> This is necessary to tell Cucumber Expressions what text to match when searching for this parameter in a Gherkin step. We won&#8217;t go into the details of regular expressions in this video, but in this case we&#8217;re just matching on either of the names of the people we&#8217;re using in our scenario. <a href="#shot-681" id="shot-681" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="paragraph">
<p>Finally, there&#8217;s a transformer block, <a href="#shot-682" id="shot-682" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> which takes the text captured from the Gherkin step that matched the regular expression pattern, and runs some code. The return value of this block is what will be passed to the step definition. In this case, the block is passed the name of the person (as a string) <a href="#shot-683" id="shot-683" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a> which we can then pass to the <code>Person</code> class&#8217;s constructor. <a href="#shot-684" id="shot-684" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="title">person_parameter.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">defineParameterType</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">defineParameterType</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">regexp</span><span class="p">:</span> <span class="sr">/Lucy|Sean/</span><span class="p">,</span>
  <span class="na">transformer</span><span class="p">:</span> <span class="nx">name</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-685" id="shot-685" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a>
All of this means that when we run our step, an instance of <code>Person</code> will be passed into our step definition automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty-js/shouty
&gt; cucumber-js

Person {}
Lucy is 100 centimetres from Sean
P-U

Failures:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metres from Sean # features/step_definitions/steps.js:5
       Pending
   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:15
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('{person} hears {person}\'s message', function (person, person2) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (1 undefined, 1 pending, 1 skipped)
0m00.011s (executing steps: 0m00.003s)
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom parameters allow you to bring your domain <em>model</em> - the names of the classes and objects in your solution - and your domain <em>language</em> - the words you use in your scenarios and step definitions - closer together.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_java">3.5.1. Lesson 5 - Questions (Java)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>@ParameterType("activated")
public Status state(String activationState) {
    return new Status(activationState);
}</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the name of the method that is decorated with the <code>@ParameterType</code> annotation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_javascript">3.5.2. Lesson 5 - Questions (Javascript)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions_2">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code_2">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>defineParameterType({
  name: 'state',
  regexp: /activated/,
  transformer: activationState &#8658; new Status(activationState)
})</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the <code>name</code> parameter passed to the <code>defineParameterType</code> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_ruby">3.5.3. Lesson 5 - Questions (Ruby)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions_3">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code_3">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>ParameterType(
  name:        'state',
  regexp:      /activated/,
  transformer: &#8594; (activationState) { Status.new(activationState) }
)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the <code>name</code> parameter passed to the <code>ParameterType</code> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_specflowcdotnet">3.5.4. Lesson 5 - Questions (SpecFlow/C#/Dotnet)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions_4">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to restrict the text to be matched when using a custom parameter type (StepArgumentTransformation) - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to restrict the text that should be matched when a custom parameter type (StepArgumentTransformation) is used in a Cucumber Expression. You can find more examples of how to use <code>StepArgumentTransformation</code> in the <a href="https://docs.specflow.org/projects/specflow/en/latest/Bindings/Step-Argument-Conversions.html#step-argument-transformation">SpecFlow documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code_4">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>public Status ConvertState(string activationState)
{
return new Status(activationState);
}</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated} or {deactivated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{Status} - TRUE</p>
</li>
<li>
<p>{ConvertState}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the name of the return type in the method that is decorated with the <code>[StepArgumentTransformation]</code> annotation.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cleaning_up">4. Cleaning up</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_importance_of_readability">4.1. The importance of readability</h3>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1arEP_-0Fi5CK7EC8IYCJWrc67I_XF34Z" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-686" id="shot-686" title="04.01.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 0.1: 04.01.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>In the previous chapter, we talked about the importance of having readable scenarios, and you learned some new skills with Cucumber Expressions to help you achieve that goal. Those skills will give you the confidence to write scenarios exactly the way you want, knowing you’ll be able to match the Gherkin steps easily from your step definition code.</p>
</div>
<div class="paragraph">
<p>We emphasise readability because from our experience, writing Gherkin scenarios is a software design activity. Cucumber was created to bridge the communication gap between business domain experts and development teams. When you collaborate with domain experts to describe behaviour in Gherkin, you’re expressing the group’s shared understanding of the problem you need to solve. The words you use in your scenarios can have a deep impact on the way the software is designed, as we’ll see in later chapters.</p>
</div>
<div class="paragraph">
<p>The more fluent you become in writing Gherkin, the more useful a tool it becomes to help you facilitate this communication. Keeping your scenarios readable means you can get feedback at any time about whether you’re building the right thing. Over time, your features become living documentation about your system. We can’t emphasize enough how important it is to see your scenarios as more than just tests.</p>
</div>
<div class="paragraph">
<p>Maintaining a living document works both ways: the scenarios will guide your solution design, but you may also have to update your Gherkin to reflect the things you learn as you build the solution. This dance back and forth between features and solution code is an important part of BDD.</p>
</div>
<div class="paragraph">
<p>In this chapter, we’ll learn about feature descriptions, the Background keyword, and about keeping scenarios and code up-to-date with your current understanding of the project.</p>
</div>
<div class="paragraph">
<p>First, let’s catch up with what’s been happening on the Shouty project.</p>
</div>
<div class="sect3">
<h4 id="_continuity_annoucement">4.1.1. Continuity Annoucement</h4>
<div class="paragraph">
<p>Before we start, I need to explain about a continuity error between the previous chapter and this next one.</p>
</div>
<div class="paragraph">
<p>In the last chapter we showed you how to use <em>parameter types</em> to automatically create an instance of our <code>Person</code> class whenever we used it in a step defintion.</p>
</div>
<div class="paragraph">
<p>Now the first version of video series was first created many years ago, before we had added parameter types to Cucumber. Although we updated the previous chapter to demonstrate parameter types to you, we haven&#8217;t yet updated this one. So you&#8217;ll notice as you follow along here that there&#8217;s no mention of parameter types anymore.</p>
</div>
<div class="paragraph">
<p>Some of the things we&#8217;ll be doing to clean up the code in this chapter would be even cleaner if we used parameter types, and we hope to update this video someday to incorporate them into the story. In the meantime we&#8217;ll leave it as an exercise for you to think about how you would change the work we do in this episode to make the most of them.</p>
</div>
<div class="paragraph">
<p>Have fun, and don&#8217;t forget to come on <a href="https://cucumberbdd.slack.com/archives/C9C3FSGRE">the #school community Slack channel</a> to ask if you need any guidance!</p>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_ruby_java_js_2">4.1.2. Lesson 1 - Questions (Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_which_aspects_of_cucumber_help_bridge_the_communication_gap_between_business_domain_experts_and_development_teams">Which aspects of Cucumber help bridge the communication gap between business domain experts and development teams?</h5>
<div class="ulist">
<ul>
<li>
<p>The readability of Gherkin scenarios - TRUE</p>
</li>
<li>
<p>Cucumber&#8217;s availability for different programming languages - FALSE</p>
</li>
<li>
<p>Being able to express scenarios using your own domain language - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The feature files that Cucumber understands are written using Gherkin, so that you can create scenarios that utilise your own domain language, so that they can be read and understood by everyone involved in specifying and delivering your software.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_do_cucumber_feature_files_differ_from_more_traditional_automated_tests">How do Cucumber feature files differ from more traditional automated tests?</h5>
<div class="ulist">
<ul>
<li>
<p>The purpose of feature files is to create readable specifications that can be understood by the whole team, not to provide test coverage</p>
</li>
<li>
<p>Business-readable specifications make it easier to obtain feedback about what you&#8217;re building while you&#8217;re building it, rather than waiting for a later test cycle</p>
</li>
<li>
<p>Feature files become "living documentation" when they are automated, providing a single source of truth for the whole team</p>
</li>
<li>
<p>Feature files should be written collaboratively by business and delivery, not in isolation by testers</p>
</li>
<li>
<p>There is no difference - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: BDD is the collaborative approach to developing software that Cucumber was created to support. Although Cucumber scenarios do act as tests when they are automated, this is not their primary purpose. Their primary purpose is to provide a single, shared specification, written in the domain language of your business&#8201;&#8212;&#8201;facilitating collaboration, feedback, and
reliable documentation. The primary purpose of traditional automated tests, on the other hand, is to check that the software behaves as expected.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_specflowcdotnet_2">4.1.3. Lesson 1 - Questions (SpecFlow/C#/Dotnet)</h4>
<div class="sect4">
<h5 id="_which_aspects_of_specflow_help_bridge_the_communication_gap_between_business_domain_experts_and_development_teams">Which aspects of SpecFlow help bridge the communication gap between business domain experts and development teams?</h5>
<div class="ulist">
<ul>
<li>
<p>The readability of Gherkin scenarios - TRUE</p>
</li>
<li>
<p>Gherkin scenarios can be automated in different programming languages - FALSE</p>
</li>
<li>
<p>Being able to express scenarios using your own domain language - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The feature files that SpecFlow understands are written using Gherkin, so that you can create scenarios that utilise your own domain language, so that they can be read and understood by everyone involved in specifying and delivering your software.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_do_specflow_feature_files_differ_from_more_traditional_automated_tests">How do SpecFlow feature files differ from more traditional automated tests?</h5>
<div class="ulist">
<ul>
<li>
<p>The purpose of feature files is to create readable specifications that can be understood by the whole team, not to provide test coverage</p>
</li>
<li>
<p>Business-readable specifications make it easier to obtain feedback about what you&#8217;re building while you&#8217;re building it, rather than waiting for a later test cycle</p>
</li>
<li>
<p>Feature files become "living documentation" when they are automated, providing a single source of truth for the whole team</p>
</li>
<li>
<p>Feature files should be written collaboratively by business and delivery, not in isolation by testers</p>
</li>
<li>
<p>There is no difference - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: BDD is the collaborative approach to developing software that SpecFlow was created to support. Although SpecFlow scenarios do act as tests when they are automated, this is not their primary purpose. Their primary purpose is to provide a single, shared specification, written in the domain language of your business&#8201;&#8212;&#8201;facilitating collaboration, feedback, and
reliable documentation. The primary purpose of traditional automated tests, on the other hand, is to check that the software behaves as expected.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_changes_that_happened_while_we_were_away">4.2. Review changes that happened while we were away</h3>
<div class="paragraph">
<p>While we were away, the developers of Shouty have been busy working on the code. Let’s have a look at what they’ve been up to.</p>
</div>
<div class="paragraph">
<p><a href="#shot-687" id="shot-687" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: npm test</a>
We’ll start out by running Cucumber.</p>
</div>
<div class="paragraph">
<p>Great! It looks like both these scenarios are working now - both the different messages that Sean shouts are being heard by Lucy.</p>
</div>
<div class="paragraph">
<p><a href="#shot-688" id="shot-688" title="open stepdef file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: open stepdef file</a>
Let’s dig into the code and see how these steps have been automated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the step definition layer, we can see that a new class has been defined, the Network.<a href="#shot-689" id="shot-689" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> We’re creating an instance of the network here. Then we pass that network instance to each of the Person instances we create here.<a href="#shot-690" id="shot-690" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> So both instances of Person depend on the same instance of network. The Network is what allows people to send messages to one another.</p>
</div>
<div class="paragraph">
<p>There are also a couple of new unit test classes in the <code>test</code> directory,<a href="#shot-691" id="shot-691" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> one for the Network class,<a href="#shot-692" id="shot-692" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> and another one for the Person class.<a href="#shot-693" id="shot-693" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="paragraph">
<p>Unit tests are fine-grained tests that define the precise behaviour of each of those classes. We’ll talk more about this in a future lesson, but feel free to have a poke around in there in the meantime.</p>
</div>
<div class="paragraph">
<p>The familiar <code>npm test</code> <a href="#shot-694" id="shot-694" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a> command will run those unit tests <a href="#shot-695" id="shot-695" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> as well as Cucumber.<a href="#shot-696" id="shot-696" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-697" id="shot-697" title="open the feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: open the feature file</a></p>
</div>
<div class="paragraph">
<p>The first thing I notice coming back to the code is that the feature file is still talking about the distance between Lucy and Sean, but we haven’t actually implemented any behaviour around that yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Feature</span><span class="p">:</span> <span class="nx">Shout</span>

  <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">within</span> <span class="nx">range</span>
    <span class="nx">Given</span> <span class="nx">Lucy</span> <span class="nx">is</span> <span class="mi">15</span> <span class="nx">metres</span> <span class="k">from</span> <span class="nx">Sean</span>
    <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span>
    <span class="nx">Then</span> <span class="nx">Lucy</span> <span class="nx">should</span> <span class="nx">hear</span> <span class="nx">Sean</span><span class="dl">'</span><span class="s1">s message

  Scenario: Listener hears a different mesage
    Given Lucy is 15 metres from Sean
    When Sean shouts "Free coffee!"
    Then Lucy should hear Sean</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This happens to us all the time - we have an idea for a new feature, but then we find the problem is too complex to solve all at once, so we break it down into simpler steps. If we’re not careful, little bits of that original idea can be left around like clutter, in the scenarios and in the code. That clutter can get in the way, especially if plans change.</p>
</div>
<div class="paragraph">
<p>We’re definitely going to develop this behaviour, but we’ve decided to defer it to our next iteration. Our current solution is just focussed on broadcasting messages between the people on the network.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s clean up the feature to reflect that current understanding.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_ruby_java_js">4.2.1. Lesson 2 - Questions (Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_why_have_the_shouty_developers_created_unit_tests_for_the_person_and_network_classes">Why have the Shouty developers created unit tests for the Person and Network classes?</h5>
<div class="ulist">
<ul>
<li>
<p>They don&#8217;t understand how to do BDD - FALSE</p>
</li>
<li>
<p>Unit tests are fine-grained tests that define the precise behaviour of each of those classes - TRUE</p>
</li>
<li>
<p>Unit tests run faster than Cucumber scenarios - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Unit tests (also known as programmer tests) are used to define precise behaviour of units of code that may not be interesting to the business&#8201;&#8212;&#8201;and so should not be written in a feature file. Writing unit tests is entirely compatible with BDD.</p>
</div>
<div class="paragraph">
<p>There is no reason for Cucumber scenarios to run significantly slower than unit tests. The Shouty step definitions that we&#8217;ve seen so far interact directly with the domain layer and run extremely fast.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_is_the_distance_between_sean_and_lucy_not_being_used_by_shouty">Why is the distance between Sean and Lucy not being used by Shouty?</h5>
<div class="ulist">
<ul>
<li>
<p>The team has decided to defer implementing range functionality until a later iteration - TRUE</p>
</li>
<li>
<p>The developers have misunderstood the specification</p>
</li>
<li>
<p>The specification has changed since the scenarios were written</p>
</li>
<li>
<p>The distance between Sean and Lucy is being used to decide if the shout is "in range"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Teams often find that the problem is too big to solve all at once, so we split it into thinner slices. Working in smaller steps is a faster, safer way of delivering software. In this case the team has decided that broadcasting messages and calculating if a person is in-range are different problems that they will address separately.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_specflow">4.2.2. Lesson 2 - Questions (SpecFlow)</h4>
<div class="sect4">
<h5 id="_why_have_the_shouty_developers_created_unit_tests_for_the_person_and_network_classes_2">Why have the Shouty developers created unit tests for the Person and Network classes?</h5>
<div class="ulist">
<ul>
<li>
<p>They don&#8217;t understand how to do BDD - FALSE</p>
</li>
<li>
<p>Unit tests are fine-grained tests that define the precise behaviour of each of those classes - TRUE</p>
</li>
<li>
<p>Unit tests run faster than Cucumber scenarios - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Unit tests (also known as programmer tests) are used to define precise behaviour of units of code that may not be interesting to the business&#8201;&#8212;&#8201;and so should not be written in a feature file. Writing unit tests is entirely compatible with BDD.</p>
</div>
<div class="paragraph">
<p>There is no reason for SpecFlow scenarios to run significantly slower than unit tests. The Shouty step definitions that we&#8217;ve seen so far interact directly with the domain layer and run extremely fast.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_is_the_distance_between_sean_and_lucy_not_being_used_by_shouty_2">Why is the distance between Sean and Lucy not being used by Shouty?</h5>
<div class="ulist">
<ul>
<li>
<p>The team has decided to defer implementing range functionality until a later iteration - TRUE</p>
</li>
<li>
<p>The developers have misunderstood the specification</p>
</li>
<li>
<p>The specification has changed since the scenarios were written</p>
</li>
<li>
<p>The distance between Sean and Lucy is being used to decide if the shout is "in range"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Teams often find that the problem is too big to solve all at once, so we split it into thinner slices. Working in smaller steps is a faster, safer way of delivering software. In this case the team has decided that broadcasting messages and calculating if a person is in-range are different problems that they will address separately.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_description_field">4.3. Description field</h3>
<div class="paragraph">
<p>After the feature keyword, we have space in a Gherkin document to write any arbitrary text that we like.<a href="#shot-698" id="shot-698" title="feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: feature file</a> We call this the feature’s <em>description</em>. This is a great place to write up any notes or other details that can’t easily be expressed in examples. You might have links to wiki pages or issue trackers, or to wireframes. You can put anything you like in here, as long as you don’t start a line with a Gherkin keyword, like &#8220;Rule:&#8221; or &#8220;Scenario:&#8221;.</p>
</div>
<div class="paragraph">
<p>In this case, we can add a high level description of the Shouty application.<a href="#shot-699" id="shot-699" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> Because Shouty doesn&#8217;t yet filter by proximity, we can also write a todo list here so it’s clear that we do intend to get to that soon.<a href="#shot-700" id="shot-700" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">To do</span><span class="p">:</span>
    <span class="err">-</span> <span class="err">only</span> <span class="err">shout</span> <span class="err">to</span> <span class="err">people</span> <span class="err">within</span> <span class="nf">a </span>certain distance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changing the description doesn’t change anything about how Cucumber will run this feature. It just helps the human beings reading this document to understand more about the system you’re building.</p>
</div>
<div class="paragraph">
<p>Our two scenarios are examples of how Shouty can broadcast a shout to other users. This is one of the main business rules, which we can document using the Rules keyword.<a href="#shot-701" id="shot-701" title="add Rules keyword and indent scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: add Rules keyword and indent scenarios</a> We&#8217;ll learn more about this in a later chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener within range
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-702" id="shot-702" title="shows 'Lucy is 15 metres from Sean' step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: shows 'Lucy is 15 metres from Sean' step definition</a>
The step “Given Lucy is 15 metres from Sean” is misleading, since the distance between the two people is not yet relevant in our current model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">Rule</span><span class="p">:</span> <span class="nx">Shouts</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">heard</span> <span class="nx">by</span> <span class="nx">other</span> <span class="nx">users</span>

    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">within</span> <span class="nx">range</span>
      <span class="nx">Given</span> <span class="nx">Lucy</span> <span class="nx">is</span> <span class="mi">15</span> <span class="nx">metres</span> <span class="k">from</span> <span class="nx">Sean</span>
      <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span>
      <span class="nx">Then</span> <span class="nx">Lucy</span> <span class="nx">should</span> <span class="nx">hear</span> <span class="nx">Sean</span><span class="dl">'</span><span class="s1">s message

    Scenario: Listener hears a different mesage
      Given Lucy is 15 metres from Sean
      When Sean shouts "Free coffee!"
      Then Lucy should hear Sean</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The step definition calls the moveTo method on Person, <a href="#shot-703" id="shot-703" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-704" id="shot-704" title="shows move_to method in Person class" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: shows move_to method in Person class</a>
but the moveTo method doesn’t actually do anything.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-705" id="shot-705" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a>
Let’s simplify this code to do just what it needs to do right now, and no more. We can start from the scenario by changing this single step to express what’s actually going on.<a href="#shot-706" id="shot-706" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> We’ll work on one scenario at a time, and update the other one once we’re happy with this one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the scenario names make sense, and we have two steps, each creating a person. Notice we’re starting to reveal some more of our domain language here: we’ve introduced the words <code>Person</code> and <code>name</code>. Person is already a part of our domain language, so it’s nice to have that revealed in the language of the scenario. Name may well become an attribute of our person soon, so it’s also useful to have that surfaced so we can get feedback about it from the team.</p>
</div>
<div class="paragraph">
<p>One thing we’ve lost by doing this is the idea that, eventually, the two people will need to be close to each other for the message to be transmitted. We definitely wouldn’t remove detail like that unilaterally, without discussing it with the other people who were involved in writing and reviewing this scenario.</p>
</div>
<div class="paragraph">
<p><a href="#shot-707" id="shot-707" title="create new Rule and writes out two new empty scenarios for in / out of range" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: create new Rule and writes out two new empty scenarios for in / out of range</a>
In this case, as well as adding it to the TODO list above, we’ve decided to document the range rule, and write a couple of new empty scenarios to remind us to implement that behaviour later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range

    <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">is</span> <span class="err">out</span> <span class="err">of</span> <span class="err">range</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-708" id="shot-708" title="bundle exec cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: bundle exec cucumber</a>
Let’s press on. We can run Cucumber to generate new step definition snippets for the new steps and paste them into our steps file. <a href="#shot-709" id="shot-709" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a><a href="#shot-710" id="shot-710" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next lesson we&#8217;ll look at a couple of ways that we can implement these new step definitions.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions">4.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_what_is_a_feature_file_description">What is a feature file <em>description</em>?</h5>
<div class="ulist">
<ul>
<li>
<p>Any lines of text between the feature name and the first rule or scenario - TRUE</p>
</li>
<li>
<p>A line of text that starts with the <code>#</code> character</p>
</li>
<li>
<p>A block of text introduced by the <code>Description:</code> keyword</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: You can add a free text description of a feature file after the <code>Feature:</code> line that defines the feature&#8217;s name. The description can be any number of lines long. The description continues until the first rule, scenario, or scenario outline is encountered.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_the_purpose_of_writing_an_empty_scenario">What is the purpose of writing an empty scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>It is not valid Gherkin syntax to write an empty scenario</p>
</li>
<li>
<p>Empty scenarios act as a reminder that we have more work to do - TRUE</p>
</li>
<li>
<p>Empty scenarios are a way of pretending that we have done more work than we actually have</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber treats empty scenarios as work that needs to be done and reports them as <em>pending</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_before_hook">4.4. The "Before" hook</h3>
<div class="paragraph">
<p><a href="#shot-711" id="shot-711" title="broken implementation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: broken implementation</a>
We now have two step definitions to implement,<a href="#shot-712" id="shot-712" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> and that presents us with a bit of a problem. We need the same instance of Network available in both. We could just assume that the Lucy step will always run first and create it there, but that seems fragile.<a href="#shot-713" id="shot-713" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> If someone wrote a new scenario that didn’t create people in the right order, they’d end up with no Network instance, and weird bugs. We want our steps to be as independent as possible, so they can be easily composed into new scenarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most straightforward way to create this network instance in JavaScript is to use a hook.</p>
</div>
<div class="paragraph">
<p>We need an instance of Network in every scenario, so we can declare a Before Hook that creates one before each scenario starts, like this:<a href="#shot-714" id="shot-714" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="paragraph">
<p>Now we can use that Network instance as we create Lucy <a href="#shot-715" id="shot-715" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> and Sean <a href="#shot-716" id="shot-716" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> in these two new steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be working again now. Let’s run Cucumber to check. <a href="#shot-717" id="shot-717" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="paragraph">
<p>Good. Let’s do the same with the other scenario. <a href="#shot-718" id="shot-718" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-719" id="shot-719" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: npm test</a></p>
</div>
<div class="paragraph">
<p>Now we can remove this old step definition. <a href="#shot-720" id="shot-720" title="move the cursor to the step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: move the cursor to the step definition</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">Before</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We know we&#8217;ll need something like this in the future when we implement the proximity rule, but we don&#8217;t want to second-guess what that code will look like, so let&#8217;s clean it out for now.<a href="#shot-721" id="shot-721" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">Before</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-722" id="shot-722" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: npm test</a></p>
</div>
<div class="paragraph">
<p>Now we have one last bit of dead code left, the moveTo method on Person.<a href="#shot-723" id="shot-723" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a>
Let&#8217;s clean that up too.<a href="#shot-724" id="shot-724" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">network</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">network</span>      <span class="o">=</span> <span class="nx">network</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-725" id="shot-725" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: npm test</a>
And we&#8217;re still green!</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_2">4.4.1. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_when_does_a_before_hook_run">When does a Before hook run?</h5>
<div class="ulist">
<ul>
<li>
<p>Before every run of Cucumber</p>
</li>
<li>
<p>Before the first scenario in each feature file</p>
</li>
<li>
<p>Before each scenario - TRUE</p>
</li>
<li>
<p>Before each step in a scenario</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: A Before hook runs before each scenario. Since there is no way to tell if a hook exists by looking at the feature file, you should only use hooks for performing actions that you don&#8217;t expect the business to provide feedback on.</p>
</div>
<div class="paragraph">
<p>You can read more about hooks at <a href="https://cucumber.io/docs/cucumber/api/#hooks" class="bare">https://cucumber.io/docs/cucumber/api/#hooks</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_why_isnt_it_a_good_idea_to_create_a_network_instance_in_the_same_step_definition_where_we_create_lucy">Why isn&#8217;t it a good idea to create a Network instance in the same step definition where we create Lucy?</h5>
<div class="ulist">
<ul>
<li>
<p>It is a good idea</p>
</li>
<li>
<p>Steps should be independent and composable. If the Network is only created when Lucy is created, future scenarios will be forced to create Lucy - TRUE</p>
</li>
<li>
<p>We&#8217;ll need to create another Network instance when we create Sean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Every person needs to share the <strong>same</strong> Network instance, which means we need to create the Network before we create any people. By creating the Network instance in the same step definition that we create Lucy, we are forcing people to:
* create Lucy&#8201;&#8212;&#8201;even if the scenario doesn&#8217;t need Lucy
* create Lucy before any other person&#8201;&#8212;&#8201;because otherwise Network will not have been created yet</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_person_in_a_generic_stepdef">4.5. Create Person in a generic stepdef</h3>
<div class="paragraph">
<p><a href="#shot-726" id="shot-726" title="Freeze of code from end of lesson 4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Freeze of code from end of lesson 4</a></p>
</div>
<div class="paragraph">
<p>OK, so we’ve cleaned things up a bit, to bring the scenarios, the code and our current understanding of the problem all into sync. What’s nice to see is how well those new steps that create Lucy and Sean match the code inside the step definition.</p>
</div>
<div class="paragraph">
<p>When step definitions have to make a big leap to translate between our plain-language description of the domain in the Gherkin scenario, and the code, that’s usually a sign that something is wrong. We like to see step definitions that are only one or two lines long, because that usually indicates our scenarios are doing a good job of reflecting the domain model in the code, and vice-versa.</p>
</div>
<div class="paragraph">
<p>One problem that we still have with these scenarios is that we’re very fixed to only being able to use these two characters, Lucy and Sean. If we want to introduce anyone else into the scenario, we’re going to be creating quite a lot of duplicate code. In fact, the two steps for creating Lucy and Sean are almost identical, apart from those instance variables.</p>
</div>
<div class="paragraph">
<p>On a real project we wouldn’t bother about such a tiny amount of duplication at this early stage, but this isn’t a real project! Let’s play with the skills we learned in the last chapter to make a single step definition that can create Lucy or Sean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Feature</span><span class="p">:</span> <span class="nx">Shout</span>

  <span class="nx">Shouty</span> <span class="nx">allows</span> <span class="nx">users</span> <span class="nx">to</span> <span class="dl">"</span><span class="s2">hear</span><span class="dl">"</span> <span class="nx">other</span> <span class="nx">users</span> <span class="dl">"</span><span class="s2">shouts</span><span class="dl">"</span> <span class="k">as</span> <span class="nx">long</span> <span class="k">as</span> <span class="nx">they</span> <span class="nx">are</span> <span class="nx">close</span> <span class="nx">enough</span> <span class="nx">to</span> <span class="nx">each</span> <span class="nx">other</span><span class="p">.</span>

  <span class="nx">To</span> <span class="k">do</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">only</span> <span class="nx">shout</span> <span class="nx">to</span> <span class="nx">people</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">certain</span> <span class="nx">distance</span>

  <span class="nx">Rule</span><span class="p">:</span> <span class="nx">Shouts</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">heard</span> <span class="nx">by</span> <span class="nx">other</span> <span class="nx">users</span>

    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">hears</span> <span class="nx">a</span> <span class="nx">message</span>
      <span class="nx">Given</span> <span class="nx">a</span> <span class="nx">person</span> <span class="nx">named</span> <span class="nx">Lucy</span>
      <span class="nx">And</span> <span class="nx">a</span> <span class="nx">person</span> <span class="nx">named</span> <span class="nx">Sean</span>
      <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span>
      <span class="nx">Then</span> <span class="nx">Lucy</span> <span class="nx">should</span> <span class="nx">hear</span> <span class="nx">Sean</span><span class="dl">'</span><span class="s1">s message

    Scenario: Listener hears a different mesage
      Given a person named Lucy
      And a person named Sean
      When Sean shouts "Free coffee!"
      Then Lucy should hear Sean</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">message</span>

  <span class="nx">Rule</span><span class="p">:</span> <span class="nx">Shouts</span> <span class="nx">should</span> <span class="nx">only</span> <span class="nx">be</span> <span class="nx">heard</span> <span class="k">if</span> <span class="nx">listener</span> <span class="nx">is</span> <span class="nx">within</span> <span class="nx">range</span>

    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">is</span> <span class="nx">within</span> <span class="nx">range</span>

    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">is</span> <span class="nx">out</span> <span class="k">of</span> <span class="nx">range</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first problem we’ll need to tackle is these hard-coded instance variable names.<a href="#shot-727" id="shot-727" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a JavaScript object to store all the people involved in the scenario.</p>
</div>
<div class="paragraph">
<p>Let’s try replacing Lucy first.</p>
</div>
<div class="paragraph">
<p><a href="#shot-728" id="shot-728" title="Edit Stepdefs.java, adding private instance field <strong>people</strong>, creating in @Before hook, and using for Lucy throughout" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: Edit Stepdefs.java, adding private instance field <strong>people</strong>, creating in @Before hook, and using for Lucy throughout</a>
We’ll start by creating a new object in the before hook, like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can store Lucy in the people object. We’ll use her name as the key, hard-coding it for now.<a href="#shot-729" id="shot-729" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, where we check Lucy’s messages heard here in the assertion, we need to fetch her out of the people object. <a href="#shot-730" id="shot-730" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-731" id="shot-731" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: npm test</a></p>
</div>
<div class="paragraph">
<p>With that little refactoring done, we can now try and make this first step generic for any name.<a href="#shot-732" id="shot-732" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="paragraph">
<p>Using your new found Cucumber expression skills from the last chapter, you’ll know that if we replace the word Lucy here with a 'word' expression,<a href="#shot-733" id="shot-733" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a> we’ll have the name passed into our step definition as an argument, here.<a href="#shot-734" id="shot-734" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> Now we can use that as the key in the people object.<a href="#shot-735" id="shot-735" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-736" id="shot-736" title="npm test FAILS" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: npm test FAILS</a>
If we try and run Cucumber now, we get an error about an ambiguous match. Our generic step definition is now matching the step “a person named Sean”,<a href="#shot-737" id="shot-737" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a> but so is the original one. <a href="#shot-738" id="shot-738" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a> In bigger projects, this can be a real issue, so this warning is important.</p>
</div>
<div class="paragraph">
<p>Let’s remove the old step definition,<a href="#shot-739" id="shot-739" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a> and fetch Sean from the people object here where he shouts his message.<a href="#shot-740" id="shot-740" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Sean</span><span class="dl">'</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-741" id="shot-741" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: npm test</a></p>
</div>
<div class="paragraph">
<p>Great, we’re green again.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_ruby_java_js">4.5.1. Lesson 5 - Questions (Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_why_should_a_step_definition_be_short">Why should a step definition be short?</h5>
<div class="ulist">
<ul>
<li>
<p>Because the plain-language description of the domain in the Gherkin step should be close to the domain model in the code - TRUE</p>
</li>
<li>
<p>Step definitions don&#8217;t need to be short</p>
</li>
<li>
<p>Cucumber limits the length of step definitions to five lines of code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Step definitions are a thin glue between the plain-language description in a scenario and the software that we&#8217;re building. If the business domain and the solution domain are aligned, then there should be little translation to do in the step definition.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_it_mean_when_cucumber_complains_about_an_ambiguous_step">What does it mean when Cucumber complains about an <em>ambiguous</em> step?</h5>
<div class="ulist">
<ul>
<li>
<p>Cucumber couldn&#8217;t find a step definition that matches a step</p>
</li>
<li>
<p>Cucumber only found one step definition that matches a step</p>
</li>
<li>
<p>Cucumber found more than one step definition that matches a step - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: If more than one step definition matches a step, then Cucumber doesn&#8217;t know which one to call. When this ambiguity occurs, Cucumber issues an error, rather than try to choose between the matching step definitions.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backgrounds">4.6. Backgrounds</h3>
<div class="paragraph">
<p><a href="#shot-742" id="shot-742" title="Feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Feature file</a>
Let’s switch back to the feature to show you one more technique for improving the readability of your scenarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have common context steps - the Givens - in all the scenarios in our feature, it can sometimes be useful to get those out of the way.</p>
</div>
<div class="paragraph">
<p><a href="#shot-743" id="shot-743" title="move Given steps into background" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: move Given steps into background</a>
We can literally move them into the background, using a background keyword, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Background</span><span class="p">:</span>
    <span class="nf">Given </span>a person named Lucy
    <span class="nf">And </span>a person named Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-744" id="shot-744" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: npm test</a>
As far as Cucumber is concerned, these scenarios haven’t changed. It will still create both Lucy and Sean as the first things it does when running each of these scenarios.</p>
</div>
<div class="paragraph">
<p><a href="#shot-745" id="shot-745" title="Feature file, showing Background and shortened scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: Feature file, showing Background and shortened scenarios</a>
But from a readability point of view, we can now see  more clearly what’s important and interesting about these two scenarios - in this case, the message being shouted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice we just went straight into When steps in our scenarios.<a href="#shot-746" id="shot-746" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> That’s absolutely fine. We still have a context for the scenario, but we’ve chosen to push it off into the background.</p>
</div>
<div class="paragraph">
<p>Again, it’s debatable whether we’d bother to use a Background to do this on a real project, but this at least illustrates the technique. We rarely use Backgrounds in our projects, because although they can improve readability by removing the duplication of repeated contexts, they also harm readability by requiring people to read the Background in conjunction with each Scenario.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=19VLE9qKbVN4bpMxsIVvPtPqc3RGw4bSW" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>To maintain trust in the BDD process, it’s important to keep your features fresh. Even when you drive the development from BDD scenarios, you’ll still learn lessons from the implementation that might need to be fed back into your Gherkin documentation.</p>
</div>
<div class="paragraph">
<p>In this case, we discovered that we could find a smaller slice of this story, and defer the business rule about proximity until our next iteration. Splitting stories like this is a powerful agile technique, and one that BDD can help you to master. Now we have a clean codebase and a suite of scenarios that reflects the current state of the system’s development.</p>
</div>
<div class="paragraph">
<p>We’re ready to start the next iteration.</p>
</div>
<div class="sect3">
<h4 id="_lesson_6_questions_ruby_java_js">4.6.1. Lesson 6 - Questions (Ruby, Java, JS)</h4>
<div class="sect4">
<h5 id="_what_does_the_gherkin_keyword_background_do">What does the Gherkin keyword <em>Background</em> do?</h5>
<div class="ulist">
<ul>
<li>
<p>It provides a place to write a description of why the feature is valuable</p>
</li>
<li>
<p>It is treated exactly like a scenario, but is run as soon as Cucumber starts</p>
</li>
<li>
<p>It is treated exactly like a scenario, but is run once before any other scenario in the feature file</p>
</li>
<li>
<p>The steps from the background are run as if they were inserted at the beginning of every scenario in the feature file - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The background is used to reduce duplication in scenarios by moving steps that are common to all scenarios into a single location. The steps in the background are run before every scenario in the feature file.</p>
</div>
<div class="paragraph">
<p>There can be a maximum of one Background per feature file. A Background only affects scenarios that are in the same feature file as the Background.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_might_backgrounds_decrease_the_readability_or_maintainability_of_a_feature_file">How might Backgrounds decrease the readability or maintainability of a feature file?</h5>
<div class="ulist">
<ul>
<li>
<p>Backgrounds always improve readability</p>
</li>
<li>
<p>Readability can decrease because the reader must remember the contents of the background even when reading scenarios at the end of the feature file</p>
</li>
<li>
<p>Maintainability can decrease because the maintainer must be aware that there is a background even when adding scenarios to the end of the feature file</p>
</li>
<li>
<p>Maintainability can decrease because the maintainer must be aware of the background when moving a scenario to a different feature file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Backgrounds were created to aid readability, by reducing duplication in the scenarios. Unfortunately, moving important information out of a scenario means that anyone reading or modifying a feature file must be fully aware that of the existence and content of a background. Since feature files typically contain several scenarios, that means holding two sections of the feature file in your mind at the same time, making a feature file harder to read or maintain.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_loops">5. Loops</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_removing_redundant_scenarios">5.1. Removing redundant scenarios</h3>
<div class="paragraph">
<p>Welcome back to Cucumber School.</p>
</div>
<div class="paragraph">
<p><a href="#shot-747" id="shot-747" title="feature file from end of Ch 4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: feature file from end of Ch 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">To do</span><span class="p">:</span>
    <span class="err">-</span> <span class="err">only</span> <span class="err">shout</span> <span class="err">to</span> <span class="err">people</span> <span class="err">within</span> <span class="nf">a </span>certain distance

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range

    <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">is</span> <span class="err">out</span> <span class="err">of</span> <span class="err">range</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Last time we worked on cleaning up the Shouty features to keep them in sync with the current status of the project. We stripped the scenarios back to only specify the behaviour of passing messages between people. We made it clear that the proximity rule had not yet been implemented.</p>
</div>
<div class="paragraph">
<p>You’ll already remember from the Cucumber expressions chapter how important it is to be expressive in your scenarios, and keep them readable. In this chapter we’re going to learn some new tricks with Gherkin that will give you even more flexibility about how you write scenarios.</p>
</div>
<div class="paragraph">
<p>Once again the Shouty developers&#8201;&#8212;&#8201;have been hard at work implementing that proximity rule. Let’s have a look at how they got on. <a href="#shot-748" id="shot-748" title="Show chapter 5 initial checkin feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Show chapter 5 initial checkin feature file</a></p>
</div>
<div class="paragraph">
<p>Right, so those two scenarios we just left as placeholders: the one where the listener is within range,<a href="#shot-749" id="shot-749" title="show in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: show in feature file</a> and the one where the listener is out of range <a href="#shot-750" id="shot-750" title="show in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: show in feature file</a> are passing. <a href="#shot-751" id="shot-751" title="Show output from Cucumber showing the in-range/out-of-range results" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: Show output from Cucumber showing the in-range/out-of-range results</a> Fantastic! If we look at our step definitions, we can see how they have been implemented. <a href="#shot-752" id="shot-752" title="show the in-range/out-of-range scenarios in the step definitions" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: show the in-range/out-of-range scenarios in the step definitions</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s review the changes to the feature file in more detail.</p>
</div>
<div class="paragraph">
<p>We now have four scenarios:<a href="#shot-753" id="shot-753" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> our original two from the last time we looked at the code,<a href="#shot-754" id="shot-754" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a> and the two placeholders we wrote as reminders.<a href="#shot-755" id="shot-755" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>We used the second scenario - Listener hears a different message <a href="#shot-756" id="shot-756" title="Highlight second scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: Highlight second scenario</a> - to triangulate and force us to replace the hard-coded message output with a proper implementation. Now we have a domain model that uses a variable for the message, there&#8217;s an insignificant chance of this behaviour regressing, so we can safely remove the second scenario. <a href="#shot-757" id="shot-757" title="removes second scenario: Listener hears a different message" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: removes second scenario: Listener hears a different message</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keeping excess scenarios is wasteful: they clutter up your feature files, distracting your readers. When you run your features as tests, excess scenarios make them take longer to run than necessary. The one where a "listener hears a "message" is a perfectly good way of checking that the message has been sent correctly.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions">5.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_why_was_it_a_good_idea_to_delete_the_scenario">Why was it a good idea to delete the scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>It doesn&#8217;t help illustrate the rule "Shouts can be heard by other users"&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>No one should give away free coffee</p>
</li>
<li>
<p>There should only be one scenario per rule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We created the scenario "Listener hears a different message" to force us to replace our hard-coded implementation. Now we have a domain model that uses a variable for the message, there&#8217;s an insignificant chance of this behaviour regressing, so we can safely remove the second scenario.</p>
</div>
<div class="paragraph">
<p>Keeping excess scenarios is wasteful: they clutter up your feature files and slow down feedback.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_incidental_details">5.2. Incidental details</h3>
<div class="paragraph">
<p>The first scenario has changed since we last looked at it <a href="#shot-758" id="shot-758" title="hear_shout.feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: hear_shout.feature</a> - it now specifies the range of a shout and the location of Sean and Lucy.<a href="#shot-759" id="shot-759" title="Highlight the first three line of the first scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Highlight the first three line of the first scenario</a> This scenario exists to illustrate that a listener hears the message exactly as the shouter shouted it. All the additional details are incidental and make the scenario harder to read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-760" id="shot-760" title="Edit context of first scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: Edit context of first scenario</a>
Let&#8217;s ensure that this scenario includes only essential information for the reader and remove all references to location and range.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-761" id="shot-761" title="Add Network creation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: Add Network creation</a>
We&#8217;ll need to make changes to the step definitions to make sure that a Network class is always created - which we can do using an instance variable.</p>
</div>
<div class="paragraph">
<p><a href="#shot-762" id="shot-762" title="DEFAULT_RANGE" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: DEFAULT_RANGE</a>
We&#8217;ll default the range to 100. If a scenario needs to document specific range, that can still be done by explicitly including a "Given the range is &#8230;&#8203;" step.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="nx">default_range</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">default_range</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll also need to add a step definition that can create a person without the scenario needing to specify where they are located.<a href="#shot-763" id="shot-763" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> The step definition gives each person <a href="#shot-764" id="shot-764" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> created this way a default location of 0.<a href="#shot-765" id="shot-765" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-766" id="shot-766" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: run Cucumber</a>
Let&#8217;s run Cucumber to check we haven&#8217;t broken anything&#8230;&#8203; and we&#8217;re good!</p>
</div>
<div class="paragraph">
<p><a href="#shot-767" id="shot-767" title="Highlight message text in last two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: Highlight message text in last two scenarios</a>
Looking at the two new scenarios - Listener is within range <a href="#shot-768" id="shot-768" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a> &amp; Listener is out of range <a href="#shot-769" id="shot-769" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a> - we can see that they also contain incidental details. Since their purpose is to illustrate the "Shouts should only be heard if listener is within range" rule, there&#8217;s no need to actually document the content of the shout.<a href="#shot-770" id="shot-770" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-771" id="shot-771" title="Delete message text" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: Delete message text</a>
Let&#8217;s remove the details that aren&#8217;t relevant to the range rule.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-772" id="shot-772" title="Add new step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: Add new step definition</a>
Next we add a step definition that allows Sean to shout, without needing us to specify the exact message.</p>
</div>
<div class="listingblock">
<div class="title">steps.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="no">When</span><span class="p">(</span><span class="s1">'Sean shouts'</span><span class="p">,</span> <span class="n">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">this</span><span class="p">.</span><span class="nf">people</span><span class="p">[</span><span class="s1">'Sean'</span><span class="p">].</span><span class="nf">shout</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-773" id="shot-773" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16</a>
One that allows us to check that Lucy has heard exactly one shout - because she&#8217;s in range of the shouter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="no">Then</span><span class="p">(</span><span class="s1">'Lucy should hear a shout'</span><span class="p">,</span> <span class="n">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">assertThat</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="nf">people</span><span class="p">[</span><span class="s1">'Lucy'</span><span class="p">].</span><span class="nf">messagesHeard</span><span class="p">().</span><span class="nf">length</span><span class="p">,</span> <span class="n">is</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-774" id="shot-774" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a>
And one that allows us to check that Larry hasn&#8217;t heard any messages at all - because he&#8217;s out-of-range.</p>
</div>
<div class="listingblock">
<div class="title">steps.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="no">Then</span><span class="p">(</span><span class="s1">'Larry should not hear a shout'</span><span class="p">,</span> <span class="n">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">assertThat</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="nf">people</span><span class="p">[</span><span class="s1">'Larry'</span><span class="p">].</span><span class="nf">messagesHeard</span><span class="p">().</span><span class="nf">length</span><span class="p">,</span> <span class="n">is</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-775" id="shot-775" title="Run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: Run Cucumber</a>
And finally run Cucumber - and we&#8217;re still green.</p>
</div>
<div class="paragraph">
<p><a href="#shot-776" id="shot-776" title="Show hear_shout.feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19: Show hear_shout.feature</a>
That&#8217;s better. We&#8217;ve removed inessential details, so that each scenario contains only the information needed to illustrate its business rule.</p>
</div>
<div class="paragraph">
<p>The scenarios would still run green if we removed the steps that set the range of a shout <a href="#shot-777" id="shot-777" title="Highlight in last two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: Highlight in last two scenarios</a> , because the range already has a default value. We&#8217;re not going to, because since those scenarios are illustrating the rule that deals with the range of a shout, it&#8217;s an essential part of context for anyone reading them.</p>
</div>
<div class="paragraph">
<p>A happy side-effect is that, in order to set the range from our scenario, we’ve had to make it a configurable property of the system <a href="#shot-778" id="shot-778" title="highlight Network constructor" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21: highlight Network constructor</a>. So if our business stakeholders ever change their minds about the range, we won’t have to go hunting around in the code for where we’d hard-coded it.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_3">5.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_why_did_we_remove_any_reference_to_range_or_location_from_the_first_scenario_listener_hears_a_message">Why did we remove any reference to range or location from the first scenario "Listener hears a message"?</h5>
<div class="ulist">
<ul>
<li>
<p>They are essential to system behaviour</p>
</li>
<li>
<p>They are incidental to the rule being illustrated&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>They were only needed to triangulate the implementation</p>
</li>
<li>
<p>They made the scenario too long</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The first scenario exists to illustrate the rule "Listener hears a message." Since the behaviour is not affected by the range of a shout, neither the range nor the distance between the shouter and the listener is relevant. The information is therefore <em>incidental</em> and should be omitted from the scenario.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_do_we_need_to_know_the_names_of_people_using_shouty">Why do we need to know the names of people using Shouty?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s important that every person in the system has a real name</p>
</li>
<li>
<p>It&#8217;s necessary to use <em>persona</em>, where the shouter is called Sean and the listeners are called Lucy or Larry</p>
</li>
<li>
<p>It doesn&#8217;t matter what we call them&#8201;&#8212;&#8201;but the automation code does need to be able to tell them apart&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>The automation code has been written to recognise the names Sean, Lucy, and Larry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
It&#8217;s necessary to be able to distinguish the people that are involved in the scenario. We have called them Sean, Lucy, and Larry, but we could have called them Shouter, Listener1, and Listener2 (or even User1, User2, and User3).</p>
</div>
<div class="paragraph">
<p>We find that using <em>persona</em> (where the name gives an indication of the person&#8217;s purpose in the scenario) can be a useful way of conveying information, without cluttering up the scenario. If the names conveyed no information at all, they would not contribute to the readability of the scenario, and could be considered incidental.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_pieces_of_information_are_incidental_in_this_scenario">Which pieces of information are incidental in this scenario?</h5>
<div class="paragraph">
<p>Rule: Offer is only valid for Shouty users
  Scenario: Customer is not a Shouty user
    Given Nora is not a Shouty user
    And Sean shouted "free bagels until midday"
    When Nora orders a bagel and a coffee at 11:00am
    Then she should be charged 75¢ for the bagel</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nora is not a Shouty user</p>
</li>
<li>
<p>Sean is offering "free bagels!"</p>
</li>
<li>
<p>Sean&#8217;s offer is only valid until midday&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora orders a bagel</p>
</li>
<li>
<p>Nora orders a coffee&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora places her order at 11:00am&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora gets charged for the bagel</p>
</li>
<li>
<p>Nora get charged 75¢ for the bagel&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
This scenario is illustrating the rule that the "offer is only valid for Shouty users". It&#8217;s therefore essential to know that Nora is not a Shouty user, because this means that she is not eligible for the offer.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t need to know that Nora orders a coffee, because that has no relevance to the rule. Nor do we need to know when the offer expires, when Nora places the order, or how much she will be charged&#8201;&#8212;&#8201;there will be other rules (and other scenarios) that illustrate that behaviour.</p>
</div>
<div class="paragraph">
<p>Although it&#8217;s incidental that the offer is for bagels, it is necessary to illustrate that Nora has ordered the item that is on offer to Shouty users&#8201;&#8212;&#8201;and that she will be charged for that item. We use "bagels" as an example to make the scenario easier to read, not because there&#8217;s something inherently special about bagels!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_refactoring_to_data_tables">5.3. Refactoring to Data Tables</h3>
<div class="paragraph">
<p>Let&#8217;s look at the two scenarios that illustrate the rule about range again <a href="#shot-779" id="shot-779" title="show the range rule &amp; scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: show the range rule &amp; scenarios</a>. Notice how the steps that create the Sean,<a href="#shot-780" id="shot-780" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> Lucy,<a href="#shot-781" id="shot-781" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> and Larry <a href="#shot-782" id="shot-782" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> are very similar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="nl">Rule:</span> <span class="nc">Shouts</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">heard</span> <span class="k">if</span> <span class="n">listener</span> <span class="n">is</span> <span class="n">within</span> <span class="n">range</span>

    <span class="nl">Scenario:</span> <span class="nc">Listener</span> <span class="n">is</span> <span class="n">within</span> <span class="n">range</span>
      <span class="nc">Given</span> <span class="n">the</span> <span class="n">range</span> <span class="n">is</span> <span class="mi">100</span>
      <span class="nc">And</span> <span class="n">a</span> <span class="n">person</span> <span class="n">named</span> <span class="nc">Sean</span> <span class="n">is</span> <span class="n">located</span> <span class="n">at</span> <span class="mi">0</span>
      <span class="nc">And</span> <span class="n">a</span> <span class="n">person</span> <span class="n">named</span> <span class="nc">Lucy</span> <span class="n">is</span> <span class="n">located</span> <span class="n">at</span> <span class="mi">50</span>
      <span class="nc">When</span> <span class="nc">Sean</span> <span class="n">shouts</span>
      <span class="nc">Then</span> <span class="nc">Lucy</span> <span class="n">should</span> <span class="n">hear</span> <span class="n">a</span> <span class="n">shout</span>

    <span class="nl">Scenario:</span> <span class="nc">Listener</span> <span class="n">is</span> <span class="n">out</span> <span class="n">of</span> <span class="n">range</span>
      <span class="nc">Given</span> <span class="n">the</span> <span class="n">range</span> <span class="n">is</span> <span class="mi">100</span>
      <span class="nc">And</span> <span class="n">a</span> <span class="n">person</span> <span class="n">named</span> <span class="nc">Sean</span> <span class="n">is</span> <span class="n">located</span> <span class="n">at</span> <span class="mi">0</span>
      <span class="nc">And</span> <span class="n">a</span> <span class="n">person</span> <span class="n">named</span> <span class="nc">Larry</span> <span class="n">is</span> <span class="n">located</span> <span class="n">at</span> <span class="mi">150</span>
      <span class="nc">When</span> <span class="nc">Sean</span> <span class="n">shouts</span>
      <span class="nc">Then</span> <span class="nc">Larry</span> <span class="n">should</span> <span class="n">not</span> <span class="n">hear</span> <span class="n">a</span> <span class="n">shout</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we see steps like this, Gherkin’s Given When Then syntax starts to feel a bit clunky. Imagine if we could just write out a table, like this:</p>
</div>
<div class="paragraph">
<p><a href="#shot-783" id="shot-783" title="feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: feature file</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span> <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span> <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Lucy</span> <span class="p">|</span> <span class="n">50</span>       <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, we’re in luck. You can!</p>
</div>
<div class="paragraph">
<p>Gherkin has a special syntax called Data Tables, that allows you to specify tabular data for a step, using pipe characters to mark the boundary between cells.<a href="#shot-784" id="shot-784" title="highlight data table" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: highlight data table</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-785" id="shot-785" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: run cucumber</a><a href="#shot-786" id="shot-786" title="copy snippet, paste into steps.rb" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: copy snippet, paste into steps.rb</a><a href="#shot-787" id="shot-787" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the step definition implicitly takes a single argument <a href="#shot-788" id="shot-788" title="highlight stepdef parameters" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: highlight stepdef parameters</a>, which is a DataTable. This object has a rich API for using the tabular data.</p>
</div>
<div class="paragraph">
<p>At its most basic, the table is just a two-dimensional array. So, Lucy&#8217;s location can be accessed <a href="#shot-789" id="shot-789" title="Print out a single cell value" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: Print out a single cell value</a> by getting the value from array cell (2, 1)</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-790" id="shot-790" title="run Cucumber, highlight 'Lucy&#8217;s location'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: run Cucumber, highlight 'Lucy&#8217;s location'</a></p>
</div>
<div class="paragraph">
<p>You can also turn the table into a array of objects <a href="#shot-791" id="shot-791" title="Print out data table as hashes" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: Print out data table as hashes</a>, where the first row is used for the property names,<a href="#shot-792" id="shot-792" title="split IntelliJ screen horizontally, showing feature file at top and stepdefs below. Highlight first row" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: split IntelliJ screen horizontally, showing feature file at top and stepdefs below. Highlight first row</a> and each following row is used for the property values.<a href="#shot-793" id="shot-793" title="highlight second and third rows" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: highlight second and third rows</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">hashes</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-794" id="shot-794" title="run Cucumber, highlight data table output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: run Cucumber, highlight data table output</a></p>
</div>
<div class="paragraph">
<p>Now we can easily iterate <a href="#shot-795" id="shot-795" title="write the loop" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17: write the loop</a> over these objects and turn them into instances of Person: <a href="#shot-796" id="shot-796" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dataTable</span><span class="p">.</span><span class="nx">hashes</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">person</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">person</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-797" id="shot-797" title="run cucumber&#8201;&#8212;&#8201;all green" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19: run cucumber&#8201;&#8212;&#8201;all green</a></p>
</div>
<div class="paragraph">
<p>With that done, we can update the other scenario <a href="#shot-798" id="shot-798" title="update other scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: update other scenario</a> &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>  <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span>  <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Larry</span> <span class="p">|</span> <span class="n">150</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can check that everything is still green. <a href="#shot-799" id="shot-799" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21</a></p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>and delete our old step definition <a href="#shot-800" id="shot-800" title="delete unused step def" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22: delete unused step def</a>, which is now unused.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word} is located at {int}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-801" id="shot-801" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Cucumber strips all the white space surrounding each cell <a href="#shot-802" id="shot-802" title="show lining up of pipe characters" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24: show lining up of pipe characters</a>, so we can have a nice neat table in the Gherkin but still get clean values in the step definition underneath.</p>
</div>
<div class="paragraph">
<p>That looks much nicer - <a href="#shot-803" id="shot-803" title="hear_shout.feature data tables" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25: hear_shout.feature data tables</a> people positioned using a table in the feature file and <a href="#shot-804" id="shot-804" title="people_are_located_at()" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26: people_are_located_at()</a> really clean code that creates and positions people according to the data.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>  <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span>  <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Larry</span> <span class="p">|</span> <span class="n">150</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_2">5.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_what_is_the_name_of_the_gherkin_syntax_that_allows_you_to_specify_pipe_separated_tabular_data_for_a_step">What is the name of the Gherkin syntax that allows you to specify pipe-separated, tabular data for a step?</h5>
<div class="ulist">
<ul>
<li>
<p>Array</p>
</li>
<li>
<p>Data Matrix</p>
</li>
<li>
<p>Data Table&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Example Table</p>
</li>
<li>
<p>Table</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The Gherkin syntax is called a Data Table. It represents a 2-dimensional array, with cell boundaries indicated by pipe characters <code>|</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_value_would_be_retieved_from_cell_1_2_in_the_following_table">What value would be retieved from cell (1, 2) in the following table?</h5>
<div class="paragraph">
<p>| 0 | 1 | 2 |
| 3 | 4 | 5 |
| 6 | 7 | 8 |</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0</p>
</li>
<li>
<p>1</p>
</li>
<li>
<p>2</p>
</li>
<li>
<p>3</p>
</li>
<li>
<p>4</p>
</li>
<li>
<p>5&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>6</p>
</li>
<li>
<p>7</p>
</li>
<li>
<p>8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The data table is indexed, starting from 0. The first coordinate indicates which <em>row</em> to access, the second indicates the <em>column</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_java_only">JAVA ONLY</h5>
<div class="sect5">
<h6 id="_which_of_the_answers_correctly_shows_how_cucumber_will_convert_the_following_data_table_into_a_list_of_maps_list_mapstring_string">Which of the answers correctly shows how Cucumber will convert the following data table into a list of maps: List&lt; Map&lt;String, String&gt; &gt; ?</h6>
<div class="paragraph">
<p>| A | B | C |
| D | 0 | 1 |
| E | 2 | 3 |</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[{A=A, B=B, C=C}, {A=D, B=0, C=1}, {A=E, B=2, C=3}]</p>
</li>
<li>
<p>[{A=D, B=2, C=1}, {A=E, B=0, C=3}]</p>
</li>
<li>
<p>[{A=B, D=0, E=2}, {A=C, D=1, E=3}]</p>
</li>
<li>
<p>[{A=D, B=0, C=1}, {A=E, B=2, C=3}]&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When Cucumber converts a Data Table into a list of maps, it treats the first row as the labels (or indexes), and each subsequent row provides the values for the next map within the list.</p>
</div>
<div class="paragraph">
<p>So, in this example, since there are three rows, we end up with two maps in the list&#8201;&#8212;&#8201;the first row providing the indexes into each map, the next two rows providing the values for the two maps that are added to the list.</p>
</div>
</div>
<div class="sect5">
<h6 id="_which_of_the_following_data_tables_will_this_method_process_successfully">Which of the following Data Tables will this method process successfully?</h6>
<div class="paragraph">
<p>@DataTableType
public OrderLine createOrderLine(Map&lt;String, String&gt; orderItem) {
    return new OrderLine(entry.get("Item Name"), Integer.parseInt(entry.get("Quantity")));
}</p>
</div>
<div class="ulist">
<ul>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| name            | quantity |
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>| Item Name       | Quantity | Notes        |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        | Extra cheese |</p>
</li>
<li>
<p>| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Quantity | Item Name       | &#8201;&#8212;&#8201;TRUE
| 1        | Cheese &amp; tomato |</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Cucumber attempts to convert each non-header row in the data table into an instance of OrderLine by calling this method. For the conversion to succeed, the header cell text must match the hard coded index strings used in the method exactly. The order of the columns is not significant and any extra columns are ignored. A Data Table with only a header row would be considered an empty table and createOrderLine() would not be called and the relavent step definition would be passed an empty list of OrderLine objects.</p>
</div>
<div class="paragraph">
<p>There is more documentation about Data Table conversions at <a href="https://github.com/cucumber/cucumber/tree/master/datatable" class="bare">https://github.com/cucumber/cucumber/tree/master/datatable</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ruby_only">RUBY ONLY</h5>
<div class="sect5">
<h6 id="_which_of_the_answers_correctly_shows_how_cucumber_will_convert_the_following_data_table_into_symbolic_hashes">Which of the answers correctly shows how Cucumber will convert the following data table into symbolic hashes?</h6>
<div class="paragraph">
<p>| A | B | C |
| D | 0 | 1 |
| E | 2 | 3 |</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[{:A="A", :B="B", :C="C"}, {:A="D", :B="0", :C="1"}, {:A="E", :B="2", :C="3"}]</p>
</li>
<li>
<p>[{:A="D", :B="2", :C="1"}, {:A="E", :B="0", :C="3"}]</p>
</li>
<li>
<p>[{:A="B", :D="0", :E="2"}, {:A="C", :D="1", :E="3"}]</p>
</li>
<li>
<p>[{:A="D", :B="0", :C="1"}, {:A="E", :B="2", :C="3"}]&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
DataTable.symbolic_hashes returns an array of hashes. The first row is treated as the symbolic labels (or keys), and each subsequent row provides the values for the next hash within the array.</p>
</div>
<div class="paragraph">
<p>So, in this example, since there are three rows, we end up with two hashes in the list&#8201;&#8212;&#8201;the first row provides the keys into each hash, the next two rows providing the values for the two hashes that are added to the list.</p>
</div>
</div>
<div class="sect5">
<h6 id="_which_of_the_following_data_tables_will_this_step_definition_process_successfully">Which of the following Data Tables will this step definition process successfully?</h6>
<div class="paragraph">
<p>When "Sean orders" do |order|
  order.symbolic_hashes.each do |name:, quantity: |
    p "Item #{name} x #{quantity}"
  end
end</p>
</div>
<div class="ulist">
<ul>
<li>
<p>| Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| Item name            | quantity |
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Name       | Quantity |&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>| Name       | Quantity | Notes        |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        | Extra cheese |</p>
</li>
<li>
<p>| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Quantity | Name       | &#8201;&#8212;&#8201;TRUE
| 1        | Cheese &amp; tomato |</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
For this method to execute successfully, the header cell text must match the hard coded index strings used in the method. The order of the columns is not significant and any extra columns are ignored. A Data Table with only a header row would be considered an empty table and symbolic_hashes would return an empty array.</p>
</div>
<div class="paragraph">
<p>There is more documentation about Data Table conversions at <a href="https://github.com/cucumber/cucumber/tree/master/datatable" class="bare">https://github.com/cucumber/cucumber/tree/master/datatable</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deeper_into_data_tables">5.4. Deeper into Data Tables</h3>
<div class="paragraph">
<p><a href="#shot-805" id="shot-805" title="open feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: open feature file</a></p>
</div>
<div class="paragraph">
<p>The way that we’ve specified this data is OK,</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span> <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span> <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Lucy</span> <span class="p">|</span> <span class="n">50</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>  <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span>  <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Larry</span> <span class="p">|</span> <span class="n">150</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>but your product owner would prefer you to express it like this instead: <a href="#shot-806" id="shot-806" title="edit data table to have headings in the first column" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: edit data table to have headings in the first column</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Lucy</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">50</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Larry</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">150</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s always good to please the product owner, but you’re worried how we’ll handle it in our step definition? Fear not. Cucumber has you covered.</p>
</div>
<div class="paragraph">
<p>If you call the <code>transpose</code> method on the table <a href="#shot-807" id="shot-807" title="stepdef" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: stepdef</a>, Cucumber will turn each row into a column before passing it to the step definition.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">dataTable</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">hashes</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">person</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-808" id="shot-808" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: run cucumber</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-809" id="shot-809" title="show data tables in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: show data tables in feature file</a>
Data tables are very useful for setting up data in Given steps, but you can also use them for specifying outcomes.</p>
</div>
<div class="paragraph">
<p>One rule that we’ve been implying but have never actually explored with an example is that people can hear more than one shout. So far we’ve only specified a single message, so let’s try writing a scenario where Sean shouts more than once: <a href="#shot-810" id="shot-810" title="write two-shouts scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: write two-shouts scenario</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">should</span> <span class="err">be</span> <span class="err">able</span> <span class="err">to</span> <span class="err">hear</span> <span class="err">multiple</span> <span class="err">shouts</span>

    <span class="kn">Scenario</span><span class="p">:</span> Two shouts
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"Free bagels!"</span>
      <span class="nf">And </span>Sean shouts <span class="s">"Free toast!"</span>
      <span class="err">Then Lucy hears the following messages</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels</span>  <span class="p">|</span>
        <span class="p">|</span> <span class="n">Free</span> <span class="n">toast</span>   <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See how natural it is to use a Data Table here? We also haven’t used any column headers in this case, since the data is all in a single column anyway.</p>
</div>
<div class="paragraph">
<p>So how do we implement this step definition? Well, the Javascript assert class has a really handy method called deepEqual that we can use to compare two Data Tables. deepEqual will pass if the tables are the same, and fail if they’re different.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s run Cucumber to generate the new step definition <a href="#shot-811" id="shot-811" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: run Cucumber</a> and paste it into our StepDefinitions class <a href="#shot-812" id="shot-812" title="paste snippet" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: paste snippet</a> <a href="#shot-813" id="shot-813" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="paragraph">
<p>So we need the actual messages that Lucy’s heard to be stored in an object that looks like a raw DataTable, so we can compare it to the ones we expect.</p>
</div>
<div class="paragraph">
<p>A array of array of Strings will do <a href="#shot-814" id="shot-814" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a>, so we can just iterate over Lucy’s messages and create a new array. <a href="#shot-815" id="shot-815" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears the following messages:</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expectedMessages</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">actualMessages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">message</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span>

  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">actualMessages</span><span class="p">,</span> <span class="nx">expectedMessages</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can pass the array of actual messages and the data table of expected messages to the deepEqual method. <a href="#shot-816" id="shot-816" title="write code to call deepEqual" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: write code to call deepEqual</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">actualMessages</span><span class="p">,</span> <span class="nx">expectedMessages</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-817" id="shot-817" title="runs cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: runs cucumber</a></p>
</div>
<div class="paragraph">
<p>Oops! It looks like we made a typo in our scenario. We should have included exclamation marks on the expected messages.<a href="#shot-818" id="shot-818" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a> Well, at least this gives you a chance to see the output from deepEqual when the tables are different. We see the expected values prefixed with a plus, and the actual values prefixed with a minus.</p>
</div>
<div class="paragraph">
<p>Let’s fix just one of these <a href="#shot-819" id="shot-819" title="add exclamation mark" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: add exclamation mark</a> so you can see how the output from deepEqual changes.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels!</span> <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-820" id="shot-820" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: run cucumber</a>
The matching bagels! line no longer has a minus,<a href="#shot-821" id="shot-821" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a> and for the mismatched row, the actual value still has a minus,<a href="#shot-822" id="shot-822" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18</a> and the expected value has a plus.<a href="#shot-823" id="shot-823" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19</a></p>
</div>
<div class="paragraph">
<p>Let’s fix this last typo <a href="#shot-824" id="shot-824" title="add another exclamation mark" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: add another exclamation mark</a>, and we should be green again.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">toast!</span>  <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-825" id="shot-825" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Great.</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_3">5.4.1. Lesson 4 - Questions</h4>
<div class="paragraph">
<p>JAVA ONLY
===== Why might you use the @Transpose annotation?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transpose has been deprecated and you should not use it</p>
</li>
<li>
<p>Use it if it is more readable to have the headers in the first column&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Use it to ensure that every row in the data table has the same number of columns</p>
</li>
<li>
<p>Use it to reverse the order of the data rows in the table</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The @Transpose annotation (and the transpose method on DataTable) allows you to use tables that have their headers in the first column of a table.</p>
</div>
<div class="sect4">
<h5 id="_what_method_on_datatable_compares_two_datatables_and_produces_a_textual_output_showing_their_differences">What method on DataTable compares two DataTables and produces a textual output showing their differences?</h5>
<div class="ulist">
<ul>
<li>
<p>compare</p>
</li>
<li>
<p>difference</p>
</li>
<li>
<p>contrast</p>
</li>
<li>
<p>diff&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>covariance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The method that compares two data tables is called <strong>diff</strong></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docstring">5.5. DocString</h3>
<div class="paragraph">
<p>When writing scenarios, occasionally we want to use a really long piece of data. <a href="#shot-826" id="shot-826" title="Show feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Show feature file</a></p>
</div>
<div class="paragraph">
<p>For example, let’s introduce a new rule about the maximum length of a message <a href="#shot-827" id="shot-827" title="New rule" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: New rule</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span>  <span class="err">Maximum</span> <span class="err">length</span> <span class="err">of</span> <span class="err">message</span> <span class="err">is</span> <span class="err">180</span> <span class="err">characters</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and add a scenario to illustrate it <a href="#shot-828" id="shot-828" title="New scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: New scenario</a>, making the string just over the boundary of the rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Message is too long
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890x"</span>
      <span class="nf">Then </span>Lucy should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s pretty ugly isn’t it!</p>
</div>
<div class="paragraph">
<p>Still, we’ll press on and get it to green, then we’ll show you how to clean it up.</p>
</div>
<div class="paragraph">
<p><a href="#shot-829" id="shot-829" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: run Cucumber</a> Our existing step definition handles that ugly step with the long message just fine, but the last outcome step is undefined. We could either add a new step definition, or parameterise "Larry should not hear a shout". Let&#8217;s modify the existing step definition <a href="#shot-830" id="shot-830" title="Modify stepdef" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: Modify stepdef</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should not hear a shout</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">length</span><span class="p">,</span> <span class="nx">is</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-831" id="shot-831" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: run cucumber</a></p>
</div>
<div class="paragraph">
<p>OK, so we have a failing acceptance test.<a href="#shot-832" id="shot-832" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> Let’s dive down into our solution and implement this new rule. It seems like the Network should be responsible for implementing this rule,  so let’s go to its unit tests. <a href="#shot-833" id="shot-833" title="show NetworkTest" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: show NetworkTest</a> As we explain in more detail in the next lesson, we start by adding a new example to specify this extra responsibility. <a href="#shot-834" id="shot-834" title="start creating new unit test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: start creating new unit test</a></p>
</div>
<div class="paragraph">
<p>We’ll create a 181-character message like this <a href="#shot-835" id="shot-835" title="finish implementing unit test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: finish implementing unit test</a> and then assert that the message should not be heard when it’s broadcast.<a href="#shot-836" id="shot-836" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="title">network.test.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">does not broadcast a message over 180 characters even if listener is in range</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">shouterLocation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">listenerLocation</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="kd">const</span> <span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="nx">network</span><span class="p">,</span> <span class="nx">listenerLocation</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">lucyStub</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">(</span><span class="nx">lucy</span><span class="p">)</span>

    <span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">lucy</span><span class="p">)</span>
    <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">longMessage</span><span class="p">,</span> <span class="nx">shouterLocation</span><span class="p">)</span>

    <span class="nx">assert</span><span class="p">(</span><span class="nx">lucyStub</span><span class="p">.</span><span class="nx">hear</span><span class="p">.</span><span class="nx">notCalled</span><span class="p">)</span>
  <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s run that test <a href="#shot-837" id="shot-837" title="run Cucumber - show the unit test results" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: run Cucumber - show the unit test results</a>. Good, it fails. Lucy’s still getting the message at the moment. Now how are we going to implement this?</p>
</div>
<div class="paragraph">
<p>It looks like we’re already implementing the proximity rule here <a href="#shot-838" id="shot-838" title="Network proximity logic" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: Network proximity logic</a> in the broadcast method. Let’s add another if statement here about the message length. <a href="#shot-839" id="shot-839" title="add message length logic" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: add message length logic</a></p>
</div>
<div class="listingblock">
<div class="title">shouty.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">        <span class="k">if</span><span class="p">(</span> <span class="nx">message</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">listener</span><span class="p">.</span><span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the unit test again… and it’s passing. And cucumber is green as well <a href="#shot-840" id="shot-840" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Great.</p>
</div>
<div class="paragraph">
<p>The code here has got a little bit messy and hard to read. <a href="#shot-841" id="shot-841" title="show the modified logic in the Network class" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: show the modified logic in the Network class</a>
One very basic move we could make to improve it would be to just extract a couple of temporary variables, one for the range rule <a href="#shot-842" id="shot-842" title="extract range temporary variable" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17: extract range temporary variable</a> and one for the length rule. <a href="#shot-843" id="shot-843" title="extract length temporary variable" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: extract length temporary variable</a></p>
</div>
<div class="listingblock">
<div class="title">shouty.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">listener</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">withinRange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">location</span> <span class="o">-</span> <span class="nx">shouter_location</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span>
      <span class="kd">let</span> <span class="nx">shortEnough</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">180</span>

      <span class="k">if</span><span class="p">(</span> <span class="nx">withinRange</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">listener</span><span class="p">.</span><span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s better. This code could be improved even further of course, but at least we haven’t made it any worse.</p>
</div>
<div class="paragraph">
<p>Let’s just run the tests to check. <a href="#shot-844" id="shot-844" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19: run cucumber</a> Great - everything’s still green.</p>
</div>
<div class="paragraph">
<p>Now we have everything passing again, we can tidy up the Gherkin to use a new piece of syntax we’ve been wanting to tell you about: a DocString. <a href="#shot-845" id="shot-845" title="show message length scenario in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: show message length scenario in feature file</a></p>
</div>
<div class="paragraph">
<p>DocStrings allow you to specify a text argument for a step that spans over multiple lines. We could change our step to look like this instead: <a href="#shot-846" id="shot-846" title="convert message to DocString" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21: convert message to DocString</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Message is too long
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts the following message
        <span class="s">"""
        This is a really long message
        so long in fact that I am not going to
        be allowed to send it, at least if I keep
        typing like this until the length is over
        the limit of 180 characters.
        """</span>
      <span class="nf">Then </span>Lucy should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the scenario is much more readable.</p>
</div>
<div class="paragraph">
<p><a href="#shot-847" id="shot-847" title="show existing stepdef code" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22: show existing stepdef code</a>
We have to add a new step definition too <a href="#shot-848" id="shot-848" title="sean_shouts_the_following_message" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23: sean_shouts_the_following_message</a>. It doesn&#8217;t need a parameter in the Cucumber Expression&#8201;&#8212;&#8201;the DocString gets passed as an argument to the step definition automatically.<a href="#shot-849" id="shot-849" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24</a></p>
</div>
<div class="paragraph">
<p>Now we can fill out the rest of our new step definition. <a href="#shot-850" id="shot-850" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts the following message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Sean</span><span class="dl">'</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s check that we&#8217;re still green <a href="#shot-851" id="shot-851" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26: run cucumber</a>&#8201;&#8212;&#8201;and we are!</p>
</div>
<div class="paragraph">
<p>We don’t use DocStrings very often - having such a lot of data in a test can often make it quite brittle. But when you do need it, it&#8217;s useful to know about.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_2">5.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_we_start_implementing_the_maximummessage_length_rule_by_writing_a_scenario_and_seeing_it_fail_what_did_we_do_next">We start implementing the maximummessage length rule by writing a scenario and seeing it fail. What did we do next?</h5>
<div class="ulist">
<ul>
<li>
<p>Write another scenario to triangulate the new behaviour of the Network class</p>
</li>
<li>
<p>Implement the changed behaviour in the Network class</p>
</li>
<li>
<p>Add a new unit test to NetworkTest that specifies the change in behaviour of the Network class&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We wrote a new unit test in NetworkTest. We&#8217;ll talk more about this in the next lesson.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_would_we_use_a_docstring">Why would we use a DocString?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s the only way to include multi-line strings in a scenarios</p>
</li>
<li>
<p>It&#8217;s a readable way to include long strings in a scenario&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>DocStrings support multiple languages</p>
</li>
<li>
<p>Cucumber provides a DocString type that provides useful string manipulation features</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The DocString is Gherkin syntax that allows long strings to be readably represented in a scenario.</p>
</div>
<div class="paragraph">
<p>All the magic happens when the DocString is read from the Gherkin. The content of the DocString gets passed to the step definition as a normal String&#8201;&#8212;&#8201;there&#8217;s no corresponding Cucumber type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_snippets_of_code_are_correct_for_the_step_below">Which of the following snippets of code are correct for the step below?</h5>
<div class="literalblock">
<div class="content">
<pre>Then Simone says
"""
Now on that limb there was a branch
A rare branch and a rattlin' branch
And the branch on the limb
And the limb on the tree
And the tree in the bog
And the bog down in the valley-o
"""</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>@Then("Simone says")
public void simone_says() { }</p>
</li>
<li>
<p>@Then("Simone says")
public void simone_says(String lyrics) { }&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>@Then("Simone says {string}")
public void simone_says(String lyrics) { }</p>
</li>
<li>
<p>@Then("Simone says {docstring}")
public void simone_says(String lyrics) { }</p>
</li>
<li>
<p>@Then("Simone says {docstring}")
public void simone_says(DocString lyrics) { }</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When using a DocString in a scenario, you do not add any parameter to the matching Cucumber Expression. You do need to provide a String parameter to the step definition to receive the contents of the DocString.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tdd_loops">5.6. TDD Loops</h3>
<div class="paragraph">
<p><a href="#shot-852" id="shot-852" title="original animation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: original animation</a></p>
</div>
<div class="paragraph">
<p>You might have noticed that we’ve followed a pattern when we added behaviour to the system during this episode.</p>
</div>
<div class="paragraph">
<p>First we expressed the behaviour we wanted in a Gherkin scenario, wired up the step definitions, then ran Cucumber to watch it fail.</p>
</div>
<div class="paragraph">
<p>Then, we found the first class in our domain model that needed to change in order to support that new behaviour. In this case, the Network class. We used a unit test to describe how we wanted instances of that class to behave. Then we ran the unit test and watched it fail.</p>
</div>
<div class="paragraph">
<p>We focused in and made changes to the class until its unit tests were passing. When the unit tests were passing, we then made some minor changes to clean up the code and make it more readable. This is the basic test-driven-development cycle: red, green, clean.</p>
</div>
<div class="paragraph">
<p>The technical name for this last clean-up step is refactoring. Refactoring is an ugly name for an extremely valuable activity: improving the design of existing code without changing its behaviour. You can think about it like cleaning up and washing the dishes after you’ve prepared a meal: basic housekeeping. But imagine the state of your kitchen if you never made time to do the dishes.</p>
</div>
<div class="paragraph">
<p>Go on, imagine it for a second.</p>
</div>
<div class="paragraph">
<p>Yuck!</p>
</div>
<div class="paragraph">
<p>Well, that’s how many, many codebase end up. The good thing about taking this course is that we’re teaching you how to write solid automated tests, and the good thing about having solid automated tests is you can refactor with confidence, knowing that if you accidentally change the system’s behaviour, your tests will tell you.</p>
</div>
<div class="paragraph">
<p>Once we’re done refactoring, what do we do next? Run Cucumber, of course! In this case, our scenario was passing with a single trip round the inner TDD loop, but sometimes you can spend several hours working through all the unit tests you need to get a single scenario to green.</p>
</div>
<div class="paragraph">
<p>Once the acceptance test is passing, we figure out the next most valuable scenario on our todo list, and start the whole thing all over again!</p>
</div>
<div class="paragraph">
<p>Together, these two loops make the BDD cycle. The outer loop, which starts with an acceptance test, keeps us focussed on what the business needs us to do next. The inner loop, where we continuously test, implement then refactor small units of code, is where decide how we’ll implement that behaviour.</p>
</div>
<div class="paragraph">
<p>Both of these levels of feedback are important. It’s sometimes said that your acceptance tests ensure you’re building the right thing, and your unit tests ensure you’re building the thing right.</p>
</div>
<div class="paragraph">
<p>That’s all for this chapter of Cucumber School. See you next time!</p>
</div>
<div class="sect3">
<h4 id="_lesson_6_questions">5.6.1. Lesson 6 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_is_the_best_definition_of_the_term_refactoring">Which of the following is the best definition of the term "refactoring"?</h5>
<div class="ulist">
<ul>
<li>
<p>Improving the efficiency of the code without changing its behaviour</p>
</li>
<li>
<p>Adding new functionality to the application</p>
</li>
<li>
<p>Changing the behaviour of the code</p>
</li>
<li>
<p>Tidying up the code without changing its behaviour&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Rearchitecting the code to get ready for adding new functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The definition of refactoring is: improve the design (of some code) without changing its behaviour.</p>
</div>
</div>
<div class="sect4">
<h5 id="_when_can_refactoring_happen">When can refactoring happen?</h5>
<div class="ulist">
<ul>
<li>
<p>When a refactoring story gets prioritised by the Product Owner</p>
</li>
<li>
<p>Whenever all tests are green&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>When at least one test is failing</p>
</li>
<li>
<p>First thing in the morning</p>
</li>
<li>
<p>Before committing code to source control</p>
</li>
<li>
<p>At the end of an iteration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Refactoring is part of the day-to-day work of every software developer. It&#8217;s when they tidy up the code once they&#8217;ve got it working.</p>
</div>
<div class="paragraph">
<p>Since part of the definition of refactoring is that it shouldn&#8217;t change the behaviour of the code, they will run the tests to make sure nothing was broken. Which means that the tests MUST be passing BEFORE they start refactoring. Otherwise, how can they be sure that the behaviour hasn&#8217;t changed?</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_are_the_acceptance_test_and_unit_test_related">How are the acceptance test and unit test related?</h5>
<div class="ulist">
<ul>
<li>
<p>Acceptance tests ensure we "build the right thing"; unit tests ensure we "build the thing right"&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>An acceptance test should be passing before we start writing unit tests</p>
</li>
<li>
<p>We may write many unit tests before the currently failing acceptance test passes&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>All unit tests should be passing before we write an acceptance test</p>
</li>
<li>
<p>BDD consists of two loops: an outer acceptance test loop and an inner unit test loop&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Once we have a scenario, we automate it&#8201;&#8212;&#8201;and we expect it to fail, because we haven&#8217;t added the functionality it specifies to the system yet. This is the beginning of the outer, acceptance test loop, that ensures we&#8217;re building what the Product Owner wants: "build the right thing."</p>
</div>
<div class="paragraph">
<p>We then enter the inner, unit test loop. It&#8217;s unit tests that define the precise behaviour of small units of code&#8201;&#8212;&#8201;and ensure that we "build the thing right." They give us the safety to improve the code&#8217;s design (refactor), because they will fail if we accidentally change the code&#8217;s behaviour while refactoring. We may have to go round the inner loop a number of times, adding several unit tests, before we&#8217;ve added enought functionality to make the outer acceptance test pass.</p>
</div>
<div class="paragraph">
<p>And then we write the next failing acceptance test&#8230;&#8203;</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_cucumber">6. Working with Cucumber</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_filtering">6.1. Basic Filtering</h3>
<div class="paragraph">
<p><a href="#shot-853" id="shot-853" title="Animation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Animation</a>
Hello, and welcome back to Cucumber School.</p>
</div>
<div class="paragraph">
<p>Last time we learned about two very different kinds of loops. First, we used DataTables to loop over data in your scenarios.</p>
</div>
<div class="paragraph">
<p>Then we learned about TDD cycles. We saw how the outer loop of TDD helps you to build the right thing while the inner loop helps you build the thing right.</p>
</div>
<div class="paragraph">
<p>In this lesson, we’re going to teach you all about how to configure Cucumber.</p>
</div>
<div class="paragraph">
<p>To start with, let&#8217;s change the output that Cucumber produces to make it easier to see which scenarios have run. Open up package.json and add the pretty-formatter to the dev dependencies. <a href="#shot-854" id="shot-854" title="add pretty-formatter" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: add pretty-formatter</a></p>
</div>
<div class="listingblock">
<div class="title">package.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="w">  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@cucumber/cucumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"@cucumber/pretty-formatter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mocha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^8.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sinon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^9.0.3"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, let&#8217;s change the Cucumber script, to tell Cucumber to use the pretty-formatter. <a href="#shot-855" id="shot-855" title="modify test script" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: modify test script</a></p>
</div>
<div class="listingblock">
<div class="title">package.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="w">    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mocha test &amp;&amp; cucumber-js -f @cucumber/pretty-formatter"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s install the pretty-formatter <a href="#shot-856" id="shot-856" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> and run Cucumber.<a href="#shot-857" id="shot-857" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm install

npm test</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-858" id="shot-858" title="Scroll slowly through the output to show all scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: Scroll slowly through the output to show all scenarios</a>
Now every line from the feature file is included in the output, showing which scenarios have been run and the status of every step.</p>
</div>
<div class="paragraph">
<p>When we start working on a new scenario we often take a dive down to the inner TDD loop where we use a unit testing tool to drive out new classes or modify the behaviour of existing ones. When our unit tests are green and the new code is implemented we return to the Cucumber scenarios to verify whether we have made overall progress or not.</p>
</div>
<div class="paragraph">
<p>If we have lots of Cucumber scenarios, it can be distracting to run all of them each time we do this. We often want to focus on a single scenario - or perhaps just a couple - to get feedback on what we’re currently working on.</p>
</div>
<div class="paragraph">
<p>There are several ways to do this in Cucumber - and your IDE may offer other options. We&#8217;ll start by showing some basic filtering on the command line, before showing you an alternative.</p>
</div>
<div class="paragraph">
<p>Probably the easiest way to filter is to tell Cucumber to run only a scenario with a particular name.</p>
</div>
<div class="paragraph">
<p><a href="#shot-859" id="shot-859" title="type npm test command in console, show output and highlight that it has only run the one scenario 'Message too long'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: type npm test command in console, show output and highlight that it has only run the one scenario 'Message too long'</a>
We can pass arguments to Cucumber using the <code>--name</code> option, which tells Cucumber to only run scenarios with a name that matches the string provided, in this case "Message is too long".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --name "Message is too long"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>--name</code> option is actually a regular expression, so you can use your imagination here to run more than one scenario.
Let&#8217;s use it to run the two scenarios with the text "range" in their name. <a href="#shot-860" id="shot-860" title="type npm test in console, show output and highlight that it has run two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: type npm test in console, show output and highlight that it has run two scenarios</a><a href="#shot-861" id="shot-861" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --name "range"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to tell Cucumber to run a specific scenario is to specify the line number of the scenario within a feature file. The 'Message too long' scenario starts on line 44 in the feature file. <a href="#shot-862" id="shot-862" title="in feature file show that 'Message too long' starts on line 44." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: in feature file show that 'Message too long' starts on line 44.</a></p>
</div>
<div class="paragraph">
<p>We can use that line number when we run Cucumber. <a href="#shot-863" id="shot-863" title="add line number to npm test line" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: add line number to npm test line</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- features/hear_shout.feature:44</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-864" id="shot-864" title="show output and highlight that it has only run the scenario called 'Message too long'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: show output and highlight that it has only run the scenario called 'Message too long'</a>
Now Cucumber only runs the "Message is too long" scenario.</p>
</div>
<div class="paragraph">
<p>You can also specify multiple line numbers for each file. Let&#8217;s run 'Two shouts' as well. <a href="#shot-865" id="shot-865" title="in feature file, show 'Two shouts' starts on line 33" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: in feature file, show 'Two shouts' starts on line 33</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s add that line number to the npm test command. <a href="#shot-866" id="shot-866" title="type npm test in console, show output and highlight that it has run two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: type npm test in console, show output and highlight that it has run two scenarios</a><a href="#shot-867" id="shot-867" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- features/hear_shout.feature:33:44</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can list several files and lines together like this if you have a specific set of scenarios you want to run.</p>
</div>
<div class="paragraph">
<p>The examples that you&#8217;ve just seen pass arguments from the command line to the test script defined in package.json. If you&#8217;re working in an IDE this is less than ideal, but fortunately there are other ways to achieve exactly the same outcome.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at using cucumber.js to pass arguments to Cucumber. Open <code>cucumber.js</code> <a href="#shot-868" id="shot-868" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16</a> and add <code>default: --name range</code> <a href="#shot-869" id="shot-869" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet --name range</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the tests, it picks up the settings from cucumber.js and only runs the "range" scenarios. <a href="#shot-870" id="shot-870" title="type <code>npm test</code> in console, show output and highlight that it has run the two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: type <code>npm test</code> in console, show output and highlight that it has run the two scenarios</a><a href="#shot-871" id="shot-871" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any argument that can be supplied on the command line can also be provided in cucumber.js. The benefit of setting arguments in cucumber.js is that it gets checked in with your code, which means that they are shared with all team members.</p>
</div>
<div class="paragraph">
<p>In this lesson you&#8217;ve learnt how to filter the set of scenarios to run using scenario names and line numbers from the command line and using cucumber.js</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_2">6.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_which_option_flag_sets_a_regular_expression_that_cucumber_uses_to_filter_the_scenarios_run_by_name">Which option flag sets a regular expression that Cucumber uses to filter the scenarios run by name?</h5>
<div class="ulist">
<ul>
<li>
<p>--regex</p>
</li>
<li>
<p>--name    -----TRUE</p>
</li>
<li>
<p>--filter</p>
</li>
<li>
<p>--name-regex</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
You can find a list of supported Cucumber options by running <code>cucumber-js --help</code> or <code>npm test&#8201;&#8212;&#8201;--help</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_are_the_benefits_of_using_cucumber_js_rather_than_the_command_line_to_set_system_properties_multiple_choice">What are the benefits of using cucumber.js rather than the command line to set system properties?  <strong>MULTIPLE-CHOICE</strong></h5>
<div class="ulist">
<ul>
<li>
<p>You can check cucumber.js into source control    -----TRUE</p>
</li>
<li>
<p>The options set in the cucumber.js will be used no matter how you invoke Cucumber    -----TRUE</p>
</li>
<li>
<p>Using cucumber.js is the only way to set options when using <code>npm</code>    -----FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Because cucumber.js is a file that lives within the project, it can be checked into source control and it can be accessed by the Cucumber integration implemented by your IDE.</p>
</div>
<div class="paragraph">
<p>System properties can also be set on the command line (even when you are using npm) or by using environment variables.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_with_tags">6.2. Filtering With Tags</h3>
<div class="paragraph">
<p><a href="#shot-872" id="shot-872" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>
In the previous lesson, we modified Cucumber&#8217;s behavior using scenario names and line numbers. In this lesson I&#8217;m going to show you how to filter scenarios using tags.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s delete the <code>--name</code> parameter from <code>cucumber.js</code>. <a href="#shot-873" id="shot-873" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, Cucumber will run all scenarios. <a href="#shot-874" id="shot-874" title="run Cucumber from IntelliJ" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: run Cucumber from IntelliJ</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-875" id="shot-875" title="show 'Listener is out of range' scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: show 'Listener is out of range' scenario</a>
We’ll put a focus tag right here, above this scenario. <a href="#shot-876" id="shot-876" title="add a @focus tag to the 'Listener is out of range' scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: add a @focus tag to the 'Listener is out of range' scenario</a></p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nt">@focus</span>
    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Larry</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">150</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tags start with an at-sign and are case sensitive.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s add a tag expression to the default key,<a href="#shot-877" id="shot-877" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> which Cucumber will use to filter the scenarios run</p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--publish-quiet</span><span class="nv"> </span><span class="s">--tags</span><span class="nv"> </span><span class="s">@focus'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can run only the scenarios tagged with focus - there should be only one&#8230;&#8203; <a href="#shot-878" id="shot-878" title="npm test, then highlight that only 'Listener is out of range' scenario was run" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: npm test, then highlight that only 'Listener is out of range' scenario was run</a><a href="#shot-879" id="shot-879" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="paragraph">
<p>Yep.</p>
</div>
<div class="paragraph">
<p>Remember, tags are case sensitive, so if we change the tag in the feature file to be @Focus <a href="#shot-880" id="shot-880" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> and then run Cucumber <a href="#shot-881" id="shot-881" title="npm test &amp; show output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: npm test &amp; show output</a><a href="#shot-882" id="shot-882" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a> you can see that Cucumber found no scenarios that matched the tag expression.</p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nt">@Focus</span>
    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Larry</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">150</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s entirely up to you what you name your tags. When we’re working on a particular area of the application it is common to use a temporary tag like this - we’ll remove it before we check our code into source control.</p>
</div>
<div class="paragraph">
<p>Tags can be used for other purposes as well. If you have lots of scenarios it can be time-consuming to run them all every time. For example, you can tag a few of them with @smoke and run only those before you check in code to source control. <a href="#shot-883" id="shot-883" title="tag first" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: tag first</a></p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="nt">@smoke</span>
    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="nt">@smoke</span>
    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Lucy</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">50</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="nt">@smoke</span> <span class="nt">@Focus</span>
    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Larry</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">150</span>   <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And we change the tag in the configuration file. <a href="#shot-884" id="shot-884" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--publish-quiet</span><span class="nv"> </span><span class="s">--tags</span><span class="nv"> </span><span class="s">@smoke'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Running just the smoke tests will give you a certain level of confidence that nothing is broken without having to run them all. <a href="#shot-885" id="shot-885" title="run Cucumber, then highlight that three scenarios were run" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: run Cucumber, then highlight that three scenarios were run</a><a href="#shot-886" id="shot-886" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="paragraph">
<p>If you’re running Cucumber on a Continuous Integration Server as well, you could run all the scenarios there, detecting any regressions you might have missed by only running the smoke tests locally.</p>
</div>
<div class="paragraph">
<p>Tags give you a way to organise your scenarios that cut across feature files. You can think of them like sticky labels you might put into a book to mark interesting pages that you want to refer back to.</p>
</div>
<div class="paragraph">
<p>Some teams also use tags to reference external documents, for example, tickets in an issue tracker or planning tool. Let’s pretend we are using an issue tracker while working on Shouty and all the behaviour we built so far is related to the issue number 11. We could tag the whole feature file with this single line at the top. <a href="#shot-887" id="shot-887" title="tag feature with @SHOUTY-11" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: tag feature with @SHOUTY-11</a></p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="nt">@SHOUTY-11</span>
<span class="kd">Feature</span><span class="p">:</span> Hear shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the scenarios within that file now inherit that tag, so if we change the tag expression in cucumber.js,<a href="#shot-888" id="shot-888" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet --tags @SHOUTY-11</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber will run all the scenarios in the feature file. <a href="#shot-889" id="shot-889" title="run Cucumber, then show that all scenarios were run" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: run Cucumber, then show that all scenarios were run</a></p>
</div>
<div class="paragraph">
<p>You can use more complex tag expressions to select the scenarios you want to run. For example, you could use a tag expression to exclude all the scenarios tagged as @slow. <a href="#shot-890" id="shot-890" title="tag last two scenarios with @slow" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19: tag last two scenarios with @slow</a></p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">should</span> <span class="err">be</span> <span class="err">able</span> <span class="err">to</span> <span class="err">hear</span> <span class="err">multiple</span> <span class="err">shouts</span>

    <span class="nt">@slow</span>
    <span class="kn">Scenario</span><span class="p">:</span> Two shouts
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"Free bagels!"</span>
      <span class="nf">And </span>Sean shouts <span class="s">"Free toast!"</span>
      <span class="err">Then Lucy hears the following messages</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels!</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Free</span> <span class="n">toast!</span>  <span class="p">|</span>

  <span class="err">Rule</span><span class="p">:</span>  <span class="err">Maximum</span> <span class="err">length</span> <span class="err">of</span> <span class="err">message</span> <span class="err">is</span> <span class="err">180</span> <span class="err">characters</span>

    <span class="nt">@slow</span>
    <span class="kn">Scenario</span><span class="p">:</span> Message is too long
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts the following message
        <span class="s">"""
        This is a really long message
        so long in fact that I am not going to
        be allowed to send it, at least if I keep
        typing like this until the length is over
        the limit of 180 characters.
        """</span>
      <span class="nf">Then </span>Lucy should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then rewrite the tag expression in cucumber.js using the <code>not</code> keyword <a href="#shot-891" id="shot-891" title=""modify Cucumber.JS" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: "modify Cucumber.JS</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet --tags "not @slow"</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when you run Cucumber, the "@slow" scenarios won&#8217;t be run. <a href="#shot-892" id="shot-892" title="run Cucumber, then show that the slow scenarios were not run" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21: run Cucumber, then show that the slow scenarios were not run</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s tidy up be removing the tag filter from cucumber.js. <a href="#shot-893" id="shot-893" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="na">default</span><span class="p">:</span> <span class="dl">'</span><span class="s1">--publish-quiet</span><span class="dl">'</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can read about how to build more complicated tag expressions on the <a href="https://cucumber.io/docs/cucumber/api/#tag-expressions">Cucumber website</a> <a href="#shot-894" id="shot-894" title="open the link and show the Cucumber website" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23: open the link and show the Cucumber website</a></p>
</div>
<div class="paragraph">
<p>There&#8217;s one more thing to learn about tags. They can be combined with hooks, so that you can be selective about which hooks to run when. We&#8217;ll cover that in a future chapter.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_4">6.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_tag_expressions_below_would_cause_the_scenario_two_to_be_included_in_a_cucumber_run_based_on_this_feature_file_steps_omitted_multiple_choice">Which of the tag expressions below would cause the scenario "Two" to be included in a Cucumber run based on this feature file (steps omitted): <strong> MULTIPLE_CHOICE </strong></h5>
<div class="paragraph">
<p>@MVP
Feature: My feature</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Rule: rule A
  Scenario: One</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@smoke
@slow @regression-pack
Scenario: Two</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@regression-pack
Scenario: Three</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>@SLOW ----FALSE</p>
</li>
<li>
<p>@regression-pack ----TRUE</p>
</li>
<li>
<p>@MVP ----TRUE</p>
</li>
<li>
<p>@regression-pack and not @slow ----FALSE</p>
</li>
<li>
<p>@Mvp or @smoke ----TRUE</p>
</li>
<li>
<p>@mvp or not (@smoke and @slow) ----FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Tags are inherited from the enclosing scope, so a Scenario inherits tags from the Feature. At present Rules cannot be tagged, although we expect this to be fixed in the near future, at which point tags will be inherited like this: Feature&#8594;Rule&#8594;Scenario.</p>
</div>
<div class="paragraph">
<p>Tags are case-sensitive, so @SLOW does not match @slow.</p>
</div>
<div class="paragraph">
<p>Tag expressions can be on the same line and on consecutive lines.</p>
</div>
<div class="paragraph">
<p>Tag expressions implement the boolean operators: and, not, or.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_more_control">6.3. More Control</h3>
<div class="paragraph">
<p>Cucumber is first and foremost a tool that facilitates a common understanding between people on a project. Imagine our customers were cats. We could write our features in English, but the cats would obviously not understand that, so I&#8217;ll show you how to write a scenario in LOLCAT instead.</p>
</div>
<div class="paragraph">
<p>You can get a list of all the supported languages with --i18n-languages. <a href="#shot-895" id="shot-895" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --i18n-languages</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber supports over 70 different languages, thanks to contributions from people from all over the world.</p>
</div>
<div class="paragraph">
<p>To see the translation of the Gherkin keywords for a particular language, just use the '--i18n' option with the language code. <a href="#shot-896" id="shot-896" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --i18n-keywords en-lol</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now create a new feature file in the features folder called cat.feature <a href="#shot-897" id="shot-897" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="paragraph">
<p>The first line tells Cucumber which language the feature file is written in. <a href="#shot-898" id="shot-898" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a>
.hear-shout.feature</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="c"># language: en-lol</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber then expects the Gherkin keywords to be in LOLCAT <a href="#shot-899" id="shot-899" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="title">hear-shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="c"># language: en-lol</span>

<span class="kd">OH HAI</span><span class="p">:</span> HEAR SHOUT

  <span class="kn">MISHUN</span><span class="p">:</span> MESAGE IZ 2 LONG
    <span class="nf">I </span>CAN HAZ A KAT CALLD SHOUTR</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step is undefined, but we can quickly generate it by running Cucumber <a href="#shot-900" id="shot-900" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: npm test</a> Cucumber has generated a step definition. Implementing step definitions in non-english languages is exactly the same,<a href="#shot-901" id="shot-901" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> so we won&#8217;t go any further with LOLCAT just now. Let&#8217;s delete the cat.feature file <a href="#shot-902" id="shot-902" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a> and check that we&#8217;re still green <a href="#shot-903" id="shot-903" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="paragraph">
<p>Notice that the scenarios in hear_shout.feature are being run in the order that the occur in the feature file <a href="#shot-904" id="shot-904" title="expand/highlight the test results" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: expand/highlight the test results</a> That&#8217;s fine, but there&#8217;s a chance that since they always run in the same order we might accidentally make one scenario dependent on some other scenario.</p>
</div>
<div class="paragraph">
<p>Each scenario should be isolated - it&#8217;s result should not depend on the outcome of any other scenario. To help you catch any dependencies between your scenarios, Cucumber can be told to run your scenarios in a random order.</p>
</div>
<div class="paragraph">
<p>To do this, we can use the random flag in the profile file. <a href="#shot-905" id="shot-905" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--publish-quiet</span><span class="nv"> </span><span class="s">--order</span><span class="nv"> </span><span class="s">random'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we run Cucumber, the scenarios are run in a random order <a href="#shot-906" id="shot-906" title="run Cucumber &amp; show new order of scenario execution" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: run Cucumber &amp; show new order of scenario execution</a>. Now there&#8217;s almost no chance of a dependency between scenarios slipping through without being noticed.</p>
</div>
<div class="paragraph">
<p><a href="#shot-907" id="shot-907" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a>
A full list of Cucumber&#8217;s configuration properties can be found by passing the <code>--help</code> flag on the command line. <a href="#shot-908" id="shot-908" title="highlight top of output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: highlight top of output</a> Or using the abbreviated version <code>-h</code> <a href="#shot-909" id="shot-909" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --help
npm test -- -h</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s quite a lot to digest, but to make Cucumber really useful to your team, it’s good to spend some time learning the details of how to configure it. In this lesson, we showcased two of Cucumber’s configuration options and you learned how to write your scenarios in different spoken languages.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_3">6.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_first_lines_changes_the_language_of_a_feature_file">Which of the following first lines changes the language of a feature file?</h5>
<div class="ulist">
<ul>
<li>
<p># language: en-lol ----TRUE</p>
</li>
<li>
<p>! language: en-lol</p>
</li>
<li>
<p>language: en-lol</p>
</li>
<li>
<p># i18n: en-lol</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Gherkin supports lots of languages on a per feature file basis. It has to be the first line in the feature file, and has to be a comment with the content <code>language: &lt;language_identifier&gt;</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_why_would_you_choose_to_execute_scenarios_in_a_random_order">Why would you choose to execute scenarios in a random order?</h5>
<div class="ulist">
<ul>
<li>
<p>For fun</p>
</li>
<li>
<p>To help discover memory leaks</p>
</li>
<li>
<p>The best documentation is always sorted randomly</p>
</li>
<li>
<p>To ensure scenarios are isolated from each other ----TRUE</p>
</li>
<li>
<p>Scenarios, when run in parallel, are always executed in a random order</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Scenarios should be isolated from each other - which means that one scenario should never rely on the behaviour of any other scenario for it to behave as expected. Cucumber is implemented to facilitate the cleaning of state after each scenario, but cannot guarantee this. Random execution order can help identify unintentional dependencies between scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_formatter_plugins">6.4. Formatter plugins</h3>
<div class="paragraph">
<p>Now that we&#8217;re using the @cucumber/pretty-formatter, Cucumber outputs the features - as it runs - in the console. Cucumber can report results in other formats, which can be useful for generating reports. Let’s take a closer look at some of the formatter plugins that ship with Cucumber - starting with the HTML formatter.</p>
</div>
<div class="paragraph">
<p>When we use the html formatter we append the filename that the report should be written to.<a href="#shot-910" id="shot-910" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a> Otherwise it will be written directly to the console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --format html:report.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the html that has been generated. <a href="#shot-911" id="shot-911" title="Open target/my-report in the browser" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Open target/my-report in the browser</a> As you can see, this generates a nicely structured HTML page that details what scenarios were run and whether the system behaved as expected.</p>
</div>
<div class="paragraph">
<p><a href="#shot-912" id="shot-912" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: run Cucumber</a>
Next, we&#8217;ll use the JSON formatter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --format json:report.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON report outputs the results in a single file. <a href="#shot-913" id="shot-913" title="open the json file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: open the json file</a> You can write your own script or program to post-process this file to generate your own report. Additionally,  many continuous integration servers understand the json format and can turn it into a nicely formatted report.</p>
</div>
<div class="paragraph">
<p>There is also a progress formatter,<a href="#shot-914" id="shot-914" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: run Cucumber</a> which just prints out a single character for each step.<a href="#shot-915" id="shot-915" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> This is the default formatter, which we used in earlier chapters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- --format progress</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-916" id="shot-916" title="run cucumber with multiple formatters" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: run cucumber with multiple formatters</a>
We can specify multiple formatters like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- -f html:report.html -f json:report.json -f progress</code></pre>
</div>
</div>
<div class="paragraph">
<p>The one without a path appended will be written to the console. If you ask multiple formatters to output to the console, only the last one mentioned will actually produce any output - which is why the pretty formatter has been replaced with progress formatter. <a href="#shot-917" id="shot-917" title="show the progress output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: show the progress output</a></p>
</div>
<div class="sect3">
<h4 id="_rerun_formatter">6.4.1. Rerun formatter</h4>
<div class="paragraph">
<p>One of the formatter plugins is rather special - the rerun formatter. Before we try it out, let’s make one of our scenarios fail. <a href="#shot-918" id="shot-918" title="Changes “Two shouts” scenario’s “Sean shouts "Free bagels!"” step to “Sean shouts "Free cupcakes!"" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: Changes “Two shouts” scenario’s “Sean shouts "Free bagels!"” step to “Sean shouts "Free cupcakes!"</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Two shouts
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"Free cupcakes!"</span>
      <span class="nf">And </span>Sean shouts <span class="s">"Free toast!"</span>
      <span class="err">Then Lucy hears the following messages</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels!</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Free</span> <span class="n">toast!</span>  <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And see it fail on the terminal. <a href="#shot-919" id="shot-919" title="run npm test and show failing output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: run npm test and show failing output</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>npm test</pre>
</div>
</div>
<div class="paragraph">
<p>We choose the rerun formatter <a href="#shot-920" id="shot-920" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a> and send the output to a file whose name is preceded by the <code>@</code> (at) sign.<a href="#shot-921" id="shot-921" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a> Let&#8217;s call it @rerun.txt.<a href="#shot-922" id="shot-922" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a> <a href="#shot-923" id="shot-923" title="run cucumber using rerun formatter" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: run cucumber using rerun formatter</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- -f rerun:@rerun.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s look at what’s in that @rerun.txt file. <a href="#shot-924" id="shot-924" title="open @rerun.txt" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: open @rerun.txt</a> It’s a list of the scenarios that failed! And the format looks familiar doesn’t it? It’s using the line number filtering format that we showed you earlier.</p>
</div>
<div class="paragraph">
<p>This is really useful when you have a few failing scenarios and you want to re-run only ones that failed. We tell Cucumber to run only the failed scenarios by pointing it at the rerun file. <a href="#shot-925" id="shot-925" title="run Cucumber using the @rerun.txt file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: run Cucumber using the @rerun.txt file</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>npm test -- @rerun.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a big time saver when you’re in the middle of a refactoring where you have broken a few scenarios and are working yourself back to green.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s fix the scenario <a href="#shot-926" id="shot-926" title="undo change in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17: undo change in feature file</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Two shouts
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"Free bagels!"</span>
      <span class="nf">And </span>Sean shouts <span class="s">"Free toast!"</span>
      <span class="err">Then Lucy hears the following messages</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels!</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Free</span> <span class="n">toast!</span>  <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and rerun the failing scenario again <a href="#shot-927" id="shot-927" title="run npm test from console" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: run npm test from console</a></p>
</div>
<div class="paragraph">
<p>Great. We&#8217;re back to green again.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_4">6.4.2. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_which_or_the_following_plugins_ship_with_cucumber_multiple_choice">Which or the following plugins ship with Cucumber? <strong> MULTIPLE-CHOICE </strong></h5>
<div class="ulist">
<ul>
<li>
<p>AsciiDoc ----FALSE</p>
</li>
<li>
<p>HTML ----TRUE</p>
</li>
<li>
<p>JSON ----TRUE</p>
</li>
<li>
<p>Jira ----FALSE</p>
</li>
<li>
<p>JUnit ----FALSE</p>
</li>
<li>
<p>Pretty ----FALSE</p>
</li>
<li>
<p>Progress ----TRUE</p>
</li>
<li>
<p>Rerun ----TRUE</p>
</li>
<li>
<p>XML ----FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Cucumber ships with lots of plugins. If the plugin that you want does not exist yet you can create your own or you can post-process the output of one of the standard plugins (JSON is often a starting point).</p>
</div>
<div class="paragraph">
<p>The Cucumber team support the @cucumber/pretty-formatter plugin, but it does not ship with cucumber-js and needs to be installed separately.</p>
</div>
<div class="paragraph">
<p>A newer plugin (that is out of scope for this course) is the <strong>message</strong> plugin. Internally, Cucumber generates messages that are used by the other plugins to create their output. The message plugin outputs these messages directly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_many_plugins_can_output_to_the_console_in_any_run_of_cucumber_multiple_choice">How many plugins can output to the console in any run of Cucumber? <strong> MULTIPLE-CHOICE </strong></h5>
<div class="ulist">
<ul>
<li>
<p>Zero ----TRUE</p>
</li>
<li>
<p>One ----TRUE</p>
</li>
<li>
<p>Many ----FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
So that the output remains easy to read, no more than one plugin is allowed to write to the console in any given run of Cucumber. You may choose to write the output of every plugin to file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_the_rerun_formatter_do">What does the rerun formatter do?</h5>
<div class="ulist">
<ul>
<li>
<p>It causes Cucumber to rerun each scenario multiple times</p>
</li>
<li>
<p>It causes Cucumber to rerun each failed scenario</p>
</li>
<li>
<p>It creates a file called rerun.txt that documents which scenarios failed</p>
</li>
<li>
<p>It outputs a list of failed scenarios identified by feature file and line number ----TRUE</p>
</li>
<li>
<p>It outputs a running total of how many times each scenario has ever been run</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The rerun formatter keeps track of the feature file and line number of every scenario that fails. This information is output in a feature file/line number format that can be saved to file. When provided to Cucumber as input (as long as the file name begins with a <code>@</code>), the identified scenarios will be run.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_results">6.5. Publishing Results</h3>
<div class="paragraph">
<p><a href="#shot-928" id="shot-928" title="show HTML output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: show HTML output</a>
In the last lesson we saw the output generated by the HTML plugin. This is a great way for your business colleagues and customers to engage with the development of the product. Since the scenarios are written in business language, they act as documentation that everyone interested in the product can understand. And, because the results are colour-coded green (if the system behaves as expected) or red (if it doesn&#8217;t) everyone can see what behaviour has been implemented.</p>
</div>
<div class="paragraph">
<p>The challenge is making sure that this documentation is easily available. Feature files are usually checked into source control along with the source code, which isn&#8217;t a great way of making it accessible to less technical team members. The HTML output can be shared, but it needs to be stored somewhere that everyone has access to - such as on your intranet or wiki. That&#8217;s something that your team has to configure themselves.</p>
</div>
<div class="paragraph">
<p>Since Cucumber-JS 7.0.0 there has been a new feature that allows you to automatically publish the results online to a free service called Cucumber Reports. <a href="#shot-929" id="shot-929" title="go to reports.cucumber.io" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: go to reports.cucumber.io</a></p>
</div>
<div class="paragraph">
<p>Ensure that you&#8217;re using Cucumber-JS 7.0.0 or later <a href="#shot-930" id="shot-930" title="show package-lock.json file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: show package-lock.json file</a></p>
</div>
<div class="listingblock">
<div class="title">package-lock.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="w">    </span><span class="nl">"@cucumber/cucumber"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.0.0"</span><span class="p">,</span><span class="w">
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and remove publish-quiet from cucumber.js. <a href="#shot-931" id="shot-931" title="cucumber.js" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: cucumber.js</a></p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--order</span><span class="nv"> </span><span class="s">random'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we run Cucumber, <a href="#shot-932" id="shot-932" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: npm test</a> it helpfully prints out a banner telling you how to publish your results to Cucumber Reports <a href="#shot-933" id="shot-933" title="highlight banner" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: highlight banner</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s follow the instructions in the banner and add --publish to cucumber.js <a href="#shot-934" id="shot-934" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a>.</p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--publish</span><span class="nv"> </span><span class="s">--order</span><span class="nv"> </span><span class="s">random'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can run Cucumber again and we get a different banner output shot:[1, "show published banner"]. The unique URL in this banner is the address of your published report <a href="#shot-935" id="shot-935" title="highlight URL" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: highlight URL</a>.</p>
</div>
<div class="paragraph">
<p><a href="#shot-936" id="shot-936" title="follow URL" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: follow URL</a>
Open the URL and you&#8217;ll find your report published in the same format as the HTML plugin. Now you can share the report just by sharing the URL. You also get some extra information about the run that generated the report. If you publish reports from a recognised CI server, then extra information is gathered <a href="#shot-937" id="shot-937" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="paragraph">
<p>You might have noticed the warning in the banner that says the report will "self-destruct". <a href="#shot-938" id="shot-938" title="highlight warning" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: highlight warning</a> To prevent a report from being deleted, it has to be associated with an authenticated account.</p>
</div>
<div class="paragraph">
<p>Follow the link in the report to authenticate your account <a href="#shot-939" id="shot-939" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a> You can then retrieve your Cucumber Reports publish token <a href="#shot-940" id="shot-940" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a>. Reports associated with a publish token will be kept until explicitly deleted.</p>
</div>
<div class="paragraph">
<p><a href="#shot-941" id="shot-941" title="publish quiet" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: publish quiet</a>
During development you probably won&#8217;t want to publish a report after every build&#8230;&#8203; and you might prefer not to see the banner output telling you about Cucumber Reports. Let&#8217;s fix this in cucumber.js by replacing --publish with --publish-quiet:</p>
</div>
<div class="listingblock">
<div class="title">cucumber.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="s">module.exports = { default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--publish-quiet</span><span class="nv"> </span><span class="s">--order</span><span class="nv"> </span><span class="s">random'</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-942" id="shot-942" title="no banner" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: no banner</a>
Now when we run Cucumber, no report is published and no banner advertising Cucumber Reports is output.</p>
</div>
<div class="paragraph">
<p>Cucumber Reports is under active development, so expect to see many more useful features coming in the coming months.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_3">6.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_why_did_the_cucumber_team_create_cucumber_reports">Why did the Cucumber team create Cucumber Reports?</h5>
<div class="ulist">
<ul>
<li>
<p>To enable the removal of the HTML formatter</p>
</li>
<li>
<p>To make it easier to share living documentation between stakeholders and team members ----TRUE</p>
</li>
<li>
<p>To provide a chargeable service for Cucumber users</p>
</li>
<li>
<p>To get a chance to play with cloud platforms</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The output from running Cucumber forms the basis of a system&#8217;s "living documentation". Before the existence of Cucumber Reports each team/organisation had to implement their own mechanism for sharing the living documentation, but now it&#8217;s as simple as asking Cucumber to publish it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_does_the_output_from_the_html_formatter_differ_from_that_displayed_by_cucumber_reports">How does the output from the HTML formatter differ from that displayed by Cucumber Reports?</h5>
<div class="ulist">
<ul>
<li>
<p>Cucumber Reports has much less detail that the HTML formatter</p>
</li>
<li>
<p>Cucumber Reports uses animated GIFs and emojis to make the living documentation more business-friendly</p>
</li>
<li>
<p>Cucumber Reports are identical to the HTML output, but include some extra information about the build environment ----TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The same underlying library generates the output for both Cucumber Reports and the HTML formatter. Cucumber Reports also displays some extra information about that run of Cucumber, summarising the execution context and scenario outcomes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_extra_information_can_be_published_by_cucumber_reports_multiple_choice">What extra information can be published by Cucumber Reports? <strong> MULTIPLE_CHOICE </strong></h5>
<div class="ulist">
<ul>
<li>
<p>Username of last committer ----FALSE</p>
</li>
<li>
<p>Version of Cucumber that generated the report ----TRUE</p>
</li>
<li>
<p>Identifier (SHA) of the last commit ----TRUE</p>
</li>
<li>
<p>Version of operating system that Cucumber ran on ----TRUE</p>
</li>
<li>
<p>Timestamp of when the report was generated ----FALSE</p>
</li>
<li>
<p>Cucumber configuration properties used ----FALSE</p>
</li>
<li>
<p>Number of scenarios that ran ----TRUE</p>
</li>
<li>
<p>Percentage of scenarios that passed ----TRUE</p>
</li>
<li>
<p>Version of CI tool that ran Cucumber ----TRUE</p>
</li>
<li>
<p>Code coverage statistics for run ----FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Cucumber Reports always publishes:
* High level statistics of scenarios run and their status
* Elapsed time since the report was generated
* The time it took to run the scenarios and generate the report
* Operating system version
* Language version used for stepdefs
* Cucumber version</p>
</div>
<div class="paragraph">
<p>If Cucumber Reports was run by a supported CI tool, it also publishes:
* CI tool version
* Identifier (SHA) of the last commit</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_happens_to_reports_that_are_not_associated_with_a_publish_token">What happens to reports that are not associated with a "publish token"</h5>
<div class="ulist">
<ul>
<li>
<p>The report is not published</p>
</li>
<li>
<p>The report is published and cannot be deleted</p>
</li>
<li>
<p>The report is published and will be deleted automatically ----TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Reports that are not associated with a publish token will be deleted approximately 24 hours after being published. Once published, a report can be associated with a publish token, which will then preserve the report until it is explicitly deleted.</p>
</div>
<div class="paragraph">
<p>For more details on publish tokens, authentication, and association with Github repositories, see reports.cucumber.io</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_details">7. Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the last lesson we took a break from the code to sharpen up your skills with Cucumber’s command-line interface.</p>
</div>
<div class="paragraph">
<p>Now it’s time to dive right back into the code. We’re going to explore one of the hottest topics that teams come across when they start to get to grips with Cucumber and BDD: how much detail to use in your scenarios.</p>
</div>
<div class="paragraph">
<p>Many teams find they can’t easily agree on this. It can often seem like a matter of personal preference. It’s true there are no right and wrong answers, but we’re going to teach you some heuristics you can apply to help you make better decisions.</p>
</div>
<div class="sect2">
<h3 id="_premium_accounts_with_a_bug">7.1. Premium Accounts! With a bug!</h3>
<div class="paragraph">
<p>Once again, while we were away, the developers of Shouty have been busy. A new hot-shot ninja rock-star subcontractor, Stevie, has built a new feature called <em>premium accounts</em>. We don’t know much about it yet but, our tester Tamsin has reported a bug from their manual exploratory testing, and it’s up to us tofix it.</p>
</div>
<div class="sect3">
<h4 id="_the_bug">7.1.1. The bug</h4>
<div class="paragraph">
<p>Tamsin has helpfully documented the bug as a failing scenario. Here is it:</p>
</div>
<div class="paragraph">
<p><a href="#shot-943" id="shot-943" title="Run cucumber with @todo tag" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Run cucumber with @todo tag</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ cucumber --tags @todo

Feature: Premium accounts

  @todo
  Scenario: BUG #2789
    Given Sean has bought 30 credits
    When Sean shouts "buy, buy buy!"
    Then Sean should have 25 credits
      Expected: 25
          Got: 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hum. So let’s try and figure out what this is all about. Sean starts out with some credits,
<a href="#shot-944" id="shot-944" title="Highlight first step" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Highlight first step</a>
presumably that&#8217;s what gives his account premium status?</p>
</div>
<div class="paragraph">
<p>As a result of that shout, he’s obviously supposed to have some credits deducted. Tamsin’s scenario says that the correct behaviour is for 5 credits to be deducted, leaving him with 25 credits. As we can see from running the test, the system is deducting 15 credits instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_the_new_feature">7.1.2. Reading the new feature</h4>
<div class="paragraph">
<p>Let’s read the whole feature file - that should tell us some more about how the system is supposed to behave.</p>
</div>
<div class="paragraph">
<p><a href="#shot-945" id="shot-945" title="Open premium_accounts.feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Open premium_accounts.feature</a>
Oh my.</p>
</div>
<div class="paragraph">
<p>This is very difficult to read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Premium account

  <span class="kn">Background</span><span class="p">:</span>
    <span class="nf">Given </span>the range is 100
    <span class="nf">And </span>people are located at
      <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Lucy</span> <span class="p">|</span>
      <span class="p">|</span> <span class="n">location</span> <span class="p">|</span> <span class="n">0</span>    <span class="p">|</span> <span class="n">100</span>  <span class="p">|</span>

  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts <span class="s">"Come and buy a coffee"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"My bagels are yummy"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Free cookie with your espresso for the next hour"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Who will buy my sweet red muffins?"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Buy my delicious sausage rolls"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      Here are some things you will love about Sean's:
      - the bagels
      - the coffee
      - the chickens
      Come and visit us today! We'd really love to see you.
      Pop round anytime, honestly it's fine.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"We have cakes by the dozen"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits

  <span class="nt">@todo</span>
  <span class="kn">Scenario</span><span class="p">:</span> BUG <span class="c">#2789</span>
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts <span class="s">"buy, buy buy!"</span>
    <span class="nf">Then </span>Sean should have 25 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apart from Tamsin’s new bug report scenario at the bottom, there’s only one scenario, and it’s long! I think I can count twelve steps altogether, excluding the background steps. As a general guideline, we like our scenarios to be no longer than about five steps long, so this is big.</p>
</div>
<div class="paragraph">
<p>The scenario has several <code>When</code> steps - nine of them in all! - which is often a sign that the scenario is trying to test more than one business rule at a time.</p>
</div>
<div class="paragraph">
<p>We normally like to document the business rules in the Gherkin, and add a few paragraphs of prose description, but there&#8217;s no <code>Rule</code> keyword and the description section is blank, so we haven’t been left any clues there.</p>
</div>
<div class="paragraph">
<p>Let’s see if we can gleam the rules from reading the scenario carefully. Sean starts out with 30 credits and ends up with 11, but why?</p>
</div>
<div class="paragraph">
<p>There’s so much detail here. I wonder which bits are important. Could it be the number of words Sean shouts that affects his credits? Or the number of messages? Based on Tamsin’s test case, maybe the word “buy” is important&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>It’s really hard to tell.</p>
</div>
<div class="paragraph">
<p>It’s interesting that Lucy hears all Sean’s messages - even these ones which look to be over 180 characters and would normally be blocked. Perhaps premium accounts get to send messages over 180 characters in exchange for credits?</p>
</div>
<div class="paragraph">
<p>This is a classic example of a scenario written by someone who is using Cucumber as a <em>testing</em> tool rather than a <em>documentation</em> tool. This scenario may well work as an effective test, but it&#8217;s terrible documentation. We have no clear idea from reading it what the system is supposed to do.</p>
</div>
<div class="paragraph">
<p>Let’s try reading the code instead.</p>
</div>
<div class="paragraph">
<p><a href="#shot-946" id="shot-946" title="Open Network class" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Open Network class</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">Network</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span>
  <span class="p">}</span>

  <span class="nx">subscribe</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">shortEnough</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">180</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">listener</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">withinRange</span> <span class="o">=</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">location</span> <span class="o">-</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">withinRange</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">shortEnough</span> <span class="o">||</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">listener</span><span class="p">.</span><span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/gi</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>OK, so we have a <code>deductCredits</code> method here that seems to encapsulate the rules. It looks like over-long messages - messages that are not short enough - cost two credits, and each time the word “buy” is mentioned, we deduct 5 credits.</p>
</div>
<div class="paragraph">
<p>It’s a good job we know how to read code!</p>
</div>
<div class="paragraph">
<p>One of the promises of BDD is that our feature files become the single source of truth for the whole team. Yet here, the scenario does such a poor job of documenting what the system does, we had to go hunting for the truth in the code. That’s fine for us, because we know how to read code, but it’s excluded anyone on our team who isn’t technical. How would they be able to understand the behaviour of premium accounts at the moment?</p>
</div>
<div class="paragraph">
<p>We need to fix this feature file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_3">7.1.3. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_which_do_we_think_are_the_correct_business_rules_in_shouty_problem_domain">Which do we think are the correct business rules in Shouty problem domain?</h5>
<div class="ulist">
<ul>
<li>
<p>Mentioning the word "buy" costs 5 credits (<strong>Correct</strong>)</p>
</li>
<li>
<p>Mentioning the word "buy" costs 25 credits</p>
</li>
<li>
<p>A message that&#8217;s not short enough costs 2 credits (<strong>Correct</strong>)</p>
</li>
<li>
<p>Each message costs 11 credits</p>
</li>
<li>
<p>Each word costs 1 credit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>In the end, we discovered that the business rules appear to be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mention the word "buy" and you lose 5 credits.</p>
</li>
<li>
<p>Long messages cost 2 credits</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_how_did_we_discover_the_business_rules">How did we discover the business rules?</h5>
<div class="ulist">
<ul>
<li>
<p>They were clearly documented in the Gherkin</p>
</li>
<li>
<p>We went and talked to the stakeholders</p>
</li>
<li>
<p>We had to read the code (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Talking to the stakeholders would be great if we had easy access to them, but they&#8217;re often busy and certainly don&#8217;t want to have to repeat themselves over and over to the delivery team. If we&#8217;ve had them tell us the business rules once, it&#8217;s a good idea for us to document them clearly in a place that everyone can read.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_is_it_a_problem_that_the_business_rules_could_only_be_found_in_the_code">Why is it a problem that the business rules could only be found in the code?</h5>
<div class="ulist">
<ul>
<li>
<p>Not everyone can read code, so not everyone can look up the business rules when they want to (<strong>Correct</strong>)</p>
</li>
<li>
<p>Code is always changing</p>
</li>
<li>
<p>The code could be badly designed and hard to read (<strong>Correct</strong>)</p>
</li>
<li>
<p>Business rules in code can&#8217;t be validated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>The code is the ultimate source of truth for the system&#8217;s behaviour, but it&#8217;s often difficult for even experienced developers to read code and know exactly what it will do. Certainly, less technical team memmbers are completely excluded from this source of truth.</p>
</div>
<div class="paragraph">
<p>The advantage of using Gherkin together with Cucumber to validate it, is that you get a <em>single source of truth</em> that everyone on the team can read.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_makes_it_hard_to_understand_the_business_rules_from_stevies_scenario_test_premium_account_features">What makes it hard to understand the business rules from Stevie&#8217;s scenario, "Test premium account features"</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s long (<strong>Correct</strong>)</p>
</li>
<li>
<p>It&#8217;s trying to test multiple business rules at the same time (<strong>Correct</strong>)</p>
</li>
<li>
<p>It doesn&#8217;t document the business rules that the scenarios are supposed to illustrate (<strong>Correct</strong>)</p>
</li>
<li>
<p>It has too much detail (<strong>Correct</strong>)</p>
</li>
<li>
<p>The name of the scenario does not describe a specific aspect of the system&#8217;s behaviour (<strong>Correct</strong>)</p>
</li>
<li>
<p>It&#8217;s designed to be a test, rather than documentation (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>We made up this example to showcase some of the classic mistakes we&#8217;ve seen people make with their scenarios. In lesson 3 we&#8217;ll show you some specific criteria you can use to judge the quality of your team&#8217;s scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clarifying_the_rules">7.2. Clarifying the rules</h3>
<div class="paragraph">
<p><a href="#shot-947" id="shot-947" title="Opens the premium accounts feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Opens the premium accounts feature file</a></p>
</div>
<div class="paragraph">
<p>This seems like a good time to ask our domain experts for clarification about this behaviour. Ideally a three amigos meeting would have done this already, but things don’t always go according to the script. Let’s pay a visit to our product owner.</p>
</div>
<div class="paragraph">
<p>Paula the product owner tells us the rules are as follows:
<a href="#shot-948" id="shot-948" title="Writes the rules up in the feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Writes the rules up in the feature file</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Premium account

    <span class="err">Rules</span><span class="p">:</span>
    <span class="nf">* </span>Mention the word <span class="s">"buy"</span> and you lose 5 credits.
    <span class="nf">* </span>Long messages cost 2 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve just scribbled these down in the feature description for now, but later, once we&#8217;ve teased this scenario apart, we&#8217;ll be able to use the <code>Rule</code> keyword as we showed you in chapter 4.</p>
</div>
<div class="paragraph">
<p>OK, well that helps us a great deal, but this scenario is still doing a poor job of illustrating those rules. Let’s take a moment to understand why.</p>
</div>
<div class="paragraph">
<p><a href="#shot-949" id="shot-949" title="07.03.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: 07.03.animation.mp4</a></p>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1NxU_CzKngKaGGxnoaxxbmSZngaz9VGDG" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>It’s all about the details.</p>
</div>
<div class="paragraph">
<p>When you’re first exploring a new domain problem, details like the exact messages people have shouted are a great way to shine light into the dark corners of your ignorance. They bring examples to life by making them vivid and real. This encourages what we call <em>divergent thinking</em>, which helps you discover even more examples as you explore the behaviour you need to provide.</p>
</div>
<div class="paragraph">
<p>In BDD, we call this <em>deliberate discovery</em>, when we try to explore the problem domain as thoroughly as we can. Details are good here.</p>
</div>
<div class="paragraph">
<p>At some point, however, we need to write a computer program. When that time comes, we need to switch to <em>convergent thinking</em> and try to distill down all that detail into something that clearly communicates the essence of the behaviour. Now, too much detail can be distracting, or even misleading to our future readers. We call these <em>incidental details</em>.</p>
</div>
<div class="paragraph">
<p>Being able to distill down the essence of a scenario with too much detail is a skill you&#8217;ll find yourself practicing time and time again as a BDD practitioner, since we almost always deliberately start with too much detail, then want to refine it afterwards as it becomes more clear which details are relevant, and which are incidental.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_5">7.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_why_did_we_confirm_the_business_rules_with_our_product_owner_paula">Why did we confirm the business rules with our product owner, Paula?</h5>
<div class="ulist">
<ul>
<li>
<p>Paula will fire us if we get the business rules wrong</p>
</li>
<li>
<p>As Product Owner, it&#8217;s Paula&#8217;s responsibilty to decide which rules we should implement in our code (<strong>Correct</strong>)</p>
</li>
<li>
<p>We want to as confident as we can that they&#8217;re correct before we proceed (<strong>Correct</strong>)</p>
</li>
<li>
<p>We don&#8217;t want Paula to feel left out</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Teams should collaborate to discover and decide on the business rules their code should implement but ultimately, on most teams, it&#8217;s the Product Owner&#8217;s decision what is "correct" or incorrect behaviour.</p>
</div>
<div class="paragraph">
<p>Getting this clarified only takes a few minuutes, and can save us potentially wasting our time further down the line building upon an earlier misunderstanding.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_not_use_the_rule_keyword_as_described_in_chapter_4">Why did we not use the Rule: keyword as described in chapter 4?</h5>
<div class="ulist">
<ul>
<li>
<p>The version of Cucumber we&#8217;re using doesn&#8217;t support it</p>
</li>
<li>
<p>Paula doesn&#8217;t like that way of writing Rules in Gherkin</p>
</li>
<li>
<p>The big scenario is covering multiple rules, so we couldn&#8217;t place it under a single Rule (<strong>Correect</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Before we had the <code>Rule</code> keyword in Gherkin, we always used to recommend to teams to write their rules down at the top of the feature file. This works great, but using the <code>Rule</code> keyword to make an explicit link between each scenario and the rule it illustrates is even better. As soon as we&#8217;ve broken this scenario down into smaller ones that only illustrate one rule, we can do that.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_these_statements_are_true">Which of these statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Using real details in your scenario can help with divergent thinking (<strong>Correct</strong>)</p>
</li>
<li>
<p>Divergent thinking closes our minds to the possiblity of scenarios we haven&#8217;t thought of</p>
</li>
<li>
<p>Details are things like real names of people or products, dates, or amounts (<strong>Correct</strong>)</p>
</li>
<li>
<p>Finding the right level of detail to use in a scenario is easy</p>
</li>
<li>
<p>Incidental details are details that aren&#8217;t relevent to the purpose of the scenario (<strong>Correct</strong>)</p>
</li>
<li>
<p>If your team can&#8217;t agree on the right level of detail then you should give up on BDD</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Finding the right level of detail, and discerning which details are incidential to your scenario is a difficult, subjective process. The key thing to do is keep trying. Each time you talk about it as a team, you will better align your perspectives (as long as you listen to each other!) and hone your own domain language.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keeping_your_scenarios_brief">7.3. Keeping your scenarios BRIEF</h3>
<div class="paragraph">
<p>Seb Rose came up with a brilliant acronym to help you remember six heuristics or guidelines to think about when reviewing the quality of your scenarios: BRIEF.</p>
</div>
<div class="paragraph">
<p>"B" is for <strong>Business language:</strong> The words used in a scenario should be drawn from the business domain, otherwise you will not be able to engage your business colleagues painlessly. The language you use should use terms that business team members understand unambiguously.</p>
</div>
<div class="paragraph">
<p>"R" is for <strong>Real data:</strong> When you&#8217;re first discussing the details of a story, your examples should use concrete, real data. This helps bring the scenarios to life, and expose boundary conditions and underlying assumptions early in the development process. When writing scenarios, we should also use real data whenever this helps reveal intention and make them move vivid.</p>
</div>
<div class="paragraph">
<p>"I" is for <strong>Intention revealing:</strong> Scenarios should describe the intent of what the actors in the scenario are trying to achieve, rather than describing the mechanics of how they will achieve it. We should start by giving the scenario an intention revealing name, and then follow through by ensuring that every line in the scenario describes intent, not mechanics.</p>
</div>
<div class="paragraph">
<p>"E" is for <strong>Essential:</strong> The purpose of a scenario is to illustrate how a rule should behave. Any parts of a scenario that don&#8217;t directly contribute to this purpose are <em>incidental</em> and should be removed. If they are important to the system, then they will be covered in other scenarios that illustrate other rules. Additionally, any scenarios that do not add to the reader&#8217;s understanding of the expected behaviour have no place in the documentation.</p>
</div>
<div class="paragraph">
<p>"F" is for <strong>Focused:</strong> Most scenarios should be focused on illustrating a single rule.</p>
</div>
<div class="paragraph">
<p>You might have noticed we said "six heuristics" but we only gave you five. That&#8217;s because the word <em>Brief</em> itself is the sixth guideline. We suggest you try to restrict most of your scenarios to five lines or fewer. This makes them easier to read, much easier to reason about, and helps avoid that temptation to test multiple rules, or add incidental details.</p>
</div>
<div class="sect3">
<h4 id="_review_our_new_feature_using_the_brief_heuristics">7.3.1. Review our new feature using the BRIEF heuristics</h4>
<div class="paragraph">
<p>Let&#8217;s have a look at this new Premium Accounts scenario <a href="#shot-950" id="shot-950" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a> and use the BRIEF heuristics to help us look for ways to improve it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Premium account

  <span class="kn">Background</span><span class="p">:</span>
    <span class="nf">Given </span>the range is 100
    <span class="nf">And </span>people are located at
      <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Lucy</span> <span class="p">|</span>
      <span class="p">|</span> <span class="n">location</span> <span class="p">|</span> <span class="n">0</span>    <span class="p">|</span> <span class="n">100</span>  <span class="p">|</span>

  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts <span class="s">"Come and buy a coffee"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"My bagels are yummy"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Free cookie with your espresso for the next hour"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Who will buy my sweet red muffins?"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Buy my delicious sausage rolls"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      Here are some things you will love about Sean's:
      - the bagels
      - the coffee
      - the chickens
      Come and visit us today! We'd really love to see you.
      Pop round anytime, honestly it's fine.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"We have cakes by the dozen"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_b_is_for_business_language">B is for Business Language</h5>
<div class="paragraph">
<p>Firstly, does this scenario use business language?</p>
</div>
<div class="paragraph">
<p>Well, we can see words like "credits" and "shout" and "message" which look like terms from our problem domain&#8217;s <em>ubiquitous language</em>, but there are also a lot of words in these scenarios that are nothing to do with our domain - words like "cakes" or "chickens" or "muffins" for example. Granted, all these words are surrounded by quotes, but they&#8217;re still distracting.</p>
</div>
</div>
<div class="sect4">
<h5 id="_r_is_for_real_data">R is for Real Data</h5>
<div class="paragraph">
<p>Do these scenarios use real data? Without seeing the user research, it looks like they do. We&#8217;re not talking about "User A" or "A message", but instead we&#8217;re using realistic examples of the kinds of messages genuine users of our app might send to each other.</p>
</div>
</div>
<div class="sect4">
<h5 id="_i_is_for_intention_revealing">I is for Intention Revealing</h5>
<div class="paragraph">
<p>This one really hits the nail on the head. The intention of this scenario is completely obscured by all the detail. As we said earlier, we have no idea from this Gherkin what is special about these messages, or how they contribute to the final tally of expected credits. We had to go down into the code to start to figure that out.</p>
</div>
</div>
<div class="sect4">
<h5 id="_e_is_for_essential">E is for Essential</h5>
<div class="paragraph">
<p>It&#8217;s hard to know whether every step here is essential to the purpose of this scenario, because we don&#8217;t even know what it&#8217;s purpose is yet! Once we&#8217;ve made the steps more intention revealing it will be easier to see if they&#8217;re all essential.</p>
</div>
</div>
<div class="sect4">
<h5 id="_f_is_for_focussed">F is for Focussed</h5>
<div class="paragraph">
<p>We&#8217;re not quite clear what exactly the rules are that underpin the behaviour in this scenario (yet) but we have a hunch that there&#8217;s more than one rule being played out here. So we&#8217;re not looking good on this heuristic.</p>
</div>
</div>
<div class="sect4">
<h5 id="_and_is_it_brief">And is it Brief?</h5>
<div class="paragraph">
<p>Certainly, this scenario is well over five lines long. So not Brief.</p>
</div>
<div class="paragraph">
<p>So we have some work to do!</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_4">7.3.2. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_what_do_we_mean_when_we_say_that_brief_is_a_set_of_heuristics">What do we mean when we say that BRIEF is a set of "heuristics"?</h5>
<div class="ulist">
<ul>
<li>
<p>We should follow them precisely or the BDD police will surely come and arrest us</p>
</li>
<li>
<p>We can use them to guide our work, but we may find times when they&#8217;re not approriate in our context (<strong>Correct</strong>)</p>
</li>
<li>
<p>They are complicated and hard to remember</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Heuristics are mental shortcuts - general guidelines that are easy to remember and can be trusted to work in most (but not all!) contexts.</p>
</div>
</div>
<div class="sect4">
<h5 id="_b_in_brief_is_for">B in "BRIEF" is for&#8230;&#8203;</h5>
<div class="ulist">
<ul>
<li>
<p>Behaviour Describing - scenarios should describe behaviour</p>
</li>
<li>
<p>Big - scenarios should have as many steps as possible</p>
</li>
<li>
<p>Business Lanaguage - the language in your scenario should come from the business problem domain (<strong>Correct</strong>)</p>
</li>
<li>
<p>Basic - keep it simple, don&#8217;t add extraneous information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>"B" is for <strong>Business language:</strong> The words used in a scenario should be drawn from the business domain, otherwise you will not be able to engage your business colleagues painlessly. The language you use should use terms that business team members understand unambiguously.</p>
</div>
</div>
<div class="sect4">
<h5 id="_r_in_brief_stands_for_real_data_in_the_context_of_an_atm_which_of_these_steps_follow_this_heuristic">"R" in BRIEF stands for "Real Data". In the context of an ATM, which of these steps follow this heuristic?</h5>
<div class="ulist">
<ul>
<li>
<p>When Bobby makes a withdrawl of $50 (<strong>Correct</strong>)</p>
</li>
<li>
<p>Given "User A" has opened an account</p>
</li>
<li>
<p>Given an account with an arranged overdraft of $123</p>
</li>
<li>
<p>When the user changes their PIN to 0000 (<strong>Correct</strong>)</p>
</li>
<li>
<p>Given a cheque for $19.99 was deposited on 2021-04-01 (<strong>Correct</strong>)</p>
</li>
<li>
<p>When Bobby makes a withdrawl of $1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>"R" is for <strong>Real data:</strong> When you&#8217;re first discussing the details of a story, your examples should use concrete, real data. This helps bring the scenarios to life, and expose boundary conditions and underlying assumptions early in the development process. When writing scenarios, we should also use real data whenever this helps reveal intention and make them move vivid.</p>
</div>
<div class="paragraph">
<p>Arguably, the PIN of 0000 is not very realistic, but if this step is being used in a scenario to describe validation rules for new PIN numbers, this could be entirely appropriate real-world data for an invalid PIN.</p>
</div>
<div class="paragraph">
<p>It&#8217;s impossible to withdraw $1 from most ATMs, so this is not real data. Similarly, most banks won&#8217;t let you set an overdraft of $123. We can be more imaginative than calling our user "User A".</p>
</div>
</div>
<div class="sect4">
<h5 id="_i_in_brief_stands_for_intention_revealing_which_of_these_steps_are_good_at_revealing_their_intention">"I" in BRIEF stands for "Intention Revealing". Which of these steps are good at revealing their intention?</h5>
<div class="ulist">
<ul>
<li>
<p>When Bobby makes a withdrawl of $50 (<strong>Correct</strong>)</p>
</li>
<li>
<p>When I click on ".btn-primary"</p>
</li>
<li>
<p>When I log in (<strong>Correct</strong>)</p>
</li>
<li>
<p>Then the response should match "data/test_response-4591.json"</p>
</li>
<li>
<p>Then the response should contain balance of $50 (<strong>Correct</strong>)</p>
</li>
<li>
<p>When I fill in "input[type=text].search" with "Zen Motorcycle"</p>
</li>
<li>
<p>When I search for "Zen Motorcycle" (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>"I" is for <strong>Intention revealing:</strong> Scenarios should describe the intent of what the actors in the scenario are trying to achieve, rather than describing the mechanics of how they will achieve it. We should start by giving the scenario an intention revealing name, and then follow through by ensuring that every line in the scenario describes intent, not mechanics.</p>
</div>
</div>
<div class="sect4">
<h5 id="_e_in_brief_stands_for_essential_look_at_this_scenario_then_select_the_steps_that_are_essential">"E" in BRIEF stands for "Essential". Look at this scenario, then select the steps that are essential.</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Search

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Search</span> <span class="err">result</span> <span class="err">includes</span> <span class="err">any</span> <span class="err">title</span> <span class="err">containing</span> <span class="err">all</span> <span class="err">keywords</span> <span class="err">in</span> <span class="err">the</span> <span class="err">search</span>

    <span class="kn">Scenario</span><span class="p">:</span> Two keywords, only one book matches both
      <span class="nf">Given </span>a publisher <span class="s">"Penguin"</span>
      <span class="nf">And </span>a book <span class="s">"Zen and the Art of Motorcycle Maintenance"</span> is in stock
      <span class="nf">And </span>a book <span class="s">"The Art of Zen Gardens"</span> is in stock
      <span class="nf">And </span>I already have three books on loan
      <span class="nf">When </span>I nagivate to the search page via the main menu
      <span class="nf">And </span>I search for <span class="s">"Zen Motorcycle"</span>
      <span class="nf">Then </span>there should be 1 result
      <span class="err">And the results should include</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Title</span>                                     <span class="p">|</span>
        <span class="p">|</span> <span class="n">Zen</span> <span class="n">and</span> <span class="n">the</span> <span class="n">Art</span> <span class="n">of</span> <span class="n">Motorcycle</span> <span class="n">Maintenance</span> <span class="p">|</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Given a publisher "Penguin"</p>
</li>
<li>
<p>And a book "Zen and the Art of Motorcycle Maintenance" is in stock (<strong>Correct</strong>)</p>
</li>
<li>
<p>And a book "The Art of Zen Gardens" is in stock (<strong>Correct</strong>)</p>
</li>
<li>
<p>And I already have three books on loan</p>
</li>
<li>
<p>When I nagivate to the search page via the main menu</p>
</li>
<li>
<p>And I search for "Zen Motorcycle" (<strong>Correct</strong>)</p>
</li>
<li>
<p>Then there should be 1 result (<strong>Correct</strong>)</p>
</li>
<li>
<p>And the results should include: (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>"E" is for <strong>Essential:</strong> The purpose of a scenario is to illustrate how a rule should behave. Any parts of a scenario that don&#8217;t directly contribute to this purpose are <em>incidental</em> and should be removed. If they are important to the system, then they will be covered in other scenarios that illustrate other rules. Additionally, any scenarios that do not add to the reader&#8217;s understanding of the expected behaviour have no place in the documentation.</p>
</div>
<div class="paragraph">
<p>The step about creating a publisher is incedental as the publisher does not appear anywhere else in the scenario. Perhaps the team added it because there&#8217;s a database relationship between books and publishers, and you can&#8217;t create a book without a publisher. That&#8217;s not a good reason to clutter up your scenario. Instead, you can use patterns like "test data builder" to create your Publisher automatically when you create a Book.</p>
</div>
<div class="paragraph">
<p>The step about having books on load is incidental because the number of books on loan, as far as we can tell, has no bearing on the behaviour of the search, which is what this scenario is focussed on.</p>
</div>
<div class="paragraph">
<p>The step about navigation is incidental. We are describing the business logic here, not the UI navigation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_f_is_for_focused_most_scenarios_should_be_focused_on_illustrating_a_single_rule_why">"F" is for <strong>Focused:</strong> Most scenarios should be focused on illustrating a single rule. Why?</h5>
<div class="ulist">
<ul>
<li>
<p>If a scenario fails, it&#8217;s difficult to know what&#8217;s broken. (<strong>Correct</strong>)</p>
</li>
<li>
<p>It makes it hard to develop the user interface for the feature</p>
</li>
<li>
<p>It encourages you to add behaviour in small increments (<strong>Correct</strong>)</p>
</li>
<li>
<p>It helps you to make sure you have good coverage of your business rules (<strong>Correct</strong>)</p>
</li>
<li>
<p>It keeps the code clean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>BDD is an extension of TDD, or Test-Driven Development. In both these practices, we gradually add new behaviour, with each test demanding a little more behaviour from the system. Working like this, it makes sense to work in small increments, adding focussed scenarios so that we can iterate rapidly and keep a good flow going.</p>
</div>
<div class="paragraph">
<p>A pleasant side-effect of working this way is that each test has a single purpose, and so has fewer reasons to fail. So when a regression occurs, you tend to get a clear signal from the failing scenario about what&#8217;s broken. Compare this with having a single huge scenario that covers a lot of behaviour. When that fails, you know something&#8217;s wrong but you don&#8217;t have much idea about where to go to start fixing it.</p>
</div>
<div class="paragraph">
<p>When you&#8217;re concious of the relationship between rules and example, and you want to make sure all of your rules are covered, it&#8217;s much easier to do that and see clearly where you might have gaps if each of your examples covers a single rule.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_distilling_the_essence">7.4. Distilling the essence</h3>
<div class="paragraph">
<p>Let’s try to distill the essence of this scenario by removing the incidental details.</p>
</div>
<div class="paragraph">
<p><a href="#shot-951" id="shot-951" title="Opens the premium account feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Opens the premium account feature</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts <span class="s">"Come and buy a coffee"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"My bagels are yummy"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Free cookie with your espresso for the next hour"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Who will buy my sweet red muffins?"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Buy my delicious sausage rolls"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      Here are some things you will love about Sean's:
      - the bagels
      - the coffee
      - the chickens
      Come and visit us today! We'd really love to see you.
      Pop round anytime, honestly it's fine.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"We have cakes by the dozen"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can start with this step, <code>When Sean shouts "Come and buy a coffee".</code> <a href="#shot-952" id="shot-952" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="paragraph">
<p>From what what we know about the rules, what’s important here is that the shout contains the word “buy”. So let’s write that:</p>
</div>
<div class="paragraph">
<p><a href="#shot-953" id="shot-953" title="Changes step to When Sean shouts a message containing the word " style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: Changes step to When Sean shouts a message containing the word </a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Better. We still have a little bit of detail - the word buy - but that’s quite important, in fact it helps to illustrate our business rule.</p>
</div>
<div class="paragraph">
<p>We’ll need a new step definition for this, of course.</p>
</div>
<div class="paragraph">
<p><a href="#shot-954" id="shot-954" title="Runs <code>cucumber --tags ~@todo</code>, copies / pastes step def snippet into steps file." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: Runs <code>cucumber --tags ~@todo</code>, copies / pastes step def snippet into steps file.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">npm <span class="nb">exec </span>cucumber-js <span class="nt">--</span> <span class="nt">--tags</span> <span class="s2">"not @todo"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-955" id="shot-955" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a>
We can just copy the code for shouting a message from this step down here for now. We will deal with this duplication, but later.</p>
</div>
<div class="paragraph">
<p><a href="#shot-956" id="shot-956" title="Copies code from step def below, then adds code above to create a test message containing the given word." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: Copies code from step def below, then adds code above to create a test message containing the given word.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean shouts a message containing the word {string}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`A message containing the word </span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s run Cucumber to check we haven’t made any mistakes…</p>
</div>
<div class="paragraph">
<p><a href="#shot-957" id="shot-957" title="Runs <code>cucumber --tags ~@todo</code>." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: Runs <code>cucumber --tags ~@todo</code>.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">npm <span class="nb">exec </span>cucumber-js <span class="nt">--</span> <span class="nt">--tags</span> <span class="s2">"not @todo"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All green. Good.</p>
</div>
<div class="paragraph">
<p>Now we can use that same step everywhere else in the scenario, too, where that is the real intent of the step.
<a href="#shot-958" id="shot-958" title="Changes the other two steps that mention the word “buy”. Runs <code>cucumber --tags ~@todo</code>. All green." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: Changes the other two steps that mention the word “buy”. Runs <code>cucumber --tags ~@todo</code>. All green.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"My bagels are yummy"</span>
    <span class="nf">And </span>Sean shouts <span class="s">"Free cookie with your espresso for the next hour"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span>
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span>
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      Here are some things you will love about Sean's:
      - the bagels
      - the coffee
      - the chickens
      Come and visit us today! We'd really love to see you.
      Pop round anytime, honestly it's fine.
      """</span>
    <span class="nf">And </span>Sean shouts <span class="s">"We have cakes by the dozen"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>And run cucumber again. <a href="#shot-959" id="shot-959" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">npm <span class="nb">exec </span>cucumber-js <span class="nt">--</span> <span class="nt">--tags</span> <span class="s2">"not @todo"</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_distill_the_regular_shout_step">7.4.1. Distill the regular shout step</h4>
<div class="paragraph">
<p>We can apply this same pattern to remove the noisy incidental details from this next step too. What’s the essence of this step? <a href="#shot-960" id="shot-960" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts <span class="s">"My bagels are yummy"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, it really doesn’t matter what Sean is shouting - a regular shout doesn’t have any effect on his premium account credits. So we could just re-word it like this:</p>
</div>
<div class="paragraph">
<p><a href="#shot-961" id="shot-961" title="Changes the step from And Sean shouts " style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: Changes the step from And Sean shouts </a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts a message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we’ll need a new step definition, and again, we’ll just duplicate the code for shouting a message for now.</p>
</div>
<div class="paragraph">
<p><a href="#shot-962" id="shot-962" title="Runs <code>cucumber --tags ~@todo</code>,  copies snippet. Copies shouting code from step def below, then adds code above to create a test message." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: Runs <code>cucumber --tags ~@todo</code>,  copies snippet. Copies shouting code from step def below, then adds code above to create a test message.</a><a href="#shot-963" id="shot-963" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean shouts a message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">A message from Sean</span><span class="dl">"</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We’ll run Cucumber again just in case&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><a href="#shot-964" id="shot-964" title="Runs <code>cucumber --tags ~@todo</code>." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: Runs <code>cucumber --tags ~@todo</code>.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">npm <span class="nb">exec </span>cucumber-js <span class="nt">--</span> <span class="nt">--tags</span> <span class="s2">"not @todo"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All green.</p>
</div>
<div class="paragraph">
<p>And finally, let’s use that new step everywhere we can…</p>
</div>
<div class="paragraph">
<p><a href="#shot-965" id="shot-965" title="Changes two steps to that shout regular messages to use the new step" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: Changes two steps to that shout regular messages to use the new step</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts a message
    <span class="nf">And </span>Sean shouts a message
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span>
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span>
    <span class="nf">When </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      Here are some things you will love about Sean's:
      - the bagels
      - the coffee
      - the chickens
      Come and visit us today! We'd really love to see you.
      Pop round anytime, honestly it's fine.
      """</span>
    <span class="nf">And </span>Sean shouts a message
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and run Cucumber once again.</p>
</div>
<div class="paragraph">
<p><a href="#shot-966" id="shot-966" title="Runs `cucumber --tags ~@todo`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: Runs `cucumber --tags ~@todo`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">npm <span class="nb">exec </span>cucumber-js <span class="nt">--</span> <span class="nt">--tags</span> <span class="s2">"not @todo"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All green.</p>
</div>
</div>
<div class="sect3">
<h4 id="_distill_the_long_shout_step">7.4.2. Distill the long shout step</h4>
<div class="paragraph">
<p>Now let’s deal with this next step.<a href="#shot-967" id="shot-967" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a> What’s the essence here?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      You need to come and visit Sean's coffee,
      we have the best bagels in town.
      """</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the exact words in the shout don’t have any significance in this scenario. What matters, if anything, is that this is a long message. It’s under 180 characters, but still longer than a regular message. It’s not clear how important this distinction is just yet, but let’s give the authors of this scenario the benefit of the doubt for now that there must be <em>some</em> reason it&#8217;s different. So we&#8217;ll push the details about the message content down into the step definition, following the same recipe.</p>
</div>
<div class="paragraph">
<p><a href="#shot-968" id="shot-968" title="Changes the step to `And Sean shouts a long message`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 18: Changes the step to `And Sean shouts a long message`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts a long message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-969" id="shot-969" title="Runs `cucumber --tags ~@todo`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19: Runs `cucumber --tags ~@todo`</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-970" id="shot-970" title="Copies / pastes step def snippet into steps file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20: Copies / pastes step def snippet into steps file</a></p>
</div>
<div class="paragraph">
<p>Again, we’ll tolerate the duplication for now, and just generate a long message here.</p>
</div>
<div class="paragraph">
<p><a href="#shot-971" id="shot-971" title="Copies shouting code from step def below, then adds code above to create a 180 character test message." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21: Copies shouting code from step def below, then adds code above to create a 180 character test message.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean shouts a long message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">A message from Sean</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">that spans multiple lines</span><span class="dl">"</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span>
    <span class="dl">"</span><span class="se">\n</span><span class="dl">"</span>
  <span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-972" id="shot-972" title="Runs <code>cucumber --tags ~@todo</code>. All green." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22: Runs <code>cucumber --tags ~@todo</code>. All green.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_distill_the_over_long_shout_step">7.4.3. Distill the over-long shout step</h4>
<div class="paragraph">
<p>Now what’s interesting about this next step? <a href="#shot-973" id="shot-973" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts the following message
      <span class="s">"""
      This morning I got up early and baked some
      bagels especially for you. Then I fried some
      sausages. I went out to see my chickens, they
      had some delicious fresh eggs waiting for me
      and I scrambled them just for you. Come on over
      and let's eat breakfast!
      """</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This shout is over our 180-character limit. After a quick chat with Paula, we’ve confirmed she wants to call this an <em>over-long message</em>. Let’s update the rule we wrote up earlier to document this evolution of our domain language:</p>
</div>
<div class="paragraph">
<p><a href="#shot-974" id="shot-974" title="Changes second rule “Long messages…” to “Over-long messages…”" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24: Changes second rule “Long messages…” to “Over-long messages…”</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">Rules</span><span class="p">:</span>
    <span class="nf">* </span>Mention the word <span class="s">"buy"</span> and you lose 5 credits.
    <span class="nf">* </span>Over-long messages cost 2 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can use that term in a new, more abstract step:</p>
</div>
<div class="paragraph">
<p><a href="#shot-975" id="shot-975" title="Changes step to `And Sean shouts an over-long message`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25: Changes step to `And Sean shouts an over-long message`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts an over-long message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we’ll make a step definition that duplicates the shouting code, and this time make a 181-character message, just long enough to be over the 180 character limit.</p>
</div>
<div class="paragraph">
<p><a href="#shot-976" id="shot-976" title="Copies shouting code from step def below, then changes first line to create a 181-character test message." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26: Copies shouting code from step def below, then changes first line to create a 181-character test message.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean shouts an over-long message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">A message from Sean that is 181 characters long </span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">baseMessage</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span> <span class="o">-</span> <span class="nx">baseMessage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-977" id="shot-977" title="Runs <code>cucumber --tags ~@todo</code>. All green." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 27: Runs <code>cucumber --tags ~@todo</code>. All green.</a></p>
</div>
<div class="paragraph">
<p>Again, we have another step we can replace with this more abstract one:</p>
</div>
<div class="paragraph">
<p><a href="#shot-978" id="shot-978" title="Replace imperative step on line 22 with `Sean shouts an over-long message`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 28: Replace imperative step on line 22 with `Sean shouts an over-long message`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts an over-long message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-979" id="shot-979" title="Runs <code>cucumber --tags ~@todo</code>. All green." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 29: Runs <code>cucumber --tags ~@todo</code>. All green.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_pointless_steps">7.4.4. Remove pointless steps</h4>
<div class="paragraph">
<p>Right. With the incidental details removed from these steps, it’s starting to become easier to see what’s going on. It would be even easier if we re-ordered them so they&#8217;re grouped together. Let’s do that:</p>
</div>
<div class="paragraph">
<p><a href="#shot-980" id="shot-980" title="Re-orders When steps so each type of step is grouped together." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 30: Re-orders When steps so each type of step is grouped together.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts a message
    <span class="nf">And </span>Sean shouts a message
    <span class="nf">And </span>Sean shouts a message
    <span class="nf">And </span>Sean shouts a long message
    <span class="nf">And </span>Sean shouts an over-long message
    <span class="nf">And </span>Sean shouts an over-long message
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>So now we can clearly see that Sean shouts three regular messages, a long message, two over-long messages, and three messages containing the word “buy”. It’s still a lot to digest, but a clearer picture is starting to emerge.</p>
</div>
<div class="paragraph">
<p>Are there any other incidental details remaining in this scenario? In BRIEF terms, is every step here <em>essential</em> to the purpose of this particular scenario?</p>
</div>
<div class="paragraph">
<p>Arguably, the steps that create regular and long messages are incidental, since they have no bearing on the behaviour we’re describing with this scenario. We can remove them altogether, and the behaviour should be exactly the same. So let’s do that:</p>
</div>
<div class="paragraph">
<p><a href="#shot-981" id="shot-981" title="Removes the first four When steps (remember to change And for When on the next step)" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 31: Removes the first four When steps (remember to change And for When on the next step)</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts an over-long message
    <span class="nf">And </span>Sean shouts an over-long message
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">And </span>Sean shouts a message containing the word <span class="s">"buy"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s better.</p>
</div>
<div class="paragraph">
<p>Now that we’ve removed all that incidental detail, it’s much easier to see how the figure of 11 credits has been calculated: two over-long messages at 2 credits per message, and three messages containing the word “buy” at 5 credits each makes a total of 19 credits, which subtracted from the initial 30 makes 11.</p>
</div>
<div class="paragraph">
<p>But we can make this even clearer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_merge_repeated_steps">7.4.5. Merge repeated steps</h4>
<div class="paragraph">
<p>These repetitive steps aren’t necessary. They make this scenario look more like a computer program than a specification document. Instead of repeating the step “When Sean shouts an over-long message” over and over again, let’s just tell it like it is:
<a href="#shot-982" id="shot-982" title="Replaces two steps with new step: `When Sean shouts 2 over-long messages`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 32: Replaces two steps with new step: `When Sean shouts 2 over-long messages`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">When </span>Sean shouts 2 over-long messages</code></pre>
</div>
</div>
<div class="paragraph">
<p>We’ll need a new step definition for this one.</p>
</div>
<div class="paragraph">
<p><a href="#shot-983" id="shot-983" title="Runs <code>cucumber --tags ~@todo</code>. Copies step def snippet and pastes into steps file." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 33: Runs <code>cucumber --tags ~@todo</code>. Copies step def snippet and pastes into steps file.</a></p>
</div>
<div class="paragraph">
<p>We can re-use the existing step definition, we just need to run a loop around it, based on the number of messages specified in the scenario.</p>
</div>
<div class="paragraph">
<p><a href="#shot-984" id="shot-984" title="Copy / paste code from step def below. Add loop around the body of the code." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 34: Copy / paste code from step def below. Add loop around the body of the code.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean shouts {int} over-long messages</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">A message from Sean that is 181 characters long </span><span class="dl">"</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">baseMessage</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span> <span class="o">-</span> <span class="nx">baseMessage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-985" id="shot-985" title="Runs <code>cucumber --tags ~@todo</code>. All green." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 35: Runs <code>cucumber --tags ~@todo</code>. All green.</a></p>
</div>
<div class="paragraph">
<p>Let’s do the exact same thing with these other three steps.</p>
</div>
<div class="paragraph">
<p><a href="#shot-986" id="shot-986" title="Replaces three steps with new step: `When Sean shouts 3 messages containing the word “buy”`" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 36: Replaces three steps with new step: `When Sean shouts 3 messages containing the word “buy”`</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nf">And </span>Sean shouts 3 messages containing the word <span class="s">"buy"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-987" id="shot-987" title="Runs <code>cucumber --tags ~@todo</code>. Copies step def snippet and pastes into steps file." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 37: Runs <code>cucumber --tags ~@todo</code>. Copies step def snippet and pastes into steps file.</a></p>
</div>
<div class="paragraph">
<p>Again, we have the bulk of this code that we can just recycle. We just need to capture the count, then add add a loop around the outside.</p>
</div>
<div class="paragraph">
<p><a href="#shot-988" id="shot-988" title="Copy / paste code from step def below. Add loop around the body of the code." style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 38: Copy / paste code from step def below. Add loop around the body of the code.</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">Sean shouts {int} messages containing the word {string}</span><span class="dl">"</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`A message containing the word </span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And everything is still green. <a href="#shot-989" id="shot-989" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 39</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s step back and see how BRIEF our scenario reads now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> Test premium account features
    <span class="nf">Given </span>Sean has bought 30 credits
    <span class="nf">When </span>Sean shouts 2 over-long messages
    <span class="nf">And </span>Sean shouts 3 messages containing the word <span class="s">"buy"</span>
    <span class="nf">Then </span>Lucy hears all Sean's messages
    <span class="nf">And </span>Sean should have 11 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nice!</p>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_5">7.4.6. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_what_are_the_details_in_this_step">What are the details in this step?</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="nf">When </span>Sean shouts <span class="s">"Come and buy a coffee"</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sean&#8217;s name (<strong>Correct</strong>)</p>
</li>
<li>
<p>the fact that Sean is shouting</p>
</li>
<li>
<p>the text "Come and buy a coffee" (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Sean&#8217;s name, like the text "Come and buy a coffee" are both details in this step. Note that details don&#8217;t always have to be surrounded by quotes. The action, <em>shouts</em> is not really what we&#8217;d call a detail.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_words_in_the_phrase_come_and_buy_a_coffee_are_essential_to_this_scenario">Which words in the phrase "Come and buy a coffee" are essential to this scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>Come</p>
</li>
<li>
<p>and</p>
</li>
<li>
<p>buy (<strong>Correct</strong>)</p>
</li>
<li>
<p>a</p>
</li>
<li>
<p>coffee</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>The rule we&#8217;re illustrating is that a shout containing the word "buy" costs 5 credits. All the other words in the message are <em>incidental details</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_change_the_rule_long_messages_cost_2_credits_to_over_long_messages_cost_2_credits">Why did we change the rule "Long messages cost 2 credits" to "Over-long messages cost 2 credits"?</h5>
<div class="ulist">
<ul>
<li>
<p>It just feels better that way</p>
</li>
<li>
<p>We agreed with our product owner that it was the right term to use (<strong>Currect</strong>)</p>
</li>
<li>
<p>It&#8217;s important to capture our evolving understading of the domain lanaguge (<strong>Correct</strong>)</p>
</li>
<li>
<p>We have to, otherwise the scenarios will fail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Gherkin makes a great place to capture your emerging understanding of your team&#8217;s Ubuiquitous Language (see Eric Evans&#8217;s book, Domain Driven Design). Because it&#8217;s version controlled, you can keep refining the words in your scenarios as you get a clearer understanding of the domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_run_cucumber_each_time_we_changed_the_scenario">Why did we run Cucumber each time we changed the scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>We wanted to capture our latest test results</p>
</li>
<li>
<p>We wanted to catch any mistakes in our refactoring quickly (<strong>Correct</strong>)</p>
</li>
<li>
<p>We wanted to show our product owner we were making progress</p>
</li>
<li>
<p>It keeps us confident that things are working as before (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>A great benefit of automated tests is that you can run them while you&#8217;re refactoring to ensure you haven&#8217;t made a mistake. The definition of refactoring is that you&#8217;re improving the maintainability without changing the behaviour. This applies to your test code too, and the best way to check the behaviour hasn&#8217;t changed is to run the automated tests and check they&#8217;re all still passing.</p>
</div>
<div class="sect5">
<h6 id="_which_of_these_statements_is_true_about_the_trade_offs_in_what_we_did_when_refining_the_essence_of_the_scenario">Which of these statements is true about the trade-offs in what we did when refining the essence of the scenario?</h6>
<div class="ulist">
<ul>
<li>
<p>We had to push some complexity into the step definition code in order to get the scenarios to read how we wanted. (<strong>Correct</strong>)</p>
</li>
<li>
<p>We made our step definition code simpler and more elegant.</p>
</li>
<li>
<p>We ended up with more step definitions than before. (<strong>Correct</strong>)</p>
</li>
<li>
<p>We removed some duplication in the step definitions</p>
</li>
<li>
<p>We removed some duplication in the scenario (<strong>Correct</strong>)</p>
</li>
<li>
<p>The scenario ended up much easier to read (<strong>Correct</strong>)</p>
</li>
<li>
<p>The scenario had a lot more steps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>When refining your scenarios like this, there is a trade-off that you need to add a little bit more complexity to your step definition code. This is why it&#8217;s important to have software engineers working on Cucumber tests, because they&#8217;ll be confident that they can do this. When Cucumber automation is left to people with less development experience, they may be afraid of pushing additional complexity into the step defintion code, and end up leaving some really ugly scenarios.</p>
</div>
<div class="paragraph">
<p>The ideal thing is to have testers and developers working together.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_expressing_the_rules_capturing_questions">7.5. Expressing the rules, capturing questions</h3>
<div class="paragraph">
<p>Now things are really getting clearer.</p>
</div>
<div class="paragraph">
<p>There are still a couple of problems with this scenario. One is the name of the scenario.<a href="#shot-990" id="shot-990" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a> It really doesn’t tell us anything at all.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Test</span> <span class="err">premium</span> <span class="err">account</span> <span class="err">features</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A great way to name your scenarios is to think about how they named episodes of the TV sitcom series, <em>Friends</em>. Remember? They were all called something like <em>The one where Ross is fine</em> or <em>The one where Phoebe gets married</em>.</p>
</div>
<div class="paragraph">
<p>Instead of expressing the outcome, we find it&#8217;s best to keep that out of our scenario, and just descrbe the context and the action.</p>
</div>
<div class="paragraph">
<p>So if this scenario were an epside of Friends, what would it be called? This is the one where… well.. <em>the one where Sean shouts some over-long messages and some containing the word “buy”.</em></p>
</div>
<div class="paragraph">
<p><a href="#shot-991" id="shot-991" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Se</span><span class="nf">an </span>shouts some over-long messages and some messages containing the word “buy”</code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, this is better than what we had before, but it&#8217;s s quite a complicated name isn’t it? Maybe this scenario is doing too much!</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and that’s the second problem.</p>
</div>
<div class="paragraph">
<p>It’s trying to test both business rules at once.</p>
</div>
<div class="sect3">
<h4 id="_split_scenario">7.5.1. Split scenario</h4>
<div class="paragraph">
<p>Normally you’ll want at least one scenario for each business rule. That way, each scenario clearly illustrates the effect of that rule on the system. Sometimes it’s interesting to also document the effect that multiple rules have when they play out at the same time, but as you’ve already experienced, that can quickly get confusing.</p>
</div>
<div class="paragraph">
<p>You’ll often need more than one scenario to illustrate each rule, but in this case, one scenario for each rule looks like it will be fine for the time being. Let’s split this scenario in two: the one where Sean shouts several over-long messages, and the one where Sean shouts several messages containing the word “buy”.</p>
</div>
<div class="paragraph">
<p>We can tuck each one under a <code>Rule</code> keyword, removing the rules from the feature file&#8217;s free-text description:</p>
</div>
<div class="paragraph">
<p><a href="#shot-992" id="shot-992" title="leaving the original in place."" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: leaving the original in place."</a><a href="#shot-993" id="shot-993" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Mention</span> <span class="err">the</span> <span class="err">word</span> <span class="err">"buy"</span> <span class="err">and</span> <span class="err">you</span> <span class="err">lose</span> <span class="err">5</span> <span class="err">credits.</span>
    <span class="kn">Scenario</span><span class="p">:</span> Sean some messages containing the word “buy”
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">And </span>Sean shouts 3 messages containing the word <span class="s">"buy"</span>
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 15 credits

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Over-long</span> <span class="err">messages</span> <span class="err">cost</span> <span class="err">2</span> <span class="err">credits</span>
    <span class="kn">Scenario</span><span class="p">:</span> Sean shouts some over-long messages
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">When </span>Sean shouts 2 over-long messages
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 26 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Great. Now the effect of each of these rules is much more clearly documented.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_original_scenario">7.5.2. Remove original scenario</h4>
<div class="paragraph">
<p>We run these new scenarios past Paula and she’s delighted. She really likes how they read. She asks us - why do we still need the original scenario?</p>
</div>
<div class="paragraph">
<p>Tamsin chimes in and says she has a concern that the rules might conflict with each other in the code somehow. That&#8217;s why she likes having a scenario that covers both. As we talk about it, we realise that while we don’t need this one anymore
<a href="#shot-994" id="shot-994" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> <a href="#shot-995" id="shot-995" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a>
there’s a missing scenario - where both rules apply to the <em>same message</em>: <em>The one where there’s a shout that’s both over-long and with the word “buy” in it.</em></p>
</div>
<div class="paragraph">
<p>We’d better document that as a question for now.</p>
</div>
<div class="paragraph">
<p><a href="#shot-996" id="shot-996" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">Questions</span><span class="p">:</span>
    <span class="nf">* </span>What about the one where the same message is both over-long and contains the word <span class="s">"buy"</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ask_context_question">7.5.3. Ask context question</h4>
<div class="paragraph">
<p>While we have Paula and Tamsin’s attention, we ask a question we know often helps to discover missing scenarios:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Is there another context that would result in a different outcome here?</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>They both think about this. Tamsin suggests starting Sean out with fewer credits, or shouting lots more messages, so that he runs out of credit. What would happen then?</p>
</div>
<div class="paragraph">
<p>Good question! It looks like there’s more to this feature than we’d previously thought. We’ll write that down as a question too. We still haven&#8217;t even started fixing that bug yet!</p>
</div>
<div class="paragraph">
<p><a href="#shot-997" id="shot-997" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">Questions</span><span class="p">:</span>
    <span class="nf">* </span>What about the one where the same message is both over-long and contains the word <span class="s">"buy"</span>
    <span class="nf">* </span>What happens if Sean runs out of credits?</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_4">7.5.4. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_we_recommend_you_name_your_scenarios_like_which_tv_series">We recommend you name your scenarios like which TV series?</h5>
<div class="ulist">
<ul>
<li>
<p>Cheers</p>
</li>
<li>
<p>The Simpsons</p>
</li>
<li>
<p>Family Guy</p>
</li>
<li>
<p>Friends (<strong>Correct</strong>)</p>
</li>
<li>
<p>Brooklyn 99</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>"The one where&#8230;&#8203; " is a great way to frame the name of each of your scenarios.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_these_scenario_names_follows_the_advice_we_gave_you_in_this_episode">Which of these scenario names follows the advice we gave you in this episode?</h5>
<div class="ulist">
<ul>
<li>
<p>Scenario: The one where the user logs in</p>
</li>
<li>
<p>Scenario: User logs in (<strong>Correct</strong>)</p>
</li>
<li>
<p>Scenario: User tries to log in with the wrong password (<strong>Correct</strong>)</p>
</li>
<li>
<p>Scenario: User tries to log in with the wrong password three times (<strong>Correct</strong>)</p>
</li>
<li>
<p>Scenario: User tries to log in with the wrong password three times and gets locked out</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>You don&#8217;t actually put the words "The one where" into the scenario title - it would appear everywhere otherwise! Just imagine that it&#8217;s there.</p>
</div>
<div class="paragraph">
<p>We suggest you avoid putting the <em>outcome</em> into your scenario name, and instead just describe the context and action.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_many_scenarios_should_you_normally_have_per_business_rule">How many scenarios should you normally have per business rule?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Exactly one</p>
</li>
<li>
<p>At least one (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Rules generalise examples, so each rule needs one or more examples to illustrate it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_in_this_episode_we_discovered_two_potentially_missing_scenarios_why">In this episode we discovered two potentially missing scenarios. Why?</h5>
<div class="ulist">
<ul>
<li>
<p>We&#8217;re constantly learning about the problem domain, and working together on the Gherkin helped us to discover some new scenarios we hadn&#8217;t previously considered. (<strong>Correct</strong>)</p>
</li>
<li>
<p>Tamsin the tester has been absent from work and wasn&#8217;t doing any testing.</p>
</li>
<li>
<p>We wanted to delete a scenario, and discussed the idea with our colleage who had an objection. Listening to that objection lead us to a new insight. (<strong>Correct</strong>)</p>
</li>
<li>
<p>Paula the product owner has been too busy to pay attention to what we were doing.</p>
</li>
<li>
<p>We asked the question "Is there another context that would result in a different outcome here" (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Software development is a constant process of discovery. When we can embrace this ignorance, instead of trying to pretend we know everything, and we listen to each other&#8217;s perspetives, we can get insights about gaps in our knowledge, helping us to see things we hadn&#8217;t considered before.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">7.6. Conclusion</h3>
<div class="paragraph">
<p><a href="#shot-998" id="shot-998" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 07.closing.common.animation.mp4</a></p>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1FGdj-mN_h0aTk9p7c_sY5aIhuLeZeNkt" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>Well that’s been quite a session. We came in to fix one bug, and ended up having to fix our feature file first. We’re still not done with that, either. By pushing the incidental details down out of the scenario into the step definitions, we’ve made a mess of duplication in the step definitions. There’s a neat fix for that, but we’ll have to save that for next time.</p>
</div>
<div class="paragraph">
<p>Let’s reflect on what we’ve learned.</p>
</div>
<div class="paragraph">
<p>When scenarios are very heavy in detail, they can be confusing to read. We call these <em>incidental details</em> when they are just noise that detracts from communicating the essence of the scenario.</p>
</div>
<div class="paragraph">
<p>Scenarios that are heavy in detail are sometimes said to be written in an <em>imperative</em> style. They contain lots of “how”, and not much “what”. We often use this style when we’re working on a brand new domain problem and are still grasping for an understanding. We just want to write <em>something</em> down.</p>
</div>
<div class="paragraph">
<p>As your confidence in your domain knowledge improves, you’d expect to feel comfortable removing some of these details. Scenarios with more abstract steps like this are said to be written in a <em>declarative</em> style.</p>
</div>
<div class="paragraph">
<p>Using a more declarative style might mean you’ll need to find names for things, like the way we had to name an over-long message. This discovery of your ubiquitous domain language is a great side-effect of distilling the essence of your scenarios. Now you have a bigger vocabulary that you can use all the way down through your code, and in your future conversations, too.</p>
</div>
<div class="paragraph">
<p>One down-side, as you’ve seen, of pushing the “how” down from your scenarios into the step definitions is that the step definition code becomes more complex. Some teams reject this, and prefer to use a simple vocabulary of step definitions, leaving more detail in their scenarios. There are no right and wrong answers here, but if you have sufficient competence with code, you’ll easily be able to handle that extra bit of complexity and keep readability top of your priorities.</p>
</div>
<div class="paragraph">
<p>That’s what we’ll work on next time. Bye for now!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_mapping">8. Example Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#shot-999" id="shot-999" title="Animation of Matt talking to camera" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Animation of Matt talking to camera</a></p>
</div>
<div class="paragraph">
<p>In the last lesson we saw how easily incidental details can creep into your scenarios, talked about why they’re a problem, and showed you some techniques for massaging them back out again.
But, as we pushed the details out of our scenarios, we made the step definition code more complicated. We promised to show you how to deal with that extra complexity, and we&#8217;re going to get to that in the next chapter, Chapter 9.</p>
</div>
<div class="paragraph">
<p>First though, we want to look at how we could have prevented the Premium Accounts feature from getting into such a mess in the first place.</p>
</div>
<div class="paragraph">
<p>We&#8217;re going to learn about a practice called Example Mapping, a way to structure the conversation between the <em>Three Amigos</em> - Tester, Developer and Product Owner - to develop shared understanding before you write any code.</p>
</div>
<div class="sect2">
<h3 id="_example_mapping_why">8.1. Example Mapping: Why?</h3>
<div class="paragraph">
<p><a href="#shot-1000" id="shot-1000" title="BDD circles diagram" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: BDD circles diagram</a>
In terms of the three practices we introduced in Chapter 1 - Discovery, Formulation and Automation - what went wrong with the Premium Accounts feature?</p>
</div>
<div class="paragraph">
<p>Thinking about it, we can see that the development team
<a href="#shot-1001" id="shot-1001" title="BDD circles diagram - (1) pointing to Automation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: BDD circles diagram - (1) pointing to Automation</a>
jumped straight into <em>Automation</em> - writing the implementation of the feature. They did the bare minimum of
<a href="#shot-1002" id="shot-1002" title="BDD circles diagram - (2) pointing to Formulation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: BDD circles diagram - (2) pointing to Formulation</a>
<em>Formulation</em> - just enough to automate a test for the feature, but really we did a lot of the Formulation later on as we cleaned it up. Finally, much of the
<a href="#shot-1003" id="shot-1003" title="BDD circles diagram - (3) pointing to Discovery" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: BDD circles diagram - (3) pointing to Discovery</a>
<em>Discovery</em> happened at the end once Tamsin had a chance to test the feature by hand.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1004" id="shot-1004" title="BDD circles diagram - draw a red 'X' over the three arrows" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: BDD circles diagram - draw a red 'X' over the three arrows</a>
So in essence, they did everything backwards.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1005" id="shot-1005" title="Animation ending with 'Deliberate Discovery'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: Animation ending with 'Deliberate Discovery'</a>
In software projects, it’s often the unknown unknowns that can make the biggest difference between success and failure. In BDD, we always try to assume we’re ignorant of some important information and try to <em>deliberately discover</em> those unknown unknowns as early as possible, so they don’t surprise us later on.</p>
</div>
<div class="paragraph">
<p>A team that invests just a little bit extra in Discovery, before they write any code, saves themselves a huge amount of wasted time further down the line.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1006" id="shot-1006" title="Animation introducing three people, showing them talking" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: Animation introducing three people, showing them talking</a>
In lesson 1, we showed you an example of the <em>Three Amigos</em> - Tester, Developer and Product owner - having a conversation about a new user story.</p>
</div>
<div class="paragraph">
<p>Nobody likes long meetings, so we’ve developed a simple framework for this conversation that keeps it quick and effective. We call this
<a href="#shot-1007" id="shot-1007" title="Example Mapping" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: Example Mapping</a>
<em>Example Mapping</em>.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1008" id="shot-1008" title="diagram: User Story &#8594; Example Mapping" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: diagram: User Story &#8594; Example Mapping</a></p>
</div>
<div class="paragraph">
<p>An Example Mapping session takes a single User Story as input, and aims to produce four outputs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Business Rules,
<a href="#shot-1009" id="shot-1009" title="diagram: &#8594; Rules" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: diagram: &#8594; Rules</a>
that must be satisified for the story to be implemented correctly</p>
</li>
<li>
<p>Examples
<a href="#shot-1010" id="shot-1010" title="diagram: &#8594; Examples" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: diagram: &#8594; Examples</a>
of those business rules playing out in real-world scenarios</p>
</li>
<li>
<p>Questions or Assumptions
<a href="#shot-1011" id="shot-1011" title="diagram: &#8594; Questions" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: diagram: &#8594; Questions</a>
that the group of people in the conversation need to deal with soon, but cannot resolve during the immediate conversation</p>
</li>
<li>
<p>New User Stories
<a href="#shot-1012" id="shot-1012" title="diagram: &#8594; New User Stories" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: diagram: &#8594; New User Stories</a>
sliced out from the one being discussed in order to simplify it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We capture these, as we talk, using index cards, or another virtual equivalent.</p>
</div>
<div class="paragraph">
<p>Working with these simple artefacts rather than trying to go straight to formulating Gherkin, allows us to keep the conversation at the right level - seeing the whole picture of the user story without getting lost in details.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_4">8.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_why_did_we_say_the_development_teams_initial_attempt_at_the_premium_accounts_feature_was_done_backwards">Why did we say the development team&#8217;s initial attempt at the premium accounts feature was "done backwards"?</h5>
<div class="ulist">
<ul>
<li>
<p>They did Discovery before Automation</p>
</li>
<li>
<p>They did Discovery before Formulation</p>
</li>
<li>
<p>They started with Automation, without doing enough Discovery or Formulation first (<strong>Correct</strong>)</p>
</li>
<li>
<p>They started with Discovery, then did Formulation and finally Automation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>The intended order is Discovery, Formulation then Automation. Each of these steps teaches us a little more about the problem.</p>
</div>
<div class="paragraph">
<p>Our observation was that the the team jumped straight into coding (Automation), retro-fitting a scenario later. The discovery only happened when Tamsin tested the feature.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_deliberate_discovery_mean_multiple_choice">What does "Deliberate Discovery" mean (Multiple choice)</h5>
<div class="ulist">
<ul>
<li>
<p>One person is responsible for gathering the requirements</p>
</li>
<li>
<p>Discovery is something you can only do in collaboration with others</p>
</li>
<li>
<p>Having the humility to assume there are things you don&#8217;t yet understand about the problem you&#8217;re working on (<strong>Correct</strong>)</p>
</li>
<li>
<p>Embracing your ignorance about what you&#8217;re building (<strong>Correct</strong>)</p>
</li>
<li>
<p>There are no unknown unknowns on your project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>Deliverate Discovery means we assume that there are important things we don&#8217;t yet know about the project we&#8217;re working on, and so make a deliberate effort to look for them at every opportunity.</p>
</div>
<div class="paragraph">
<p>Although we very much encouage doing that collaboratively, it&#8217;s not the main emphasis here.</p>
</div>
<div class="paragraph">
<p>Read Daniel Terhorst-North&#8217;s <a href="https://dannorth.net/2010/08/30/introducing-deliberate-discovery/">original blog post</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_is_it_a_good_idea_to_try_and_slice_a_user_story">Why is it a good idea to try and slice a user story?</h5>
<div class="ulist">
<ul>
<li>
<p>Working in smaller pieces allows us to iterate and get feedback faster (<strong>Correct</strong>)</p>
</li>
<li>
<p>We can defer behaviour that&#8217;s lower priority (<strong>Correct</strong>)</p>
</li>
<li>
<p>Smaller stories are less likely to contain unknown unknowns (<strong>Correct</strong>)</p>
</li>
<li>
<p>Doing TDD and refactoring becomes much easier when we proceed in small steps (<strong>Correct</strong>)</p>
</li>
<li>
<p>Small steps help us keep momentum, which is motivating (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>Just like grains of sand flow through the neck of a bottle faster than pebbles, the smaller you can slice your stories, the faster they will flow through your development team.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to preserve stories as a <em>vertical slice</em> right through your application, that changes the behaviour of the system from the point of view of a user, even in a very simple way.</p>
</div>
<div class="paragraph">
<p>That&#8217;s why we call it slicing rather than splitting.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_discourage_doing_formulation_as_part_of_an_example_mapping_conversation">Why did we discourage doing Formulation as part of an Example Mapping conversation?</h5>
<div class="ulist">
<ul>
<li>
<p>Trying to write Gherkin slows the conversation down, which means you might miss the bigger picture. (<strong>Correct</strong>)</p>
</li>
<li>
<p>It&#8217;s usually an unneccesary level of detail to go into when you&#8217;re trying to discover unknown unknowns. (<strong>Correct</strong>)</p>
</li>
<li>
<p>Formulation should be done by a separate team</p>
</li>
<li>
<p>One person should be in charge of the documentation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation</strong></p>
</div>
<div class="paragraph">
<p>This is why we&#8217;ve separated Discovery from Formulation. It&#8217;s better to stay relatively shallow and go for breadth at this stage - making sure you&#8217;ve looked over the entire user story without getting pulled into rabbit holes.</p>
</div>
<div class="paragraph">
<p>Product Owners and Domain Experts are often busy people who only have limited time with the team. Make the most of this time by keeping the conversation at the level where the team can learn the maximum amount from them.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_mapping_how">8.2. Example Mapping: How?</h3>
<div class="paragraph">
<p><a href="#shot-1013" id="shot-1013" title="index cards and pens" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: index cards and pens</a></p>
</div>
<div class="paragraph">
<p>We first developed example mapping in face-to-face meeting using a simple a multi-colour pack of index cards and some pens. For teams that are working remotely, there are many virtual equivalents of that nowadays.</p>
</div>
<div class="paragraph">
<p>We use the four different coloured cards to represent the four main kinds of information that arise in the conversation.</p>
</div>
<div class="paragraph">
<p>We can start with the easy stuff: Take a yellow card and write down the name of the story.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1014" id="shot-1014" title="write 'premium accounts' on a yellow card" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: write 'premium accounts' on a yellow card</a></p>
</div>
<div class="paragraph">
<p>Now, do we already know any rules or acceptance criteria about this story?</p>
</div>
<div class="paragraph">
<p>Write each rule down on a blue card:</p>
</div>
<div class="paragraph">
<p><a href="#shot-1015" id="shot-1015" title="write two rules on blue cards" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: write two rules on blue cards</a></p>
</div>
<div class="paragraph">
<p>They look pretty straightforward, but let’s explore them a bit by coming up with some examples.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1016" id="shot-1016" title="Show male character, with text appearing on their left" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: Show male character, with text appearing on their left</a></p>
</div>
<div class="paragraph">
<p>Darren the developer comes up with a simple scenario to check he understands the basics of the “buy” rule: "I start with 10 credits, I shout <em>buy my muffins</em> and then <em>I want to buy some socks</em>, then I have zero credits. Correct?"</p>
</div>
<div class="paragraph">
<p>"Yes", says Paula.
<a href="#shot-1017" id="shot-1017" title="Write up Darren&#8217;s example on a green card" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: Write up Darren&#8217;s example on a green card</a></p>
</div>
<div class="paragraph">
<p>Darren writes this example up on a green card, and places it underneath the rule that it illustrates.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1018" id="shot-1018" title="Show female character" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: Show female character</a>
Tammy the tester chimes in: "How about the one where you shout a word that contains <em>buy</em>, like <em>buyer</em> for example?
<a href="#shot-1019" id="shot-1019" title="Show female character with text appearing" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: Show female character with text appearing</a>
If you were to shout <em>I need a buyer for my house</em>. Would that lose credits too?"</p>
</div>
<div class="paragraph">
<p><a href="#shot-1020" id="shot-1020" title="Show second female character in foreground" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: Show second female character in foreground</a>
Paula thinks about it for a minute, and
<a href="#shot-1021" id="shot-1021" title="Second female character opens arms and smiles" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: Second female character opens arms and smiles</a>
decides that no, only the whole word <em>buy</em> counts. They’ve discovered a new rule!
<a href="#shot-1022" id="shot-1022" title="Modify text on blue card, add new green card" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10: Modify text on blue card, add new green card</a>
They write that up on the rule card, and place the example card underneath it.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1023" id="shot-1023" title="Show male character in foreground, talking" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: Show male character in foreground, talking</a>
Darren asks: "How do the users get these credits? Are we building that functionality as part of this story too?"</p>
</div>
<div class="paragraph">
<p><a href="#shot-1024" id="shot-1024" title="Show female character in foreground, talking" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12: Show female character in foreground, talking</a>
Paula tells him that’s part of another story, and they can assume the user can already purchase credits. They write that down as a rule too.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1025" id="shot-1025" title="Write 'assumption: credit purchase has already been implemented'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13: Write 'assumption: credit purchase has already been implemented'</a></p>
</div>
<div class="paragraph">
<p>This isn’t a behaviour rule - it’s a rule about the scope of the story. It’s still useful to write it down since we’ve agreed on it. But it won’t need any examples. We could also have chosen to use a red card her to write down our assumption.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1026" id="shot-1026" title="Female character speaking, blank background; writing appears" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14: Female character speaking, blank background; writing appears</a>
Still focussed on the “buy” rule, Tammy asks: "What if they run out of credit? Say you start with 10 credits and shout <em>buy</em> three times. What’s the outcome?"</p>
</div>
<div class="paragraph">
<p>Paula looks puzzled. "I don’t know". She says. I’ll need to give that some thought.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1027" id="shot-1027" title="Write out red card: 'What should happen when one runs out of credits?" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15: Write out red card: 'What should happen when one runs out of credits?</a>
Darren takes a red card and writes this up as a question.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1028" id="shot-1028" title="More (empty) cards appearing" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16: More (empty) cards appearing</a>
They apply the same technique to the other rule about long messages, and pretty soon the table is covered in cards, reflecting the rules, examples and questions that have come up in their conversation. Now they have a picture in front of them that reflects back what they know, and still don’t know, about this story.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_6">8.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_what_do_the_green_cards_represent_in_an_example_map">What do the <strong>Green</strong> cards represent in an example map?</h5>
<div class="ulist">
<ul>
<li>
<p>Stories</p>
</li>
<li>
<p>Rules</p>
</li>
<li>
<p>Examples (<strong>Correct</strong>)</p>
</li>
<li>
<p>Questions or assumptions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>We use the green card to represent examples because when we turn them into tests we want them to go green and pass!</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_do_the_blue_cards_represent_in_an_example_map">What do the <strong>Blue</strong> cards represent in an example map?</h5>
<div class="ulist">
<ul>
<li>
<p>Stories</p>
</li>
<li>
<p>Rules (<strong>Correct</strong>)</p>
</li>
<li>
<p>Examples</p>
</li>
<li>
<p>Questions or assumptions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>We use the blue cards to represent rules because they&#8217;re fixed, or frozen, like blue ice.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_do_the_red_cards_represent_in_an_example_map">What do the <strong>Red</strong> cards represent in an example map?</h5>
<div class="ulist">
<ul>
<li>
<p>Stories</p>
</li>
<li>
<p>Rules</p>
</li>
<li>
<p>Examples</p>
</li>
<li>
<p>Questions or assumptions (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>We use the red cards to represent questions and assumptions because it indicates danger! There&#8217;s still some uncertainty to be resolved here.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_do_the_yellow_cards_represent_in_an_example_map">What do the <strong>Yellow</strong> cards represent in an example map?</h5>
<div class="ulist">
<ul>
<li>
<p>Story (<strong>Correct</strong>)</p>
</li>
<li>
<p>Rule</p>
</li>
<li>
<p>Example</p>
</li>
<li>
<p>Question or assumption</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>We chose the yellow cards to represent stories in our example mapping sessions, mostly because that was the last colour left over in the pack!</p>
</div>
</div>
<div class="sect4">
<h5 id="_look_at_the_following_example_map_do_you_think_the_team_is_ready_to_start_coding_yet">Look at the following example map. Do you think the team is ready to start coding yet?</h5>
<div class="imageblock">
<div class="content">
<img src="example-map-1.png" alt="example map 1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No. There are still a lot of questions to resolve.</p>
</li>
<li>
<p>No. They probably haven&#8217;t explored the story enough yet. More conversation needed. (<strong>Correct</strong>)</p>
</li>
<li>
<p>No. There are too many rules. They should try to slice the story first.</p>
</li>
<li>
<p>Yes. There&#8217;s a good number of examples for each rule, and no questions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>When an example map shows only a few cards, and some rules with no examples at all, it suggests that either the story is very simple, or the discussion hasn&#8217;t gone deep enough yet.</p>
</div>
</div>
<div class="sect4">
<h5 id="_look_at_the_following_example_map_do_you_think_the_team_is_ready_to_start_coding_yet_2">Look at the following example map. Do you think the team is ready to start coding yet?</h5>
<div class="imageblock">
<div class="content">
<img src="example-map-2.png" alt="example map 2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No. There are still a lot of questions to resolve.</p>
</li>
<li>
<p>No. They probably haven&#8217;t explored the story enough yet. More conversation needed.</p>
</li>
<li>
<p>No. There are too many rules. They should try to slice the story first.</p>
</li>
<li>
<p>Yes. There&#8217;s a good number of examples for each rule, and no questions. (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>This example map shows a good number of examples for each rule, and no questions. If the team feel like the conversation is finished, then they&#8217;re probably ready to start hacking on this story.</p>
</div>
</div>
<div class="sect4">
<h5 id="_look_at_the_following_example_map_do_you_think_the_team_is_ready_to_start_coding_yet_3">Look at the following example map. Do you think the team is ready to start coding yet?</h5>
<div class="imageblock">
<div class="content">
<img src="example-map-3.png" alt="example map 3">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No. There are still a lot of questions to resolve. (<strong>Correct</strong>)</p>
</li>
<li>
<p>No. They probably haven&#8217;t explored the story enough yet. More conversation needed.</p>
</li>
<li>
<p>No. There are too many rules. They should try to slice the story first.</p>
</li>
<li>
<p>Yes. There&#8217;s a good number of examples for each rule, and no questions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>The large number of red cards here suggests that the team have encountered a number of questions that they couldn&#8217;t resolve themselves. Often this is an indication that there&#8217;s someone missing from the conversation. It would probably be irresponsible to start coding until at least some of those questions have been resolved.</p>
</div>
</div>
<div class="sect4">
<h5 id="_look_at_the_following_example_map_do_you_think_the_team_is_ready_to_start_coding_yet_4">Look at the following example map. Do you think the team is ready to start coding yet?</h5>
<div class="imageblock">
<div class="content">
<img src="example-map-4.png" alt="example map 4">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No. There are still a lot of questions to resolve.</p>
</li>
<li>
<p>No. They probably haven&#8217;t explored the story enough yet. More conversation needed.</p>
</li>
<li>
<p>No. There are too many rules. They should try to slice the story first. (<strong>Correct</strong>)</p>
</li>
<li>
<p>Yes. There&#8217;s a good number of examples for each rule, and no questions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>When an example map is wide like this, with a lot of different rules, it&#8217;s often a signal that there&#8217;s an opportunity to slice the story up by de-scoping some of those rules from the first iteration. Even if it&#8217;s not something that would be high enough quality to ship to a customer, you can often defer some of the rules into another story that you can implement later.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_mapping_conclusions">8.3. Example Mapping: Conclusions</h3>
<div class="paragraph">
<p><a href="#shot-1029" id="shot-1029" title="Animation of Matt talking to camera" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1: Animation of Matt talking to camera</a></p>
</div>
<div class="paragraph">
<p>As you’ve just seen, an example mapping session should go right across the breadth of the story, trying to get a complete picture of the behaviour. Inviting all three amigos - product owner, tester and developer - is important because each perspective adds something to the conversation.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1030" id="shot-1030" title="Diagram showing user story &#8594; example mapping &#8594; rules / examples" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2: Diagram showing user story &#8594; example mapping &#8594; rules / examples</a></p>
</div>
<div class="paragraph">
<p>Although the apparent purpose of an example mapping session is to take a user story, and try to produce rules and examples that illustrate the behaviour, the underlying goal is to achieve a
<a href="#shot-1031" id="shot-1031" title="Show <strong>shared understanding</strong> appearing" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3: Show <strong>shared understanding</strong> appearing</a>
 <em>shared understanding</em> and agreement about the precise scope of a user story. Some people tell us that example mapping has helped to build empathy within their team!</p>
</div>
<div class="paragraph">
<p>With this goal in mind, make sure the session isn’t just a rubber-stamping exercise, where one person does all the talking. Notice how in our example, everyone in the group was asking questions and writing new cards.</p>
</div>
<div class="paragraph">
<p>In the conversation, we often end up
<a href="#shot-1032" id="shot-1032" title="show feedback arrow going back to 'User Story'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: show feedback arrow going back to 'User Story'</a>
refining, or even slicing out new user stories
<a href="#shot-1033" id="shot-1033" title="show New user Stories" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: show New user Stories</a>
to make the current one smaller.  Deciding what a story is not - and maximising the amount of work not done - is one of the most useful things you can do in a three amigos session. Small stories are the secret of a successful agile team.</p>
</div>
<div class="paragraph">
<p>Each time you come up with an example, try to understand what the underlying rule or rules are. If you discover an example that doesn’t fit your rules, you’ll need to reconsider your rules. In this way, the scope of the story is refined by the group.</p>
</div>
<div class="paragraph">
<p>Although there’s no doubt of the power of examples for exploring and talking through requirements, it’s the rules that will go into the code. If you understand the rules, you’ll be able to build an elegant solution.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1034" id="shot-1034" title="David West / Object Thinking quote" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: David West / Object Thinking quote</a>
As Dr David West says in his excellent book "Object Thinking", <em>If you problem the solution well enough, the solution will take care of itself</em>.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1035" id="shot-1035" title="Return to diagram" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: Return to diagram</a></p>
</div>
<div class="paragraph">
<p>Sometimes, you’ll come across questions that nobody can answer. Instead of getting stuck trying to come up with an answer, just write down the question.
<a href="#shot-1036" id="shot-1036" title="show questions / assumptions as output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: show questions / assumptions as output</a></p>
</div>
<div class="paragraph">
<p>Congratulations! You’ve just turned an unknown unknown into a known unknown. That’s progress.</p>
</div>
<div class="paragraph">
<p><a href="#shot-1037" id="shot-1037" title="Animation of Matt talking to camera" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9: Animation of Matt talking to camera</a></p>
</div>
<div class="paragraph">
<p>Many people think they need to produce formal Gherkin scenarios from their three amigos conversations, but in our experience that’s only occasionally necessary. In fact, it can often slow the discussion down.</p>
</div>
<div class="paragraph">
<p>The point of an example mapping session is to do the <em>discovery</em> work. You can do <em>formulation</em> as a separate activity, next.</p>
</div>
<div class="paragraph">
<p>One last tip is to run your example mapping sessions in a timebox. When you’re practiced at it, you should be able to analyse a story within 25 minutes. If you can’t, it’s either too big, or you don’t understand it well enough yet. Either way, it’s not ready to play.</p>
</div>
<div class="paragraph">
<p>At the end of the 25 minutes, you can check whether everyone thinks the story is ready to start work on. If lots of questions remain, it would be risky to start work, but people might be comfortable taking on a story with only a few minor questions to clear up. Check this with a quick thumb-vote.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_5">8.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_are_direct_outcomes_you_could_expect_if_your_team_starts_practcing_example_mapping">Which of the following are direct outcomes you could expect if your team starts practcing Example Mapping?</h5>
<div class="ulist">
<ul>
<li>
<p>Less rework due to bugs found in your stories (<strong>Correct</strong>)</p>
</li>
<li>
<p>Greater empathy and mutual respect between team members (<strong>Correct</strong>)</p>
</li>
<li>
<p>Amazing Gherkin that reads really well</p>
</li>
<li>
<p>Smaller user stories (<strong>Correct</strong>)</p>
</li>
<li>
<p>A shared understanding of what you&#8217;re going to build for the story (<strong>Correct</strong>)</p>
</li>
<li>
<p>More predicatable delivery pace (<strong>Correct</strong>)</p>
</li>
<li>
<p>A quick sense of whether a story is about the right size and ready to start writing code. (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>We don&#8217;t write Gherkin during an example mapping session, so that&#8217;s not one of the direct outcomes, though a good example mapping session should leave the team ready to write their best Gherkin.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_presents_the_most_risk_to_your_project">Which of the following presents the most risk to your project?</h5>
<div class="ulist">
<ul>
<li>
<p>Unknown unknowns (<strong>Correct</strong>)</p>
</li>
<li>
<p>Known unknowns</p>
</li>
<li>
<p>Known knowns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Explanation:</strong></p>
</div>
<div class="paragraph">
<p>In project management, there are famously "uknown unknowns", "known unknowns" and "known knowns". The most dangerous are the "unknown unknows" because not only do we not know the answer to them, we have not even realised yet that there&#8217;s a question!</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support_code">9. Support Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Chapter 7 we refined the Gherkin of the Premium Accounts feature, turning what had started out as nothing more than an automated test into some valuable documentation.</p>
</div>
<div class="paragraph">
<p>As we did that, we <em>pushed the "how" down</em>, making the scenarios themselves more declarative of the desired behaviour, pushing the implementation details of the testing into the code in the step defintions below.</p>
</div>
<div class="paragraph">
<p>In doing this, we got more readable, maintainable and useful scenarios in exchange for more complex automation code. In this chapter we&#8217;ll show you how to organise your automation support code so that you won&#8217;t be afraid of making this trade-off.</p>
</div>
<div class="sect2">
<h3 id="_problem_and_solution_domains">9.1. Problem and Solution Domains</h3>
<div class="paragraph">
<p>When we build software, we’re always working across two domains.</p>
</div>
<div class="paragraph">
<p>There’s the problem domain, where our customers and business stakeholders live, and there’s a solution domain, where we solve those business problems using technology.</p>
</div>
<div class="paragraph">
<p>Each domain has its own jargon, it’s own dialect. That’s fine: specialized language helps domain experts to communicate. Often though, this jargon can prevent us from understanding one another across the two domains.</p>
</div>
<div class="paragraph">
<p>As BDD practitioners, we’re focussed on trying to grow this area in the middle, where we have a common or ubiquitous language. We know that the bigger this shared vocabulary is, the quicker the team can communicate ideas between the business and technology-facing sides of the team.</p>
</div>
<div class="paragraph">
<p>We’ve also heard it said that if you model the problem well enough, the solution will take care of itself.</p>
</div>
<div class="paragraph">
<p>Certainly, we believe that the better an understanding you have of the problem domain, the better a solution you can build. That’s why Cucumber is so powerful, because it helps you to stay rooted in the problem domain.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_5">9.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_what_are_the_two_domains_we_described_in_this_chapter">What are the two domains we described in this chapter?</h5>
<div class="ulist">
<ul>
<li>
<p>Problem domain (<strong>Correct</strong>)</p>
</li>
<li>
<p>Test domain</p>
</li>
<li>
<p>Solution domain (<strong>Correct</strong>)</p>
</li>
<li>
<p>Data domain</p>
</li>
<li>
<p>User interface domain</p>
</li>
<li>
<p>Core domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>While the word "domain" is applicable in lots of ways when talking about software, the two we&#8217;re focussed on in this lesson are the <strong>problem domain</strong>, where our users and customer live, and the <strong>solution domain</strong> where our development teams and their technical tools live.</p>
</div>
</div>
<div class="sect4">
<h5 id="_imagine_were_building_a_system_for_a_healthcare_provider_which_of_these_concepts_are_likely_from_the_solution_domain">Imagine we&#8217;re building a system for a healthcare provider. Which of these concepts are likely from the <strong>solution</strong> domain?</h5>
<div class="ulist">
<ul>
<li>
<p>Java (<strong>Correct</strong>)</p>
</li>
<li>
<p>Patient</p>
</li>
<li>
<p>Database (<strong>Correct</strong>)</p>
</li>
<li>
<p>Doctor</p>
</li>
<li>
<p>Message broker (<strong>Correct</strong>)</p>
</li>
<li>
<p>Flight</p>
</li>
<li>
<p>Medicine</p>
</li>
<li>
<p>CSS class (<strong>Correct</strong>)</p>
</li>
<li>
<p>Checkup</p>
</li>
<li>
<p>JavaScript (<strong>Correct</strong>)</p>
</li>
<li>
<p>Airport</p>
</li>
<li>
<p>Blood pressure</p>
</li>
<li>
<p>XML (<strong>Correct</strong>)</p>
</li>
<li>
<p>Bed</p>
</li>
<li>
<p>JSON (<strong>Correct</strong>)</p>
</li>
<li>
<p>Air miles</p>
</li>
<li>
<p>Availability</p>
</li>
<li>
<p>REST endpoint (<strong>Correct</strong>)</p>
</li>
<li>
<p>Waiting list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Words matter. You might have found this difficult because you&#8217;re someone who works in the solution domain, <strong>and</strong> you&#8217;re also probably someone who&#8217;s been to a hospital, so you can speak the language of both of these domains.</p>
</div>
<div class="paragraph">
<p>Remember that for people who come from the problem domain, these words from the solution domain can be confusing.</p>
</div>
</div>
<div class="sect4">
<h5 id="_imagine_were_building_a_system_for_a_healthcare_provider_which_of_these_concepts_are_likely_from_the_problem_domain">Imagine we&#8217;re building a system for a healthcare provider. Which of these concepts are likely from the <strong>problem</strong> domain?</h5>
<div class="ulist">
<ul>
<li>
<p>Java</p>
</li>
<li>
<p>Patient (<strong>Correct</strong>)</p>
</li>
<li>
<p>Database</p>
</li>
<li>
<p>Doctor (<strong>Correct</strong>)</p>
</li>
<li>
<p>Flight</p>
</li>
<li>
<p>Message broker</p>
</li>
<li>
<p>Medicine (<strong>Correct</strong>)</p>
</li>
<li>
<p>CSS class</p>
</li>
<li>
<p>Checkup (<strong>Correct</strong>)</p>
</li>
<li>
<p>JavaScript</p>
</li>
<li>
<p>Airport</p>
</li>
<li>
<p>Blood pressure (<strong>Correct</strong>)</p>
</li>
<li>
<p>XML</p>
</li>
<li>
<p>Bed (<strong>Correct</strong>)</p>
</li>
<li>
<p>JSON</p>
</li>
<li>
<p>Air miles</p>
</li>
<li>
<p>Availability (<strong>Correct</strong>)</p>
</li>
<li>
<p>REST endpoint</p>
</li>
<li>
<p>Waiting list (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Problem domain language is the language you&#8217;ll hear people say when they talk about the system from a user&#8217;s perspective.</p>
</div>
</div>
<div class="sect4">
<h5 id="_whats_the_right_term_for_words_that_have_the_same_meaning_in_both_the_problem_and_solution_domains">What&#8217;s the right term for words that have the same meaning in both the problem and solution domains?</h5>
<div class="ulist">
<ul>
<li>
<p>Unique language</p>
</li>
<li>
<p>Ubiquitous language (<strong>Correct</strong>)</p>
</li>
<li>
<p>Programming language</p>
</li>
<li>
<p>Proper language</p>
</li>
<li>
<p>Enterprise domain</p>
</li>
<li>
<p>General language</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>The term 'ubuquitous language' comes from Eric Evans' brilliant book, Domain Driven Design.</p>
</div>
<div class="paragraph">
<p>As a consulting who worked on multiple projects, Eric noticed that a common factor between the projects that went well, was that <strong>people used the same words for stuff</strong>.</p>
</div>
<div class="paragraph">
<p>So if the business people referred to "Blood pressure" in their conversations, the database table where we stored records of those measurements would also be called <code>BloodPressure</code> and not something that the engineers made up, like <code>tbl_user_metric_items</code></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_layers_of_a_cucumber_test_suite">9.2. Layers of a Cucumber Test Suite</h3>
<div class="paragraph">
<p>So where do your feature files sit on this diagram of problem and solution domains?</p>
</div>
<div class="paragraph">
<p>Well, we hope they sit right in the middle here, and act as the place where the problem and solution domains come together. Someone from either domain should be able to read a feature file and it will make sense to them.</p>
</div>
<div class="paragraph">
<p>And how about step definitions?</p>
</div>
<div class="paragraph">
<p>Step definitions are right on the boundary, here, translating between the problem-domain language we use in our Gherkin scenarios and the concrete actions we take in code to pull and poke at our solution.</p>
</div>
<div class="paragraph">
<p>We want to prevent solution-domain concepts and language from leaking into our Gherkin scenarios to keep them readable. As we saw in the last lesson, when we remove details from scenarios, we trade-off for increased complexity in our step definitions.</p>
</div>
<div class="paragraph">
<p>So how do we manage this complexity?</p>
</div>
<div class="paragraph">
<p>A mature Cucumber test suite will have a layer of support code sitting between the step definitions and the system being automated.</p>
</div>
<div class="paragraph">
<p>This layer of support code literally supports the step definitions by providing an API for automating your application.</p>
</div>
<div class="paragraph">
<p>We can extract this API from our step definitions. Let’s pick up the shouty codebase from Chapter 8 and show you what we mean.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_7">9.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_what_language_should_be_used_in_feature_files">What language should be used in Feature files?</h5>
<div class="ulist">
<ul>
<li>
<p>Problem domain language (<strong>Correct</strong>)</p>
</li>
<li>
<p>Solution domain language</p>
</li>
<li>
<p>Language from both problem and solution domains</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Feature files should try to avoid using language from the <em>solution</em> domain, because that will exclude anyone who doesn&#8217;t write code from being able to read them and give you feedback.</p>
</div>
<div class="paragraph">
<p>It can sometimes be hard, because we have to really learn the way our users and customers talk about their problems. But in the end that&#8217;s one of the most beneficial things you can do for your project.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examine_the_following_scenarios_which_is_using_more_problem_domain_language">Examine the following scenarios. Which is using more problem domain language?</h5>
<div class="paragraph">
<p>Scenario A:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Given database table "tblTasks" has data "Pay rent,Fetch milk"
When I visit "/"
And I click "ui.todos input[type='checkbox' value='Pay rent']"
Then there should be 1 item in "ul.done input[type='checkbox' value='Pay rent']"
Then there should be 1 item in "ul.not-done input[type='checkbox' value='Fetch milk']"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Scenario B:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Given a task "Pay rent"
And a task "Fetch milk"
When I complete the task "Pay rent"
Then the task "Pay rent" should be complete
Then the task "Fetch milk" should be incomplete</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Scenario A is using problem domain language</p>
</li>
<li>
<p>Secnario B is using problem domain language (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>The first scenario has details like the name of a database table, a browser URL, some CSS selectors. All of these are solution domain artefacts.</p>
</div>
</div>
<div class="sect4">
<h5 id="_when_you_use_problem_domain_language_in_your_scenarios_what_is_the_trade_off">When you use problem-domain language in your scenarios, what is the trade-off?</h5>
<div class="ulist">
<ul>
<li>
<p>You may end up with more complex step definition code behind the features (<strong>Correct</strong>)</p>
</li>
<li>
<p>You may alienate business people who prefer to read scenarios written in solution-domain language</p>
</li>
<li>
<p>You end up having to write more scenarios</p>
</li>
<li>
<p>Your scenarios can&#8217;t be read by everyone on the team anymore</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>When you really think of your feature files as documentation first, tests second, you will prioritise readability over everything else. As a consequence, sometimes you&#8217;ll end up needing to push some complexity down into your step definitions.</p>
</div>
<div class="paragraph">
<p>That&#8217;s why building a support API can be useful, to help you manage this complexity.</p>
</div>
<div class="paragraph">
<p>The whole reason for using problem-domain language is that your whole team can understand them, meaning they can act as a shared source of truth.</p>
</div>
<div class="paragraph">
<p>You shouldn&#8217;t need any more scenarios just because you use problem-domain language.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_all_the_time">9.3. Test all the time</h3>
<div class="paragraph">
<p>Up until now, we&#8217;ve been running Cucumber every time we make a change in order to follow the TDD process. When we find a change that&#8217;s too specific to a particular domain model, we drop down to running the unit tests for that model and run them individually, again, following the TDD loop.</p>
</div>
<div class="paragraph">
<p>We wanted to take a moment to highlight something that&#8217;s been in the codebase we&#8217;re working with for a while, but that we&#8217;ve perhaps taken for granted.</p>
</div>
<div class="paragraph">
<p>It&#8217;s here, in our <code>package.json</code> file: <a href="#shot-1038" id="shot-1038" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mocha test &amp;&amp; cucumber-js --tags 'not @todo'</span><span class="dl">"</span>
  <span class="p">},</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What this means, is that every time we run the command <code>npm test</code>, <a href="#shot-1039" id="shot-1039" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> we first run our unit tests (using the javascript unit testing tool, <code>mocha</code>)<a href="#shot-1040" id="shot-1040" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> and then, if those pass, we run our acceptance tests using Cucumber. <a href="#shot-1041" id="shot-1041" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="paragraph">
<p>In this case, we&#8217;re filtering out the scenarios tagged with <code>@todo</code> <a href="#shot-1042" id="shot-1042" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a> so we only run the ones we&#8217;d expect to pass.</p>
</div>
<div class="paragraph">
<p>Refactoring, the process of improving the design without changing the behaviour of the code, needs us to have a way to quickly check that the behaviour of the code hasn&#8217;t changed.</p>
</div>
<div class="paragraph">
<p>Having this <code>npm test</code> command to lean on as we refactor is very useful, because we can use a single command to make sure everything is passing. <a href="#shot-1043" id="shot-1043" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  9 passing <span class="o">(</span>24ms<span class="o">)</span>

.........................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.099s <span class="o">(</span>executing steps: 0m00.014s<span class="o">)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_6">9.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_why_do_we_run_the_unit_tests_before_the_acceptance_tests">Why do we run the unit tests before the acceptance tests?</h5>
<div class="ulist">
<ul>
<li>
<p>If the unit tests are failing, it&#8217;s unlikely that the acceptance tests will pass (<strong>Correct</strong>)</p>
</li>
<li>
<p>Unit tests are better than acceptance tests</p>
</li>
<li>
<p>Acceptance tests are always faster so we leave them until the end</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>We&#8217;ve heard it said that acceptance tests help you <strong>build the right thing</strong>, and unit tests help you <strong>build the thing right</strong>.</p>
</div>
<div class="paragraph">
<p>We run the unit tests first to get feedback about whether the pieces of our solution (the <em>units</em>) are fundamentally working. Then, if they are, we can find out whether they play together to deliver the overall system behaviour that we&#8217;re looking for.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extracting_support_code">9.4. Extracting Support Code</h3>
<div class="paragraph">
<p>We need a new directory to contain our support code. the conventional place to put it is here, in a <code>support</code> directory underneath <code>features</code>. <a href="#shot-1044" id="shot-1044" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nb">mkdir </span>features/support</code></pre>
</div>
</div>
<div class="paragraph">
<p>There’s a special file in <code>features/support</code> that Cucumber always loads first, called <code>env.js</code> <a href="#shot-1045" id="shot-1045" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> (or <code>env.ts</code>, if you&#8217;re using Typescript). You can use this to boot up the system that you’re testing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nb">touch </span>features/support/env.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, our system is just a domain model, so there isn&#8217;t really anything to do in order to boot it up.</p>
</div>
<div class="paragraph">
<p>Still, it&#8217;s useful to have this <code>env.js</code> file because we can use it to set up one-time configuration that all of our scenarios will need.</p>
</div>
<div class="paragraph">
<p>The most obvious duplication in the step definition code is for shouting a message. <a href="#shot-1046" id="shot-1046" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, world</span><span class="dl">"</span>
  <span class="nx">shouter</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">])</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, we call the <code>shouter</code> domain model <code>Person</code> object to send the message,<a href="#shot-1047" id="shot-1047" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> and then we cache that message in <code>this.messagesShoutedBy</code> so that we&#8217;ll be able to use it for validation later on.<a href="#shot-1048" id="shot-1048" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-1049" id="shot-1049" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5.1</a></p>
</div>
<div class="paragraph">
<p>On it&#8217;s own, this wouldn&#8217;t be a problem, but there are four other step definitions for various kinds of shouts that all duplicate this same code.</p>
</div>
<div class="paragraph">
<p>Let’s imagine we had a helper method we could call like this, instead. Wouldn’t that be neater? <a href="#shot-1050" id="shot-1050" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, world</span><span class="dl">"</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So how would we add this <code>shout</code> method to <code>this</code>?<a href="#shot-1051" id="shot-1051" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a> What even <em>is</em> <code>this</code> in the context of a Cucumber step definition function? In order to understand that, we need to learn about a concept called <em>The World</em>.</p>
</div>
<div class="sect3">
<h4 id="_the_world">9.4.1. The World</h4>
<div class="paragraph">
<p>Every time Cucumber runs a scenario, it creates a new object, called the <em>World</em>. We can define the new world class in our <code>env.js</code> support file that we just created.<a href="#shot-1052" id="shot-1052" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a>.</p>
</div>
<div class="paragraph">
<p>Each step definition function runs in the context of a new instance of the world, almost as though it were a method on that object. We can customise the methods available on the world (and so the methods available to the step defintions) by first defining them on a JavaScript class,<a href="#shot-1053" id="shot-1053" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> then calling Cucumber&#8217;s <code>setWorldConstructor</code> method to tell it to use that class when constructing new instances of the world. <a href="#shot-1054" id="shot-1054" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="p">{</span> <span class="nx">setWorldConstructor</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@cucumber/cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">class</span> <span class="nx">ShoutyWorld</span> <span class="p">{</span>
<span class="p">}</span>

<span class="nx">setWorldConstructor</span><span class="p">(</span><span class="nx">ShoutyWorld</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we define our new helper method on this module and paste in the code from the step definition. <a href="#shot-1055" id="shot-1055" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">ShoutyWorld</span> <span class="p">{</span>
  <span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span> <span class="p">{</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">])</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s run Cucumber to check everything’s still working… <a href="#shot-1056" id="shot-1056" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 12</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  9 passing <span class="o">(</span>26ms<span class="o">)</span>

.........................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.087s <span class="o">(</span>executing steps: 0m00.008s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Good.</p>
</div>
<div class="paragraph">
<p>Now we can use that new method everywhere… <a href="#shot-1057" id="shot-1057" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 13</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="p">...</span>
<span class="nx">When</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">{person} shouts {int} messages containing the word {string}</span><span class="dl">"</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`A message containing the word </span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts {int} over-long messages</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="s2">`A message from </span><span class="p">${</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> that is 181 characters long `</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">baseMessage</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span> <span class="o">-</span> <span class="nx">baseMessage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts {string}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts the following message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span>
<span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and check we haven’t broken anything… <a href="#shot-1058" id="shot-1058" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 14</a> Done!</p>
</div>
</div>
<div class="sect3">
<h4 id="_move_this_messagesshoutedby_property_behind_a_getter">9.4.2. Move <code>this.messagesShoutedBy</code> property behind a getter</h4>
<div class="paragraph">
<p>Notice that the helper method we extracted uses that <code>this.messagesShoutedBy</code> property.<a href="#shot-1059" id="shot-1059" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 15</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">ShoutyWorld</span> <span class="p">{</span>
  <span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span> <span class="p">{</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">])</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re using this instance variable in this assertion step <a href="#shot-1060" id="shot-1060" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 16</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Then</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} hears all {person}'s messages</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="nx">listener</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span>
    <span class="nx">equalTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span><span class="p">[</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">])</span>
  <span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One problem with the current approach is that we&#8217;re assuming that <code>this.messagesShoutedBy</code> is always initialized as an object. If it wasn&#8217;t, we&#8217;d get errors like <code>cannot read property "Sean" of undefined</code> from our step definitions.</p>
</div>
<div class="paragraph">
<p>Currently, we mitigate this risk by initializing the property in a <code>Before</code> hook: <a href="#shot-1061" id="shot-1061" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messagesShoutedBy</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">DEFAULT_RANGE</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of doing this, we can explicitly make <code>messagesShoutedBy</code> a property of the <code>World</code>, by defining a getter for it: <a href="#shot-1062" id="shot-1062" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 17</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">ShoutyWorld</span> <span class="p">{</span>
  <span class="kd">get</span> <span class="nx">messagesShoutedBy</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_messagesShoutedBy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_messagesShoutedBy</span> <span class="o">||</span> <span class="p">{})</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The getter uses a private variable for the value of the property, initializing it with an empty object if it’s never been accessed before. <a href="#shot-1063" id="shot-1063" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 19</a></p>
</div>
<div class="paragraph">
<p>Now we no longer need to initialize it in this before hook. <a href="#shot-1064" id="shot-1064" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 20</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">DEFAULT_RANGE</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And run cucumber to check we’re still green. <a href="#shot-1065" id="shot-1065" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 21</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">npm <span class="nb">test</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_move_this_network_property_behind_a_helper_method">9.4.3. Move <code>this.network</code> property behind a helper method</h4>
<div class="paragraph">
<p>We can follow the same steps for the <code>this.network</code> property.<a href="#shot-1066" id="shot-1066" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 22</a> First, make the accessor method: <a href="#shot-1067" id="shot-1067" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 23</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="kd">get</span> <span class="nx">network</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_network</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_network</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">DEFAULT_RANGE</span><span class="p">))</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable the <code>{person}</code> parameter type transformer to pull a <code>network</code> as soon as it needs one: <a href="#shot-1068" id="shot-1068" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 24</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we don&#8217;t need to create a <code>Network</code> in a <code>Before</code> hook anymore.<a href="#shot-1069" id="shot-1069" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 25</a></p>
</div>
<div class="paragraph">
<p>In fact, we can delete the <code>Before</code> hook altogether.<a href="#shot-1070" id="shot-1070" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 26</a></p>
</div>
<div class="paragraph">
<p>This is changing the behaviour slightly, and for the better. Now we&#8217;re not relying on timing - assuming that the hook has created the <code>Network</code> at a particular point in the scenario&#8217;s lifecycle. We just create the <code>Network</code> as we need it. This is called <em>Lazy loading</em>.</p>
</div>
<div class="paragraph">
<p>There&#8217;s one other place where we&#8217;re using the <code>Network</code>, in this step: <a href="#shot-1071" id="shot-1071" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 27</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">"</span><span class="s2">the range is {int}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we&#8217;re trying to change the range of the network, and the only way to do that at the moment is to create a brand new instance of <code>Network</code>. This code won&#8217;t work at the moment, because it&#8217;s trying to set a <code>network</code> property on the World, but we don&#8217;t have a setter for it.</p>
</div>
<div class="paragraph">
<p>All the way through this lesson, we&#8217;ve been <em>pushing the how down</em>, moving the implementation details down from step defintions into our automation support code. Here, we can move the implementation right down into our domain model.</p>
</div>
<div class="paragraph">
<p>Imagine we had a <code>range</code> setter method on our <code>Network</code> that allowed us to modify the range on the fly. Then, our step would just look like this: <a href="#shot-1072" id="shot-1072" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 28</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">"</span><span class="s2">the range is {int}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Isn&#8217;t that better?</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do it!</p>
</div>
<div class="paragraph">
<p>First, we&#8217;ll add a unit test for the <code>Network</code> class: <a href="#shot-1073" id="shot-1073" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 29</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">can change the range</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">laura</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Laura</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">laura</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span>

    <span class="nx">network</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">laura</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span>
  <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll create a couple of people on the Network, which defaults to a range of 100, so they&#8217;re going to be close enough to hear each other at the moment. <a href="#shot-1074" id="shot-1074" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 30</a></p>
</div>
<div class="paragraph">
<p>We&#8217;ll broadcast a shout from Sean, which Lucy should be able to hear.<a href="#shot-1075" id="shot-1075" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 31</a></p>
</div>
<div class="paragraph">
<p>Now, we can try setting the range to something much shorter, like 5, so that Sean will now be out of range.<a href="#shot-1076" id="shot-1076" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 32</a></p>
</div>
<div class="paragraph">
<p>Broadcast again, and this time Lucy shouldn&#8217;t have heard anything.<a href="#shot-1077" id="shot-1077" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 33</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s run the test, and watch it fail like good TDD practitioners.<a href="#shot-1078" id="shot-1078" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 34</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    1<span class="o">)</span> can change the range

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  9 passing <span class="o">(</span>16ms<span class="o">)</span>
  1 failing

  1<span class="o">)</span> Network
       can change the range:

      AssertionError <span class="o">[</span>ERR_ASSERTION]: Expected values to be loosely deep-equal:

<span class="o">[</span>
  <span class="s1">'Free bagels!'</span>,
  <span class="s1">'Free bagels!'</span>
<span class="o">]</span>

should loosely deep-equal

<span class="o">[</span>
  <span class="s1">'Free bagels!'</span>
<span class="o">]</span>
      + expected - actual

       <span class="o">[</span>
         <span class="s2">"Free bagels!"</span>
      -  <span class="s2">"Free bagels!"</span>
       <span class="o">]</span>

      at Context.&lt;anonymous&gt; <span class="o">(</span><span class="nb">test</span>/network.test.js:73:12<span class="o">)</span>
      at processImmediate <span class="o">(</span>node:internal/timers:464:21<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can add the attribute writer: <a href="#shot-1079" id="shot-1079" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 35</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">Network</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_range</span> <span class="o">=</span> <span class="nx">range</span>
  <span class="p">}</span>

  <span class="kd">set</span> <span class="nx">range</span><span class="p">(</span><span class="nx">newRange</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_range</span> <span class="o">=</span> <span class="nx">newRange</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We run the tests again, and everything should be passing. Great! <a href="#shot-1080" id="shot-1080" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 36</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"> npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  10 passing <span class="o">(</span>12ms<span class="o">)</span>

...................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can use that new method in our step: <a href="#shot-1081" id="shot-1081" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 37</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">"</span><span class="s2">the range is {int}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s run all the tests to make sure everything&#8217;s working again: <a href="#shot-1082" id="shot-1082" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 38</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">npm <span class="nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hooray!</p>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_6">9.4.4. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_where_can_you_use_a_world_object">Where can you use a World object?</h5>
<div class="ulist">
<ul>
<li>
<p>In your step definitions (<strong>Correct</strong>)</p>
</li>
<li>
<p>In a custom parameter type (<strong>Correct</strong>)</p>
</li>
<li>
<p>In a <code>Before</code> / <code>After</code> hook (<strong>Correct</strong>)</p>
</li>
<li>
<p>In your application code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Support code, like the World, is created by Cucumber and made available to your step definitions, parameter types and hooks. It doesn&#8217;t make sense to have your application code depend on it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_would_we_put_code_into_a_world_object">Why would we put code into a World object?</h5>
<div class="ulist">
<ul>
<li>
<p>Move complexity out of our step definitions (<strong>Correct</strong>)</p>
</li>
<li>
<p>Hide duplication</p>
</li>
<li>
<p>Share code (<strong>Correct</strong>)</p>
</li>
<li>
<p>Increase the readability of our step definitions (<strong>Correct</strong>)</p>
</li>
<li>
<p>Optimizing performance</p>
</li>
<li>
<p>To share state between steps (<strong>Correct</strong>)</p>
</li>
<li>
<p>Reduce the coupling from the step defintions to the system under test (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>There are many reasons to move code into a support layer!</p>
</div>
<div class="paragraph">
<p>Adding fields to store state allows us to pass context between steps, so we can make them feel more natural to read.</p>
</div>
<div class="paragraph">
<p>If we have step definitions spread across multiple files, they can all access the same fields and methods on a shared World object.</p>
</div>
<div class="paragraph">
<p>Creating an API of methods on the World for interacting with our system makes the step definitions simpler, have less duplication between them, and easier to read. You&#8217;ll end up being happy to have many similar step definitions - to match the wording you want to use in your scenarios - because they all delegate to the same underlying code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_when_is_the_state_of_the_world_reset">When is the state of the World reset?</h5>
<div class="ulist">
<ul>
<li>
<p>We get a brand new instance of the World every time a step definition is invoked</p>
</li>
<li>
<p>We get one new instance for every scenario (<strong>Correct</strong>)</p>
</li>
<li>
<p>We get the same instance for the whole test suite</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Cucumber will create new instances of the World for each scenario. Every step defininition, parameter type or hook will receive the same instance during that scenario.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_organizing_step_definitions_into_multiple_files">9.5. Organizing step definitions into multiple files</h3>
<div class="paragraph">
<p>As your test suite grows, you can end up with hundreds of step defintiions, and keeping them all in a single file becomes a maintenance nightmare.</p>
</div>
<div class="paragraph">
<p>A great benefit of delegating to a support layer is that we can start to organise our step definitions into multiple files, with any step function being able to access the same state and methods on the World, or other support layer objects.</p>
</div>
<div class="paragraph">
<p>To show you how this works, we can move all the steps to do with shouting over to a separate class.</p>
</div>
<div class="paragraph">
<p>First, create an empty file called <code>shout_steps.js</code> <a href="#shot-1083" id="shot-1083" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a>, and import the <code>When</code> method for defining steps.<a href="#shot-1084" id="shot-1084" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="p">{</span> <span class="nx">When</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@cucumber/cucumber</span><span class="dl">"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can cut <a href="#shot-1085" id="shot-1085" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> and paste those steps from the existing <code>steps.js</code> file into this new one: <a href="#shot-1086" id="shot-1086" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, world</span><span class="dl">"</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">{person} shouts {int} messages containing the word {string}</span><span class="dl">"</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`A message containing the word </span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts {int} over-long messages</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="s2">`A message from </span><span class="p">${</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> that is 181 characters long `</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">baseMessage</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span> <span class="o">-</span> <span class="nx">baseMessage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts {string}</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts the following message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And run Cucumber <a href="#shot-1087" id="shot-1087" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> to check everything&#8217;s still working. Great.</p>
</div>
<div class="paragraph">
<p>Breaking apart your step definitions into multiple files is more of an art than a science, but we can give you a couple of pieces of advice. We&#8217;ve seen teams try to organise their step definitions by feature so that, for example, the premium accounts feature would have its own steps file. We find that tends to work out badly, since while feature files live in the problem domain, step definitions are closer to the solution domain. Usually multiple features will need to carry out common actions against the system (think of logging in, for example), so this leaves us with low cohesion: step definitions that sit together in the same file, but don&#8217;t have much in common with each other.</p>
</div>
<div class="paragraph">
<p>We find it&#8217;s better to organise your steps by which part of the system they act on. This is a bit hard to illustrate in a tiny solution like Shouty, but bear this in mind when you&#8217;re working on your own projects.</p>
</div>
<div class="paragraph">
<p>We could continue to move code from our step definitions into the support layer. For example, we could write a support method for generating messages of a certain length <a href="#shot-1088" id="shot-1088" title="Highlight lines 20-21" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4: Highlight lines 20-21</a>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">When</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} shouts {int} over-long messages</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">shouter</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="s2">`A message from </span><span class="p">${</span><span class="nx">shouter</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> that is 181 characters long `</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">baseMessage</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span> <span class="o">-</span> <span class="nx">baseMessage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shout</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="nx">shouter</span><span class="p">,</span> <span class="nx">message</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or a method for asserting that a person has heard certain messages. <a href="#shot-1089" id="shot-1089" title="Highlight lines 23-24" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: Highlight lines 23-24</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Then</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">{person} hears the following messages:</span><span class="dl">"</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">expectedMessages</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">actualMessages</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span>
    <span class="nx">assertThat</span><span class="p">(</span><span class="nx">actualMessages</span><span class="p">,</span> <span class="nx">equalTo</span><span class="p">(</span><span class="nx">expectedMessages</span><span class="p">.</span><span class="nx">raw</span><span class="p">()))</span>
  <span class="p">}</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ideally, each step definition <a href="#shot-1090" id="shot-1090" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a> should only contain one or two lines that delegate to your support code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">"</span><span class="s2">{person} has bought {int} credits</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">credits</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">person</span><span class="p">.</span><span class="nx">credits</span> <span class="o">=</span> <span class="nx">credits</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you follow this principle, your step definitions become a translation layer from plain language into code. By keeping the vocabulary consistent as you move across the problem-solution boundary, you start to allow the scenarios to drive the design of your domain model. This is what we call modelling by example.</p>
</div>
<div class="paragraph">
<p>In this way, we create our own API for automating our application. As this API grows, it becomes easier and easier to write new step definitions, because the actions you need to take are already defined on the API.</p>
</div>
<div class="paragraph">
<p>It might seem like over-engineering on our little Shouty application, but you’ll be surprised how quickly these test suites grow. Taking time to stamp out complexity early  and organise your code to create a good support API is a great investment for the future.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_5">9.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_what_is_a_good_heuristic_for_breaking_up_step_definitions_into_multiple_files">What is a good heuristic for breaking up step definitions into multiple files?</h5>
<div class="ulist">
<ul>
<li>
<p>Name each step definition file after the feature where the steps are used</p>
</li>
<li>
<p>No more than 2 step definitions in any file</p>
</li>
<li>
<p>Have three files: one for all the `Given`s, one for all the `When`s, and one for all the `Then`s</p>
</li>
<li>
<p>Keep them all in the same file until you see patterns emerge (<strong>Correct</strong>)</p>
</li>
<li>
<p>Try to maintain cohesion by keeping steps that act on the same part of the system in the same file (<strong>Correct</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>It&#8217;s hard to give you a rule of thumb for how many step definitions should be in the same file. What&#8217;s more important is to look for how cohesive they are: if there&#8217;s a cluster of steps that are all acting on the same fields or methods in the World, or the same part of the system itself, they probably belong together in one file.</p>
</div>
<div class="paragraph">
<p>We would always start out by lumping them in to a single file at first, then looking for patterns.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_what_are_some_advantages_of_a_well_organised_support_layer">9.5.2. What are some advantages of a well-organised support layer?</h4>
<div class="ulist">
<ul>
<li>
<p>It makes it easier to use problem-domain language in your scenarios because writing step defintion code is easier (<strong>Correct</strong>)</p>
</li>
<li>
<p>It keeps step defintions down to one or two lines, so you can easily see whether the language used in the code is consistent with that used in the scenarios (<strong>Correct</strong>)</p>
</li>
<li>
<p>Business stakeholders will love reading your support code API and giving you feedback on it</p>
</li>
<li>
<p>It enables you to write new scenarios increasingly quickly, since you have invested in the infrastructure for automating your application (<strong>Correct</strong>)</p>
</li>
<li>
<p>Newcomers should be able to start contributing to your test suite sooner, since complexity is abstracted away into the support layer (<strong>Correct</strong>)</p>
</li>
<li>
<p>You&#8217;ll eliminate the chances of bugs in your test code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>Although it would be great to think we can eliminate bugs, this is impossible. Still, the more you apply good software engineering principles (like short methods) to your test code as well as your production code, the easier it will be to maintain.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a chance that, if you&#8217;ve really put the work into creating a readable API on your support layer, some of your more technical stakeholders will be able to read it and give you feedback, but that&#8217;s really not the main purpose.</p>
</div>
<div class="paragraph">
<p>By pushing re-usable code down into a support layer, you&#8217;re investing in the future by building the scaffolding around your system to make adding more automation easier in the future. Think of it like adding handrails and ladders on a construction site, rather than having people scale the walls with ropes to work on the building.</p>
</div>
<div class="paragraph">
<p>As you do this, a lovely side-effect is that with neater code it becomes easier to see when you&#8217;re using consistent domain language from the scenarios and into the code.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acceptance_tests_vs_unit_tests">10. Acceptance Tests vs Unit Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the last chapter, we extracted a layer of support code from your step definitions to keep your Cucumber code easy - and cost-effective - to maintain.</p>
</div>
<div class="paragraph">
<p>We&#8217;re going to keep things technical in this chapter. Remember that bug we spotted right back at the beginning of Chapter 7, where the user was over-charged if they mentioned “buy” several times in the same message? It&#8217;s finally time to knuckle down and fix it.</p>
</div>
<div class="paragraph">
<p>As we do so, you&#8217;re going to get some more experience of the inner and outer BDD loops that we first introduced you to in Chapter 5. We&#8217;ll explore the difference between unit tests and acceptance tests, and learn the value of each.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re someone who doesn&#8217;t normally dive deep into code, try not to worry. We think you&#8217;ll find it valuable to see how different kinds of tests complement each other in helping you to build a quality product.</p>
</div>
<div class="sect2">
<h3 id="_tidy_up_the_bug_report_gherkin">10.1. Tidy up the bug report Gherkin</h3>
<div class="paragraph">
<p>Let&#8217;s start by running our failing scenario.</p>
</div>
<div class="paragraph">
<p>We have it marked with a <code>@todo</code> tag on it,<a href="#shot-1091" id="shot-1091" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a> but those scenarios are filtered out in our default <code>npm test</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nt">@todo</span>
    <span class="kn">Scenario</span><span class="p">:</span> BUG <span class="c">#2789</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re going to start work on the scenario now, so let&#8217;s change that tag to a <code>@wip</code> to indicate that it&#8217;s "Work In Progress":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="nt">@wip</span>
    <span class="kn">Scenario</span><span class="p">:</span> BUG <span class="c">#2789</span>
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">When </span>Sean shouts <span class="s">"buy, buy buy!"</span>
      <span class="nf">Then </span>Sean should have 25 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we run our regular <code>npm test</code> command, we should see the failing scenario: <a href="#shot-1092" id="shot-1092" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>OK. We&#8217;ll work outside-in and start by tidying up the Gherkin specification.</p>
</div>
<div class="paragraph">
<p>Right now, the scenario is still in the raw form it was in when the bug was first reported, with a name that references an ID in our bug tracking system.<a href="#shot-1093" id="shot-1093" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> This doesn&#8217;t make for very good documentation about the intended behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="p">@</span><span class="nd">wip</span>
    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">BUG</span> <span class="err">#</span><span class="mi">2789</span>
      <span class="nx">Given</span> <span class="nx">Sean</span> <span class="nx">has</span> <span class="nx">bought</span> <span class="mi">30</span> <span class="nx">credits</span>
      <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">buy, buy buy!</span><span class="dl">"</span>
      <span class="nx">Then</span> <span class="nx">Sean</span> <span class="nx">should</span> <span class="nx">have</span> <span class="mi">25</span> <span class="nx">credits</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It also isn&#8217;t sitting under the right rule.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by moving it here, under the rule about charging for mentioning the word "buy" <a href="#shot-1094" id="shot-1094" title="move scenario under first rule" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5: move scenario under first rule</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Mention</span> <span class="err">the</span> <span class="err">word</span> <span class="err">"buy"</span> <span class="err">and</span> <span class="err">you</span> <span class="err">lose</span> <span class="err">5</span> <span class="err">credits.</span>

    <span class="kn">Scenario</span><span class="p">:</span> Sean some messages containing the word “buy”
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">And </span>Sean shouts 3 messages containing the word <span class="s">"buy"</span>
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 15 credits

    <span class="nt">@wip</span>
    <span class="kn">Scenario</span><span class="p">:</span> BUG <span class="c">#2789</span>
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">When </span>Sean shouts <span class="s">"buy, buy buy!"</span>
      <span class="nf">Then </span>Sean should have 25 credits

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Over-long</span> <span class="err">messages</span> <span class="err">cost</span> <span class="err">2</span> <span class="err">credits</span>

    <span class="kn">Scenario</span><span class="p">:</span> Sean shouts some over-long messages
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">When </span>Sean shouts 2 over-long messages
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 26 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s find a better name for the scenario.</p>
</div>
<div class="paragraph">
<p>Using our Friends Episode naming convention that we introduced in Chapter 7, we could call it something like "(the one where Sean) mentions “buy” several times in one shout"? <a href="#shot-1095" id="shot-1095" title="change the scenario title" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6: change the scenario title</a><a href="#shot-1096" id="shot-1096" title="run tests" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7: run tests</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Mention</span> <span class="err">"buy"</span> <span class="err">multiple</span> <span class="err">times</span> <span class="err">in</span> <span class="err">one</span> <span class="err">shout</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You might be worried about losing this bug ID. We could keep it in a comment <a href="#shot-1097" id="shot-1097" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 </a>, a tag <a href="#shot-1098" id="shot-1098" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 </a>, or in the description of the Scenario.</p>
</div>
<div class="paragraph">
<p>Just like under a <code>Feature</code> keyword, you can write any arbitrary text you want beneath a <code>Scenario</code> keyword, before the first <code>Given</code>, <code>When</code> or <code>Then</code> keyword.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s do that. <a href="#shot-1099" id="shot-1099" title="write the bug number in the scenario description" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8: write the bug number in the scenario description</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ghekrin">    @wip
    Scenario: Mention "buy" multiple times in one shout
      BUG #2789</code></pre>
</div>
</div>
<div class="paragraph">
<p>We think the values in the example could be changed to make it a little more expressive. If we start Sean off with 100 credits,<a href="#shot-1100" id="shot-1100" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a> and end him with 95,<a href="#shot-1101" id="shot-1101" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 10</a> it more clearly illustrates the rule that only five credits should be deducted. <a href="#shot-1102" id="shot-1102" title="run tests" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 11: run tests</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="p">@</span><span class="nd">wip</span>
    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Mention</span> <span class="dl">"</span><span class="s2">buy</span><span class="dl">"</span> <span class="nx">multiple</span> <span class="nx">times</span> <span class="k">in</span> <span class="nx">one</span> <span class="nx">shout</span>
      <span class="nx">BUG</span> <span class="err">#</span><span class="mi">2789</span>

      <span class="nx">Given</span> <span class="nx">Sean</span> <span class="nx">has</span> <span class="nx">bought</span> <span class="mi">100</span> <span class="nx">credits</span>
      <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">buy, buy buy!</span><span class="dl">"</span>
      <span class="nx">Then</span> <span class="nx">Sean</span> <span class="nx">should</span> <span class="nx">have</span> <span class="mi">95</span> <span class="nx">credits</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>OK great, so now we have a failing test we&#8217;re more happy with.</p>
</div>
<div class="paragraph">
<p>The trouble is, although this test tells us what&#8217;s wrong with the behaviour of the system - the wrong number of credits are being deducted - it doesn&#8217;t give us any clues as to <strong>why</strong>.</p>
</div>
<div class="paragraph">
<p>This is why we need a balance of unit tests <em>and</em> acceptance tests: when they fail, acceptance tests tell you what is wrong with the system, but unit tests should tell you where you need to go to fix it.</p>
</div>
<div class="paragraph">
<p>That&#8217;s what we&#8217;ll look at in the next lesson.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_ice_cream_cone">10.2. Testing ice cream cone</h3>
<div class="paragraph">
<p>Now that we have tidied up the scenario, we need to find the source of our bug.</p>
</div>
<div class="paragraph">
<p>We have a passing unit test suite. <a href="#shot-1103" id="shot-1103" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a> So this doesn&#8217;t give us any clues as to where the problem lies in the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npx mocha


  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  11 passing <span class="o">(</span>9ms<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we know there&#8217;s a bug, we should have at least one unit test failing. So that&#8217;s an indication that we might be missing a test. Lets see how we&#8217;re testing the mention of the word "buy" in the lower level tests.</p>
</div>
<div class="paragraph">
<p>Oh my! We have absolutely no tests for this feature on our unit test suite! <a href="#shot-1104" id="shot-1104" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> The only test here about credits is this one for charging for shouts that are over 180 characters. We&#8217;ll need to remedy this in order to triage our problem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">credits</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">deducts 2 credits for a shout over 180 characters</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">longMessage</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span>

      <span class="kd">const</span> <span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">laura</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Laura</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

      <span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">laura</span><span class="p">)</span>
      <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">longMessage</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>

      <span class="nx">assertThat</span><span class="p">(</span><span class="nx">sean</span><span class="p">.</span><span class="nx">credits</span><span class="p">,</span> <span class="nx">equalTo</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">})</span>
  <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a common problem we&#8217;ve seen time and again in the test suties of teams who adopt Cucumber. In fact, it was a problem on Cucumber&#8217;s own codebase in the early days. We were so enamoured by writing new scenarios to describe new behaviour, we used it for everything, and hardly wrote any unit tests. Gradually, we started to realise that this had some significant disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We had a lot of scenarios, some describing quite obscure edge-cases, making for poor documentation.</p>
</li>
<li>
<p>The tests were slow, because they all ran as full integration tests.</p>
</li>
<li>
<p>When something was broken, there was a lot of code to sift through to try and find the cause of the problem.</p>
</li>
<li>
<p>The internal design of the code wasn&#8217;t very modular, because we had no design pressure from unit testing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;s a well-known model for how many different types of tests you should have, known as the <em>testing pyramid</em>. It describes this idea that, at the wide base of the pyramid, you should have a large number of unit tests. Then, as you move up the pyramid and it gets wider, you have a smaller number of integration or component tests that exercise subsystems or "chunks" of your application. Finally, at the tip of the pyramid you have a small number of full-stack integation tests.</p>
</div>
<div class="paragraph">
<p>Floating above the pyramid here is a sweet little fluffy cloud representing the few manual <em>exploratory</em> tests that the team perform on a regular basis.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://alisterbscott.com/wp-content/uploads/2018/02/ideal-automated-testing-pyramid.jpg" alt="ideal automated testing pyramid">
</div>
</div>
<div class="paragraph">
<p>What we have here is the opposite, which experienced test automation engineer Alister Scott <a href="https://alisterbscott.com/kb/testing-pyramids/">once described</a> as a "testing ice cream cone".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://alisterbscott.com/wp-content/uploads/2018/02/software-testing-icecream-cone-antipattern.jpg" alt="software testing icecream cone antipattern">
</div>
</div>
<div class="paragraph">
<p>Here, in this anti-pattern, everything is the wrong way around. We have a tiny number of unit tests supporting (or rather failing to support) an excessive number of slower, full-stack integration tests.</p>
</div>
<div class="paragraph">
<p>Notice that above the ice-cream cone, we have a huge heavy blob of manual regression tests. I&#8217;d rather have a real ice-cream!</p>
</div>
<div class="paragraph">
<p>Many teams find themselves in this situation when they first get into test automation, and it&#8217;s not something to get despondent about. It&#8217;s possible to shift your distribution of tests toward the pyramid, but it takes deliberate effort and discipline.</p>
</div>
<div class="paragraph">
<p>In the next lesson we&#8217;ll get started on doing that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retrofit_unit_test">10.3. Retrofit unit test</h3>
<div class="paragraph">
<p>Lets add a unit test where Sean shouts a message using the word "buy",<a href="#shot-1105" id="shot-1105" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a> and then we assert that five credits have been deducted.<a href="#shot-1106" id="shot-1106" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">deducts 5 credits for mentioning the word 'buy'</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Come buy these awesome croissants</span><span class="dl">'</span>

      <span class="kd">const</span> <span class="nx">sean</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">laura</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Laura</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

      <span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">laura</span><span class="p">)</span>
      <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>

      <span class="nx">assertThat</span><span class="p">(</span><span class="nx">sean</span><span class="p">.</span><span class="nx">credits</span><span class="p">,</span> <span class="nx">equalTo</span><span class="p">(</span><span class="mi">95</span><span class="p">))</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We run our unit test suite <a href="#shot-1107" id="shot-1107" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a> and &#8230;&#8203; it passes.<a href="#shot-1108" id="shot-1108" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  12 passing <span class="o">(</span>22ms<span class="o">)</span>

...................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.066s <span class="o">(</span>executing steps: 0m00.005s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing a test that passes the first time it runs gives us no confidence. Remember: <em>Never trust an autommated test that you haven&#8217;t seen fail</em>.</p>
</div>
<div class="paragraph">
<p>We could be adding a spec that testes the wrong thing or that it tests nothing at all and we&#8217;d never even realize it, because it "works". So lets force it to fail by commenting the line of code in the solution where we actually deduct the credits. <a href="#shot-1109" id="shot-1109" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="c1">// shouter.credits -= (message.match(/buy/g) || []).length * 5</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we run the unit tests and watch it fail.<a href="#shot-1110" id="shot-1110" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      1<span class="o">)</span> deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  11 passing <span class="o">(</span>24ms<span class="o">)</span>
  1 failing

  1<span class="o">)</span> Network
       credits
         deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>:

      AssertionError:
Expected: <b class="conum">(95)</b>
     but: was <b class="conum">(100)</b>
      + expected - actual

      <span class="nt">-100</span>
      +95

      at Context.&lt;anonymous&gt; <span class="o">(</span><span class="nb">test</span>/network.test.js:98:7<span class="o">)</span>
      at processImmediate <span class="o">(</span>node:internal/timers:466:21<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can actually see it fails for the right reasons: no credits have been deducted. <a href="#shot-1111" id="shot-1111" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="paragraph">
<p>Now that we&#8217;re confident our unit test is testing the right thing, we can make it pass again by uncommenting the line.<a href="#shot-1112" id="shot-1112" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/g</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And run the entire suite to make sure everything&#8217;s still in place.<a href="#shot-1113" id="shot-1113" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 9</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  12 passing <span class="o">(</span>15ms<span class="o">)</span>

...................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.042s <span class="o">(</span>executing steps: 0m00.004s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alright, it seems we&#8217;re finally in a position to be able to write a unit test to trap this bug.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tdd_our_fix_with_a_unit_test">10.4. TDD our fix with a unit test</h3>
<div class="paragraph">
<p>Now that we added a unit test for the word "buy", we can add another one for when we mention it multiple times, which is the bug we were trying to solve in the first place.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll just copy and paste the previous spec and add buy three times.<a href="#shot-1114" id="shot-1114" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="paragraph">
<p>The result should be the same.<a href="#shot-1115" id="shot-1115" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">deducts 5 credits even if you mention the word 'buy' several times</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Come buy buy buy these awesome croissants</span><span class="dl">'</span>

      <span class="kd">const</span> <span class="nx">sean</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">laura</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Laura</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

      <span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">laura</span><span class="p">)</span>
      <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>

      <span class="nx">assertThat</span><span class="p">(</span><span class="nx">sean</span><span class="p">.</span><span class="nx">credits</span><span class="p">,</span> <span class="nx">equalTo</span><span class="p">(</span><span class="mi">95</span><span class="p">))</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we make sure it fails.<a href="#shot-1116" id="shot-1116" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>
      1<span class="o">)</span> deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times

  </span>Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  12 passing <span class="o">(</span>17ms<span class="o">)</span>
  1 failing

  1<span class="o">)</span> Network
       credits
         deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times</span>:

      AssertionError:
Expected: <b class="conum">(95)</b>
     but: was <b class="conum">(85)</b>
      + expected - actual

      <span class="nt">-85</span>
      +95

      at Context.&lt;anonymous&gt; <span class="o">(</span><span class="nb">test</span>/network.test.js:110:7<span class="o">)</span>
      at processImmediate <span class="o">(</span>node:internal/timers:466:21<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in place, we can focus on fixing the bug.<a href="#shot-1117" id="shot-1117" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding this <code>g</code> flag means the regular expression can match "globally" - so it will return an array of all matches, rather than just the first one.</p>
</div>
<div class="paragraph">
<p>And run the specs.<a href="#shot-1118" id="shot-1118" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>
      ✓ deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times

  </span>Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  13 passing <span class="o">(</span>16ms<span class="o">)</span>

...................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.051s <span class="o">(</span>executing steps: 0m00.004s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Well look at that. One character! Just one little character was missing from the code and caused us to do so much work! Sometimes computers can be so picky!</p>
</div>
<div class="paragraph">
<p>Aaannyway.</p>
</div>
<div class="paragraph">
<p>With our unit test suit all green, we&#8217;re confident to remove the BUG reference and the <code>@todo</code> tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Mention "buy" multiple times in one shout
      <span class="nf">Given </span>Sean has bought 100 credits
      <span class="nf">When </span>Sean shouts <span class="s">"buy, buy buy!"</span>
      <span class="nf">Then </span>Sean should have 95 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can run the full test suite to make sure everything&#8217;s working as expected.<a href="#shot-1119" id="shot-1119" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>
      ✓ deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times

  </span>Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  13 passing <span class="o">(</span>16ms<span class="o">)</span>

.........................................

7 scenarios <span class="o">(</span>7 passed<span class="o">)</span>
41 steps <span class="o">(</span>41 passed<span class="o">)</span>
0m00.044s <span class="o">(</span>executing steps: 0m00.005s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And they all pass.</p>
</div>
<div class="paragraph">
<p>Fantastic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_another_edge_case">10.5. Another edge case</h3>
<div class="paragraph">
<p>One nice thing about working with unit tests (or microtests as Mike Hill likes to call them) is that they bring your focus down to a very narrow part of the code. Wheras a Cucumber scenario is for zooming out and thinking abou the big picture, a unit test puts a microscope on one tiny part of the system.</p>
</div>
<div class="paragraph">
<p>Sometimes that helps us to see things we hadn&#8217;t anticipated.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the <code>deduct_credits</code> method.<a href="#shot-1120" id="shot-1120" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">_deductCredits</span><span class="p">(</span><span class="nx">shortEnough</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">shouter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shortEnough</span><span class="p">)</span> <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s something on this method that caught our attention: the regex we&#8217;re using is case sensitive.<a href="#shot-1121" id="shot-1121" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which raises the question, what should happen if the word has a different capitalization? What if they literally shout "BUY" in capitals?</p>
</div>
<div class="paragraph">
<p>To answer this question, we have a quick chat with Paula, who confirms that it should have the same effect as if it were lowercased: deduct 5 credits.</p>
</div>
<div class="paragraph">
<p>So lets first add a test.<a href="#shot-1122" id="shot-1122" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 3</a></p>
</div>
<div class="paragraph">
<p>We&#8217;ll copy the same test we copied last time,<a href="#shot-1123" id="shot-1123" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 4</a> and capitalize the word "Buy".<a href="#shot-1124" id="shot-1124" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">deducts 5 credits for mentioning the word 'buy'</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Come Buy these awesome croissants</span><span class="dl">'</span>

      <span class="kd">const</span> <span class="nx">sean</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sean</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">laura</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="dl">"</span><span class="s2">Laura</span><span class="dl">"</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

      <span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">laura</span><span class="p">)</span>
      <span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sean</span><span class="p">)</span>

      <span class="nx">assertThat</span><span class="p">(</span><span class="nx">sean</span><span class="p">.</span><span class="nx">credits</span><span class="p">,</span> <span class="nx">equalTo</span><span class="p">(</span><span class="mi">95</span><span class="p">))</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we run the spec to watch it fail.<a href="#shot-1125" id="shot-1125" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>
      ✓ deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times
      </span>1<span class="o">)</span> deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  13 passing <span class="o">(</span>17ms<span class="o">)</span>
  1 failing

  1<span class="o">)</span> Network
       credits
         deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>:

      AssertionError:
Expected: <b class="conum">(95)</b>
     but: was <b class="conum">(100)</b>
      + expected - actual

      <span class="nt">-100</span>
      +95

      at Context.&lt;anonymous&gt; <span class="o">(</span><span class="nb">test</span>/network.test.js:122:7<span class="o">)</span>
      at processImmediate <span class="o">(</span>node:internal/timers:466:21<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we write the code that&#8217;ll make it pass.<a href="#shot-1126" id="shot-1126" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="nx">shouter</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/buy/i</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, we run the entire test suite to watch that beautiful green.<a href="#shot-1127" id="shot-1127" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 8</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span>
<span class="o">&gt;</span> mocha <span class="nb">test</span> <span class="o">&amp;&amp;</span> cucumber-js <span class="nt">--tags</span> <span class="s1">'not @todo'</span>



  Network
    ✓ broadcasts a message to a listener within range
    ✓ does not broadcast a message to a listener out of range
    ✓ does not broadcast a message to a listener out of range negative distance
    ✓ does not broadcast a message over 180 characters even <span class="k">if </span>listener is <span class="k">in </span>range
    ✓ can change the range
    credits
      ✓ deducts 2 credits <span class="k">for </span>a shout over 180 characters
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>
      ✓ deducts 5 credits even <span class="k">if </span>you mention the word <span class="s1">'buy'</span> several <span class="nb">times</span>
      ✓ deducts 5 credits <span class="k">for </span>mentioning the word <span class="s1">'buy'</span>

  Person
    ✓ subscribes to the network
    ✓ has a location
    ✓ broadcasts shouts to the network
    ✓ remembers messages heard
    ✓ can be moved to a different location


  14 passing <span class="o">(</span>15ms<span class="o">)</span>

...................................

6 scenarios <span class="o">(</span>6 passed<span class="o">)</span>
35 steps <span class="o">(</span>35 passed<span class="o">)</span>
0m00.042s <span class="o">(</span>executing steps: 0m00.005s<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Great. So working with unit tests here has helped us to notice and fix another small edge-case. Normally if we were doing test-driven development, we&#8217;d have spotted this at the time this code was written, especially if we were doing ensemble programming and had some other folks thinking about and reviewing the code as we wrote it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_re_balancing_our_test_suite">10.6. Re-balancing our test suite</h3>
<div class="paragraph">
<p>Finally, we can sit down with Paula and Tammy and discuss the fact that we have this edge-case tested both at the unit and feature levels. Do we need to keep both tests?</p>
</div>
<div class="paragraph">
<p>Since it&#8217;s not in the happy path, we decide to remove the scenario and leave the unit test in place.<a href="#shot-1128" id="shot-1128" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">🎬 7</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Mention</span> <span class="err">the</span> <span class="err">word</span> <span class="err">"buy"</span> <span class="err">and</span> <span class="err">you</span> <span class="err">lose</span> <span class="err">5</span> <span class="err">credits.</span>

    <span class="kn">Scenario</span><span class="p">:</span> Sean some messages containing the word “buy”
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">And </span>Sean shouts 3 messages containing the word <span class="s">"buy"</span>
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 15 credits

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Over-long</span> <span class="err">messages</span> <span class="err">cost</span> <span class="err">2</span> <span class="err">credits</span>

    <span class="kn">Scenario</span><span class="p">:</span> Sean shouts some over-long messages
      <span class="nf">Given </span>Sean has bought 30 credits
      <span class="nf">When </span>Sean shouts 2 over-long messages
      <span class="nf">Then </span>Lucy hears all Sean's messages
      <span class="nf">And </span>Sean should have 26 credits</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a great move from the team, moving the balance back from ice-cream cone towards pyramid. It&#8217;s often not easy getting the team to let go of any of their automated tests, especially since unit tests are something that not all team members can easily see and get confidence from.</p>
</div>
<div class="paragraph">
<p>But it&#8217;s the right thing to do. There&#8217;s no point wasting the computer&#8217;s time testing the same behaviour in two different ways, and it leaves behind more test automation code for the people who&#8217;ll have to maintain the system in the future.</p>
</div>
<div class="paragraph">
<p>Kent Beck, who is famous for popularising test-driven development and has written some great books on it, once said that "I get paid for code that works, not for tests. My philosophy is to test as little as possible to reach a given level of confidence."</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to remember that while we absolutely need automated tests in order to keep our code easy and safe to change in the future, we need as few of them as possible. That means the whole team need to be involved in testing, and deciding where is the best place to connect an automated test in order to give you that confidence. Very often, a unit test will be the better choice, but you have to work together to decide that.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_epilogue">11. Epilogue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This concludes our epic journey to get you started using Cucumber as it was intended - a tool to help you and your team decide what to build, build it, and maintain it for years to come.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve been working with these techniques for 20 years now, and I&#8217;m still learning new stuff every day. So don&#8217;t get disheartened if it seems overwhelming sometimes.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a great supportive community of other practitioners waiting for you in our <a href="https://cucumber.io/community#slack">Community Slack</a> and there are a wealth of great books you can pick up for further study.</p>
</div>
<div class="paragraph">
<p>There&#8217;s the classic Cucumber Book, which has versions in both <a href="https://pragprog.com/titles/hwcuc2/the-cucumber-book-second-edition/">Ruby</a> and <a href="https://pragprog.com/titles/srjcuc/the-cucumber-for-java-book/">Java</a>.</p>
</div>
<div class="paragraph">
<p>There&#8217;s John Fergusson Smart&#8217;s <a href="https://www.manning.com/books/bdd-in-action">BDD in Action</a>.</p>
</div>
<div class="paragraph">
<p>There&#8217;s Richard Lawrence and Paul Rayner&#8217;s book <a href="https://www.pearson.com/store/p/behavior-driven-development-with-cucumber-better-collaboration-for-better-software/P200000009515/9780321772633">Behavior-Driven Development with Cucumber</a></p>
</div>
<div class="paragraph">
<p>And last but definitely not least, there&#8217;s Seb Rose and Gaspar Nagy&#8217;s series of three, <a href="https://bddbooks.com/">The BDD Books: Discovery, Formulation and Automation</a>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re keep to see more courses here on Cucumber School on other topics, or you&#8217;d just like to give us some feedback on this course, please come into the Slack and let us know. We&#8217;d love to hear from you.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-15 12:56:38 -0700
</div>
</div>
</body>
</html>