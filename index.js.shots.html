<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Matt Wynne">
<title>BDD with Cucumber (JavaScript)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>BDD with Cucumber (JavaScript)</h1>
<div class="details">
<span id="author" class="author">Matt Wynne</span><br>
<span id="email" class="email"><a href="mailto:matt@cucumber.io">matt@cucumber.io</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_discovering_bdd">1. Discovering BDD</a></li>
<li><a href="#_your_first_scenario">2. Your first Scenario</a>
<ul class="sectlevel2">
<li><a href="#_an_introduction_to_shouty">2.1. An introduction to Shouty</a></li>
<li><a href="#_choose_the_first_scenario">2.2. Choose the first scenario</a></li>
<li><a href="#_install_cucumber">2.3. Install Cucumber</a></li>
<li><a href="#_add_a_scenario_wire_it_up">2.4. Add a scenario, wire it up</a></li>
<li><a href="#_sketch_out_the_solution">2.5. Sketch out the solution</a></li>
<li><a href="#_make_the_scenario_pass">2.6. Make the scenario pass</a></li>
</ul>
</li>
<li><a href="#_expressing_yourself">3. Expressing yourself</a>
<ul class="sectlevel2">
<li><a href="#_cucumber_expressions_not_regular_expressions">3.1. Cucumber expressions not regular expressions</a></li>
<li><a href="#_literal_expressions">3.2. Literal expressions</a></li>
<li><a href="#_capturing_parameters">3.3. Capturing parameters</a></li>
<li><a href="#_flexibility">3.4. Flexibility</a></li>
<li><a href="#_custom_parameters">3.5. Custom parameters</a></li>
</ul>
</li>
<li><a href="#_cleaning_up">4. Cleaning up</a>
<ul class="sectlevel2">
<li><a href="#_the_importance_of_readability">4.1. The importance of readability</a></li>
<li><a href="#_review_changes_that_happened_while_we_were_away">4.2. Review changes that happened while we were away</a></li>
<li><a href="#_description_field">4.3. Description field</a></li>
<li><a href="#_the_before_hook">4.4. The "Before" hook</a></li>
<li><a href="#_create_person_in_a_generic_stepdef">4.5. Create Person in a generic stepdef</a></li>
<li><a href="#_backgrounds">4.6. Backgrounds</a></li>
</ul>
</li>
<li><a href="#_loops">5. Loops</a>
<ul class="sectlevel2">
<li><a href="#_removing_redundant_scenarios">5.1. Removing redundant scenarios</a></li>
<li><a href="#_incidental_details">5.2. Incidental details</a></li>
<li><a href="#_refactoring_to_data_tables">5.3. Refactoring to Data Tables</a></li>
<li><a href="#_deeper_into_data_tables">5.4. Deeper into Data Tables</a></li>
<li><a href="#_docstring">5.5. DocString</a></li>
<li><a href="#_tdd_loops">5.6. TDD Loops</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_discovering_bdd">1. Discovering BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The script for this chapter is currently in <a href="https://docs.google.com/document/d/1S8eX3lz8-Ys9v94id9atFcX70hpi6XUoBaE5d6jsbHs/edit">Google Docs</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_your_first_scenario">2. Your first Scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The video and audio assets for this chapter are <a href="https://drive.google.com/drive/u/2/folders/1He7stdn0S-zIlNmWF-d1ISuyhfC7tMwO">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_an_introduction_to_shouty">2.1. An introduction to Shouty</h3>
<div class="paragraph">
<p>Shouty is a social network that allows people who are physically close to communicate, just like people have always communicated with their voices. In the real world you can talk to someone in the same room, or across the street. Or even 100 m away from you in a park - if you shout.</p>
</div>
<div class="paragraph">
<p>That’s Shouty. What you say on this social network can only be “heard” by people who are nearby.</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://drive.google.com/uc?id=185INaLm9jKvAZqvm-CzqpkfSyGt3C_kb" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1coTuZC_HcN3RXfduRqnZMfzlYJStQ2hq" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_choose_the_first_scenario">2.2. Choose the first scenario</h3>
<div class="paragraph">
<p>Let’s start with a very basic example of Shouty’s behaviour. Something we might have discussed in a three amigos meeting:</p>
</div>
<div class="paragraph">
<p>Sean the shouter shouts "free bagels at Sean&#8217;s" and Lucy the listener who happens to be stood across the street from his store, 15 metres away, hears him. She walks into Sean’s Coffee and takes advantage of the offer.</p>
</div>
<div class="paragraph">
<p><a href="#shot-236" id="shot-236" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
We can translate this into a Gherkin scenario so that Cucumber can run it. Here&#8217;s how that would look.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kn">Scenario</span><span class="p">:</span> Listener is within range
  <span class="nf">Given </span>Lucy is located 15m from Sean
  <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
  <span class="nf">Then </span>Lucy hears Sean’s message</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see there are four special keywords being used here. <code>Scenario</code> just tells Cucumber we’re about to describe an example that it can execute. Then you see the lines beginning with Given, When and Then.</p>
</div>
<div class="paragraph">
<p><a href="#shot-237" id="shot-237" title="Highlight line 2" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: Highlight line 2</a>
<code>Given</code> is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</div>
<div class="paragraph">
<p><a href="#shot-238" id="shot-238" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a>
<code>When</code> is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</div>
<div class="paragraph">
<p><a href="#shot-239" id="shot-239" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
<code>Then</code> is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</div>
<div class="paragraph">
<p>You’ll notice we’ve omitted from our outcome anything about Lucy walking into Sean’s store and making a purchase. Remember, Gherkin is supposed to describe the behaviour of the system, so it would be distracting to have it in our scenario.</p>
</div>
<div class="paragraph">
<p>Each scenario has these three ingredients:
<a href="#shot-240" id="shot-240" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a>
  a context,
<a href="#shot-241" id="shot-241" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a>
  an action,
<a href="#shot-242" id="shot-242" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a>
  and one or more outcomes.</p>
</div>
<div class="paragraph">
<p>Together, they describe one single aspect of the behaviour of the system. An example.</p>
</div>
<div class="paragraph">
<p>Now that we’ve translated our example into Gherkin, we can automate it!</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions">2.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_whats_an_advantage_of_using_gherkin_to_express_our_examples_in_bdd_choose_one">What’s an advantage of using  Gherkin to express our examples in BDD? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>We can get Cucumber to test whether the code does what the scenario describes.</p>
</li>
<li>
<p>We can easily automate tests even if we don&#8217;t know much about programming.</p>
</li>
<li>
<p>We can use tools to generate the scenarios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Gherkin is just one way of expressing examples of how you want your system to behave. The advantage of using this particular format is that you can use Cucumber to test them for you, making them into Living Documentation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_these_are_gherkin_keywords_choose_multiple">Which of these are Gherkin keywords? (choose multiple)::</h5>
<div class="ulist">
<ul>
<li>
<p>Scenario</p>
</li>
<li>
<p>Story</p>
</li>
<li>
<p>Given</p>
</li>
<li>
<p>Only</p>
</li>
<li>
<p>If</p>
</li>
<li>
<p>When</p>
</li>
<li>
<p>Before</p>
</li>
<li>
<p>Then</p>
</li>
<li>
<p>While</p>
</li>
<li>
<p>Check</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We’ve introduced four Gherkin keywords so far:
  * <code>Scenario</code> tells Cucumber we’re about to describe an example that it can execute.
  * <code>Given</code>, <code>When</code> and <code>Then</code> identify the steps of the scenario.
There are a few other keywords which will be introduced later in the course.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_gherkin_keywords_given_when_and_then_allow_us_to_express_three_different_components_of_a_scenario_which_of_these_statements_correctly_describes_how_each_of_these_keywords_should_be_used_choose_multiple">The Gherkin keywords Given, When and Then, allow us to express three different components of a scenario. Which of these statements correctly describes how each of these keywords should be used? (Choose multiple)::</h5>
<div class="ulist">
<ul>
<li>
<p>Given describes something that has already happened before the interesting part of the scenario starts. (Correct)</p>
</li>
<li>
<p>Then describes an action you want to take.</p>
</li>
<li>
<p>When explains what should happen at the end of the sceanario.</p>
</li>
<li>
<p>Then explains what should happen at the end of the sceanario. (Correct)</p>
</li>
<li>
<p>When expresses an action that changes the state of the system. (Correct)</p>
</li>
<li>
<p>Given describes the context in which the scenario occurs (Correct)</p>
</li>
<li>
<p>Explanation:</p>
</li>
<li>
<p>Given is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</li>
<li>
<p>When is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</li>
<li>
<p>Then is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
<strong>Given</strong> is the context for the scenario. We’re putting the system into a specific state, ready for the scenario to unfold.</p>
</div>
<div class="paragraph">
<p><strong>When</strong> is an action. Something that happens to the system that will cause something else to happen: an outcome.</p>
</div>
<div class="paragraph">
<p><strong>Then</strong> is the outcome. It’s the behaviour we expect from the system when this action happens in this context.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_our_scenario_not_mention_anything_about_lucy_walking_into_seans_store_and_making_a_purchase">Why did our scenario not mention anything about Lucy walking into Sean’s store and making a purchase?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s a business goal which does not belong in a Gherkin document.</p>
</li>
<li>
<p>As BDD practitioners, we&#8217;re focussed on the behaviour of the system, so we don&#8217;t care about the people who use the software.</p>
</li>
<li>
<p>Including details about these two people would be distracting from the main point of our scenario.</p>
</li>
<li>
<p>Executable scenarios need to stay focussed on the behaviour of the system itself. We can document business goals elsewhere in our Gherkin to provide context. - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Behaviour-Driven Development practitioners definitely do care about business goals, but when we&#8217;re writing the Scenario part of our Gherkin, we need to focus on the observable, testable behaviour of the system we&#8217;re building.</p>
</div>
<div class="paragraph">
<p>Later in the course we&#8217;ll show you how you can use other parts of Gherkin documents to add other relevant details, like business goals, to make great executable specifications.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_cucumber">2.3. Install Cucumber</h3>
<div class="paragraph">
<p><a href="#shot-243" id="shot-243" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
Before we get started make sure you have a modern version of NodeJs,
<a href="#shot-244" id="shot-244" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a>
and NPM installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>node <span class="nt">-v</span>
<span class="nv">$ </span>npm <span class="nt">-v</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see an error message when you run these commands, you’ll need to fix your Node installation.</p>
</div>
<div class="paragraph">
<p><a href="#shot-245" id="shot-245" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a>
Go back to the command prompt and create a new directory for our project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>shouty</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-246" id="shot-246" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
Go use cd to go into that directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>shouty</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-247" id="shot-247" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a>
First we’ll create a <code>package.json</code> that describes the NPM packages we need for our project
<a href="#shot-248" id="shot-248" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a>
and add the <code>cucumber</code> package to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm init <span class="nt">-y</span>
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-D</span> cucumber</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-249" id="shot-249" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a>
We&#8217;ll  also add <code>cucumber-pretty</code>, which will prettify our output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ npm install -D cucumber-pretty</pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-250" id="shot-250" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a>
We can now run  the <code>cucumber-js -f node_modules/cucumber-pretty</code> command to see if everything works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>./node_modules/.bin/cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this is not very user friendly. There&#8217;s a nicer way to run cucumber.</p>
</div>
<div class="paragraph">
<p><a href="#shot-251" id="shot-251" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a>
Edit <code>package.json</code> and change the <code>test</code> line under the <code>scripts</code> from it&#8217;s default to <code>cucumber-js</code> <a href="#shot-252" id="shot-252" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cucumber-js -f node_modules/cucumber-pretty</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-253" id="shot-253" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a>
Now we’re ready! If we run <code>npm test</code> at this point, we’ll see cucumber pass with no scenarios or steps to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty-js@1.0.0 <span class="nb">test</span> /home/fedex/cucumber/shouty-js
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

0 scenarios
0 steps
0m00.000s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we&#8217;re going to install <code>hamjest</code> in order to have more expressive assertions <a href="#shot-254" id="shot-254" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-D</span> hamjest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Good, we&#8217;ve installed Cucumber. Now we need to write our specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_scenario_wire_it_up">2.4. Add a scenario, wire it up</h3>
<div class="paragraph">
<p><a href="#shot-255" id="shot-255" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
We need to create a <code>features</code> directory. This is the conventional place to store your Gherkin specifications.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>features</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-256" id="shot-256" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a>
Now we’re ready to create our first feature file. Call the file <code>hear_shout.feature</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">touch </span>features/hear_shout.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-257" id="shot-257" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a>
All feature files start with the keyword <code>Feature:</code>
<a href="#shot-258" id="shot-258" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
followed by a name.
It’s a good convention to give it a name that matches the file name.</p>
</div>
<div class="paragraph">
<p>Now let’s write out our first scenario.</p>
</div>
<div class="paragraph">
<p>This is the one where the listener is within range, <a href="#shot-259" id="shot-259" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a> Lucy is located 15 metres from Sean, <a href="#shot-260" id="shot-260" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a> Sean shouts "free bagels at Sean&#8217;s", <a href="#shot-261" id="shot-261" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a> Lucy hears Sean&#8217;s message. <a href="#shot-262" id="shot-262" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean’s message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-263" id="shot-263" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a>
Save the file, switch back to the command-prompt and run <code>npm test</code>. You’ll see Cucumber has found our feature file and read it back to us. We can see a summary of the results at the bottom: one scenario,<a href="#shot-264" id="shot-264" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10</a> three steps - all undefined.<a href="#shot-265" id="shot-265" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    ? undefined
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    ? undefined
    Then Lucy hears Sean’s message
    ? undefined

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15 metres from Sean
       Undefined. Implement with the following snippet:

         Given<span class="o">(</span><span class="s1">'Lucy is located {int} metres from Sean'</span>, <span class="k">function</span> <span class="o">(</span>int<span class="o">)</span> <span class="o">{</span>
         // Given<span class="o">(</span><span class="s1">'Lucy is located {float} metres from Sean'</span>, <span class="k">function</span> <span class="o">(</span>float<span class="o">)</span> <span class="o">{</span>
           // Write code here that turns the phrase above into concrete actions
           <span class="k">return</span> <span class="s1">'pending'</span><span class="p">;</span>
         <span class="o">})</span><span class="p">;</span>

   ? When Sean shouts <span class="s2">"free bagels at Sean's"</span>
       Undefined. Implement with the following snippet:

         When<span class="o">(</span><span class="s1">'Sean shouts {string}'</span>, <span class="k">function</span> <span class="o">(</span>string<span class="o">)</span> <span class="o">{</span>
           // Write code here that turns the phrase above into concrete actions
           <span class="k">return</span> <span class="s1">'pending'</span><span class="p">;</span>
         <span class="o">})</span><span class="p">;</span>

   ? Then Lucy hears Sean’s message
       Undefined. Implement with the following snippet:

         Then<span class="o">(</span><span class="s1">'Lucy hears Sean’s message'</span>, <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>
           // Write code here that turns the phrase above into concrete actions
           <span class="k">return</span> <span class="s1">'pending'</span><span class="p">;</span>
         <span class="o">})</span><span class="p">;</span>


1 scenario <span class="o">(</span>1 undefined<span class="o">)</span>
3 steps <span class="o">(</span>3 undefined<span class="o">)</span>
0m00.000s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Undefined</em>` means Cucumber doesn’t know what to do for any of the three steps we wrote in our Gherkin scenario. It needs us to provide some <em>step definitions</em>.</p>
</div>
<div class="paragraph">
<p><a href="#shot-266" id="shot-266" title="02.04.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11.1: 02.04.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>Step definitions translate from the plain language you use in Gherkin into JavaScript code.</p>
</div>
<div class="paragraph">
<p>When Cucumber runs a step, it looks for a step definition that matches the text in the step. If it finds one, then it executes the code in the step definition.</p>
</div>
<div class="paragraph">
<p>If it doesn’t find one… well, you’ve just seen what happens. Cucumber helpfully prints out some code snippets that we can use as a basis for new step definitions.</p>
</div>
<div class="paragraph">
<p>Let’s copy those to create our first step definitions.</p>
</div>
<div class="paragraph">
<p><a href="#shot-267" id="shot-267" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a><a href="#shot-268" id="shot-268" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13</a>
We’ll paste them into a JavaScript file under a new directory called <code>step_definitions</code> underneath the <code>features</code> directory. I’ll just call it <code>steps.js</code>.</p>
</div>
<div class="paragraph">
<p>We need to import the <code>Given</code>, <a href="#shot-269" id="shot-269" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13</a> <code>When</code> <a href="#shot-270" id="shot-270" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 14</a> and <code>Then</code> <a href="#shot-271" id="shot-271" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 15</a> keywords from the <code>cucumber</code> package.<a href="#shot-272" id="shot-272" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 16</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean’s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-273" id="shot-273" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 17</a>
Now we run Cucumber again.</p>
</div>
<div class="paragraph">
<p>This time the output is a little different. We now have a pending step <a href="#shot-274" id="shot-274" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 18</a> and two skipped ones.<a href="#shot-275" id="shot-275" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 19</a> This means Cucumber found all our step definitions, and executed the first one.</p>
</div>
<div class="paragraph">
<p><a href="#shot-276" id="shot-276" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 20</a>
But that first step definition returns <code>'pending'</code>, which causes Cucumber to stop, skip the rest of the steps, and mark the scenario as pending.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty-js@1.0.0 <span class="nb">test</span> /home/fedex/cucumber/shouty-js
<span class="o">&gt;</span> cucumber-js

P--

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15m from Sean <span class="c"># features/step_definitions/steps.js:5</span>
       Pending
   - When Sean shouts “free bagels at Sean’s” <span class="c"># features/step_definitions/steps.js:10</span>
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:15</span>

1 scenario <span class="o">(</span>1 pending<span class="o">)</span>
3 steps <span class="o">(</span>1 pending, 2 skipped<span class="o">)</span>
0m00.000s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve wired up our step definitions to the Gherkin steps, it&#8217;s almost time to start working on our solution. First though, let&#8217;s tidy up the generated code.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll rename the <code>int</code> parameter to something that better reflects its meaning. Let&#8217;s call it <code>distance</code>.<a href="#shot-277" id="shot-277" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 21</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-278" id="shot-278" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 22</a>
And we can print it to the terminal to see the captured result</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">distance</span><span class="p">);</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">;</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-279" id="shot-279" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 23</a>
If we run <code>cucumber</code> again on our terminal, we can see the number 15 pop up in the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15m from Sean
15
    ? pending
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    - skipped
    Then Lucy hears Sean’s message
    - skipped

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ? Given Lucy is located 15m from Sean <span class="c"># features/step_definitions/steps.js:3</span>
       Pending
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:8</span>
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:13</span>

1 scenario <span class="o">(</span>1 pending<span class="o">)</span>
3 steps <span class="o">(</span>1 pending, 2 skipped<span class="o">)</span>
0m00.002s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the number 15 does not appear anywhere in our code. The value is automatically passed from the Gherkin step to the step definition. If you&#8217;re curious, that’s the <a href="#shot-280" id="shot-280" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 24</a><code>{int}</code> in the step definition pattern or <em>cucumber expression</em>. We’ll explain these patterns in detail in a future lesson.</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions">2.4.1. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_what_do_step_definitions_do_choose_one">What do step definitions do? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>Provide a glossary of domain terms for your stakeholders</p>
</li>
<li>
<p>Give Cucumber/SpecFlow a way to automate your gherkin steps - TRUE</p>
</li>
<li>
<p>Add extra meaning to our Gherkin steps</p>
</li>
<li>
<p>Generate code from gherkin documents</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
&lt;java&gt;
Step definitions are Java methods that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the method to run it.
&lt;/java&gt;</p>
</div>
<div class="paragraph">
<p>&lt;js&gt;
Step definitions are JavaScript functions that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the function.
&lt;/js&gt;</p>
</div>
<div class="paragraph">
<p>&lt;ruby&gt;
Step definitions are Ruby blocks that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, Cucumber will search for a step definition that matches. If there&#8217;s a matching step definition, it will execute the code in the block.
&lt;/ruby&gt;</p>
</div>
<div class="paragraph">
<p>&lt;C#&gt;
Step definitions are C# methods that actually do what&#8217;s described in each step of a Gherkin scenario.</p>
</div>
<div class="paragraph">
<p>When it tries to run each step of a scenario, SpecFlow will search for a step definition that matches. If there&#8217;s a matching step definition, it will call the method to run it.
&lt;/C#&gt;</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_it_mean_when_cucumberspecflow_says_a_step_is_pending_choose_one">What does it mean when Cucumber/SpecFlow says a step is Pending? (choose one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>The step took too long to execute and was terminated
&lt;java&gt; * The step threw a <code>PendingException</code>, meaning we&#8217;re still working on implementing that step.&lt;/java&gt;
&lt;js&gt; * The step returned pending, meaning we&#8217;re still working on implementing that step.&lt;/js&gt;
&lt;ruby&gt; * The step definition threw a Pending error, meaning we&#8217;re still working on implementing that step.&lt;/ruby&gt;
&lt;C#&gt; ASK GASPAR &lt;/C#&gt;</p>
</li>
<li>
<p>Cucumber/SpecFlow was unable to find the step definitions</p>
</li>
<li>
<p>The scenario is passing</p>
</li>
<li>
<p>The scenario is failing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:</p>
</div>
<div class="paragraph">
<p>&lt;java&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a PendingException.</p>
</div>
<div class="paragraph">
<p>The PendingException is a special type of exception provided by Cucumber to allow the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that aren&#8217;t finished yet and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/java&gt;</p>
</div>
<div class="paragraph">
<p>&lt;js&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a Pending error.</p>
</div>
<div class="paragraph">
<p>This allows the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that are still being worked on and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/js&gt;</p>
</div>
<div class="paragraph">
<p>&lt;ruby&gt;
Cucumber tells us that a step (and by inference the Scenario that contains it) is Pending when the automation code throws a Pending error.</p>
</div>
<div class="paragraph">
<p>This allows the development team to signal that automation for a step is a work in progress. This makes it possible to tell the difference between steps that are still being worked on and steps that are failing due to a defect in the system.</p>
</div>
<div class="paragraph">
<p>For example, when we run our tests in a Continuous Integration (CI) environment, we can choose to ignore pending scenarios.
&lt;/ruby&gt;</p>
</div>
<div class="paragraph">
<p>&lt;C#&gt; ASK GASPAR &lt;/C#&gt;</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_might_you_want_to_consider_when_using_a_snippet_generated_by_cucumberspecflow">Which of the following might you want to consider when using a snippet generated by Cucumber/SpecFlow?</h5>
<div class="ulist">
<ul>
<li>
<p>Does the name of the method correctly describe the intent of the step? - TRUE</p>
</li>
<li>
<p>Do the parameter names correctly describe the meaning of the arguments? - TRUE</p>
</li>
<li>
<p>Does the snippet correctly automate the gherkin step as described? - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When Cucumber/SpecFlow generates a snippet, it has no idea of the business context of the undefined step. The implementation that Cucumber/SpecFlow generates will definitely not automate what&#8217;s been written in your Gherkin - that&#8217;s up to you! Also, the name of the method and the parameters are just placeholders. It&#8217;s the job of the person writing the code to rename the method and parameters to reflect the business domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="_whats_the_next_step_in_bdd_after_weve_pasted_in_the_step_definition_snippet_and_seen_it_fail_with_a_pending_status">What’s the next step in BDD after we’ve pasted in the step definition snippet and seen it fail with a <code>pending</code> status?</h5>
<div class="ulist">
<ul>
<li>
<p>Check with our project manager about the requirement</p>
</li>
<li>
<p>Implement some code that does what the Gherkin step describes - TRUE</p>
</li>
<li>
<p>Create a test framework for modelling our application</p>
</li>
<li>
<p>Run a manual test to check what the system does</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
If you read the comment in the generated snippet, Cucumber/SpecFlow is telling you to "turn the phrase above into concrete actions".</p>
</div>
<div class="paragraph">
<p>You need your step definition to call your application and do whatever the Gherkin step describes. In the case of our first step here, we want to tell the system that there are two people in certain locations.</p>
</div>
<div class="paragraph">
<p>We can use the act of fleshing out the body of our step definition as an opportunity to do some software design. We can think about what we want the interface to our system to look like, from the point of view of someone who needs to interact with it. Should we interact with it through the User Interface, or make a call to the programmer API directly? How would we like that interface to work?</p>
</div>
<div class="paragraph">
<p>We can do all of this without writing any implementation yet.</p>
</div>
<div class="paragraph">
<p>This is known as "outside-in" development. It helps us to ensure that when we do come to implementing our solution, we&#8217;re implementing it based on real needs.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sketch_out_the_solution">2.5. Sketch out the solution</h3>
<div class="paragraph">
<p><a href="#shot-281" id="shot-281" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
Now that we have the step definitions matching, we can start working on our solution. We like to use our scenarios to <em>guide</em> our development, so we&#8217;ll start designing the objects we&#8217;ll need by sketching out some code in our step definitions.</p>
</div>
<div class="paragraph">
<p>The scenario will be failing while we do this, but we should see the error messages gradually progressing as we drive out the interface to our object model.</p>
</div>
<div class="paragraph">
<p>Our next goal is for the scenario to fail because we need to implement the actual business logic. <em>Then</em> we can work on changing the business logic inside our objects to make it pass.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean’s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To implement the first step, we need to create a couple of <code>Person</code> objects,<a href="#shot-282" id="shot-282" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a> with the specified distance between them. <a href="#shot-283" id="shot-283" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a> We can remove the <code>pending</code> status now,<a href="#shot-284" id="shot-284" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a> and this <code>console.log</code> statement,<a href="#shot-285" id="shot-285" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a> and write the implementation for the first step like this:</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have two instances of person, one representing Lucy, <a href="#shot-286" id="shot-286" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a>and one representing Sean. <a href="#shot-287" id="shot-287" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a>Then we call a method to move Lucy to the position specified in the scenario.<a href="#shot-288" id="shot-288" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-289" id="shot-289" title="02.05.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8.1: 02.05.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>To keep things simple, we&#8217;re going to assume all people are situated on a line: a one-dimensional co-ordinate system. We can always introduce proper geo-locations later. We&#8217;ll place Sean in the centre, and Lucy 15 metres away from Sean.</p>
</div>
<div class="paragraph">
<p>This might not be the design we&#8217;ll end up with once this is all working, but it&#8217;s a decent place to start.</p>
</div>
<div class="paragraph">
<p><a href="#shot-290" id="shot-290" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a>
If we run Cucumber, we’ll see a compilation error from JavaScript: we need to define our <code>Person</code> class.<a href="#shot-291" id="shot-291" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty-js@1.0.0 <span class="nb">test</span> /home/fedex/cucumber/shouty-js
<span class="o">&gt;</span> cucumber-js

F--

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✖ Given Lucy is located 15m from Sean <span class="c"># features/step_definitions/steps.js:17</span>
       ReferenceError: Person is not defined
           at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/cucumber/shouty-js/features/step_definitions/steps.js:18:19<span class="o">)</span>
   - When Sean shouts “free bagels at Sean’s” <span class="c"># features/step_definitions/steps.js:23</span>
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:28</span>

1 scenario <span class="o">(</span>1 failed<span class="o">)</span>
3 steps <span class="o">(</span>1 failed, 2 skipped<span class="o">)</span>
0m00.001s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-292" id="shot-292" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a>
Let’s give our solution a home by creating a <code>src</code> directory.
<a href="#shot-293" id="shot-293" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a>
We’ll put our Shouty application in a JavaScript file called <code>shouty.js</code> in that directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>src
<span class="nv">$ </span><span class="nb">touch </span>src/shouty.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can  create an empty <code>Person</code> class, <a href="#shot-294" id="shot-294" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13</a> and export it.<a href="#shot-295" id="shot-295" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 14</a></p>
</div>
<div class="listingblock">
<div class="title">src/shouty.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>

<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-296" id="shot-296" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 15</a>
For now, we’ll just require the <code>Person</code> class from our <code>steps.js</code> file. In a later lesson we’ll talk more about how to organise this code a bit better.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty.js</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int}m from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-297" id="shot-297" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 16</a>
When we run the scenario, cucumber tells us that we&#8217;re missing the <code>moveTo</code> method on the <code>Person</code> class.<a href="#shot-298" id="shot-298" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 17</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    ✖ failed
      TypeError: this.lucy.moveTo is not a <span class="k">function
          </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:7:13<span class="o">)</span>
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    - skipped
    Then Lucy hears Sean’s message
    - skipped

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✖ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
       TypeError: this.lucy.moveTo is not a <span class="k">function
           </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:7:13<span class="o">)</span>
   - When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:15</span>

1 scenario <span class="o">(</span>1 failed<span class="o">)</span>
3 steps <span class="o">(</span>1 failed, 2 skipped<span class="o">)</span>
0m00.000s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-299" id="shot-299" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 18</a>
We&#8217;ll add the method definition without implementing it yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the scenario again,<a href="#shot-300" id="shot-300" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 19</a> the first step is green!<a href="#shot-301" id="shot-301" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 20</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    ? pending
    Then Lucy hears Sean’s message
    - skipped

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ? When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
       Pending
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:15</span>

1 scenario <span class="o">(</span>1 pending<span class="o">)</span>
3 steps <span class="o">(</span>1 pending, 1 skipped, 1 passed<span class="o">)</span>
0m00.001s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re making progress!</p>
</div>
<div class="paragraph">
<p>We&#8217;ll keep working like this until we see the scenario failing for the right reasons.</p>
</div>
<div class="paragraph">
<p>In the second step definition, we want to tell Sean to shout something.</p>
</div>
<div class="paragraph">
<p><a href="#shot-302" id="shot-302" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 21</a>
In order to send instructions to Sean, we need to store him in an property, which we already have, so that he’ll be accessible from all of our step definitions.</p>
</div>
<div class="paragraph">
<p><a href="#shot-303" id="shot-303" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 22</a>
In the <code>When</code> step, we&#8217;re capturing Sean&#8217;s message using the <code>{string}</code> pattern, and pass an argument to the function. We&#8217;ll call it <code>message</code>.<a href="#shot-304" id="shot-304" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 23</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-305" id="shot-305" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 24</a>
And now we can now tell him to <em>shout</em> the message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-306" id="shot-306" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 25</a>
If we run Cucumber, it&#8217;s telling is that our <code>Person</code> class needs a <code>shout</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    ✖ failed
      TypeError: this.sean.shout is not a <span class="k">function
          </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:11:13<span class="o">)</span>
    Then Lucy hears Sean’s message
    - skipped

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ✖ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
       TypeError: this.sean.shout is not a <span class="k">function
           </span>at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:11:13<span class="o">)</span>
   - Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:14</span>

1 scenario <span class="o">(</span>1 failed<span class="o">)</span>
3 steps <span class="o">(</span>1 failed, 1 skipped, 1 passed<span class="o">)</span>
0m00.000s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-307" id="shot-307" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 26</a>
Let’s not worry about the implementation yet. The most important thing right now is to discover the shape of our domain model.</p>
</div>
<div class="listingblock">
<div class="title">shouty.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And now the second step is green: <a href="#shot-308" id="shot-308" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 27</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    Then Lucy hears Sean’s message
    ? pending

Warnings:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:4</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:10</span>
   ? Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:14</span>
       Pending

1 scenario <span class="o">(</span>1 pending<span class="o">)</span>
3 steps <span class="o">(</span>1 pending, 2 passed<span class="o">)</span>
0m00.000s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-309" id="shot-309" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 28</a>
The last step definition is where we implement a check, or assertion. We’ll verify that what Lucy has heard is exactly the same as what Sean shouted.</p>
</div>
<div class="paragraph">
<p><a href="#shot-310" id="shot-310" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 29</a>
Once again we’re are going to write the code we wish we had.</p>
</div>
<div class="paragraph">
<p>But before, we need to import <code>assertThat</code> <a href="#shot-311" id="shot-311" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 30</a> and <code>is</code> <a href="#shot-312" id="shot-312" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 31</a> from `hamjest`<a href="#shot-313" id="shot-313" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 32</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// ...</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears Sean’s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">]))</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we need a way to ask Lucy what messages she’s heard, and we also need to know what it was that Sean shouted.</p>
</div>
<div class="paragraph">
<p><a href="#shot-314" id="shot-314" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 33</a>
We can record what Sean shouts by storing it in the <code>this.message</code> property as the <code>When</code> step runs. This is a common pattern to use in Cucumber step definitions when you don’t want to repeat the same test data in different parts of a scenario. Now we can use that in the assertion check.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-315" id="shot-315" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 34</a>
We also need to add a <code>messagesHeard</code> method to our Person class. Let’s do that now, we&#8217;ll just return an empty array for now <a href="#shot-316" id="shot-316" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 35</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">moveTo</span><span class="p">()</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-317" id="shot-317" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 36</a>
&#8230;&#8203;and watch Cucumber run the tests again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    Then Lucy hears Sean’s message
    ✖ failed
      AssertionError:
      Expected: is <span class="o">[</span><span class="s2">"free bagels at Sean's"</span><span class="o">]</span>
           but: was <span class="o">[]</span>
          + expected - actual

          -[]
          +[
          +  <span class="s2">"free bagels at Sean's"</span>
          +]

          at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:17:3<span class="o">)</span>

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:5</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:11</span>
   ✖ Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:16</span>
       AssertionError:
       Expected: is <span class="o">[</span><span class="s2">"free bagels at Sean's"</span><span class="o">]</span>
            but: was <span class="o">[]</span>
           + expected - actual

           -[]
           +[
           +  <span class="s2">"free bagels at Sean's"</span>
           +]

           at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:17:3<span class="o">)</span>

1 scenario <span class="o">(</span>1 failed<span class="o">)</span>
3 steps <span class="o">(</span>1 failed, 2 passed<span class="o">)</span>
0m00.003s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is great! Whenever we do BDD, getting to our first failing test is a milestone. Seeing the test fail proves that it is capable of detecting errors in our code!</p>
</div>
<div class="paragraph">
<p>Never trust an automated test that you haven’t seen fail!</p>
</div>
<div class="paragraph">
<p>Now all we have to do is write the code to make it do what it&#8217;s supposed to.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions">2.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_how_does_the_practice_writing_a_failing_test_before_implementing_the_solution_help_us">How does the practice writing a failing test before implementing the solution help us?</h5>
<div class="ulist">
<ul>
<li>
<p>Until you see a scenario fail, you can’t be sure that it can ever fail [true]</p>
</li>
<li>
<p>There’s no need to always see a scenario fail [false]</p>
</li>
<li>
<p>BDD practitioners use failing scenarios to guide their development [true]</p>
</li>
<li>
<p>A passing scenario implies the functionality it describes has already been implemented, so it may be a duplicate of an existing scenario [true]</p>
</li>
<li>
<p>BDD practitioners believe in learning from failure [false]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Behaviour-Driven Development comes from Test-Driven Development, where we always start with a failing test, then use that to guide our development. This sometimes described as red-green-refactor.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>red - write a scenario/test and see it fail
green - make it pass (as simply as possible)
refactor - improve your code, while keeping all the tests/scenarios green</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s surprisingly easy to write scenarios and step definitions that don&#8217;t do anything. It&#8217;s the transition from red to green that gives us confidence that the scenario and the implementation actually do what we expect.</p>
</div>
<div class="paragraph">
<p>If a scenario passes as soon as we write it, that means that either it&#8217;s not doing what we think it should or the behaviour that it describes has already been implemented. In that case, we&#8217;re not developing using behaviour-driven development.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_did_we_change_to_use_an_instance_variable_for_storing_each_person_select_one">Why did we change to use an instance variable for storing each Person? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>It ensures we can interact with the same object from different steps. [true]</p>
</li>
<li>
<p>It’s a better way to organise the code</p>
</li>
<li>
<p>It’s more efficient for performance</p>
</li>
<li>
<p>Cucumber/SpecFlow requires us to store our objects as instance variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
In Cucumber/SpecFlow, one of the ways to access the same instance of an object from different step definition methods, is to store it on an instance variable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_did_we_avoid_having_to_mention_the_detail_of_the_text_sean_had_shouted_in_our_when_and_then_steps_select_one">How did we avoid having to mention the detail of the text Sean had shouted in our When and Then steps? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>We duplicated the text inside our Person class</p>
</li>
<li>
<p>We used an instance variable to store the text that was shouted [true]</p>
</li>
<li>
<p>We called a method on the Person class to retrieve the messages heard</p>
</li>
<li>
<p>We passed the message text in from our Gherkin scenarios</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When you need to assert for a specific value coming out of your system in a Then step, you can use an instance variable to store it where it goes into the system (in a Given or When) step. This means you can avoid duplicating the value in multiple places in your code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_flow_should_we_follow_when_making_a_scenario_pass_select_one">Which flow should we follow when making a Scenario pass? (select one) ::</h5>
<div class="ulist">
<ul>
<li>
<p>Domain modelling &#8594; Write some code &#8594; Make it compile &#8594; Run the scenario &amp; watch it fail</p>
</li>
<li>
<p>Write some code &#8594; Domain modelling &#8594; Make it compile &#8594; Run the scenario</p>
</li>
<li>
<p>Write some code &#8594; Make it compile &#8594; Domain modelling &#8594; Run the scenario - TRUE</p>
</li>
<li>
<p>Domain modelling &#8594; Run the scenario &#8594; Write some code &#8594; Make it compile</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Our goal at this stage is to get to a failing test, where the only thing left to do to make it pass is make changes to the implementation of the app itself.</p>
</div>
<div class="paragraph">
<p>On an existing system, we might not need to create so much new code to get to this goal, but we might need to make some changes to how we call the system. This gives us an opportunity to do some lightweight domain modelling.</p>
</div>
<div class="paragraph">
<p>It may not compile first-time, so we implement the bare-bones of our solution until it does.</p>
</div>
<div class="paragraph">
<p>We use the scenarios to guide us in our implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_make_the_scenario_pass">2.6. Make the scenario pass</h3>
<div class="paragraph">
<p>So we have our failing scenario: <a href="#shot-318" id="shot-318" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    Then Lucy hears Sean’s message
    ✖ failed
      AssertionError:
      Expected: is <span class="o">[</span><span class="s2">"free bagels at Sean's"</span><span class="o">]</span>
           but: was <span class="o">[]</span>
          + expected - actual

          -[]
          +[
          +  <span class="s2">"free bagels at Sean's"</span>
          +]

          at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:17:3<span class="o">)</span>

Failures:

1<span class="o">)</span> Scenario: Listener is within range <span class="c"># features/hear_shout.feature:2</span>
   ✔ Given Lucy is located 15 metres from Sean <span class="c"># features/step_definitions/steps.js:5</span>
   ✔ When Sean shouts <span class="s2">"free bagels at Sean's"</span> <span class="c"># features/step_definitions/steps.js:11</span>
   ✖ Then Lucy hears Sean’s message <span class="c"># features/step_definitions/steps.js:16</span>
       AssertionError:
       Expected: is <span class="o">[</span><span class="s2">"free bagels at Sean's"</span><span class="o">]</span>
            but: was <span class="o">[]</span>
           + expected - actual

           -[]
           +[
           +  <span class="s2">"free bagels at Sean's"</span>
           +]

           at World.&lt;anonymous&gt; <span class="o">(</span>/home/fedex/code/shouty/features/step_definitions/steps.js:17:3<span class="o">)</span>

1 scenario <span class="o">(</span>1 failed<span class="o">)</span>
3 steps <span class="o">(</span>1 failed, 2 passed<span class="o">)</span>
0m00.003s
npm ERR! Test failed.  See above <span class="k">for </span>more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lucy is expected to hear Sean&#8217;s message, but she hasn&#8217;t heard anything: we got an empty Array back from the <code>messagesHeard</code> method.</p>
</div>
<div class="paragraph">
<p><a href="#shot-319" id="shot-319" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a>
In this case, we’re going to cheat. We have a one-line fix that will make this scenario pass, but it’s not a particularly future-proof implementation. Can you guess what it is?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">move_to</span><span class="p">()</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I told you it wasn’t very future proof!</p>
</div>
<div class="paragraph">
<p><a href="#shot-320" id="shot-320" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    Then Lucy hears Sean’s message

1 scenario <span class="o">(</span>1 passed<span class="o">)</span>
3 steps <span class="o">(</span>3 passed<span class="o">)</span>
0m00.001s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Woohoo! Our scenario is passing for the first time. As long as this is the only message anyone ever shouts, we&#8217;re good to ship this thing!</p>
</div>
<div class="paragraph">
<p>Now, the fact that such a poor implementation can pass our tests shows us that we need to work on our tests. A more comprehensive set of scenarios would force us to write a better implementation.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also a good habit to look for the most simple solution. We can trust that, as our scenarios evolve, so will our solution.</p>
</div>
<div class="paragraph">
<p>This is the essence of Behaviour-Driven Development. Examples of behaviour drive the development. We do just enough to make the next scenario pass, and no more.</p>
</div>
<div class="paragraph">
<p><a href="#shot-321" id="shot-321" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
Instead of writing a note on our TODO list, let&#8217;s write another scenario that shouts a different message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15m from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean’s message

  <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
    <span class="nf">Given </span>Lucy is 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-322" id="shot-322" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a>
It fails, reminding us we need to find a solution that doesn&#8217;t rely on hard-coding the message.
Now when we come back to this code, we can just run the tests and Cucumber will remind us what we need to do next. We’re done for today!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">test</span>

<span class="o">&gt;</span> shouty@1.0.0 <span class="nb">test</span> /home/fedex/code/shouty
<span class="o">&gt;</span> cucumber-js <span class="nt">-f</span> node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 15 metres from Sean
    When Sean shouts <span class="s2">"free bagels at Sean's"</span>
    Then Lucy hears Sean’s message

  Scenario: Listener hears a different message
    Given Lucy is 15 metres from Sean
    ? undefined
    When Sean shouts <span class="s2">"Free coffee!"</span>
    - skipped
    Then Lucy hears Sean<span class="s1">'s message
    ? undefined

Warnings:

1) Scenario: Listener hears a different message # features/hear_shout.feature:7
   ? Given Lucy is 15 metres from Sean
       Undefined. Implement with the following snippet:

         Given('</span>Lucy is <span class="o">{</span>int<span class="o">}</span> metres from Sean<span class="s1">', function (int) {
         // Given('</span>Lucy is <span class="o">{</span>float<span class="o">}</span> metres from Sean<span class="s1">', function (float) {
           // Write code here that turns the phrase above into concrete actions
           return '</span>pending<span class="s1">';
         });

   - When Sean shouts "Free coffee!" # features/step_definitions/steps.js:11
   ? Then Lucy hears Sean'</span>s message
       Undefined. Implement with the following snippet:

         Then<span class="o">(</span><span class="s1">'Lucy hears Sean\'</span>s message<span class="s1">', function () {
           // Write code here that turns the phrase above into concrete actions
           return '</span>pending<span class="s1">';
         });


2 scenarios (1 undefined, 1 passed)
6 steps (2 undefined, 1 skipped, 3 passed)
0m00.001s
npm ERR! Test failed.  See above for more details.</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_questions">2.6.1. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>Why should we always make sure that we see a scenario fail before we make it pass? (select multiple) </em></p>
<div class="ulist">
<ul>
<li>
<p>Until you see a scenario fail, you can’t be sure that it can ever fail [true]</p>
</li>
<li>
<p>There’s no need to always see a scenario fail [false]</p>
</li>
<li>
<p>BDD practitioners use failing scenarios to drive their development [true]</p>
</li>
<li>
<p>A passing scenario implies the functionality it describes has already been implemented, so it may be a duplicate of an existing scenario [true]</p>
</li>
<li>
<p>BDD practitioners believe in learning from failure [false]</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Why did we change to use an instance variable for storing each Person? </em></p>
<div class="ulist">
<ul>
<li>
<p>It ensures we can interact with the same object from different steps. [true]</p>
</li>
<li>
<p>It’s a better way to organise the code</p>
</li>
<li>
<p>It’s more efficient for performance</p>
</li>
<li>
<p>Cucumber requires us to store our objects as instance variables.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>How did we avoid having to mention the detail of the text Sean had shouted in our When and Then steps? </em></p>
<div class="ulist">
<ul>
<li>
<p>We duplicated the text inside our Person class</p>
</li>
<li>
<p>We used an instance variable to store the text that was shouted [true]</p>
</li>
<li>
<p>We called a method on the Person class to retrieve the messages heard</p>
</li>
<li>
<p>We passed the message text in from our Gherkin scenarios</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Which flow should we follow when making a Scenario pass? </em></p>
<div class="ulist">
<ul>
<li>
<p>Domain modelling &#8594; Write some code &#8594; Make it compile &#8594; Run the scenario &amp; watch it fail</p>
</li>
<li>
<p>Write some code &#8594; Domain modelling &#8594; Make it compile &#8594; Run the scenario</p>
</li>
<li>
<p>Write some code &#8594; Make it compile &#8594; Domain modelling &#8594; Run the scenario</p>
</li>
<li>
<p>Domain modelling &#8594; Run the scenario &#8594; Write some code &#8594; Make it compile</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Why is our naive implementation of Person.getMessagesHeard, with a hard-coded message OK in BDD? (select multiple) </em></p>
<div class="ulist">
<ul>
<li>
<p>It shows us that we need better examples to pin down the behaviour we really want from the code. [correct]</p>
</li>
<li>
<p>We know we will iterate on our solution, when we come up with more examples of what we want it to do. [correct]</p>
</li>
<li>
<p>Nobody is using our solution yet [incorrect]</p>
</li>
<li>
<p>We have to do a bad implementation so we can see our test fail. [incorrect]</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Look at this diagram (1) Write a scenario, 2) Automate it and watch it fail, 3) Write just enough code to make it pass). Which stage are we at as the video ends? </em></p>
<div class="ulist">
<ul>
<li>
<p>1</p>
</li>
<li>
<p>2</p>
</li>
<li>
<p>3</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressing_yourself">3. Expressing yourself</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cucumber_expressions_not_regular_expressions">3.1. Cucumber expressions not regular expressions</h3>
<div class="paragraph">
<p><a href="#shot-323" id="shot-323" title="03.01.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 0.1: 03.01.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>In the previous chapter we explored the fundamental components of a Cucumber test suite, and how we use Cucumber to drive out a solution, test-first.</p>
</div>
<div class="paragraph">
<p>First we specified the behaviour we wanted, using a Gherkin scenario in a feature file. Then we wrote step definitions to translate the plain english from our scenario into concrete actions in code. Finally, we used the step definitions to guide us in building out our very basic domain model for the Shouty application.</p>
</div>
<div class="paragraph">
<p>We tend to think of the code that actually pokes around with the system as distinct from the step definitions, so we’ve drawn an extra box labelled "automation code" for this.</p>
</div>
<div class="paragraph">
<p>Automation code can do almost anything to your application: it can drive a web browser around your site, make HTTP requests to a REST API, or&#8201;&#8212;&#8201;as you’ve already seen&#8201;&#8212;&#8201;drive a domain model directly.</p>
</div>
<div class="paragraph">
<p>Automation code is a big topic that we’ll come back to. First, we want to concentrate on step definitions.
Good step definitions are important because they enable the <em>readability</em> of your scenarios. The better you are at matching plain language phrases from Gherkin, the more expressive you can be when writing scenarios. Teams who do this well refer to their features as <em>living documentation</em> - a specification document that never goes out of date.</p>
</div>
<div class="paragraph">
<p>When Cucumber first started, we used to use <em>regular expressions</em> to match plain language phrases from Gherkin steps.</p>
</div>
<div class="paragraph">
<p>Regular expressions have quite an intimidating reputation.</p>
</div>
<div class="paragraph">
<p>So we replaced them with something simpler, something we call <em>Cucumber expressions</em>. Cucumber is backwards compatible so you can still use the power of regular expressions if that&#8217;s your thing.</p>
</div>
<div class="paragraph">
<p>This chapter is all about Cucumber Expressions.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions">3.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Step definitions translate human-readable scenarios into concrete actions in code - TRUE</p>
</li>
<li>
<p>BDD practitioners think of "step definitions" and "automation code" as distinct concepts - TRUE</p>
</li>
<li>
<p>Cucumber only supports automation through the user interface - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: A step definition is a piece of code that is called by Cucumber in response to a step in a scenario. You can write any code you like inside a step definition, but we&#8217;ve found it easier to maintain if we keep them short. This leads to step definitions calling dedicated automation code to perform concrete actions against the system under construction. That automation code can manipulate the user interface, make a REST call, or drive the domain model directly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_are_true_2">Which of the following statements are true?</h5>
<div class="ulist">
<ul>
<li>
<p>Regular Expressions are exactly the same as Cucumber Expressions - FALSE</p>
</li>
<li>
<p>Modern versions of Cucumber only support both Cucumber Expressions and Rregular Expressions - TRUE</p>
</li>
<li>
<p>Cucumber Expressions are more intimidating than Regular Expressions - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Regular Expressions are a powerful tool that have been in use in computer science for many decades. They can be hard understand and maintain, so the Cucumber team created a simplified mechanism, called Cucumber Expressions. However, Cucumber remains backwards compatible, so you can use both Regular Expressions and Cucumber Expressions with modern releases of Cucumber.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_literal_expressions">3.2. Literal expressions</h3>
<div class="paragraph">
<p><a href="#shot-324" id="shot-324" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
Let&#8217;s look at the Shouty scenario from the last chapter.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Cucumber starts to execute this feature, it will come to the first step of the scenario <code>Given Lucy is located 15 metres from Sean</code> <a href="#shot-325" id="shot-325" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a> and say to itself "now - do I have any step definitions that match the phrase <code>Lucy is located 15 metres from Sean</code>?”"</p>
</div>
<div class="paragraph">
<p><a href="#shot-326" id="shot-326" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a>
The most simple cucumber expression that would match that step is this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Lucy is located 15 metres from Sean</pre>
</div>
</div>
<div class="paragraph">
<p>That’s pretty simple isn&#8217;t it? Cucumber expressions are just string patterns, and the most simple pattern you can use is a perfect match.</p>
</div>
<div class="paragraph">
<p>In Javscript, we can use this pattern to make a step definition like this: <a href="#shot-327" id="shot-327" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located 15 metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">matched!</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use a normal Javascript string to pass the cucumber expression to Cucumber.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_2">3.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_cucumber_expressions_will_match_the_step_given_lucy_is_15_metres_from_sean">Which of the following Cucumber Expressions will match the step "Given Lucy is 15 metres from Sean"?</h5>
<div class="ulist">
<ul>
<li>
<p>"lucy is 15 metres from sean" - FALSE</p>
</li>
<li>
<p>"Given Lucy is 15 metres from Sean" - FALSE</p>
</li>
<li>
<p>"Lucy is 15 metres from Sean" - TRUE</p>
</li>
<li>
<p>"Lucy is 15 metres from Sean Smith" - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber Expressions look for a match of the whole step text EXCLUDING the Gherkin keyword (Given/When/Then/And/But). The match is case sensitive and matches whitespace as well.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_capturing_parameters">3.3. Capturing parameters</h3>
<div class="paragraph">
<p>Sometimes, we want to write step definitions that allow us to use different values in our Gherkin scenarios. For example, we might want to have other scenarios that place Lucy a different distance away from Sean. <a href="#shot-328" id="shot-328" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout
  <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
    <span class="nf">Given </span>Lucy is located 15 metres from Sean
    <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
    <span class="nf">Then </span>Lucy hears Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>To capture interesting values from our step definitions, we can use a feature of Cucumber Expressions called <em>parameters</em>.</p>
</div>
<div class="paragraph">
<p>For example, to capture the number of metres, we can use the <code>{int}</code> parameter: <a href="#shot-329" id="shot-329" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a> which is passed as an argument to our step definition: <a href="#shot-330" id="shot-330" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we’re capturing that value as an argument. The value <code>100</code> will be passed to our code automatically by Cucumber.</p>
</div>
<div class="paragraph">
<p>Because we&#8217;ve used Cucumber Expressions' built-in <code>{int}</code> parameter type, the value has been cast to a Number for us automatically, so we can do maths with it if we want.<a href="#shot-331" id="shot-331" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Lucy is </span><span class="p">${</span><span class="nx">distance</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}</span><span class="s2"> centimetres from Sean`</span><span class="p">);</span>

  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber has a bunch of built-in parameter types: <code>{int}</code>, <code>{float}</code>, <code>{word}</code> and <code>{string}</code>. You can also define your own, as we&#8217;ll see later.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3">3.3.1. Lesson 3</h4>
<div class="sect4">
<h5 id="_which_of_the_following_is_not_a_built_in_cucumber_expression_parameter_type">Which of the following is NOT a built in Cucumber Expression parameter type?</h5>
<div class="ulist">
<ul>
<li>
<p>float - FALSE</p>
</li>
<li>
<p>integer - TRUE</p>
</li>
<li>
<p>string - FALSE</p>
</li>
<li>
<p>word - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The Cucumber Expression parameter type that matches an integer is <code>{int}</code>, not <code>{integer}</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_statements_is_true">Which of the following statements is true?</h5>
<div class="ulist">
<ul>
<li>
<p>You cannot create your own Cucumber Expression parameter types - FALSE</p>
</li>
<li>
<p>Cucumber discards the value that matches a Cucumber Expression parameter type - FALSE</p>
</li>
<li>
<p>Your step definition code will be passed the value that matched the Cucumber Expression parameter type - TRUE</p>
</li>
<li>
<p>Cucumber always passes the matched parameter as a string - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber will pass the step definition a parameter for each Cucumber Expression parameter type. Cucumber will attempt to convert the text that matched into a suitable format. Using the <code>{int}</code> parameter type will result in a number being passed to the step definition. You can extend the predefined Cucumber Expression parameter types, by creating your own.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flexibility">3.4. Flexibility</h3>
<div class="paragraph">
<p>Although it&#8217;s important to try to use consistent terminology in our Gherkin scenarios to help develop the ubiquitous language of your domain, we also want scenarios to read naturally, which sometimes means allowing a bit of flexibility.</p>
</div>
<div class="paragraph">
<p>Ideally, the language used in scenarios should never be constrained by your step definitions. Otherwise they&#8217;ll end up sounding like they were written by robots. Or worse, they read like code.</p>
</div>
<div class="paragraph">
<p>One common example is the problem of plurals. Suppose we want to place Lucy and Sean just 1 metre apart: <a href="#shot-332" id="shot-332" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">​</span><span class="nf">Given </span>Lucy is located 1 metre from Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we’ve used the singular <code>metre</code> instead of the plural <code>metres</code> we don&#8217;t get a match: <a href="#shot-333" id="shot-333" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty
&gt; cucumber-js -f node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 1 metre from Sean
    ? undefined
    When Sean shouts "free bagels at Sean's"
    - skipped
    Then Lucy hears Sean's message
    - skipped

Warnings:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metre from Sean
       Undefined. Implement with the following snippet:

         Given('Lucy is located {int} metre from Sean', function (int) {
         // Given('Lucy is located {float} metre from Sean', function (float) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });

   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   - Then Lucy hears Sean's message # features/step_definitions/steps.js:15

1 scenario (1 undefined)
3 steps (1 undefined, 2 skipped)
0m00.000s
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>What a pain!</p>
</div>
<div class="paragraph">
<p>Fear not. We can just surround the <code>s</code> in parentheses to make it optional, like this: <a href="#shot-334" id="shot-334" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-335" id="shot-335" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
Now our step matches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty
&gt; cucumber-js -f node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 1 metre from Sean
    ? undefined
    When Sean shouts "free bagels at Sean's"
    - skipped
    Then Lucy hears Sean's message
    - skipped

Warnings:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metre from Sean
       Undefined. Implement with the following snippet:

         Given('Lucy is located {int} metre from Sean', function (int) {
         // Given('Lucy is located {float} metre from Sean', function (float) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });

   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   - Then Lucy hears Sean's message # features/step_definitions/steps.js:15

1 scenario (1 undefined)
3 steps (1 undefined, 2 skipped)
0m00.000s
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is one way to smooth off some of the rough edges in your cucumber expressions, and allow your scenarios to be as expressive as possible.</p>
</div>
<div class="paragraph">
<p>Another is to allow <em>alternates</em> - different ways of saying the same thing. For example, to accept this step: <a href="#shot-336" id="shot-336" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="err">​</span><span class="nf">Given </span>Lucy is standing 1 metre from Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;we can use this Cucumber Expression: <a href="#shot-337" id="shot-337" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is located/standing {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-338" id="shot-338" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a>
Now we can use either 'standing' or 'located' in our scenarios, and both will match just fine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/code/shouty
&gt; cucumber-js -f node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is standing 1 metre from Sean
Lucy is 100 centimetres from Sean
    ? pending
    When Sean shouts "free bagels at Sean's"
    - skipped
    Then Lucy hears Sean's message
    - skipped

Warnings:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is standing 1 metre from Sean # features/step_definitions/steps.js:3
       Pending
   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:10
   - Then Lucy hears Sean's message # features/step_definitions/steps.js:15

1 scenario (1 pending)
3 steps (1 pending, 2 skipped)
0m00.002s
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_4">3.4.1. Lesson 4</h4>
<div class="sect4">
<h5 id="_how_can_you_express_in_a_cucumber_expression_that_matching_some_text_is_optional">How can you express in a Cucumber Expression that matching some text is optional?</h5>
<div class="ulist">
<ul>
<li>
<p>Enclose it in square brackets: [] - FALSE</p>
</li>
<li>
<p>Enclose it in parentheses: () - TRUE</p>
</li>
<li>
<p>Place a question mark after it: ? - FALSE</p>
</li>
<li>
<p>Precede it with a slash: / - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Any text in a Cucumber Expression that is surrounded by parentheses <code>()</code> is considered optional.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_a_slash_separating_words_mean_in_a_cucumber_expression">What does a slash <code>/</code> separating words mean in a Cucumber Expression?</h5>
<div class="ulist">
<ul>
<li>
<p>The words are considered alternatives - the Cucumber Expression will match any of them - TRUE</p>
</li>
<li>
<p>It doesn&#8217;t mean anything special - the Cucumber Expression will match the slash as a literal character- FALSE</p>
</li>
<li>
<p>The word that follows the slash is considered optional - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Words in a Cucumber Expression that are separated by a slash <code>/</code> are considered alternates. There must be no whitespace between the word and the slash.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_cucumber_expressions_would_match_both_it_weighed_3_grammes_and_it_weighed_1_gramme">Which of the following Cucumber Expressions would match both "it weighed 3 grammes" and "it weighed 1 gramme"?</h5>
<div class="ulist">
<ul>
<li>
<p>"it weighed {int} gramme(s)" - TRUE</p>
</li>
<li>
<p>"it weighed 1/3 gramme/s" - FALSE</p>
</li>
<li>
<p>"it weighed 1/3 gramme(s)" - TRUE</p>
</li>
<li>
<p>"it weighed 1 / 3 gramme(s)" - FALSE</p>
</li>
<li>
<p>"it weighed 1/2/3 gramme/grammes" - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Any text surrounded by parentheses <code>()</code> is considered optional. Any words separated by a slash <code>/</code> are considered to be alternates. You can find full documentation about Cucumber Expressions at <a href="https://cucumber.io/docs/cucumber/cucumber-expressions/" class="bare">https://cucumber.io/docs/cucumber/cucumber-expressions/</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_parameters">3.5. Custom parameters</h3>
<div class="paragraph">
<p>Although you can get a long way with Cucumber Expressions' built-in parameter types, you get real power when you define your own <em>custom parameter types</em>. This allows you to transform the text captured from the Gherkin into any object you like before it&#8217;s passed into your step definition.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s define our own <code>{person}</code> custom parameter type that will convert the string <code>Lucy</code> into an instance of <code>Person</code> automatically.</p>
</div>
<div class="paragraph">
<p><a href="#shot-339" id="shot-339" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1</a>
We can start with the step definition, which would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{person} is located/standing {int} metre(s) from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lucy</span><span class="p">,</span> <span class="nx">distance</span><span class="p">)</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-340" id="shot-340" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a>
If we run Cucumber at this point we&#8217;ll see an error, because we haven&#8217;t defined the <code>{person}</code> parameter type yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ npm test

&gt; shouty@1.0.0 test /home/fedex/cucumber/chapter-03-code-js
&gt; cucumber-js -f node_modules/cucumber-pretty

Error: Undefined parameter type {person}
    at UndefinedParameterTypeError.CucumberExpressionError [as constructor] (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber-expressions/dist/src/Errors.js:19:42)
    at new UndefinedParameterTypeError (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber-expressions/dist/src/Errors.js:47:23)
    at /home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber-expressions/dist/src/CucumberExpression.js:101:23
    at String.replace (&lt;anonymous&gt;)
    at CucumberExpression.processParameters (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber-expressions/dist/src/CucumberExpression.js:93:27)
    at new CucumberExpression (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber-expressions/dist/src/CucumberExpression.js:46:21)
    at buildStepDefinitionFromConfig (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/support_code_library_builder/build_helpers.js:158:22)
    at /home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/support_code_library_builder/index.js:83:134
    at Array.map (&lt;anonymous&gt;)
    at SupportCodeLibraryBuilder.finalize (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/support_code_library_builder/index.js:83:71)
    at Cli.getSupportCodeLibrary (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/cli/index.js:120:50)
    at Cli.run (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/cli/index.js:141:37)
    at async Object.run [as default] (/home/fedex/cucumber/chapter-03-code-js/node_modules/cucumber/lib/cli/run.js:30:14)
npm ERR! Test failed.  See above for more details.</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s how we define one.</p>
</div>
<div class="paragraph">
<p><a href="#shot-341" id="shot-341" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a> <a href="#shot-342" id="shot-342" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a>
Let&#8217;s create a new JS file in <code>features/support</code> called <code>person_parameter.js</code>:</p>
</div>
<div class="listingblock">
<div class="title">person_parameter.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <code>defineParameterType</code> function from Cucumber to define our new parameter type. <a href="#shot-343" id="shot-343" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a></p>
</div>
<div class="paragraph">
<p>We need to give it a <code>name</code> which is the name we&#8217;ll use inside the curly brackets in our step definition expressions. <a href="#shot-344" id="shot-344" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a></p>
</div>
<div class="paragraph">
<p>We also need to define&#8201;&#8212;&#8201;gasp!&#8201;&#8212;&#8201;a regular expression. <a href="#shot-345" id="shot-345" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a> This is necessary to tell Cucumber Expressions what text to match when searching for this parameter in a Gherkin step. We won&#8217;t go into the details of regular expressions in this video, but in this case we&#8217;re just matching on either of the names of the people we&#8217;re using in our scenario. <a href="#shot-346" id="shot-346" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a></p>
</div>
<div class="paragraph">
<p>Finally, there&#8217;s a transformer block, <a href="#shot-347" id="shot-347" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a> which takes the text captured from the Gherkin step that matched the regular expression pattern, and runs some code. The return value of this block is what will be passed to the step definition. In this case, the block is passed the name of the person (as a string) <a href="#shot-348" id="shot-348" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10</a> which we can then pass to the <code>Person</code> class&#8217;s constructor. <a href="#shot-349" id="shot-349" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a></p>
</div>
<div class="listingblock">
<div class="title">person_parameter.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">defineParameterType</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">defineParameterType</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">regexp</span><span class="p">:</span> <span class="sr">/Lucy|Sean/</span><span class="p">,</span>
  <span class="na">transformer</span><span class="p">:</span> <span class="nx">name</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-350" id="shot-350" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a>
All of this means that when we run our step, an instance of <code>Person</code> will be passed into our step definition automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ npm test

&gt; shouty@1.0.0 test /home/fedex/cucumber/chapter-03-code-js
&gt; cucumber-js -f node_modules/cucumber-pretty

Feature: Hear shout

  Scenario: Listener is within range
    Given Lucy is located 1 metres from Sean
Person {}
Lucy is 100 centimetres from Sean
    ? pending
    When Sean shouts "free bagels at Sean's"
    - skipped
    Then Lucy hears Sean's message
    ? undefined

Warnings:

1) Scenario: Listener is within range # features/hear_shout.feature:2
   ? Given Lucy is located 1 metres from Sean # features/step_definitions/steps.js:5
       Pending
   - When Sean shouts "free bagels at Sean's" # features/step_definitions/steps.js:16
   ? Then Lucy hears Sean's message
       Undefined. Implement with the following snippet:

         Then('{person} hears {person}\'s message', function (person, person2) {
           // Write code here that turns the phrase above into concrete actions
           return 'pending';
         });


1 scenario (1 undefined)
3 steps (1 undefined, 1 pending, 1 skipped)
0m00.002s
npm ERR! Test failed.  See above for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom parameters allow you to bring your domain <em>model</em> - the names of the classes and objects in your solution - and your domain <em>language</em> - the words you use in your scenarios and step definitions - closer together.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_java">3.5.1. Lesson 5 - Questions (Java)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>@ParameterType("activated")
public Status state(String activationState) {
    return new Status(activationState);
}</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the name of the method that is decorated with the <code>@ParameterType</code> annotation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_javascript">3.5.2. Lesson 5 - Questions (Javascript)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions_2">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code_2">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>defineParameterType({
  name: 'state',
  regexp: /activated/,
  transformer: activationState &#8658; new Status(activationState)
})</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the <code>name</code> parameter passed to the <code>defineParameterType</code> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_ruby">3.5.3. Lesson 5 - Questions (Ruby)</h4>
<div class="sect4">
<h5 id="_what_role_do_regular_expressions_play_in_cucumber_expressions_3">What role do Regular Expressions play in Cucumber Expressions?</h5>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
<li>
<p>Cucumber Expressions provide a subset of Regular Expression syntax</p>
</li>
<li>
<p>Cucumber Expressions are exactly the same as Regular Expressions</p>
</li>
<li>
<p>A Regular Expression is used to define the text to be matched when using a custom Parameter Type - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: We use a Regular Expression to specify the text that should be matched when a custom Parameter Type is used in a Cucumber Expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_would_you_use_the_custom_parameter_type_defined_by_the_following_code_3">How would you use the custom Parameter Type defined by the following code?</h5>
<div class="paragraph">
<p>ParameterType(
  name:        'state',
  regexp:      /activated/,
  transformer: &#8594; (activationState) { Status.new(activationState) }
)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{activated}</p>
</li>
<li>
<p>{activationState}</p>
</li>
<li>
<p>{state} - TRUE</p>
</li>
<li>
<p>{Status}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The name of a custom Parameter Type is defined by the <code>name</code> parameter passed to the <code>ParameterType</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_c">C#</h5>

</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cleaning_up">4. Cleaning up</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_importance_of_readability">4.1. The importance of readability</h3>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=1arEP_-0Fi5CK7EC8IYCJWrc67I_XF34Z" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-351" id="shot-351" title="04.01.animation.mp4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 0.1: 04.01.animation.mp4</a></p>
</div>
<div class="paragraph">
<p>In the previous chapter, we talked about the importance of having readable scenarios, and you learned some new skills with Cucumber Expressions to help you achieve that goal. Those skills will give you the confidence to write scenarios exactly the way you want, knowing you’ll be able to match the Gherkin steps easily from your step definition code.</p>
</div>
<div class="paragraph">
<p>We emphasise readability because from our experience, writing Gherkin scenarios is a software design activity. Cucumber was created to bridge the communication gap between business domain experts and development teams. When you collaborate with domain experts to describe behaviour in Gherkin, you’re expressing the group’s shared understanding of the problem you need to solve. The words you use in your scenarios can have a deep impact on the way the software is designed, as we’ll see in later chapters.</p>
</div>
<div class="paragraph">
<p>The more fluent you become in writing Gherkin, the more useful a tool it becomes to help you facilitate this communication. Keeping your scenarios readable means you can get feedback at any time about whether you’re building the right thing. Over time, your features become living documentation about your system. We can’t emphasize enough how important it is to see your scenarios as more than just tests.</p>
</div>
<div class="paragraph">
<p>Maintaining a living document works both ways: the scenarios will guide your solution design, but you may also have to update your Gherkin to reflect the things you learn as you build the solution. This dance back and forth between features and solution code is an important part of BDD.</p>
</div>
<div class="paragraph">
<p>In this chapter, we’ll learn about feature descriptions, the Background keyword, and about keeping scenarios and code up-to-date with your current understanding of the project.</p>
</div>
<div class="paragraph">
<p>First, let’s catch up with what’s been happening on the Shouty project.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_2">4.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_which_aspects_of_cucumber_help_bridge_the_communication_gap_between_business_domain_experts_and_development_teams">Which aspects of Cucumber help bridge the communication gap between business domain experts and development teams?</h5>
<div class="ulist">
<ul>
<li>
<p>The readability of Gherkin scenarios - TRUE</p>
</li>
<li>
<p>Cucumber&#8217;s availability for different programming languages - FALSE</p>
</li>
<li>
<p>Being able to express scenarios using your own domain language - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The feature files that Cucumber understands are written using Gherkin, so that you can create scenarios that utilise your own domain language, so that they can be read and understood by everyone involved in specifying and delivering your software.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_do_cucumber_feature_files_differ_from_more_traditional_automated_tests">How do Cucumber feature files differ from more traditional automated tests?</h5>
<div class="ulist">
<ul>
<li>
<p>The purpose of feature files is to create readable specifications that can be understood by the whole team, not to provide test coverage</p>
</li>
<li>
<p>Business-readable specifications make it easier to obtain feedback about what you&#8217;re building while you&#8217;re building it, rather than waiting for a later test cycle</p>
</li>
<li>
<p>Feature files become "living documentation" when they are automated, providing a single source of truth for the whole team</p>
</li>
<li>
<p>Feature files should be written collaboratively by business and delivery, not in isolation by testers</p>
</li>
<li>
<p>There is no difference - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: BDD is the collaborative approach to developing software that Cucumber was created to support. Although Cucumber scenarios do act as tests when they are automated, this is not their primary purpose. Their primary purpose is to provide a single, shared specification, written in the domain language of your business&#8201;&#8212;&#8201;facilitating collaboration, feedback, and
reliable documentation. The primary purpose of traditional automated tests, on the other hand, is to check that the software behaves as expected.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_changes_that_happened_while_we_were_away">4.2. Review changes that happened while we were away</h3>
<div class="paragraph">
<p>While we were away, the developers of Shouty have been busy working on the code. Let’s have a look at what they’ve been up to.</p>
</div>
<div class="paragraph">
<p><a href="#shot-352" id="shot-352" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: npm test</a>
We’ll start out by running Cucumber.</p>
</div>
<div class="paragraph">
<p>Great! It looks like both these scenarios are working now - both the different messages that Sean shouts are being heard by Lucy.</p>
</div>
<div class="paragraph">
<p><a href="#shot-353" id="shot-353" title="open stepdef file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: open stepdef file</a>
Let’s dig into the code and see how these steps have been automated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
  <span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the step definition layer, we can see that a new class has been defined, the Network.<a href="#shot-354" id="shot-354" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a> We’re creating an instance of the network here. Then we pass that network instance to each of the Person instances we create here.<a href="#shot-355" id="shot-355" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a> So both instances of Person depend on the same instance of network. The Network is what allows people to send messages to one another.</p>
</div>
<div class="paragraph">
<p>There are also a couple of new unit test classes in the <code>spec</code> directory,<a href="#shot-356" id="shot-356" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a> one for the Network class,<a href="#shot-357" id="shot-357" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a> and another one for the Person class.<a href="#shot-358" id="shot-358" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a></p>
</div>
<div class="paragraph">
<p>Unit tests are fine-grained tests that define the precise behaviour of each of those classes. We’ll talk more about this in a future lesson, but feel free to have a poke around in there in the meantime.</p>
</div>
<div class="paragraph">
<p>The familiar <code>npm test</code> <a href="#shot-359" id="shot-359" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7a</a> command will run those unit tests as well as Cucumber.<a href="#shot-360" id="shot-360" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7b</a></p>
</div>
<div class="paragraph">
<p><a href="#shot-361" id="shot-361" title="open the feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: open the feature file</a></p>
</div>
<div class="paragraph">
<p>The first thing I notice coming back to the code is that the feature file is still talking about the distance between Lucy and Sean, but we haven’t actually implemented any behaviour around that yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Feature</span><span class="p">:</span> <span class="nx">Shout</span>

  <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">within</span> <span class="nx">range</span>
    <span class="nx">Given</span> <span class="nx">Lucy</span> <span class="nx">is</span> <span class="mi">15</span> <span class="nx">metres</span> <span class="k">from</span> <span class="nx">Sean</span>
    <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span>
    <span class="nx">Then</span> <span class="nx">Lucy</span> <span class="nx">should</span> <span class="nx">hear</span> <span class="nx">Sean</span><span class="dl">'</span><span class="s1">s message

  Scenario: Listener hears a different mesage
    Given Lucy is 15 metres from Sean
    When Sean shouts "Free coffee!"
    Then Lucy should hear Sean</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This happens to us all the time - we have an idea for a new feature, but then we find the problem is too complex to solve all at once, so we break it down into simpler steps. If we’re not careful, little bits of that original idea can be left around like clutter, in the scenarios and in the code. That clutter can get in the way, especially if plans change.</p>
</div>
<div class="paragraph">
<p>We’re definitely going to develop this behaviour, but we’ve decided to defer it to our next iteration. Our current solution is just focussed on broadcasting messages between the people on the network.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s clean up the feature to reflect that current understanding.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_3">4.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_why_have_the_shouty_developers_created_unit_tests_for_the_person_and_network_classes">Why have the Shouty developers created unit tests for the Person and Network classes?</h5>
<div class="ulist">
<ul>
<li>
<p>They don&#8217;t understand how to do BDD - FALSE</p>
</li>
<li>
<p>Unit tests are fine-grained tests that define the precise behaviour of each of those classes - TRUE</p>
</li>
<li>
<p>Unit tests run faster than Cucumber scenarios - FALSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Unit tests (also known as programmer tests) are used to define precise behaviour of units of code that may not be interesting to the business&#8201;&#8212;&#8201;and so should not be written in a feature file. Writing unit tests is entirely compatible with BDD.</p>
</div>
<div class="paragraph">
<p>There is no reason for Cucumber scenarios to run significantly slower than unit tests. The Shouty step definitions that we&#8217;ve seen so far interact directly with the domain layer and run extremely fast.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_is_the_distance_between_sean_and_lucy_not_being_used_by_shouty">Why is the distance between Sean and Lucy not being used by Shouty?</h5>
<div class="ulist">
<ul>
<li>
<p>The team has decided to defer implementing range functionality until a later iteration - TRUE</p>
</li>
<li>
<p>The developers have misunderstood the specification</p>
</li>
<li>
<p>The specification has changed since the scenarios were written</p>
</li>
<li>
<p>The distance between Sean and Lucy is being used to decide if the shout is "in range"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Teams often find that the problem is too big to solve all at once, so we split it into thinner slices. Working in smaller steps is a faster, safer way of delivering software. In this case the team has decided that broadcasting messages and calculating if a person is in-range are different problems that they will address separately.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_description_field">4.3. Description field</h3>
<div class="paragraph">
<p>After the feature keyword, we have space in a Gherkin document to write any arbitrary text that we like.<a href="#shot-362" id="shot-362" title="feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: feature file</a> We call this the feature’s <em>description</em>. This is a great place to write up any notes or other details that can’t easily be expressed in examples. You might have links to wiki pages or issue trackers, or to wireframes. You can put anything you like in here, as long as you don’t start a line with a Gherkin keyword, like &#8220;Rule:&#8221; or &#8220;Scenario:&#8221;.</p>
</div>
<div class="paragraph">
<p>In this case, we can add a high level description of the Shouty application.<a href="#shot-363" id="shot-363" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a> Because Shouty doesn&#8217;t yet filter by proximity, we can also write a todo list here so it’s clear that we do intend to get to that soon.<a href="#shot-364" id="shot-364" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">To do</span><span class="p">:</span>
    <span class="err">-</span> <span class="err">only</span> <span class="err">shout</span> <span class="err">to</span> <span class="err">people</span> <span class="err">within</span> <span class="nf">a </span>certain distance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changing the description doesn’t change anything about how Cucumber will run this feature. It just helps the human beings reading this document to understand more about the system you’re building.</p>
</div>
<div class="paragraph">
<p>Our two scenarios are examples of how Shouty can broadcast a shout to other users. This is one of the main business rules, which we can document using the Rules keyword.<a href="#shot-365" id="shot-365" title="add Rules keyword and indent scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4: add Rules keyword and indent scenarios</a> We&#8217;ll learn more about this in a later chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener within range
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-366" id="shot-366" title="shows 'Lucy is 15 metres from Sean' step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5: shows 'Lucy is 15 metres from Sean' step definition</a>
The step “Given Lucy is 15 metres from Sean” is misleading, since the distance between the two people is not yet relevant in our current model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">Rule</span><span class="p">:</span> <span class="nx">Shouts</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">heard</span> <span class="nx">by</span> <span class="nx">other</span> <span class="nx">users</span>

    <span class="nx">Scenario</span><span class="p">:</span> <span class="nx">Listener</span> <span class="nx">within</span> <span class="nx">range</span>
      <span class="nx">Given</span> <span class="nx">Lucy</span> <span class="nx">is</span> <span class="mi">15</span> <span class="nx">metres</span> <span class="k">from</span> <span class="nx">Sean</span>
      <span class="nx">When</span> <span class="nx">Sean</span> <span class="nx">shouts</span> <span class="dl">"</span><span class="s2">free bagels at Sean's</span><span class="dl">"</span>
      <span class="nx">Then</span> <span class="nx">Lucy</span> <span class="nx">should</span> <span class="nx">hear</span> <span class="nx">Sean</span><span class="dl">'</span><span class="s1">s message

    Scenario: Listener hears a different mesage
      Given Lucy is 15 metres from Sean
      When Sean shouts "Free coffee!"
      Then Lucy should hear Sean</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The step definition calls the moveTo method on Person, <a href="#shot-367" id="shot-367" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-368" id="shot-368" title="shows move_to method in Person class" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7: shows move_to method in Person class</a>
but the moveTo method doesn’t actually do anything.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-369" id="shot-369" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a>
Let’s simplify this code to do just what it needs to do right now, and no more. We can start from the scenario by changing this single step to express what’s actually going on.<a href="#shot-370" id="shot-370" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a> We’ll work on one scenario at a time, and update the other one once we’re happy with this one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener within range
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>Lucy is 15 metres from Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the scenario names make sense, and we have two steps, each creating a person. Notice we’re starting to reveal some more of our domain language here: we’ve introduced the words <code>Person</code> and <code>name</code>. Person is already a part of our domain language, so it’s nice to have that revealed in the language of the scenario. Name may well become an attribute of our person soon, so it’s also useful to have that surfaced so we can get feedback about it from the team.</p>
</div>
<div class="paragraph">
<p>One thing we’ve lost by doing this is the idea that, eventually, the two people will need to be close to each other for the message to be transmitted. We definitely wouldn’t remove detail like that unilaterally, without discussing it with the other people who were involved in writing and reviewing this scenario.</p>
</div>
<div class="paragraph">
<p><a href="#shot-371" id="shot-371" title="create new Rule and writes out two new empty scenarios for in / out of range" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: create new Rule and writes out two new empty scenarios for in / out of range</a>
In this case, as well as adding it to the TODO list above, we’ve decided to document the range rule, and write a couple of new empty scenarios to remind us to implement that behaviour later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range

    <span class="kn">Scenario</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">is</span> <span class="err">out</span> <span class="err">of</span> <span class="err">range</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-372" id="shot-372" title="bundle exec cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11: bundle exec cucumber</a>
Let’s press on. We can run Cucumber to generate new step definition snippets for the new steps and paste them into our steps file. <a href="#shot-373" id="shot-373" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next lesson we&#8217;ll look at a couple of ways that we can implement these new step definitions.</p>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions">4.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_what_is_a_feature_file_description">What is a feature file <em>description</em>?</h5>
<div class="ulist">
<ul>
<li>
<p>Any lines of text between the feature name and the first rule or scenario - TRUE</p>
</li>
<li>
<p>A line of text that starts with the <code>#</code> character</p>
</li>
<li>
<p>A block of text introduced by the <code>Description:</code> keyword</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: You can add a free text description of a feature file after the <code>Feature:</code> line that defines the feature&#8217;s name. The description can be any number of lines long. The description continues until the first rule, scenario, or scenario outline is encountered.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_the_purpose_of_writing_an_empty_scenario">What is the purpose of writing an empty scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>It is not valid Gherkin syntax to write an empty scenario</p>
</li>
<li>
<p>Empty scenarios act as a reminder that we have more work to do - TRUE</p>
</li>
<li>
<p>Empty scenarios are a way of pretending that we have done more work than we actually have</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Cucumber treats empty scenarios as work that needs to be done and reports them as <em>pending</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_before_hook">4.4. The "Before" hook</h3>
<div class="paragraph">
<p><a href="#shot-374" id="shot-374" title="broken implementation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: broken implementation</a>
We now have two step definitions to implement,<a href="#shot-375" id="shot-375" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a> and that presents us with a bit of a problem. We need the same instance of Network available in both. We could just assume that the Lucy step will always run first and create it there, but that seems fragile.<a href="#shot-376" id="shot-376" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3</a> If someone wrote a new scenario that didn’t create people in the right order, they’d end up with no Network instance, and weird bugs. We want our steps to be as independent as possible, so they can be easily composed into new scenarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most straightforward way to create this network instance in JavaScript is to use a hook.</p>
</div>
<div class="paragraph">
<p>We need an instance of Network in every scenario, so we can declare a Before Hook that creates one before each scenario starts, like this:<a href="#shot-377" id="shot-377" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a></p>
</div>
<div class="paragraph">
<p>Now we can use that Network instance as we create Lucy <a href="#shot-378" id="shot-378" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a> and Sean <a href="#shot-379" id="shot-379" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a> in these two new steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be working again now. Let’s run Cucumber to check. <a href="#shot-380" id="shot-380" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a></p>
</div>
<div class="paragraph">
<p>Good. Let’s do the same with the other scenario. <a href="#shot-381" id="shot-381" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-382" id="shot-382" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9: npm test</a></p>
</div>
<div class="paragraph">
<p>Now we can remove this old step definition. <a href="#shot-383" id="shot-383" title="move the cursor to the step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: move the cursor to the step definition</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">Before</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
  <span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We know we&#8217;ll need something like this in the future when we implement the proximity rule, but we don&#8217;t want to second-guess what that code will look like, so let&#8217;s clean it out for now.<a href="#shot-384" id="shot-384" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">Before</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">Network</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../src/shouty</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy is {int} metres from Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lucy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Sean</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">sean</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
  <span class="nx">sean</span><span class="p">.</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lucy</span><span class="p">.</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-385" id="shot-385" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12: npm test</a></p>
</div>
<div class="paragraph">
<p>Now we have one last bit of dead code left, the move_to method on Person.<a href="#shot-386" id="shot-386" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13</a>
Let&#8217;s clean that up too.<a href="#shot-387" id="shot-387" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 14</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">network</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">network</span>      <span class="o">=</span> <span class="nx">network</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">moveTo</span><span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">messagesHeard</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-388" id="shot-388" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 15: npm test</a>
And we&#8217;re still green!</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_2">4.4.1. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_when_does_a_before_hook_run">When does a Before hook run?</h5>
<div class="ulist">
<ul>
<li>
<p>Before every run of Cucumber</p>
</li>
<li>
<p>Before the first scenario in each feature file</p>
</li>
<li>
<p>Before each scenario - TRUE</p>
</li>
<li>
<p>Before each step in a scenario</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: A Before hook runs before each scenario. Since there is no way to tell if a hook exists by looking at the feature file, you should only use hooks for performing actions that you don&#8217;t expect the business to provide feedback on.</p>
</div>
<div class="paragraph">
<p>You can read more about hooks at <a href="https://cucumber.io/docs/cucumber/api/#hooks" class="bare">https://cucumber.io/docs/cucumber/api/#hooks</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_why_isnt_it_a_good_idea_to_create_a_network_instance_in_the_same_step_definition_where_we_create_lucy">Why isn&#8217;t it a good idea to create a Network instance in the same step definition where we create Lucy?</h5>
<div class="ulist">
<ul>
<li>
<p>It is a good idea</p>
</li>
<li>
<p>Steps should be independent and composable. If the Network is only created when Lucy is created, future scenarios will be forced to create Lucy - TRUE</p>
</li>
<li>
<p>We&#8217;ll need to create another Network instance when we create Sean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Every person needs to share the <strong>same</strong> Network instance, which means we need to create the Network before we create any people. By creating the Network instance in the same step definition that we create Lucy, we are forcing people to:
* create Lucy&#8201;&#8212;&#8201;even if the scenario doesn&#8217;t need Lucy
* create Lucy before any other person&#8201;&#8212;&#8201;because otherwise Network will not have been created yet</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_person_in_a_generic_stepdef">4.5. Create Person in a generic stepdef</h3>
<div class="paragraph">
<p><a href="#shot-389" id="shot-389" title="Freeze of code from end of lesson 4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: Freeze of code from end of lesson 4</a></p>
</div>
<div class="paragraph">
<p>OK, so we’ve cleaned things up a bit, to bring the scenarios, the code and our current understanding of the problem all into sync. What’s nice to see is how well those new steps that create Lucy and Sean match the code inside the step definition.</p>
</div>
<div class="paragraph">
<p>When step definitions have to make a big leap to translate between our plain-language description of the domain in the Gherkin scenario, and the code, that’s usually a sign that something is wrong. We like to see step definitions that are only one or two lines long, because that usually indicates our scenarios are doing a good job of reflecting the domain model in the code, and vice-versa.</p>
</div>
<div class="paragraph">
<p>One problem that we still have with these scenarios is that we’re very fixed to only being able to use these two characters, Lucy and Sean. If we want to introduce anyone else into the scenario, we’re going to be creating quite a lot of duplicate code. In fact, the two steps for creating Lucy and Sean are almost identical, apart from those instance variables.</p>
</div>
<div class="paragraph">
<p>On a real project we wouldn’t bother about such a tiny amount of duplication at this early stage, but this isn’t a real project! Let’s play with the skills we learned in the last chapter to make a single step definition that can create Lucy or Sean.</p>
</div>
<div class="paragraph">
<p>The first problem we’ll need to tackle is these hard-coded instance variable names.<a href="#shot-390" id="shot-390" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a></p>
</div>
<div class="paragraph">
<p>We can use a JavaScript object to store all the people involved in the scenario.</p>
</div>
<div class="paragraph">
<p>Let’s try replacing Lucy first.</p>
</div>
<div class="paragraph">
<p><a href="#shot-391" id="shot-391" title="Edit Stepdefs.java, adding private instance field <strong>people</strong>, creating in @Before hook, and using for Lucy throughout" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: Edit Stepdefs.java, adding private instance field <strong>people</strong>, creating in @Before hook, and using for Lucy throughout</a>
We’ll start by creating a new object in the before hook, like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can store Lucy in the people object. We’ll use her name as the key, hard-coding it for now.<a href="#shot-392" id="shot-392" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named Lucy</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, where we check Lucy’s messages heard here in the assertion, we need to fetch her out of the people object. <a href="#shot-393" id="shot-393" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy should hear Sean</span><span class="se">\'</span><span class="s1">s message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">(),</span> <span class="nx">is</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span><span class="p">]))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-394" id="shot-394" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6: npm test</a></p>
</div>
<div class="paragraph">
<p>With that little refactoring done, we can now try and make this first step generic for any name.<a href="#shot-395" id="shot-395" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6a</a></p>
</div>
<div class="paragraph">
<p>Using your new found Cucumber expression skills from the last chapter, you’ll know that if we replace the word Lucy here with a 'word' expression,<a href="#shot-396" id="shot-396" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a> we’ll have the name passed into our step definition as an argument, here.<a href="#shot-397" id="shot-397" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8</a> Now we can use that as the key in the people object.<a href="#shot-398" id="shot-398" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-399" id="shot-399" title="npm test FAILS" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: npm test FAILS</a>
If we try and run Cucumber now, we get an error about an ambiguous match. Our generic step definition is now matching the step “a person named Sean”,<a href="#shot-400" id="shot-400" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10a</a> but so is the original one. <a href="#shot-401" id="shot-401" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10b</a> In bigger projects, this can be a real issue, so this warning is important.</p>
</div>
<div class="paragraph">
<p>Let’s remove the old step definition,<a href="#shot-402" id="shot-402" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a> and fetch Sean from the people object here where he shouts his message.<a href="#shot-403" id="shot-403" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts {string}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Sean</span><span class="dl">'</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageFromSean</span> <span class="o">=</span> <span class="nx">message</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-404" id="shot-404" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13: npm test</a></p>
</div>
<div class="paragraph">
<p>Great, we’re green again.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_2">4.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_why_should_a_step_definition_be_short">Why should a step definition be short?</h5>
<div class="ulist">
<ul>
<li>
<p>Because the plain-language description of the domain in the Gherkin step should be close to the domain model in the code - TRUE</p>
</li>
<li>
<p>Step definitions don&#8217;t need to be short</p>
</li>
<li>
<p>Cucumber limits the length of step definitions to five lines of code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Step definitions are a thin glue between the plain-language description in a scenario and the software that we&#8217;re building. If the business domain and the solution domain are aligned, then there should be little translation to do in the step definition.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_does_it_mean_when_cucumber_compains_about_an_ambiguous_step">What does it mean when Cucumber compains about an <em>ambiguous</em> step?</h5>
<div class="ulist">
<ul>
<li>
<p>Cucumber couldn&#8217;t find a step definition that matches a step</p>
</li>
<li>
<p>Cucumber only found one step definition that matches a step</p>
</li>
<li>
<p>Cucumber found more than one step definition that matches a step - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: If more than one step definition matches a step, then Cucumber doesn&#8217;t know which one to call. When this ambiguity occurs, Cucumber issues an error, rather than try to choose between the matching step definitions.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backgrounds">4.6. Backgrounds</h3>
<div class="paragraph">
<p><a href="#shot-405" id="shot-405" title="Feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: Feature file</a>
Let’s switch back to the feature to show you one more technique for improving the readability of your scenarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener within range
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">Given </span>a person named Lucy
      <span class="nf">And </span>a person named Sean
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have common context steps - the Givens - in all the scenarios in our feature, it can sometimes be useful to get those out of the way.</p>
</div>
<div class="paragraph">
<p><a href="#shot-406" id="shot-406" title="move Given steps into background" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: move Given steps into background</a>
We can literally move them into the background, using a background keyword, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="kn">Background</span><span class="p">:</span>
    <span class="nf">Given </span>a person named Lucy
    <span class="nf">And </span>a person named Sean</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-407" id="shot-407" title="npm test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: npm test</a>
As far as Cucumber is concerned, these scenarios haven’t changed. It will still create both Lucy and Sean as the first things it does when running each of these scenarios.</p>
</div>
<div class="paragraph">
<p><a href="#shot-408" id="shot-408" title="Feature file, showing Background and shortened scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4: Feature file, showing Background and shortened scenarios</a>
But from a readability point of view, we can now see  more clearly what’s important and interesting about these two scenarios - in this case, the message being shouted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different mesage
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice we just went straight into When steps in our scenarios.<a href="#shot-409" id="shot-409" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a> That’s absolutely fine. We still have a context for the scenario, but we’ve chosen to push it off into the background.</p>
</div>
<div class="paragraph">
<p>Again, it’s debatable whether we’d bother to use a Background to do this on a real project, but this at least illustrates the technique. We rarely use Backgrounds in our projects, because although they can improve readability by removing the duplication of repeated contexts, they also harm readability by requiring people to read the Background in conjunction with each Scenario.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="https://drive.google.com/uc?id=19VLE9qKbVN4bpMxsIVvPtPqc3RGw4bSW" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>To maintain trust in the BDD process, it’s important to keep your features fresh. Even when you drive the development from BDD scenarios, you’ll still learn lessons from the implementation that might need to be fed back into your Gherkin documentation.</p>
</div>
<div class="paragraph">
<p>In this case, we discovered that we could find a smaller slice of this story, and defer the business rule about proximity until our next iteration. Splitting stories like this is a powerful agile technique, and one that BDD can help you to master. Now we have a clean codebase and a suite of scenarios that reflects the current state of the system’s development.</p>
</div>
<div class="paragraph">
<p>We’re ready to start the next iteration.</p>
</div>
<div class="sect3">
<h4 id="_lesson_6_questions">4.6.1. Lesson 6 - Questions</h4>
<div class="sect4">
<h5 id="_what_does_the_gherkin_keyword_background_do">What does the Gherkin keyword _Background_do?</h5>
<div class="ulist">
<ul>
<li>
<p>It provides a place to write a description of why the feature is valuable</p>
</li>
<li>
<p>It is treated exactly like a scenario, but is run as soon as Cucumber starts</p>
</li>
<li>
<p>It is treated exactly like a scenario, but is run once before any other scenario in the feature file</p>
</li>
<li>
<p>The steps from the background are run as if they were inserted at the beginning of every scenario in the feature file - TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: The background is used to reduce duplication in scenarios by moving steps that are common to all scenarios into a single location. The steps in the background are run before every scenario in the feature file.</p>
</div>
<div class="paragraph">
<p>There can be a maximum of one Background per feature file. A Background only affects scenarios that are in the same feature file as the Background.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_might_backgrounds_decrease_the_readability_or_maintainability_of_a_feature_file">How might Backgrounds decrease the readability or maintainability of a feature file?</h5>
<div class="ulist">
<ul>
<li>
<p>Backgrounds always improve readability</p>
</li>
<li>
<p>Readability can decrease because the reader must remember the contents of the background even when reading scenarios at the end of the feature file</p>
</li>
<li>
<p>Maintainability can decrease because the maintainer must be aware that there is a background even when adding scenarios to the end of the feature file</p>
</li>
<li>
<p>Maintainability can decrease because the maintainer must be aware of the background when moving a scenario to a different feature file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Answer: Backgrounds were created to aid readability, by reducing duplication in the scenarios. Unfortunately, moving important information out of a scenario means that anyone reading or modifying a feature file must be fully aware that of the existence and content of a background. Since feature files typically contain several scenarios, that means holding two sections of the feature file in your mind at the same time, making a feature file harder to read or maintain.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_loops">5. Loops</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_removing_redundant_scenarios">5.1. Removing redundant scenarios</h3>
<div class="paragraph">
<p>Welcome back to Cucumber School.</p>
</div>
<div class="paragraph">
<p><a href="#shot-410" id="shot-410" title="feature file from end of Ch 4" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: feature file from end of Ch 4</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last time we worked on cleaning up the Shouty features to keep them in sync with the current status of the project. We stripped the scenarios back to only specify the behaviour of passing messages between people. We made it clear that the proximity rule had not yet been implemented.</p>
</div>
<div class="paragraph">
<p>You’ll already remember from the Cucumber expressions chapter how important it is to be expressive in your scenarios, and keep them readable. In this chapter we’re going to learn some new tricks with Gherkin that will give you even more flexibility about how you write scenarios.</p>
</div>
<div class="paragraph">
<p>Once again the Shouty developers&#8201;&#8212;&#8201;have been hard at work implementing that proximity rule. Let’s have a look at how they got on.</p>
</div>
<div class="paragraph">
<p><a href="#shot-411" id="shot-411" title="Runs cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: Runs cucumber</a></p>
</div>
<div class="paragraph">
<p>Right, so those two scenarios we just left as just placeholders: the one where the listener is within range,<a href="#shot-412" id="shot-412" title="show in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: show in feature file</a> and the one where the listener is out of range <a href="#shot-413" id="shot-413" title="show in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: show in feature file</a> are passing.<a href="#shot-414" id="shot-414" title="Show output from Cucumber showing the in-range/out-of-range results" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5: Show output from Cucumber showing the in-range/out-of-range results</a> Fantastic! If we look at our step definitions, we can see how they have been implemented. <a href="#shot-415" id="shot-415" title="show the in-range/out-of-range scenarios in the step definitions" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6: show the in-range/out-of-range scenarios in the step definitions</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s review the changes to the feature file in more detail.</p>
</div>
<div class="paragraph">
<p><a href="#shot-416" id="shot-416" title="Show all four scenarios in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7: Show all four scenarios in feature file</a></p>
</div>
<div class="paragraph">
<p>We now have four scenarios: our original two from the last time we looked at the code, and the two placeholders we wrote as reminders.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Hear shout

  Shouty allows users to "hear" other users "shouts" as long as they are close enough to each other.

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">c</span><span class="nf">an </span>be heard by other users

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

  <span class="err">Rule</span><span class="p">:</span> <span class="err">Shouts</span> <span class="err">should</span> <span class="err">only</span> <span class="err">be</span> <span class="err">heard</span> <span class="err">if</span> <span class="err">listener</span> <span class="err">is</span> <span class="err">within</span> <span class="err">range</span>

    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>We used the second scenario - Listener hears a different message <a href="#shot-417" id="shot-417" title="Highlight second scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: Highlight second scenario</a> - to triangulate and force us to replace the hard-coded message output with a proper implementation. Now we have a domain model that uses a variable for the message, there&#8217;s an insignificant chance of this behaviour regressing, so we can safely remove the second scenario. <a href="#shot-418" id="shot-418" title="removes second scenario: Listener hears a different message" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9: removes second scenario: Listener hears a different message</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a different message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"Free coffee!"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keeping excess scenarios is wasteful: they clutter up your feature files, distracting your readers. When you run your features as tests, excess scenarios make them take longer to run than necessary. The one where a "listener hears a "message" is a perfectly good way of checking that the message has been sent correctly.</p>
</div>
<div class="sect3">
<h4 id="_lesson_1_questions_3">5.1.1. Lesson 1 - Questions</h4>
<div class="sect4">
<h5 id="_why_was_it_a_good_idea_to_delete_the_scenario">Why was it a good idea to delete the scenario?</h5>
<div class="ulist">
<ul>
<li>
<p>It doesn&#8217;t help illustrate the rule "Shouts can be heard by other users"&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>No one should give away free coffee</p>
</li>
<li>
<p>There should only be one scenario per rule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We created the scenario "Listener hears a different message" to force us to replace our hard-coded implementation. Now we have a domain model that uses a variable for the message, there&#8217;s an insignificant chance of this behaviour regressing, so we can safely remove the second scenario.</p>
</div>
<div class="paragraph">
<p>Keeping excess scenarios is wasteful: they clutter up your feature files and slow down feedback.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_incidental_details">5.2. Incidental details</h3>
<div class="paragraph">
<p><a href="#shot-419" id="shot-419" title="hear_shout.feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: hear_shout.feature</a>
The first scenario has changed since we last looked at it <a href="#shot-420" id="shot-420" title="Highlight the first three line of the first scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: Highlight the first three line of the first scenario</a> - it now specifies the range of a shout and the location of Sean and Lucy. This scenario exists to illustrate that a listener hears the message exactly as the shouter shouted it. All the additional details are incidental and make the scenario harder to read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-421" id="shot-421" title="Edit context of first scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: Edit context of first scenario</a>
Let&#8217;s ensure that this scenario includes only essential information for the reader and remove all references to location and range.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener hears a message
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-422" id="shot-422" title="Add Network creation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4: Add Network creation</a>
We&#8217;ll need to make changes to the step definitions to make sure that a Network class is always created - which we can do using an instance variable.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-423" id="shot-423" title="Highlight DEFAULT_RANGE" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5: Highlight DEFAULT_RANGE</a>
We&#8217;ve defaulted the range to 100. If a scenario needs to document specific range, that can still be done by explicitly including a "Given the range is &#8230;&#8203;" step.</p>
</div>
<div class="paragraph">
<p><a href="#shot-424" id="shot-424" title="Create new step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6: Create new step definition</a>
We&#8217;ll also need to add a step definition that can create a person without the scenario needing to specify where they are located. The step definition gives each person created this way a default location of 0.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-425" id="shot-425" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7: run Cucumber</a>
Let&#8217;s run Cucumber to check we haven&#8217;t broken anything&#8230;&#8203; and we&#8217;re good!</p>
</div>
<div class="paragraph">
<p><a href="#shot-426" id="shot-426" title="Highlight message text in last two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: Highlight message text in last two scenarios</a>
Looking at the two new scenarios - Listener is within range &amp; Listener is out of range - we can see that they also contain incidental details. Since their purpose is to illustrate the "Shouts should only be heard if listener is within range" rule, there&#8217;s no need to actually document the content of the shout.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Lucy should hear Sean's message

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts <span class="s">"free bagels at Sean's"</span>
      <span class="nf">Then </span>Larry should not hear Sean's message</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-427" id="shot-427" title="Delete message text" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9: Delete message text</a>
Let&#8217;s remove the details that aren&#8217;t relevant to the range rule.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Lucy is located at 50
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>a person named Sean is located at 0
      <span class="nf">And </span>a person named Larry is located at 150
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-428" id="shot-428" title="Add new step definition" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: Add new step definition</a>
Next we add a step definition that allows Sean to shout, without needing us to specify the exact message.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sean shouts</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Sean</span><span class="dl">'</span><span class="p">].</span><span class="nx">shout</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello, world</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-429" id="shot-429" title="Run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11: Run Cucumber</a>
And finally run Cucumber - and we&#8217;re still green.</p>
</div>
<div class="paragraph">
<p><a href="#shot-430" id="shot-430" title="Show hear_shout.feature" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12: Show hear_shout.feature</a>
That&#8217;s better. We&#8217;ve removed inessential details, so that each scenario contains only the information needed to illustrate its business rule.</p>
</div>
<div class="paragraph">
<p>The scenarios would still run green if we removed the steps that set the range of a shout <a href="#shot-431" id="shot-431" title="Highlight in last two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13: Highlight in last two scenarios</a> , because the range already has a default value. We&#8217;re not going to, because since those scenarios are illustrating the rule that deals with the range of a shout, it&#8217;s an essential part of context for anyone reading them.</p>
</div>
<div class="paragraph">
<p>A happy side-effect is that, in order to set the range from our scenario, we’ve had to make it a configurable property of the system <a href="#shot-432" id="shot-432" title="highlight Network constructor" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 14: highlight Network constructor</a>. So if our business stakeholders ever change their minds about the range, we won’t have to go hunting around in the code for where we’d hard-coded it.</p>
</div>
<div class="sect3">
<h4 id="_lesson_2_questions_4">5.2.1. Lesson 2 - Questions</h4>
<div class="sect4">
<h5 id="_why_did_we_remove_any_reference_to_range_or_location_from_the_first_scenario_listener_hears_a_message">Why did we remove any reference to range or location from the first scenario "Listener hears a message"?</h5>
<div class="ulist">
<ul>
<li>
<p>They are essential to system behaviour</p>
</li>
<li>
<p>They are incidental to the rule being illustrated&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>They were only needed to triangulate the implementation</p>
</li>
<li>
<p>They made the scenario too long</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The first scenario exists to illustrate the rule "Listener hears a message." Since the behaviour is not affected by the range of a shout, neither the range nor the distance between the shouter and the listener is relevant. The information is therefore <em>incidental</em> and should be omitted from the scenario.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_do_we_need_to_know_the_names_of_people_using_shouty">Why do we need to know the names of people using Shouty?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s important that every person in the system has a real name</p>
</li>
<li>
<p>It&#8217;s necessary to use <em>persona</em>, where the shouter is called Sean and the listeners are called Lucy or Larry</p>
</li>
<li>
<p>It doesn&#8217;t matter what we call them&#8201;&#8212;&#8201;but the automation code does need to be able to tell them apart&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>The automation code has been written to recognise the names Sean, Lucy, and Larry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
It&#8217;s necessary to be able to distinguish the people that are involved in the scenario. We have called them Sean, Lucy, and Larry, but we could have called them Shouter, Listener1, and Listener2 (or even User1, User2, and User3).</p>
</div>
<div class="paragraph">
<p>We find that using <em>persona</em> (where the name gives an indication of the person&#8217;s purpose in the scenario) can be a useful way of conveying information, without cluttering up the scenario. If the names conveyed no information at all, they would not contribute to the readability of the scenario, and could be considered incidental.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_pieces_of_information_are_incidental_in_this_scenario">Which pieces of information are incidental in this scenario?</h5>
<div class="paragraph">
<p>Rule: Offer is only valid for Shouty users
  Scenario: Customer is not a Shouty user
    Given Nora is not a Shouty user
    And Sean shouted "free bagels until midday"
    When Nora orders a bagel and a coffee at 11:00am
    Then she should be charged 75¢ for the bagel</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nora is not a Shouty user</p>
</li>
<li>
<p>Sean is offering "free bagels!"</p>
</li>
<li>
<p>Sean&#8217;s offer is only valid until midday&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora orders a bagel</p>
</li>
<li>
<p>Nora orders a coffee&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora places her order at 11:00am&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Nora gets charged for the bagel</p>
</li>
<li>
<p>Nora get charged 75¢ for the bagel&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
This scenario is illustrating the rule that the "offer is only valid for Shouty users". It&#8217;s therefore essential to know that Nora is not a Shouty user, because this means that she is not eligible for the offer.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t need to know that Nora orders a coffee, because that has no relevance to the rule. Nor do we need to know when the offer expires, when Nora places the order, or how much she will be charged&#8201;&#8212;&#8201;there will be other rules (and other scenarios) that illustrate that behaviour.</p>
</div>
<div class="paragraph">
<p>Although it&#8217;s incidental that the offer is for bagels, it is necessary to illustrate that Nora has ordered the item that is on offer to Shouty users&#8201;&#8212;&#8201;and that she will be charged for that item. We use "bagels" as an example to make the scenario easier to read, not because there&#8217;s something inherently special about bagels!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_refactoring_to_data_tables">5.3. Refactoring to Data Tables</h3>
<div class="paragraph">
<p>Let&#8217;s look at the two scenarios that illustrate the rule about range again <a href="#shot-433" id="shot-433" title="show the range rule &amp; scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: show the range rule &amp; scenarios</a>. Notice how the steps <a href="#shot-434" id="shot-434" title="compare the two scenarios" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: compare the two scenarios</a> that create the Sean, Lucy, and Larry are very similar.</p>
</div>
<div class="paragraph">
<p>When we see steps like this, Gherkin’s Given When Then syntax starts to feel a bit clunky. Imagine if we could just write out a table, like this:</p>
</div>
<div class="paragraph">
<p><a href="#shot-435" id="shot-435" title="feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: feature file</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span> <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span> <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Lucy</span> <span class="p">|</span> <span class="n">50</span>       <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, we’re in luck. You can!</p>
</div>
<div class="paragraph">
<p>Gherkin has a special syntax called Data Tables, that allows you to specify tabular data for a step, using pipe characters to mark the boundary between cells.</p>
</div>
<div class="paragraph">
<p><a href="#shot-436" id="shot-436" title="run cucumber, copy snippet, paste into StepDefinition.java" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4: run cucumber, copy snippet, paste into StepDefinition.java</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the step definition implicitly takes a single argument <a href="#shot-437" id="shot-437" title="highlight stepdef parameters" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5: highlight stepdef parameters</a>, which as this comment explains is a DataTable. This object has a rich API for using the tabular data.</p>
</div>
<div class="paragraph">
<p>At its most basic, the table is just a two-dimensional array. So, Lucy&#8217;s location can be accessed <a href="#shot-438" id="shot-438" title="Print out a single cell value" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6: Print out a single cell value</a> by getting the value from array cell (2, 1)</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-439" id="shot-439" title="run Cucumber, highlight 'Lucy&#8217;s location'" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7: run Cucumber, highlight 'Lucy&#8217;s location'</a></p>
</div>
<div class="paragraph">
<p>You can also turn the table into a List of Maps <a href="#shot-440" id="shot-440" title="Print out data table" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: Print out data table</a>, where the first row is used for the map keys, and each following row is used for the map values.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">hashes</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-441" id="shot-441" title="run Cucumber, highlight data table output" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9: run Cucumber, highlight data table output</a></p>
</div>
<div class="paragraph">
<p>Now we can easily iterate <a href="#shot-442" id="shot-442" title="write the loop" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: write the loop</a> over these maps and turn them into instances of Person:</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dataTable</span><span class="p">.</span><span class="nx">hashes</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">person</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">person</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-443" id="shot-443" title="run cucumber&#8201;&#8212;&#8201;all green" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11: run cucumber&#8201;&#8212;&#8201;all green</a></p>
</div>
<div class="paragraph">
<p>With that done, we can update the other scenario <a href="#shot-444" id="shot-444" title="update other scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12: update other scenario</a> &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>  <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span>  <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Larry</span> <span class="p">|</span> <span class="n">150</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>and delete our old step definition <a href="#shot-445" id="shot-445" title="delete unused step def" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 13: delete unused step def</a>, which is now unused.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">a person named {word} is located at {int}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-446" id="shot-446" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 14: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Cucumber strips all the white space surrounding each cell <a href="#shot-447" id="shot-447" title="show lining up of pipe characters" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 15: show lining up of pipe characters</a>, so we can have a nice neat table in the Gherkin but still get clean values in the step definition underneath.</p>
</div>
<div class="paragraph">
<p>Notice we’ve still had to convert the location from a string to an integer <a href="#shot-448" id="shot-448" title="Conversion in step def" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 16: Conversion in step def</a>, because Cucumber can’t know that’s the type of value in our table.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">people are located at</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataTable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dataTable</span><span class="p">.</span><span class="nx">hashes</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">person</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">person</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That looks much nicer - <a href="#shot-449" id="shot-449" title="hear_shout.feature data tables" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 20: hear_shout.feature data tables</a> people positioned using a table in the feature file and <a href="#shot-450" id="shot-450" title="people_are_located_at()" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 21: people_are_located_at()</a> really clean code that creates and positions people according to the data.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>  <span class="p">|</span> <span class="nv">location</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">Sean</span>  <span class="p">|</span> <span class="n">0</span>        <span class="p">|</span>
        <span class="p">|</span> <span class="n">Larry</span> <span class="p">|</span> <span class="n">150</span>       <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lesson_3_questions_2">5.3.1. Lesson 3 - Questions</h4>
<div class="sect4">
<h5 id="_what_is_the_name_of_the_gherkin_syntax_that_allows_you_to_specify_pipe_separated_tabular_data_for_a_step">What is the name of the Gherkin syntax that allows you to specify pipe-separated, tabular data for a step?</h5>
<div class="ulist">
<ul>
<li>
<p>Array</p>
</li>
<li>
<p>Data Matrix</p>
</li>
<li>
<p>Data Table&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Example Table</p>
</li>
<li>
<p>Table</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The Gherkin syntax is called a Data Table. It represents a 2-dimensional array, with cell boundaries indicated by pipe characters <code>|</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_value_would_be_retieved_from_cell_1_2_in_the_following_table">What value would be retieved from cell (1, 2) in the following table?</h5>
<div class="paragraph">
<p>| 0 | 1 | 2 |
| 3 | 4 | 5 |
| 6 | 7 | 8 |</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0</p>
</li>
<li>
<p>1</p>
</li>
<li>
<p>2</p>
</li>
<li>
<p>3</p>
</li>
<li>
<p>4</p>
</li>
<li>
<p>5&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>6</p>
</li>
<li>
<p>7</p>
</li>
<li>
<p>8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The data table is indexed, starting from 0. The first coordinate indicates which <em>row</em> to access, the second indicates the <em>column</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_answers_correctly_shows_how_cucumber_will_convert_the_following_data_table_into_a_list_of_maps_list_mapstring_string">Which of the answers correctly shows how Cucumber will convert the following data table into a list of maps: List&lt; Map&lt;String, String&gt; &gt; ?</h5>
<div class="paragraph">
<p>| A | B | C |
| D | 0 | 1 |
| E | 2 | 3 |</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[{A=A, B=B, C=C}, {A=D, B=0, C=1}, {A=E, B=2, C=3}]</p>
</li>
<li>
<p>[{A=D, B=2, C=1}, {A=E, B=0, C=3}]</p>
</li>
<li>
<p>[{A=B, D=0, E=2}, {A=C, D=1, E=3}]</p>
</li>
<li>
<p>[{A=D, B=0, C=1}, {A=E, B=2, C=3}]&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When Cucumber converts a Data Table into a list of maps, it treats the first row as the labels (or indexes), and each subsequent row provides the values for the next map within the list.</p>
</div>
<div class="paragraph">
<p>So, in this example, since there are three rows, we end up with two maps in the list&#8201;&#8212;&#8201;the first row providing the indexes into each map, the next two rows providing the values for the two maps that are added to the list.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_data_tables_will_this_method_process_successfully">Which of the following Data Tables will this method process successfully?</h5>
<div class="paragraph">
<p>@DataTableType
public OrderLine createOrderLine(Map&lt;String, String&gt; orderItem) {
    return new OrderLine(entry.get("Item Name"), Integer.parseInt(entry.get("Quantity")));
}</p>
</div>
<div class="ulist">
<ul>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| name            | quantity |
| Cheese &amp; tomato | 1        |</p>
</li>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Item Name       | Quantity |&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>| Item Name       | Quantity | Notes        |&#8201;&#8212;&#8201;TRUE
| Cheese &amp; tomato | 1        | Extra cheese |</p>
</li>
<li>
<p>| Cheese &amp; tomato | 1        |
| Pepperoni       | 1        |</p>
</li>
<li>
<p>| Quantity | Item Name       | &#8201;&#8212;&#8201;TRUE
| 1        | Cheese &amp; tomato |</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Cucumber attempts to convert each non-header row in the data table into an instance of OrderLine by calling this method. For the conversion to succeed, the header cell text must match the hard coded index strings used in the method exactly. The order of the columns is not significant and any extra columns are ignored. A Data Table with only a header row would be considered an empty table and createOrderLine() would not be called and the relavent step definition would be passed an empty list of OrderLine objects.</p>
</div>
<div class="paragraph">
<p>There is more documentation about Data Table conversions at <a href="https://github.com/cucumber/cucumber/tree/master/datatable" class="bare">https://github.com/cucumber/cucumber/tree/master/datatable</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deeper_into_data_tables">5.4. Deeper into Data Tables</h3>
<div class="paragraph">
<p><a href="#shot-451" id="shot-451" title="open feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: open feature file</a></p>
</div>
<div class="paragraph">
<p>The way that we’ve specified this data is OK, but your product owner would prefer you to express it like this instead:</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Listener is within range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Lucy</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">50</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Lucy should hear a shout

    <span class="kn">Scenario</span><span class="p">:</span> Listener is out of range
      <span class="nf">Given </span>the range is 100
      <span class="nf">And </span>people are located at
        <span class="p">|</span> <span class="nv">name</span>     <span class="p">|</span> <span class="nv">Sean</span> <span class="p">|</span> <span class="nv">Larry</span> <span class="p">|</span>
        <span class="p">|</span> <span class="n">location</span> <span class="p">|</span>  <span class="n">0</span>   <span class="p">|</span> <span class="n">150</span>   <span class="p">|</span>
      <span class="nf">When </span>Sean shouts
      <span class="nf">Then </span>Larry should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s always good to please the product owner, but you’re worried how we’ll handle it in our step definition? Fear not. Cucumber has you covered.</p>
</div>
<div class="paragraph">
<p>If you call the <code>transpose</code> method on the table <a href="#shot-452" id="shot-452" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2</a>, Cucumber will turn each row into a column before passing it to the step definition.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">dataTable</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">hashes</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">person</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-453" id="shot-453" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Data tables are very useful for setting up data in Given steps, but you can also use them for specifying outcomes.</p>
</div>
<div class="paragraph">
<p>One rule that we’ve been implying but have never actually explored with an example is that people can hear more than one shout. So far we’ve only specified a single message, so let’s try writing a scenario where Sean shouts more than once:</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span> <span class="err">Listener</span> <span class="err">should</span> <span class="err">be</span> <span class="err">able</span> <span class="err">to</span> <span class="err">hear</span> <span class="err">multiple</span> <span class="err">shouts</span>

    <span class="kn">Scenario</span><span class="p">:</span> Two shouts
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"Free bagels!"</span>
      <span class="nf">And </span>Sean shouts <span class="s">"Free toast!"</span>
      <span class="err">Then Lucy hears the following messages</span><span class="p">:</span>
        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels</span>  <span class="p">|</span>
        <span class="p">|</span> <span class="n">Free</span> <span class="n">toast</span>   <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See how natural it is to use a Data Table here? We also haven’t used any column headers in this case, since the data is all in a single column anyway.</p>
</div>
<div class="paragraph">
<p>So how do we implement this step definition? Well, the DataTable has a really handy method called diff that we can use to compare two Data Tables. diff will pass if the tables are the same, and fail if they’re different.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s run Cucumber to generate the new step definition <a href="#shot-454" id="shot-454" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4</a> and paste it into our StepDefinitions class <a href="#shot-455" id="shot-455" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5</a></p>
</div>
<div class="paragraph">
<p>So we need the actual messages that Lucy’s heard to be stored in an object that looks like a DataTable, so we can compare it to the ones we expect.</p>
</div>
<div class="paragraph">
<p>A List of List of String will do <a href="#shot-456" id="shot-456" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a>, so we can just iterate over Lucy’s messages and create a new single-item List for each row.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="kd">let</span> <span class="nx">actualMessages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">message</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can pass that list to the diff method <a href="#shot-457" id="shot-457" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7</a> on the table of expected messages passed in from the Gherkin.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">actualMessages</span><span class="p">,</span> <span class="nx">expectedMessages</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-458" id="shot-458" title="runs cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: runs cucumber</a></p>
</div>
<div class="paragraph">
<p>Oops! It looks like we made a typo in our scenario. We should have included exclamation marks on the expected messages. Well, at least this gives you a chance to see the nice diff output from Cucumber when the tables are different. We see the expected values prefixed with a minus, and the actual values prefixed with a plus.</p>
</div>
<div class="paragraph">
<p>Let’s fix just one of these <a href="#shot-459" id="shot-459" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9</a> so you can see how the diff output changes.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">bagels!</span> <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-460" id="shot-460" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: run cucumber</a>
The matching bagels! line no longer has a minus, and for the mismatched row, the actual value still has a minus, and the expected value has a plus.</p>
</div>
<div class="paragraph">
<p>Let’s fix this last typo <a href="#shot-461" id="shot-461" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11</a>, and we should be green again.</p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">        <span class="p">|</span> <span class="nv">Free</span> <span class="nv">toast!</span>  <span class="p">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-462" id="shot-462" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12: run cucumber</a></p>
</div>
<div class="paragraph">
<p>Great.</p>
</div>
<div class="sect3">
<h4 id="_lesson_4_questions_3">5.4.1. Lesson 4 - Questions</h4>
<div class="sect4">
<h5 id="_why_might_you_use_the_transpose_annotation">Why might you use the @Transpose annotation?</h5>
<div class="ulist">
<ul>
<li>
<p>Transpose has been deprecated and you should not use it</p>
</li>
<li>
<p>Use it if it is more readable to have the headers in the first column&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Use it to ensure that every row in the data table has the same number of columns</p>
</li>
<li>
<p>Use it to reverse the order of the data rows in the table</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The @Transpose annotation (and the transpose method on DataTable) allows you to use tables that have their headers in the first column of a table.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_method_on_datatable_compares_two_datatables_and_produces_a_textual_output_showing_their_differences">What method on DataTable compares two DataTables and produces a textual output showing their differences?</h5>
<div class="ulist">
<ul>
<li>
<p>compare</p>
</li>
<li>
<p>difference</p>
</li>
<li>
<p>contrast</p>
</li>
<li>
<p>diff&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>covariance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The method that compares two data tables is called <strong>diff</strong></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docstring">5.5. DocString</h3>
<div class="paragraph">
<p>When writing scenarios, occasionally we want to use a really long piece of data. <a href="#shot-463" id="shot-463" title="Show feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 0: Show feature file</a></p>
</div>
<div class="paragraph">
<p>For example, let’s introduce a new rule about the maximum length of a message <a href="#shot-464" id="shot-464" title="New rule" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: New rule</a></p>
</div>
<div class="listingblock">
<div class="title">hear_shout.feature</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">  <span class="err">Rule</span><span class="p">:</span>  <span class="err">Maximum</span> <span class="err">length</span> <span class="err">of</span> <span class="err">message</span> <span class="err">is</span> <span class="err">180</span> <span class="err">characters</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and add a scenario to illustrate it <a href="#shot-465" id="shot-465" title="New scenario" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 2: New scenario</a>, making the string just over the boundary of the rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Message is too long
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts <span class="s">"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890x"</span>
      <span class="nf">Then </span>Lucy should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s pretty ugly isn’t it!</p>
</div>
<div class="paragraph">
<p>Still, we’ll press on and get it to green, then we’ll show you how to clean it up.</p>
</div>
<div class="paragraph">
<p><a href="#shot-466" id="shot-466" title="run Cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 3: run Cucumber</a> Our existing step definition handles that ugly step with the long message just fine, but the last outcome step is undefined. We could either add a new step definition, or paramterise "Larry should not hear a shout". Let&#8217;s modify the existing step definition <a href="#shot-467" id="shot-467" title="Modify stepdef" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 4: Modify stepdef</a></p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should not hear a shout</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">length</span><span class="p">,</span> <span class="nx">is</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-468" id="shot-468" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5: run cucumber</a></p>
</div>
<div class="paragraph">
<p>OK, so we have a failing acceptance test. Let’s dive down into our solution and implement this new rule. It seems like the Network should be responsible for implementing this rule, so let’s go to its unit tests <a href="#shot-469" id="shot-469" title="show NetworkTest" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5a: show NetworkTest</a> and add a new example to specify this extra responsibility. <a href="#shot-470" id="shot-470" title="start creating new unit test" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 5b: start creating new unit test</a></p>
</div>
<div class="paragraph">
<p>We’ll create a 181-character message like this <a href="#shot-471" id="shot-471" title="" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 6</a> and then assert that the message should not be heard when it’s broadcast.</p>
</div>
<div class="listingblock">
<div class="title">network.test.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">  <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s run that test <a href="#shot-472" id="shot-472" title="run Cucumber - show the unit test results" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 7: run Cucumber - show the unit test results</a>. Good, it fails. Lucy’s still getting the message at the moment. Now how are we going to implement this?</p>
</div>
<div class="paragraph">
<p>It looks like we’re already implementing the proximity rule here <a href="#shot-473" id="shot-473" title="Network proximity logic" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8: Network proximity logic</a> in the broadcast method. Let’s add another if statement here about the message length. <a href="#shot-474" id="shot-474" title="add message length logic" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 8a: add message length logic</a></p>
</div>
<div class="listingblock">
<div class="title">shouty.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">        <span class="k">if</span><span class="p">(</span> <span class="nx">message</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">listener</span><span class="p">.</span><span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#shot-475" id="shot-475" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9: run cucumber</a> Run the unit test again… and it’s passing. Great.</p>
</div>
<div class="paragraph">
<p>The code here has got a little bit messy and hard to read. <a href="#shot-476" id="shot-476" title="show the modified logic in the Network class" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9a: show the modified logic in the Network class</a>
One very basic move we could make to improve it would be to just extract a couple of temporary variables. <a href="#shot-477" id="shot-477" title="extract temporary variables" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 9b: extract temporary variables</a></p>
</div>
<div class="listingblock">
<div class="title">shouty.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js">    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">listener</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">withinRange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">location</span> <span class="o">-</span> <span class="nx">shouter_location</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span>
      <span class="kd">let</span> <span class="nx">shortEnough</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">100</span>

      <span class="k">if</span><span class="p">(</span> <span class="nx">withinRange</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">shortEnough</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">listener</span><span class="p">.</span><span class="nx">hear</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s better. This code could be improved even further of course, but at least we haven’t made it any worse.</p>
</div>
<div class="paragraph">
<p>Let’s just run the tests to check. <a href="#shot-478" id="shot-478" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10: run cucumber</a> Great - everything’s still green.</p>
</div>
<div class="paragraph">
<p>Now we have everything passing again, we can tidy up the Gherkin to use a new piece of syntax we’ve been wanting to tell you about: a DocString. <a href="#shot-479" id="shot-479" title="show message length scenario in feature file" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10a: show message length scenario in feature file</a></p>
</div>
<div class="paragraph">
<p>DocStrings allow you to specify a text argument for a step that spans over multiple lines. We could change our step to look like this instead: <a href="#shot-480" id="shot-480" title="convert message to DocString" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10b: convert message to DocString</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin">    <span class="kn">Scenario</span><span class="p">:</span> Message is too long
      <span class="nf">Given </span>a person named Sean
      <span class="nf">And </span>a person named Lucy
      <span class="nf">When </span>Sean shouts the following message
        <span class="s">"""
        This is a really long message
        so long in fact that I am not going to
        be allowed to send it, at least if I keep
        typing like this until the length is over
        the limit of 180 characters.
        """</span>
      <span class="nf">Then </span>Lucy should not hear a shout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the scenario is much more readable. <a href="#shot-481" id="shot-481" title="show existing stepdef code" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 10c: show existing stepdef code</a></p>
</div>
<div class="paragraph">
<p>We have to add a new step definition too <a href="#shot-482" id="shot-482" title="sean_shouts_the_following_message" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 11: sean_shouts_the_following_message</a>. It doesn&#8217;t need a parameter in the Cucumber Expression&#8201;&#8212;&#8201;the DocString gets passed as a string argument to the step definition automatically.</p>
</div>
<div class="listingblock">
<div class="title">steps.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">Lucy hears the following messages:</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expectedMessages</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">actualMessages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">].</span><span class="nx">messagesHeard</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">message</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">message</span><span class="p">])</span>

  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">actualMessages</span><span class="p">,</span> <span class="nx">expectedMessages</span><span class="p">.</span><span class="nx">raw</span><span class="p">())</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s check that we&#8217;re still green <a href="#shot-483" id="shot-483" title="run cucumber" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 12: run cucumber</a>&#8201;&#8212;&#8201;and we are!</p>
</div>
<div class="paragraph">
<p>We don’t use DocStrings very often - having such a lot of data in a test can often make it quite brittle. But when you do need it, it&#8217;s useful to know about.</p>
</div>
<div class="sect3">
<h4 id="_lesson_5_questions_3">5.5.1. Lesson 5 - Questions</h4>
<div class="sect4">
<h5 id="_we_start_implementing_the_maximummessage_length_rule_by_writing_a_scenario_and_seeing_it_fail_what_did_we_do_next">We start implementing the maximummessage length rule by writing a scenario and seeing it fail. What did we do next?</h5>
<div class="ulist">
<ul>
<li>
<p>Write another scenario to triangulate the new behaviour of the Network class</p>
</li>
<li>
<p>Implement the changed behaviour in the Network class</p>
</li>
<li>
<p>Add a new unit test to NetworkTest that specifies the change in behaviour of the Network class&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
We wrote a new unit test in NetworkTest. We&#8217;ll talk more about this in the next lesson.</p>
</div>
</div>
<div class="sect4">
<h5 id="_why_would_we_use_a_docstring">Why would we use a DocString?</h5>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s the only way to include multi-line strings in a scenarios</p>
</li>
<li>
<p>It&#8217;s a readable way to include long strings in a scenario&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>DocStrings support multiple languages</p>
</li>
<li>
<p>Cucumber provides a DocString type that provides useful string manipulation features</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The DocString is Gherkin syntax that allows long strings to be readably represented in a scenario.</p>
</div>
<div class="paragraph">
<p>All the magic happens when the DocString is read from the Gherkin. The content of the DocString gets passed to the step definition as a normal String&#8201;&#8212;&#8201;there&#8217;s no corresponding Cucumber type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_which_of_the_following_snippets_of_code_are_correct_for_the_step_below">Which of the following snippets of code are correct for the step below?</h5>
<div class="literalblock">
<div class="content">
<pre>Then Simone says
"""
Now on that limb there was a branch
A rare branch and a rattlin' branch
And the branch on the limb
And the limb on the tree
And the tree in the bog
And the bog down in the valley-o
"""</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>@Then("Simone says")
public void simone_says() { }</p>
</li>
<li>
<p>@Then("Simone says")
public void simone_says(String lyrics) { }&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>@Then("Simone says {string}")
public void simone_says(String lyrics) { }</p>
</li>
<li>
<p>@Then("Simone says {docstring}")
public void simone_says(String lyrics) { }</p>
</li>
<li>
<p>@Then("Simone says {docstring}")
public void simone_says(DocString lyrics) { }</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
When using a DocString in a scenario, you do not add any parameter to the matching Cucumber Expression. You do need to provide a String parameter to the step definition to receive the contents of the DocString.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tdd_loops">5.6. TDD Loops</h3>
<div class="paragraph">
<p><a href="#shot-484" id="shot-484" title="original animation" style="border-radius: 10px; padding: 2px 5px 2px 5px; color: white; font-weight: bold; background-color: red; font-family: sans-serif; text-decoration: none;">Shot 1: original animation</a></p>
</div>
<div class="paragraph">
<p>You might have noticed that we’ve followed a pattern when we added behaviour to the system during this episode.</p>
</div>
<div class="paragraph">
<p>First we expressed the behaviour we wanted in a Gherkin scenario, wired up the step definitions, then ran Cucumber to watch it fail.</p>
</div>
<div class="paragraph">
<p>Then, we found the first class in our domain model that needed to change in order to support that new behaviour. In this case, the Network class. We used a unit test to describe how we wanted instances of that class to behave. Then we ran the unit test and watched it fail.</p>
</div>
<div class="paragraph">
<p>We focused in and made changes to the class until its unit tests were passing. When the unit tests were passing, we then made some minor changes to clean up the code and make it more readable. This is the basic test-driven-development cycle: red, green, clean.</p>
</div>
<div class="paragraph">
<p>The technical name for this last clean-up step is refactoring. Refactoring is an ugly name for an extremely valuable activity: improving the design of existing code without changing its behaviour. You can think about it like cleaning up and washing the dishes after you’ve prepared a meal: basic housekeeping. But imagine the state of your kitchen if you never made time to do the dishes.</p>
</div>
<div class="paragraph">
<p>Go on, imagine it for a second.</p>
</div>
<div class="paragraph">
<p>Yuck!</p>
</div>
<div class="paragraph">
<p>Well, that’s how many, many codebase end up. The good thing about taking this course is that we’re teaching you how to write solid automated tests, and the good thing about having solid automated tests is you can refactor with confidence, knowing that if you accidentally change the system’s behaviour, your tests will tell you.</p>
</div>
<div class="paragraph">
<p>Once we’re done refactoring, what do we do next? Run Cucumber, of course! In this case, our scenario was passing with a single trip round the inner TDD loop, but sometimes you can spend several hours working through all the unit tests you need to get a single scenario to green.</p>
</div>
<div class="paragraph">
<p>Once the acceptance test is passing, we figure out the next most valuable scenario on our todo list, and start the whole thing all over again!</p>
</div>
<div class="paragraph">
<p>Together, these two loops make the BDD cycle. The outer loop, which starts with an acceptance test, keeps us focussed on what the business needs us to do next. The inner loop, where we continuously test, implement then refactor small units of code, is where decide how we’ll implement that behaviour.</p>
</div>
<div class="paragraph">
<p>Both of these levels of feedback are important. It’s sometimes said that your acceptance tests ensure you’re building the right thing, and your unit tests ensure you’re building the thing right.</p>
</div>
<div class="paragraph">
<p>That’s all for this chapter of Cucumber School. See you next time!</p>
</div>
<div class="sect3">
<h4 id="_lesson_6_questions_2">5.6.1. Lesson 6 - Questions</h4>
<div class="sect4">
<h5 id="_which_of_the_following_is_the_best_definition_of_the_term_refactoring">Which of the following is the best definition of the term "refactoring"?</h5>
<div class="ulist">
<ul>
<li>
<p>Improving the efficiency of the code without changing its behaviour</p>
</li>
<li>
<p>Adding new functionality to the application</p>
</li>
<li>
<p>Changing the behaviour of the code</p>
</li>
<li>
<p>Tidying up the code without changing its behaviour&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>Rearchitecting the code to get ready for adding new functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
The definition of refactoring is: improve the design (of some code) without changing its behaviour.</p>
</div>
</div>
<div class="sect4">
<h5 id="_when_can_refactoring_happen">When can refactoring happen?</h5>
<div class="ulist">
<ul>
<li>
<p>When a refactoring story gets prioritised by the Product Owner</p>
</li>
<li>
<p>Whenever all tests are green&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>When at least one test is failing</p>
</li>
<li>
<p>First thing in the morning</p>
</li>
<li>
<p>Before committing code to source control</p>
</li>
<li>
<p>At the end of an iteration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Refactoring is part of the day-to-day work of every software developer. It&#8217;s when they tidy up the code once they&#8217;ve got it working.</p>
</div>
<div class="paragraph">
<p>Since part of the definition of refactoring is that it shouldn&#8217;t change the behaviour of the code, they will run the tests to make sure nothing was broken. Which means that the tests MUST be passing BEFORE they start refactoring. Otherwise, how can they be sure that the behaviour hasn&#8217;t changed?</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_are_the_acceptance_test_and_unit_test_related">How are the acceptance test and unit test related?</h5>
<div class="ulist">
<ul>
<li>
<p>Acceptance tests ensure we "build the right thing"; unit tests ensure we "build the thing right"&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>An acceptance test should be passing before we start writing unit tests</p>
</li>
<li>
<p>We may write many unit tests before the currently failing acceptance test passes&#8201;&#8212;&#8201;TRUE</p>
</li>
<li>
<p>All unit tests should be passing before we write an acceptance test</p>
</li>
<li>
<p>BDD consists of two loops: an outer acceptance test loop and an inner unit test loop&#8201;&#8212;&#8201;TRUE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explanation:
Once we have a scenario, we automate it&#8201;&#8212;&#8201;and we expect it to fail, because we haven&#8217;t added the functionality it specifies to the system yet. This is the beginning of the outer, acceptance test loop, that ensures we&#8217;re building what the Product Owner wants: "build the right thing."</p>
</div>
<div class="paragraph">
<p>We then enter the inner, unit test loop. It&#8217;s unit tests that define the precise behaviour of small units of code&#8201;&#8212;&#8201;and ensure that we "build the thing right." They give us the safety to improve the code&#8217;s design (refactor), because they will fail if we accidentally change the code&#8217;s behaviour while refactoring. We may have to go round the inner loop a number of times, adding several unit tests, before we&#8217;ve added enought functionality to make the outer acceptance test pass.</p>
</div>
<div class="paragraph">
<p>And then we write the next failing acceptance test&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Unresolved directive in scripts.js.adoc - include::06/index.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-07-27 10:45:38 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>